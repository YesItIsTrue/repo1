<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
    <META NAME="AUTHOR" CONTENT="Trae Luttrell">
    <META NAME='VERSION' CONTENT='1.0'>
    <META NAME='COPYRIGHT' CONTENT='Solsource'>
    <META NAME='CREATE_DATE' CONTENT="12/Dec/2016">
    <META NAME='LAST_UPDATED' CONTENT="12/Dec/2016">   
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" type="text/css" href="http://www.w3schools.com/lib/w3.css"> 
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> 

<SCRIPT LANGUAGE="SpeedScript">
CREATE WIDGET-POOL.   
</SCRIPT>

<style type="text/CSS">
.w3-theme-l5 {color:#000 !important; background-color:#eff8fe !important}
.w3-theme-l4 {color:#000 !important; background-color:#cae8fd !important}
.w3-theme-l3 {color:#000 !important; background-color:#95d0fb !important}
.w3-theme-l2 {color:#000 !important; background-color:#60b9f8 !important}
.w3-theme-l1 {color:#fff !important; background-color:#2ba2f6 !important}
.w3-theme-d1 {color:#fff !important; background-color:#087acb !important}
.w3-theme-d2 {color:#fff !important; background-color:#086cb4 !important}
.w3-theme-d3 {color:#fff !important; background-color:#075f9e !important}
.w3-theme-d4 {color:#fff !important; background-color:#065187 !important}
.w3-theme-d5 {color:#fff !important; background-color:#054471 !important}

.w3-theme-light {color:#000 !important; background-color:#eff8fe !important}
.w3-theme-dark {color:#fff !important; background-color:#054471 !important}
.w3-theme-action {color:#fff !important; background-color:#054471 !important}

.w3-theme {color:#fff !important; background-color:#0987e0 !important}
.w3-text-theme {color:#0987e0 !important}
.w3-border-theme {border-color:#0987e0 !important}

.w3-hover-theme:hover {color:#fff !important; background-color:#0987e0 !important}
.w3-hover-text-theme {color:#0987e0 !important}
.w3-hover-border-theme:hover {border-color:#0987e0 !important}
</style>

<style>
.w3-yellow,.w3-hover-yellow:hover{color:#000!important;background-color:#FFEF6C!important}
</style>

<script language="javascript">

function w3_open() {
    document.getElementById("mySidenav").style.display = "block";
    document.getElementById("mySidenav").style.width = "1000px";
    document.getElementById("myOverlay").style.display = "block";
}

</script>

<script language="javascript">

function w3_close() {
    document.getElementById("mySidenav").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}
</script>

<script language="javascript">

function myAccFunc(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
        x.previousElementSibling.className += " w3-theme-dark";
    } else { 
        x.className = x.className.replace(" w3-show", "");
        x.previousElementSibling.className = 
        x.previousElementSibling.className.replace(" w3-theme-dark", "");
    }
}

</script>
</HEAD>

<BODY>
<SCRIPT LANGUAGE="SpeedScript">
  /*------------------------------------------------------------------
    File:
    Description:
    Created:
  -------------------------------------------------------------------*/

/**********************  Variable Definitions  **************************/
DEFINE VARIABLE x               AS INTEGER                  NO-UNDO.
DEFINE VARIABLE y               AS INTEGER                  NO-UNDO.
DEFINE VARIABLE act             AS CHARACTER                NO-UNDO.
DEFINE VARIABLE itmessage       AS LOGICAL INITIAL NO       NO-UNDO.
DEFINE VARIABLE v-site      LIKE qoh_det.qoh_site       NO-UNDO.
DEFINE VARIABLE v-warehouse LIKE qoh_det.qoh_warehouse  NO-UNDO.
DEFINE VARIABLE v-loc       LIKE qoh_det.qoh_loc        NO-UNDO.
DEFINE VARIABLE v-to-site           LIKE qoh_det.qoh_site       NO-UNDO.
DEFINE VARIABLE v-to-warehouse      LIKE qoh_det.qoh_warehouse  NO-UNDO.
DEFINE VARIABLE v-to-loc            LIKE qoh_det.qoh_loc        NO-UNDO.
DEFINE VARIABLE v-item_nbr      LIKE qoh_det.qoh_item_nbr   NO-UNDO.
DEFINE VARIABLE v-lot           LIKE qoh_det.qoh_lot        NO-UNDO.
DEFINE VARIABLE v-serial        LIKE qoh_det.qoh_serial     NO-UNDO.
DEFINE VARIABLE v-orig-quantity LIKE qoh_det.qoh_quantity   NO-UNDO.
DEFINE VARIABLE v-quantity      LIKE qoh_det.qoh_quantity   NO-UNDO.
DEFINE VARIABLE v-merge-quantity LIKE qoh_det.qoh_quantity  NO-UNDO.
DEFINE VARIABLE v-status        LIKE qoh_det.qoh_status     NO-UNDO.
DEFINE VARIABLE v-avail         LIKE qoh_det.qoh_avail      NO-UNDO.
DEFINE VARIABLE v-expire_date   LIKE qoh_det.qoh_expire_date NO-UNDO.
DEFINE VARIABLE c-loc-list      AS INTEGER                  NO-UNDO.

DEFINE VARIABLE o-from-create    AS LOGICAL                  NO-UNDO.
DEFINE VARIABLE o-from-update    AS LOGICAL                  NO-UNDO.
DEFINE VARIABLE o-from-success   AS LOGICAL                  NO-UNDO.

DEFINE VARIABLE o-to-create    AS LOGICAL                  NO-UNDO.
DEFINE VARIABLE o-to-update    AS LOGICAL                  NO-UNDO.
DEFINE VARIABLE o-to-success   AS LOGICAL                  NO-UNDO.

DEFINE VARIABLE o-ctrh-id       LIKE trh_hist.trh_id        NO-UNDO.
DEFINE VARIABLE o-ctrh-error    AS LOGICAL INITIAL YES      NO-UNDO.
DEFINE VARIABLE o-to-ctrh-id       LIKE trh_hist.trh_id        NO-UNDO.
DEFINE VARIABLE o-to-ctrh-error    AS LOGICAL INITIAL YES      NO-UNDO.
DEFINE VARIABLE v-po_nbr        AS CHARACTER            NO-UNDO.  
            
/**********************  HTML Variable Get-Val's  ***********************/
ASSIGN 
    act         = html-encode(get-value("h-act"))
    v-site      = html-encode(get-value("h-site"))
    v-warehouse = html-encode(get-value("h-warehouse"))
    v-loc       = html-encode(get-value("h-loc"))  
    v-to-site   = html-encode(get-value("h-to-site"))
    v-to-warehouse = html-encode(get-value("h-to-warehouse"))
    v-to-loc    = html-encode(get-value("h-to-loc"))
    v-item_nbr  = html-encode(get-value("h-item_nbr"))
    v-lot       = html-encode(get-value("h-lot"))
    v-serial    = html-encode(get-value("h-serial"))
    v-quantity  = DECIMAL(html-encode(get-value("h-quantity")))
    v-orig-quantity = DECIMAL(html-encode(get-value("h-orig-quantity")))
    v-avail     = IF LOGICAL(html-encode(get-value("h-avail"))) = NO THEN NO ELSE YES
    v-status    = html-encode(get-value("h-status"))
    v-po_nbr    = html-encode(get-value("h-po_nbr"))
    .
    
/**************************  Other Nonsense  ***************************/    
IF act= "" THEN 
    act = "Site".
/**************************  Main Program  ******************************/

{&OUT}
    "<BODY  class='w3-light-grey'>" SKIP.

/******************************************** Start of "Include" **********************************************/
    
DEFINE VARIABLE insidetheinclude-ITshowmsg AS LOG INITIAL NO NO-UNDO.
DEFINE VARIABLE insidetheinclude-localpathing AS LOG INITIAL YES NO-UNDO.    /* change to NO before putting on server */
DEFINE VARIABLE insidetheinclude-v-title-name AS CHARACTER NO-UNDO.
                                                                                                        IF insidetheinclude-ITshowmsg = YES THEN 
                                                                                                            {&OUT} "<P>Begin</P>".
                 
PROCEDURE menuwalk:
 
    DEFINE INPUT PARAMETER insidetheinclude-total-menu LIKE menu_mstr.menu_exprog NO-UNDO.
    
    DEFINE VARIABLE insidetheinclude-menexhold LIKE menu_mstr.menu_exprog NO-UNDO.
    DEFINE VARIABLE insidetheinclude-menunumber LIKE menu_mstr.menu_exprog NO-UNDO.                
    DEFINE VARIABLE insidetheinclude-modulepath AS CHARACTER NO-UNDO.
    DEFINE VARIABLE insidetheinclude-entryfill AS CHARACTER FORMAT "x(16)" NO-UNDO.
    DEFINE VARIABLE insidetheinclude-x AS INTEGER NO-UNDO.                         /** junk counter for menu filling **/
    DEFINE VARIABLE insidetheinclude-j-menu-namer AS CHARACTER NO-UNDO.
                                                                                                                  
    FOR EACH menu_mstr WHERE menu_mstr.menu_num = insidetheinclude-total-menu AND 
            menu_mstr.menu_deleted = ? AND                                                                    /* 3dot3 */
            menu_mstr.menu__log01 = NO NO-LOCK              /* is menu item hidden? */                        /* 3dot3 */
        BY menu_mstr.menu_num BY menu_mstr.menu_sel: 

        ASSIGN 
             insidetheinclude-menexhold   = IF INDEX(menu_mstr.menu_exprog,"?") = 0 THEN 
                              menu_mstr.menu_exprog + "?whattorun=" + menu_mstr.menu_num + "." + string(menu_mstr.menu_sel) 
                           ELSE 
                              menu_mstr.menu_exprog + "&whattorun=" + menu_mstr.menu_num + "." + string(menu_mstr.menu_sel) 
             insidetheinclude-modulepath  = IF menu_mstr.menu_module <> "" AND insidetheinclude-localpathing = YES then
                              "../../" + menu_mstr.menu_module + "/rcode/"
                           ELSE 
                              "".

                                                                                    IF insidetheinclude-ITshowmsg  = YES THEN {&OUT} 
                                                                                        "insidetheinclude-modulepath =" 
                                                                                        insidetheinclude-modulepath " <br> insidetheinclude-menxhold =" 
                                                                                        insidetheinclude-menexhold "<br>".

        IF menu_mstr.menu_exprog < "a" THEN DO:
         
            IF menu_mstr.menu_exprog BEGINS "0." THEN 
                insidetheinclude-menunumber  = SUBSTRING(menu_mstr.menu_exprog,3).
            ELSE 
                insidetheinclude-menunumber  = menu_mstr.menu_exprog.

            ASSIGN insidetheinclude-j-menu-namer = "m-" + menu_mstr.menu_num + STRING(menu_mstr.menu_select).
    
            {&OUT}
                "       <div class='w3-accordion'>" SKIP
                "           <a onclick=~"myAccFunc('" insidetheinclude-j-menu-namer "')~" href='#' class='w3-hover-black'>" menu_mstr.menu_select " - " menu_mstr.menu_title " <i class='fa fa-caret-down'></i></a>" SKIP
                "           <div id='" insidetheinclude-j-menu-namer "' class='w3-accordion-content w3-light-grey w3-card-4'>" SKIP
                .
            
            RUN menuwalk(insidetheinclude-menunumber).
            
            {&OUT}
               "           </div>" SKIP
               "       </div>" SKIP.
                              
        END. /** of if menu_exprog < a ***/

        ELSE DO: 
    
            insidetheinclude-entryfill = menu_mstr.menu_num + "." + STRING(menu_mstr.menu_sel) + " -".
            
                                                                IF insidetheinclude-ITshowmsg = YES THEN 
                                                                    {&OUT} "<P>Pre-fill = " length(insidetheinclude-entryfill) " " insidetheinclude-entryfill "</P>".
            
            DO x = 7 TO LENGTH(menu_mstr.menu_num + "." + STRING(menu_mstr.menu_sel) + " -") BY -1:
                insidetheinclude-entryfill = insidetheinclude-entryfill + "-".
            END.    /* of do x = 8 down to length of menunumber */
            
                                                                IF insidetheinclude-ITshowmsg = YES THEN 
                                                                    {&OUT} "<P>Post-fill = " length(insidetheinclude-entryfill) " " insidetheinclude-entryfill "</P>".

            {&OUT}
                "   <a href='" insidetheinclude-modulepath insidetheinclude-menexhold "'>" menu_mstr.menu_num "." menu_mstr.menu_select " " menu_mstr.menu_title "</a>" SKIP.
                 
        END.  /** of else do **/
                       
    END. /** of 4ea. menu_mstr ***/
                              
END. /** of PROCEDURE menuwalk ***/

FIND FIRST menu_mstr WHERE menu_mstr.menu_exprog = THIS-PROCEDURE:FILE-NAME and
    menu_mstr.menu_deleted <> ? AND 
    menu_mstr.menu__log01 = no
    NO-LOCK NO-ERROR.

IF AVAILABLE (menu_mstr) THEN ASSIGN insidetheinclude-v-title-name = menu_mstr.menu_title.
ELSE ASSIGN insidetheinclude-v-title-name = "InforMatrix".

{&OUT}
/*    "<BODY class='w3-light-grey'>" SKIP(1)*/
    "<div class='w3-container w3-opennav w3-xxlarge w3-theme-dark w3-padding-large w3-margin-bottom' onclick='w3_open()'>&#9776; &nbsp; Inventory Transfer</div>" SKIP
    "   <nav class='w3-large w3-sidenav w3-theme w3-animate-left w3-border-bottom' style='display:none;z-index:5' id='mySidenav'>" SKIP(1)
    "       <a href='javascript:void(0)' onclick='w3_close()' class='w3-closenav w3-large w3-hover-black' >Close Menu &times;</a>" SKIP.

FIND FIRST menu_mstr NO-LOCK NO-ERROR.

RUN menuwalk(MENU_num). 

{&OUT}
    "   </nav>" SKIP
    "<div class='w3-overlay w3-animate-opacity' onclick='w3_close()' style='cursor:pointer' id='myOverlay'></div>" SKIP.
/****************************************************** End of "Include" **********************************/

CASE act:

    WHEN "Site" THEN DO:
    
        {&OUT}
            "<div class='w3-card-4 w3-content w3-white' style='max-width:1700px;'>" SKIP  
            
            "<form>" SKIP
            "   <input type='hidden' name='h-warehouse' value='" v-warehouse "'/>" SKIP
            "   <input type='hidden' name='h-item_nbr' value='" v-item_nbr "'/>" SKIP
            "   <input type='hidden' name='h-quantity' value='" v-quantity "'/>" SKIP
            "   <input type='hidden' name='h-lot' value='" v-lot "'/>" SKIP
            "   <input type='hidden' name='h-serial' value='" v-serial "'/>" SKIP
/*            "   <INPUT type='hidden' name='whattorun' value='" whatshouldrun "' />" SKIP*/
            "<div class='w3-row-padding '>" SKIP
            "   <DIV class='w3-col s12'>" SKIP
            "       <DIV class='w3-text-theme'><b>From Site</b></DIV>" SKIP
            "       <select name='h-site' class='w3-border w3-round w3-select w3-yellow w3-margin-bottom' required>" SKIP.
            
        FOR EACH site_mstr WHERE 
            site_mstr.site_deleted = ? NO-LOCK:
        
            {&OUT} "                <option value'" site_mstr.site_name "'".
        
            IF site_mstr.site_name = v-site THEN {&OUT} " SELECTED ".
        
            {&OUT} ">" site_mstr.site_name "</option>" SKIP.
            
        END. /** 4ea site_mstr **/
            
        {&OUT}
            "            </select>" SKIP
            "   </div>" SKIP
            "</div> " SKIP   
            "</DIV>" SKIP

            "<br>" SKIP
            
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='Warehouse' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Submit</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='site' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Search Again</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "</form>".
        
    END. /** Site **/
    
    WHEN "Warehouse" THEN DO:

        {&OUT}
            "<div class='w3-card-4 w3-content w3-white' style='max-width:1700px;'>" SKIP  
            
            "<form>" SKIP
            "   <input type='hidden' name='h-site' value='" v-site "'/>" SKIP
            "   <input type='hidden' name='h-item_nbr' value='" v-item_nbr "'/>" SKIP
            "   <input type='hidden' name='h-quantity' value='" v-quantity "'/>" SKIP
            "   <input type='hidden' name='h-lot' value='" v-lot "'/>" SKIP
            "   <input type='hidden' name='h-serial' value='" v-serial "'/>" SKIP
            "<div class='w3-row-padding '>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>From Site</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-site' value='" v-site "' disabled />" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <DIV class='w3-text-theme'><b>From Warehouse</b></DIV>" SKIP
            "       <select name='h-warehouse' class='w3-border w3-round w3-select w3-yellow  w3-margin-bottom' required>" SKIP.
            
        FOR EACH site_mstr WHERE 
            site_mstr.site_name = v-site AND 
            site_mstr.site_deleted = ? NO-LOCK,
          EACH warehouse_mstr WHERE 
            warehouse_mstr.warehouse_site = site_mstr.site_name AND 
            warehouse_mstr.warehouse_deleted = ? NO-LOCK:
        
            {&OUT} "                <option value'" warehouse_mstr.warehouse_name "'>" warehouse_mstr.warehouse_name "</option>" SKIP.
            
        END. /** 4ea site_mstr **/
            
        {&OUT}
            "            </select>" SKIP
            "   </div>" SKIP
            "</div> " SKIP   
            "</DIV>" SKIP

            "<br>" SKIP
            
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='Item' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Submit</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='site' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Search Again</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "</form>".
        
    END. /** Warehouse **/

    WHEN "Item" THEN DO: /**** search for an item to transfer ***/
    
                                                                    IF itmessage = YES THEN {&OUT} "act = " act "<br>" SKIP.
 
        {&OUT} 
            "<form>"
            
            "<input type='hidden' name='h-site' value='" v-site "'/>" SKIP
            "<input type='hidden' name='h-warehouse' value='" v-warehouse "'/>" SKIP
            "<INPUT type='hidden' name='whattorun' value='"  "' />" SKIP             
            
/*            "<DIV class='w3-row-padding w3-container w3-theme-dark w3-margin-bottom'><h2 class=''>Mobile Inventory Receipt</h2></TH></div>" SKIP*/

            "<div class='w3-card-4 w3-content w3-white' style='max-width:1700px;'>" SKIP
                
            "<div class='w3-row-padding'> " SKIP 
            "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
            "       <label class='w3-text-theme'><b>From Site</b></label>" SKIP
            "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-site "' disabled></input>" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
            "       <label class='w3-text-theme'><b>From Warehouse</b></label>" SKIP
            "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-warehouse "' disabled></input>" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP
                
            "<div class='w3-row-padding'>      " SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>From Location</b></label>" SKIP
            "       <select name='h-loc' class='ss-scanfield w3-border w3-round w3-select w3-yellow' required>" SKIP.
            
        FOR EACH site_mstr WHERE 
            site_mstr.site_name = v-site AND 
            site_mstr.site_deleted = ? NO-LOCK,
          EACH warehouse_mstr WHERE 
            warehouse_mstr.warehouse_site = site_mstr.site_name AND 
            warehouse_mstr.warehouse_name = v-warehouse AND
            warehouse_mstr.warehouse_deleted = ? NO-LOCK,
          EACH loc_mstr WHERE 
            loc_mstr.loc_site = site_mstr.site_name AND 
            loc_mstr.loc_warehouse = warehouse_mstr.warehouse_name AND 
            loc_mstr.loc_deleted = ? NO-LOCK:
        
            {&OUT} "                <option value'" loc_mstr.loc_name "'>" loc_mstr.loc_name "</option>" SKIP.
            
        END. /** 4ea site_mstr **/
        
        {&OUT}
            "       </select>" SKIP
            "   </div>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Item Number</b></label>" SKIP
            "       <INPUT class='ss-scanfield w3-input w3-yellow w3-border w3-round' type='TEXT' name='h-item_nbr' value='" v-item_nbr "' required ></input>" SKIP
            "   </div>" SKIP
            "</DIV>" SKIP
            
            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme w3-col l6'><b>Lot Number</b></label>" SKIP
            "       <INPUT class='ss-scanfield w3-input w3-border w3-round' type='TEXT' name='h-lot' value='" v-lot "' />" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Serial</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round  w3-margin-bottom' type='TEXT' name='h-serial' value='" v-serial "' />" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP
               
            "</DIV>" SKIP
            "<br>" SKIP
            
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='Validation' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Submit</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='site' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Search Again</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "</form>".
        
            
    END. /** Item Selection **/
    
    WHEN "Validation" THEN DO:
        
        FIND FIRST loc_mstr WHERE 
            loc_mstr.loc_site = v-site AND 
            loc_mstr.loc_warehouse = v-warehouse AND 
            loc_mstr.loc_name = v-loc AND 
            loc_mstr.loc_deleted = ? NO-LOCK NO-ERROR. 
            
        IF AVAILABLE (loc_mstr) THEN DO:
                    
            FIND qoh_det WHERE 
                qoh_det.qoh_site = v-site AND 
                qoh_det.qoh_warehouse = v-warehouse AND 
                qoh_det.qoh_loc = v-loc AND 
                qoh_det.qoh_item_nbr = v-item_nbr AND 
                qoh_det.qoh_lot = v-lot AND
                qoh_det.qoh_serial = v-serial AND 
                qoh_det.qoh_deleted = ? NO-LOCK NO-ERROR. 
    
            IF AVAILABLE (qoh_det) THEN DO:   
    
                ASSIGN v-orig-quantity = qoh_det.qoh_quantity.
    
                {&OUT}
                    "<form>" SKIP
                    "   <input type='hidden' name='h-site' value='" v-site "'/>" SKIP
                    "   <input type='hidden' name='h-warehouse' value='" v-warehouse "'/>" SKIP
                    "   <input type='hidden' name='h-loc' value='" v-loc "'/>" SKIP
                    "   <input type='hidden' name='h-item_nbr' value='" v-item_nbr "'/>" SKIP
                    "   <input type='hidden' name='h-lot' value='" v-lot "'/>" SKIP
                    "   <input type='hidden' name='h-serial' value='" v-serial "'/>" SKIP
                    "   <input type='hidden' name='h-orig-quantity' value='" v-orig-quantity "'/>" SKIP
/*                    "   <INPUT type='hidden' name='whattorun' value='" whatshouldrun "' />" SKIP*/
                    
                    "<div class='w3-card-4 w3-content w3-white' style='max-width:1700px;'>" SKIP
                
                    "<div class='w3-row-padding'> " SKIP 
                    "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
                    "       <label class='w3-text-theme'><b>From Site</b></label>" SKIP
                    "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-site "' disabled></input>" SKIP
                    "   </DIV>" SKIP
                    "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
                    "       <label class='w3-text-theme'><b>From Warehouse</b></label>" SKIP
                    "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-warehouse "' disabled></input>" SKIP
                    "   </DIV>" SKIP
                    "</div>" SKIP
                        
                    "<div class='w3-row-padding'>      " SKIP
                    "   <DIV class='w3-col l6'>" SKIP
                    "       <label class='w3-text-theme'><b>From Location</b></label>" SKIP
                    "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-loc' value='" v-loc "' disabled></input>" SKIP 
                    "   </div>" SKIP
                    "   <DIV class='w3-col l6'>" SKIP
                    "       <label class='w3-text-theme'><b>Item Number</b></label>" SKIP
                    "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-item_nbr' value='" v-item_nbr "' disabled></input>" SKIP
                    "   </div>" SKIP
                    "</DIV>" SKIP
            
                    "<div class='w3-row-padding'>" SKIP
                    "   <DIV class='w3-col l6'>" SKIP
                    "       <label class='w3-text-theme w3-col l6'><b>Lot Number</b></label>" SKIP
                    "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-lot' value='" v-lot "' disabled/>" SKIP
                    "   </DIV>" SKIP
                    "   <DIV class='w3-col l6'>" SKIP
                    "       <label class='w3-text-theme'><b>Serial</b></label>" SKIP
                    "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-serial' value='" v-serial "' disabled/>" SKIP
                    "   </DIV>" SKIP
                    "</div>" SKIP
            
                    "<div class='w3-row-padding'>" SKIP
                    "   <DIV class='w3-col l6'>" SKIP
                    "       <label class='w3-text-theme'><b>Quantity</b></label>" SKIP
                    "       <INPUT class='w3-input w3-border w3-round' type='NUMBER' name='h-quantity' value='" qoh_det.qoh_quantity "' disabled min='1'/>" SKIP
                    "   </div>" SKIP
                    "   <DIV class='w3-col l6'>" SKIP
                    "       <label class='w3-text-theme'><b>Expiration Date</b></label>" SKIP
                    "       <INPUT class='w3-input w3-border w3-round' type='DATE' name='h-expire_date' value='" qoh_det.qoh_expire_date "'  disabled />" SKIP
                    "   </DIV>" SKIP
                    "</div>" SKIP   
    
                    "<hr>" SKIP
    
                    "<div class='w3-row-padding '>" SKIP
                    "   <DIV class='w3-col s12'>" SKIP
                    "       <DIV class='w3-text-theme'><b>To Site</b></DIV>" SKIP
                    "       <select name='h-to-site' class='w3-border w3-round w3-select w3-yellow w3-margin-bottom' required>" SKIP.
                    
                FOR EACH site_mstr WHERE 
                    site_mstr.site_deleted = ? NO-LOCK:
                
                    {&OUT} "                <option value'" site_mstr.site_name "'".
                
                    IF site_mstr.site_name = v-to-site THEN {&OUT} " SELECTED ".
                
                    {&OUT} ">" site_mstr.site_name "</option>" SKIP.
                    
                END. /** 4ea site_mstr **/
                    
                {&OUT}
                    "            </select>" SKIP
                    "   </div>" SKIP
                    "</div> " SKIP
                    
                    "</DIV>" SKIP 
                    "<br>" SKIP
                    
                    "<div class='w3-row-padding w3-margin'>" SKIP
                    "   <div class='w3-center w3-col s12'>" SKIP
                    "       <button type='submit' name='h-act' value='Des-Warehouse' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Submit</b></BUTTON>" SKIP
                    "   </div>" SKIP
                    "</div>" SKIP
                    "<div class='w3-row-padding w3-margin'>" SKIP
                    "   <div class='w3-center w3-col s12'>" SKIP
                    "       <button type='submit' name='h-act' value='site' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Search Again</b></BUTTON>" SKIP
                    "   </div>" SKIP
                    "</div>" SKIP
                    "</form>". 
    
            END. /*** Can-Find Location ****/
            
            ELSE DO:
    
                {&OUT}
                    "<div class='w3-container'>" SKIP
                    "<form>" SKIP
                    "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                    "    <header class='w3-container w3-red'>" SKIP
                    "       <h1>Error</h1>" SKIP
                    "    </header>" SKIP
                    
                    "    <div class='w3-container'>" SKIP
                    "       <p>The Inventory you selected is not in the database.</p>" SKIP
                    "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                    "    </div>" SKIP
                    
                    "   <!-- Variable notes for debugging --->" SKIP
                    "   <!-- v-site = " v-site " --->" SKIP
                    "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                    "   <!-- v-loc = " v-loc " --->" SKIP
                    "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                    "   <!-- v-lot = " v-lot " --->" SKIP
                    "   <!-- v-serial = " v-serial " --->" SKIP
                    "   <!-- v-quantity = " v-quantity " --->" SKIP
                    
                    "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                    "</div>" SKIP
                    "</form>" SKIP
                    "</div>" SKIP.  
    
            END. /*** Improper QOH_det ***/
    
        END. /*** legit location ***/
        
        ELSE DO:
    
            {&OUT}
                "<div class='w3-container'>" SKIP
                "<form>" SKIP
                "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                "    <header class='w3-container w3-red'>" SKIP
                "       <h1>Error</h1>" SKIP
                "    </header>" SKIP
                
                "    <div class='w3-container'>" SKIP
                "       <p>Invalid location</p>" SKIP
                "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                "    </div>" SKIP
                
                "   <!-- Variable notes for debugging --->" SKIP
                "   <!-- v-site = " v-site " --->" SKIP
                "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                "   <!-- v-loc = " v-loc " --->" SKIP
                "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                "   <!-- v-lot = " v-lot " --->" SKIP
                "   <!-- v-serial = " v-serial " --->" SKIP
                "   <!-- v-quantity = " v-quantity " --->" SKIP
                
                "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                "</div>" SKIP
                "</form>" SKIP
                "</div>" SKIP. 
     
        END. /*** improper location ***/
        
    END. /** Validation **/
    
    WHEN "Des-warehouse" THEN DO:
    
        {&OUT}
            "<form>" SKIP
            "   <input type='hidden' name='h-site' value='" v-site "'/>" SKIP
            "   <input type='hidden' name='h-warehouse' value='" v-warehouse "'/>" SKIP
            "   <input type='hidden' name='h-loc' value='" v-loc "'/>" SKIP
            "   <input type='hidden' name='h-item_nbr' value='" v-item_nbr "'/>" SKIP
            "   <input type='hidden' name='h-lot' value='" v-lot "'/>" SKIP
            "   <input type='hidden' name='h-serial' value='" v-serial "'/>" SKIP
            "   <input type='hidden' name='h-to-site' value='" v-to-site "'/>" SKIP
            "   <input type='hidden' name='h-orig-quantity' value='" v-orig-quantity "'/>" SKIP
/*            "   <INPUT type='hidden' name='whattorun' value='" whatshouldrun "' />" SKIP*/
                    
            "<div class='w3-card-4 w3-content w3-white' style='max-width:1700px;'>" SKIP
        
            "<div class='w3-row-padding'> " SKIP 
            "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
            "       <label class='w3-text-theme'><b>From Site</b></label>" SKIP
            "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-site "' disabled></input>" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
            "       <label class='w3-text-theme'><b>From Warehouse</b></label>" SKIP
            "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-warehouse "' disabled></input>" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP
                
            "<div class='w3-row-padding'>      " SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>From Location</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-loc' value='" v-loc "' disabled></input>" SKIP 
            "   </div>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Item Number</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-item_nbr' value='" v-item_nbr "' disabled></input>" SKIP
            "   </div>" SKIP
            "</DIV>" SKIP
    
            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme w3-col l6'><b>Lot Number</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-lot' value='" v-lot "' disabled/>" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Serial</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-serial' value='" v-serial "' disabled/>" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP
    
            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Quantity</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='NUMBER' name='h-quantity' value='" v-orig-quantity "' disabled min='1'/>" SKIP
            "   </div>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Expiration Date</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='DATE' name='h-expire_date' value='" v-expire_date "'  disabled />" SKIP
            "   </DIV>" SKIP  

            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>To Site</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-site' value='" v-to-site "' disabled />" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <DIV class='w3-text-theme'><b>To Warehouse</b></DIV>" SKIP
            "       <select name='h-to-warehouse' class='w3-border w3-round w3-select w3-yellow w3-margin-bottom' required>" SKIP.
            
        FOR EACH site_mstr WHERE 
            site_mstr.site_name = v-to-site AND 
            site_mstr.site_deleted = ? NO-LOCK,
          EACH warehouse_mstr WHERE 
            warehouse_mstr.warehouse_site = site_mstr.site_name AND 
            warehouse_mstr.warehouse_deleted = ? NO-LOCK:
        
            {&OUT} "                <option value'" warehouse_mstr.warehouse_name "'>" warehouse_mstr.warehouse_name "</option>" SKIP.
            
        END. /** 4ea site_mstr **/
            
        {&OUT}
            "       </select>" SKIP
            "   </div>" SKIP
            "</div> " SKIP 
            
            "</DIV>" SKIP 
            "<br>" SKIP
            
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='Des-Location' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Submit</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='site' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Search Again</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "</form>".  
        
    END. /** Destination Warehouse **/
    
    WHEN "Des-Location" THEN DO:
    
        {&OUT}
            "<form>" SKIP
            "   <input type='hidden' name='h-site' value='" v-site "'/>" SKIP
            "   <input type='hidden' name='h-warehouse' value='" v-warehouse "'/>" SKIP
            "   <input type='hidden' name='h-loc' value='" v-loc "'/>" SKIP
            "   <input type='hidden' name='h-item_nbr' value='" v-item_nbr "'/>" SKIP
            "   <input type='hidden' name='h-lot' value='" v-lot "'/>" SKIP
            "   <input type='hidden' name='h-serial' value='" v-serial "'/>" SKIP
            "   <input type='hidden' name='h-to-site' value='" v-to-site "'/>" SKIP
            "   <input type='hidden' name='h-to-warehouse' value='" v-to-warehouse "'/>" SKIP
            "   <input type='hidden' name='h-orig-quantity' value='" v-orig-quantity "'/>" SKIP
/*            "   <INPUT type='hidden' name='whattorun' value='" whatshouldrun "' />" SKIP*/
                               
            "<div class='w3-card-4 w3-content w3-white' style='max-width:1700px;'>" SKIP
        
            "<div class='w3-row-padding'> " SKIP 
            "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
            "       <label class='w3-text-theme'><b>From Site</b></label>" SKIP
            "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-site "' disabled></input>" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6 w3-margin-top'>" SKIP
            "       <label class='w3-text-theme'><b>From Warehouse</b></label>" SKIP
            "       <input class='w3-input w3-border w3-round' type='text' placeholder='" v-warehouse "' disabled></input>" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP
                
            "<div class='w3-row-padding'>      " SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>From Location</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-loc' value='" v-loc "' disabled></input>" SKIP 
            "   </div>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Item Number</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-item_nbr' value='" v-item_nbr "' disabled></input>" SKIP
            "   </div>" SKIP
            "</DIV>" SKIP
    
            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme w3-col l6'><b>Lot Number</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-lot' value='" v-lot "' disabled/>" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Serial</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-serial' value='" v-serial "' disabled/>" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP
    
            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Quantity</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='NUMBER' name='h-quantity' value='" v-orig-quantity "' disabled min='1'/>" SKIP
            "   </div>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Expiration Date</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='DATE' name='h-expire_date' value='" v-expire_date "' disabled />" SKIP
            "   </DIV>" SKIP
            "</div>" SKIP   

            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>To Site</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round' type='TEXT' name='h-to-site' value='" v-to-site "' disabled />" SKIP
            "   </DIV>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <DIV class='w3-text-theme'><b>To Warehouse</b></DIV>" SKIP
            "       <input class='w3-input w3-border w3-round' type='TEXT' name='h-to-warehouse' value='" v-to-warehouse "' disabled/>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            
            "<div class='w3-row-padding'>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>To Location</b></label>" SKIP
            "       <select name='h-to-loc' class='w3-border w3-round w3-select w3-yellow' required>" SKIP.
            
        FOR EACH site_mstr WHERE 
            site_mstr.site_name = v-site AND 
            site_mstr.site_deleted = ? NO-LOCK,
          EACH warehouse_mstr WHERE 
            warehouse_mstr.warehouse_site = site_mstr.site_name AND 
            warehouse_mstr.warehouse_name = v-warehouse AND
            warehouse_mstr.warehouse_deleted = ? NO-LOCK,
          EACH loc_mstr WHERE 
            loc_mstr.loc_site = site_mstr.site_name AND 
            loc_mstr.loc_warehouse = warehouse_mstr.warehouse_name AND 
            loc_mstr.loc_deleted = ? NO-LOCK:
        
            {&OUT} "                <option value'" loc_mstr.loc_name "'>" loc_mstr.loc_name "</option>" SKIP.
            
        END. /** 4ea site_mstr **/
        
        {&OUT}
            "       </select>" SKIP
            "   </div>" SKIP
            "   <DIV class='w3-col l6'>" SKIP
            "       <label class='w3-text-theme'><b>Quantity to transfer</b></label>" SKIP
            "       <INPUT class='w3-input w3-border w3-round w3-yellow w3-margin-bottom' type='NUMBER' name='h-quantity' value='" v-quantity "' min='1' required/>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            
            "</DIV>" SKIP 
            "<br>" SKIP
            
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='Validation-2' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Submit</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "<div class='w3-row-padding w3-margin'>" SKIP
            "   <div class='w3-center w3-col s12'>" SKIP
            "       <button type='submit' name='h-act' value='site' class='w3-btn-block w3-theme-l2 w3-round-large' style='max-width:400px;'><b>Search Again</b></BUTTON>" SKIP
            "   </div>" SKIP
            "</div>" SKIP
            "</form>".
    
    END. /**** destination Location ***/
    
    WHEN "validation-2" THEN DO:
    
        IF v-to-loc = v-loc AND 
            v-to-warehouse = v-warehouse AND 
            v-to-site = v-site THEN 
        
            {&OUT}
                "<div class='w3-container'>" SKIP
                "<form>" SKIP
                "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                "    <header class='w3-container w3-red'>" SKIP
                "       <h1>Error</h1>" SKIP
                "    </header>" SKIP
                
                "    <div class='w3-container'>" SKIP
                "       <p>The ~'From~' and ~'To' locations are the same!</p>" SKIP
                "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                "    </div>" SKIP
                
                "   <!-- Variable notes for debugging --->" SKIP
                "   <!-- v-site = " v-site " --->" SKIP
                "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                "   <!-- v-loc = " v-loc " --->" SKIP
                "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                "   <!-- v-lot = " v-lot " --->" SKIP
                "   <!-- v-serial = " v-serial " --->" SKIP
                "   <!-- v-quantity = " v-quantity " --->" SKIP
                
                "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                "</div>" SKIP
                "</form>" SKIP
                "</div>" SKIP. 
    
        ELSE DO:
    
            FIND FIRST loc_mstr WHERE                   /********************  does the destination location exsist?  ***************/
                loc_mstr.loc_site = v-to-site AND 
                loc_mstr.loc_warehouse = v-to-warehouse AND 
                loc_mstr.loc_name = v-to-loc AND 
                loc_mstr.loc_deleted = ? NO-LOCK NO-ERROR. 
                
            IF AVAILABLE (loc_mstr) THEN DO:
              
                IF CAN-FIND (FIRST item_mstr WHERE      /*********************  does the location have the required type? ************/ 
                    item_mstr.item_nbr = v-item_nbr AND 
                    (item_mstr.item_req_loc_type = loc_mstr.loc_type OR item_mstr.item_req_loc_type = "")) THEN DO:
             
                    IF v-orig-quantity >= v-quantity THEN DO:   /*************  is there sufficient quantity for xfer?  **************/
                    
                        FIND FIRST qoh_det WHERE 
                            qoh_det.qoh_site = v-to-site AND 
                            qoh_det.qoh_warehouse = v-to-warehouse AND 
                            qoh_det.qoh_loc = v-to-loc AND 
                            qoh_det.qoh_item_nbr = v-item_nbr AND 
                            qoh_det.qoh_lot = v-lot AND
                            qoh_det.qoh_serial = v-serial AND 
                            qoh_det.qoh_deleted = ? NO-LOCK NO-ERROR.
                                        
                        /*** some of same lot already there. ***/
                        IF AVAILABLE (qoh_det) THEN DO:
                            
                            ASSIGN 
                                v-merge-quantity = qoh_det.qoh_quantity + v-quantity
                                v-expire_date = qoh_det.qoh_expire_date.
                        
                        END. /*** qoh is avail ***/                   
                        
                        ELSE 
                            ASSIGN v-merge-quantity = v-quantity.
                        
                        /**** "From" qoh, subtraction in quantity ***/
                        RUN VALUE(SEARCH("SUBqoh-ucU.r"))
                            (v-site,
                            v-warehouse,
                            v-item_nbr,
                            v-loc,
                            v-lot,
                            v-serial,
                            (v-orig-quantity - v-quantity),
                            v-avail,
                            v-status,
                            v-expire_date,
                            ?, /*** last count ***/
                            OUTPUT o-from-create,
                            OUTPUT o-from-update,
                            OUTPUT o-from-success).    
                        
                        IF o-from-success = YES AND o-from-update = YES THEN DO:
                        
                            RUN VALUE(SEARCH("SUBtrh-ucU.r"))
                                (0, /*** trh_id ***/
                                v-item_nbr, /*** trh_item ***/
                                "XFER-ISS", /*** trh_action ***/
                                v-quantity, /*** trh_qty ***/
                                v-loc, /*** trh_loc ***/
                                v-lot, /*** trh_lot ***/
                                v-serial, /*** trh_serial ***/
                                v-site, /*** trh_site ***/
                                0, /*** trh_sequence ***/
                                "", /*** trh_comments ***/
                                "", /*** trh_other ***/
                                0, /*** trh_people ***/
                                v-po_nbr, /*** trh_order ***/
                                TODAY, /*** trh_date ***/
                                NOW, /*** trh_time ***/
                                "", /*** trh_ref ***/
                                OUTPUT o-ctrh-id,
                                OUTPUT o-ctrh-error).
                        
                            IF o-ctrh-error = NO THEN DO:
                        
                                /**** "To" qoh, creation ***/
                                RUN VALUE(SEARCH("SUBqoh-ucU.r"))
                                    (v-to-site,
                                    v-to-warehouse,
                                    v-item_nbr,
                                    v-to-loc,
                                    v-lot,
                                    v-serial,
                                    v-merge-quantity,
                                    v-avail,
                                    v-status,
                                    v-expire_date,
                                    ?, /*** last count ***/
                                    OUTPUT o-to-create,
                                    OUTPUT o-to-update,
                                    OUTPUT o-to-success).
                                
                                IF o-to-success = YES THEN DO:
                                
                                    RUN VALUE(SEARCH("SUBtrh-ucU.r"))
                                        (0, /*** trh_id ***/
                                        v-item_nbr, /*** trh_item ***/
                                        "XFER-RCPT", /*** trh_action ***/
                                        v-quantity, /*** trh_qty ***/
                                        v-to-loc, /*** trh_loc ***/
                                        v-lot, /*** trh_lot ***/
                                        v-serial, /*** trh_serial ***/
                                        v-to-site, /*** trh_site ***/
                                        0, /*** trh_sequence ***/
                                        "", /*** trh_comments ***/
                                        "", /*** trh_other ***/
                                        0, /*** trh_people ***/
                                        v-po_nbr, /*** trh_order ***/
                                        TODAY, /*** trh_date ***/
                                        NOW, /*** trh_time ***/
                                        "", /*** trh_ref ***/
                                        OUTPUT o-to-ctrh-id,
                                        OUTPUT o-to-ctrh-error).
                                    
                                    IF o-to-ctrh-error = YES THEN DO:
                                    
                                        {&OUT}
                                            "<div class='w3-container'>" SKIP
                                            "<form>" SKIP
                                            "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                                            "    <header class='w3-container w3-red'>" SKIP
                                            "       <h1>Error</h1>" SKIP
                                            "    </header>" SKIP
                                            
                                            "    <div class='w3-container'>" SKIP
                                            "       <p>The Reciept of the transfer failed to make a transaction history record.</p>" SKIP
                                            "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                                            "    </div>" SKIP
                                            
                                            "   <!-- Variable notes for debugging --->" SKIP
                                            "   <!-- v-site = " v-site " --->" SKIP
                                            "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                                            "   <!-- v-loc = " v-loc " --->" SKIP
                                            "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                                            "   <!-- v-lot = " v-lot " --->" SKIP
                                            "   <!-- v-serial = " v-serial " --->" SKIP
                                            "   <!-- v-quantity = " v-quantity " --->" SKIP
                                            
                                            "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                                            "</div>" SKIP
                                            "</form>" SKIP
                                            "</div>" SKIP. 
                                        
                                    END. /*** of failed trh 'to' half of transfer ***/
                                    
                                    ELSE DO:
                                    
                                        {&OUT}
                                            "<div class='w3-container'>" SKIP
                                            "<form>" SKIP
                                            "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                                            "    <header class='w3-container w3-green'>" SKIP
                                            "       <h1>Success</h1>" SKIP
                                            "    </header>" SKIP
                                            
                                            "    <div class='w3-container'>" SKIP
                                            "       <p>You've successfully issued (" v-quantity ") <b>" v-item_nbr "</b> from [" v-loc "] at " v-site ", " v-warehouse " warehouse to [" v-to-loc "] at " v-to-site ", " v-to-warehouse ".</p>" SKIP   
                                            "    </div>" SKIP
                                            
                                            "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-green'>Return to Start</BUTTON>" SKIP
                                            "</div>" SKIP
                                            "</form>" SKIP
                                            "</div>" SKIP.
                                        
                                    END. /*** of everything was successful!! ***/
                                    
                                END. /** successful QOH 'to' half of transfer ***/
                                
                                ELSE DO:
                                
                                    {&OUT}
                                        "<div class='w3-container'>" SKIP
                                        "<form>" SKIP
                                        "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                                        "    <header class='w3-container w3-red'>" SKIP
                                        "       <h1>Error</h1>" SKIP
                                        "    </header>" SKIP
                                        
                                        "    <div class='w3-container'>" SKIP
                                        "       <p>The Reciept of the transfer failed.</p>" SKIP
/*                                        "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP*/
                                        "    </div>" SKIP
                                        
                                        "   <!-- Variable notes for debugging --->" SKIP
                                        "   <!-- v-site = " v-site " --->" SKIP
                                        "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                                        "   <!-- v-loc = " v-loc " --->" SKIP
                                        "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                                        "   <!-- v-lot = " v-lot " --->" SKIP
                                        "   <!-- v-serial = " v-serial " --->" SKIP
                                        "   <!-- v-quantity = " v-quantity " --->" SKIP
                                        
                                        "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                                        "</div>" SKIP
                                        "</form>" SKIP
                                        "</div>" SKIP.
                                    
                                END. /** failed QOH to half of transfer ***/    
                            
                            END. /*** successful TRH update (from) ***/
                            
                            ELSE DO:
                            
                                {&OUT}
                                    "<div class='w3-container'>" SKIP
                                    "<form>" SKIP
                                    "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                                    "    <header class='w3-container w3-red'>" SKIP
                                    "       <h1>Error</h1>" SKIP
                                    "    </header>" SKIP
                                    
                                    "    <div class='w3-container'>" SKIP
                                    "       <p>The Issue of the transfer failed to make a transaction history record.</p>" SKIP
/*                                    "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP*/
                                    "    </div>" SKIP
                                    
                                    "   <!-- Variable notes for debugging --->" SKIP
                                    "   <!-- v-site = " v-site " --->" SKIP
                                    "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                                    "   <!-- v-loc = " v-loc " --->" SKIP
                                    "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                                    "   <!-- v-lot = " v-lot " --->" SKIP
                                    "   <!-- v-serial = " v-serial " --->" SKIP
                                    "   <!-- v-quantity = " v-quantity " --->" SKIP
                                    
                                    "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                                    "</div>" SKIP
                                    "</form>" SKIP
                                    "</div>" SKIP.
                              
                            END. /**** failed trh creation for from half ***/
                              
                        END. /** successful QOH (from) subtraction half of transfer ***/
                        
                        ELSE DO:
                        
                            {&OUT}
                                "<div class='w3-container'>" SKIP
                                "<form>" SKIP
                                "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                                "    <header class='w3-container w3-red'>" SKIP
                                "       <h1>Error</h1>" SKIP
                                "    </header>" SKIP
                                
                                "    <div class='w3-container'>" SKIP
                                "       <p>The Issue of the transfer failed.</p>" SKIP
/*                                "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP*/
                                "    </div>" SKIP
                                
                                "   <!-- Variable notes for debugging --->" SKIP
                                "   <!-- v-site = " v-site " --->" SKIP
                                "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                                "   <!-- v-loc = " v-loc " --->" SKIP
                                "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                                "   <!-- v-lot = " v-lot " --->" SKIP
                                "   <!-- v-serial = " v-serial " --->" SKIP
                                "   <!-- v-quantity = " v-quantity " --->" SKIP
                                
                                "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                                "</div>" SKIP
                                "</form>" SKIP
                                "</div>" SKIP.    
                            
                        END. /** failed QOH subtraction half of transfer ***/
        
                    END. /*** sufficient quantity ***/
                
                    ELSE DO:
                    
                        {&OUT}
                            "<div class='w3-container'>" SKIP
                            "<form>" SKIP
                            "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                            "    <header class='w3-container w3-red'>" SKIP
                            "       <h1>Error</h1>" SKIP
                            "    </header>" SKIP
                            
                            "    <div class='w3-container'>" SKIP
                            "       <p>There is an issufficient quantity of items to make that transfer.</p>" SKIP
                            "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                            "    </div>" SKIP
                            
                            "   <!-- Variable notes for debugging --->" SKIP
                            "   <!-- v-site = " v-site " --->" SKIP
                            "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                            "   <!-- v-loc = " v-loc " --->" SKIP
                            "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                            "   <!-- v-lot = " v-lot " --->" SKIP
                            "   <!-- v-serial = " v-serial " --->" SKIP
                            "   <!-- v-quantity = " v-quantity " --->" SKIP
                            
                            "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                            "</div>" SKIP
                            "</form>" SKIP
                            "</div>" SKIP.
                        
                    END. /** insufficient quantity **/
                
                END. /*** location has required location type ***/
                
                ELSE DO:
                
                    {&OUT}
                        "<div class='w3-container'>" SKIP
                        "<form>" SKIP
                        "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                        "    <header class='w3-container w3-red'>" SKIP
                        "       <h1>Error</h1>" SKIP
                        "    </header>" SKIP
                        
                        "    <div class='w3-container'>" SKIP
                        "       <p>The location you have selected does not have the required type for that item.</p>" SKIP
                        "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                        "    </div>" SKIP
                        
                        "   <!-- Variable notes for debugging --->" SKIP
                        "   <!-- v-site = " v-site " --->" SKIP
                        "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                        "   <!-- v-loc = " v-loc " --->" SKIP
                        "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                        "   <!-- v-lot = " v-lot " --->" SKIP
                        "   <!-- v-serial = " v-serial " --->" SKIP
                        "   <!-- v-quantity = " v-quantity " --->" SKIP
                        
                        "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                        "</div>" SKIP
                        "</form>" SKIP
                        "</div>" SKIP.
                    
                END. /*** wrong location type ***/
                    
            END. /*** valid location ***/
            
            ELSE DO:
             
                {&OUT}
                    "<div class='w3-container'>" SKIP
                    "<form>" SKIP
                    "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
                    "    <header class='w3-container w3-red'>" SKIP
                    "       <h1>Error</h1>" SKIP
                    "    </header>" SKIP
                    
                    "    <div class='w3-container'>" SKIP
                    "       <p>The ~'To~' location you selected is no longer in the database.</p>" SKIP
                    "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
                    "    </div>" SKIP
                    
                    "   <!-- Variable notes for debugging --->" SKIP
                    "   <!-- v-site = " v-site " --->" SKIP
                    "   <!-- v-warehouse = " v-warehouse " --->" SKIP
                    "   <!-- v-loc = " v-loc " --->" SKIP
                    "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
                    "   <!-- v-lot = " v-lot " --->" SKIP
                    "   <!-- v-serial = " v-serial " --->" SKIP
                    "   <!-- v-quantity = " v-quantity " --->" SKIP
                    
                    "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
                    "</div>" SKIP
                    "</form>" SKIP
                    "</div>" SKIP.    
                
            END. /*** invalid location ***/
        
        END. /*** destination and origin are the same. ***/
        
    END. /*** second validation  ***/
    
    WHEN "TRH_hist" THEN DO:
    END. /** trh_hist **/
    
    OTHERWISE DO:
            
        {&OUT}
            "<div class='w3-container'>" SKIP
            "<form>" SKIP
            "<div class='w3-card-8 w3-content w3-white' style='max-width:1250px;'>" SKIP
            "    <header class='w3-container w3-red'>" SKIP
            "       <h1>Error</h1>" SKIP
            "    </header>" SKIP
            
            "    <div class='w3-container'>" SKIP
            "       <p>Unable to find act ~'" act "~'.</p>" SKIP
            "       <p>Feel free to click the back button in your browser and try again.</p>" SKIP
            "    </div>" SKIP
            
            "   <!-- Variable notes for debugging --->" SKIP
            "   <!-- v-site = " v-site " --->" SKIP
            "   <!-- v-warehouse = " v-warehouse " --->" SKIP
            "   <!-- v-loc = " v-loc " --->" SKIP
            "   <!-- v-item_nbr = " v-item_nbr " --->" SKIP
            "   <!-- v-lot = " v-lot " --->" SKIP
            "   <!-- v-serial = " v-serial " --->" SKIP
            "   <!-- v-quantity = " v-quantity " --->" SKIP
            
            "    <button type='submit' name='h-act' value='SITE' class='w3-btn-block w3-left-align w3-padding-16 w3-hover-red'>Return to Start</BUTTON>" SKIP
            "</div>" SKIP
            "</form>" SKIP
            "</div>" SKIP.
            
    END. /*** otherwise ***/
    
END CASE.

/********************************** End of Line ******************************/

</SCRIPT>
</BODY>
</HTML>
</HTML>