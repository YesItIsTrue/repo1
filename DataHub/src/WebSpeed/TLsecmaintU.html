<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>

    <META NAME="AUTHOR" CONTENT="Doug Luttrell">
    <META NAME="VERSION" CONTENT="1.6">
    <META NAME="COPYRIGHT" CONTENT="Solsource">
    <META NAME="CREATE_DATE" CONTENT="08/Oct/14">
    <META NAME="LAST_UPDATED" CONTENT="18/Mar/16">
    <LINK rel='stylesheet' type='text/css' href='/depot/src/HTMLContent/stylesheets/core.css' />
    <TITLE>Test Section Maintenance</TITLE>
    
<SCRIPT LANGUAGE="SpeedScript">
/* Create an unnamed pool to store all the widgets created by this procedure.
   This is a good default which assures that this procedure's triggers and
   internal procedures will execute in this procedure's storage, and that
   proper cleanup will occur on deletion of the procedure. */
CREATE WIDGET-POOL.
</SCRIPT>
</HEAD>

<BODY class='inside'>
<SCRIPT LANGUAGE="SpeedScript">
/**********************************************************************************
 *
 *  TLsecmaintU.html   -   Version 1.2
 *
 *  This program is designed to allow users to create sections for Tests (MPA and BioMed). 
 *
 *  ----------------------------------------------------------------------------
 *
 *  Revision History:
 *  -----------------
 *  1.0 - written by Doug Luttrell on 08/Oct/14.  Original Version.
 *  1.1 - written by DOUG LUTTRELL on 19/Nov/14.  Changed creation of a new test section
 *          to be driven by a button instead of a drop-down per Danielle's request.
 *          Marked by 1dot1.
 *  1.2 - written by DOUG LUTTRELL on 05/Jan/15.  FINDs were not using all the fields
 *          that they needed to.  Marked by 1dot2.
 *  1.3 - written by Jacob Luttrell on 05/Oct/15.  Div and button corrections.
 *          Marked by 1dot3. 
 *  1.4 - written by Jacob Luttrell on 08/Oct/15. Code added to control date display.
 *          Marked by 1dot4.          
 *  1.5 - written by Jacob Luttrell on 24/Nov/15. Removed .i file (not marked).
 *          Corrected dropped Test section description on Update page. Marked 1dot5.
 *  1.6 - written by Jacob Luttrell on 18/Mar/16. Added progname updater marked by 1dot6.
 ***********************************************************************************/

{../depot/src/WebSpeed/menuname.i}.   /*** menu name assignment ***/  

/***************************  Variable Definition Section  *************************/
DEFINE VARIABLE sectid      LIKE tl_mstr.tl_sect_id         NO-UNDO. 
DEFINE VARIABLE testtype    LIKE tl_mstr.tl_testtype        NO-UNDO.
DEFINE VARIABLE testname    LIKE test_mstr.test_name        NO-UNDO.
DEFINE VARIABLE sectdesc    LIKE tl_mstr.tl_section_desc    NO-UNDO.
DEFINE VARIABLE starteff    LIKE tl_mstr.tl_start_eff       NO-UNDO.
DEFINE VARIABLE endeff      LIKE tl_mstr.tl_end_eff         NO-UNDO.
DEFINE VARIABLE sortorder   LIKE tl_mstr.tl_order           NO-UNDO.

DEFINE VARIABLE disp-start  AS CHARACTER                 NO-UNDO.                   /* 1dot4 */
DEFINE VARIABLE disp-end    AS CHARACTER                 NO-UNDO.                   /* 1dot4 */
DEFINE VARIABLE out-start   AS CHARACTER                 NO-UNDO.                   /* 1dot4 */
DEFINE VARIABLE out-end     AS CHARACTER                 NO-UNDO.                   /* 1dot4 */
 
 DEFINE VARIABLE act        AS CHARACTER                    NO-UNDO. 
 DEFINE VARIABLE ITshowmsg  AS LOG INITIAL NO              NO-UNDO.
 
 DEFINE VARIABLE thismarker AS CHARACTER                    NO-UNDO. 

 
                                                                                IF ITshowmsg = YES THEN 
                                                                                   {&OUT}
                                                                                       "<P>Pre get-value</P>" SKIP.
        
 ASSIGN 
    act         = get-value('h-act')
    sectid      = IF substring(get-value('h-sectid'),1,4) = "null" THEN         /* 1dot1 */
                    0                                                           /* 1dot1 */
                  ELSE                                                          /* 1dot1 */
                    INTEGER(get-value('h-sectid'))                              /* 1dot1 */
    testtype    = get-value('h-testtype')
    sectdesc    = get-value('h-sectdesc')
    sortorder   = INTEGER(get-value('h-sortorder'))
    disp-start  = get-value('html5-start')                                              /* 1dot4 */
    disp-end    = get-value('html5-end').                                               /* 1dot4 */
    
    RUN VALUE(SEARCH("subr_CCYY_to_YY.r")) (                                            /* 1dot4 */
            disp-start,                                                                 /* 1dot4 */
            OUTPUT starteff                                                             /* 1dot4 */    
            ).                                                                          /* 1dot4 */
        
        RUN VALUE(SEARCH("subr_CCYY_to_YY.r")) (                                        /* 1dot4 */
            disp-end,                                                                   /* 1dot4 */
            OUTPUT endeff                                                               /* 1dot4 */
            ).                                                                          /* 1dot4 */
    
    /*** also need to get-value on h-starteff and h-endeff, but need to run them through date converter ***/
    
                                                                                IF ITshowmsg = YES THEN 
                                                                                   {&OUT}
                                                                                       "<P>Post get-value</P>" SKIP
                                                                                       "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                       "<hr width=90%>" SKIP.
        
 IF act = "" THEN 
    act = "INITIAL".
    
 ELSE IF act = "INITIAL" THEN
    act = "INITIAL".
    
 ELSE IF act = "FIND TEST" THEN 
    act = "FIND TEST".
    
    /*
 ELSE IF act = "FIND SECTION" THEN 
    act = "FIND SECTION".    
    */
    
 ELSE IF act = "CREATE" THEN 
    act = "CREATE".
    
 ELSE IF act = "UPDATE" THEN  
    act = "UPDATE".
     
 ELSE IF sectid = 0 THEN 
    act = "PROMPT".
     
                                                                                IF ITshowmsg = YES THEN 
                                                                                   {&OUT}
                                                                                       "<P>Pre Case</P>" SKIP
                                                                                       "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                       "<hr width=90%>" SKIP.
        
/********************************  Main Program  ***********************************/
CASE act:
     
    WHEN "INITIAL" THEN DO:
    
    {&OUT}
        "<div class='row'>" SKIP
	    "<div class='grid_3'> </DIV>" SKIP
	    "<DIV class='grid_6'>" SKIP
	    "<FORM>" SKIP
	    "<DIV class='table_col'>" SKIP
	    "<TABLE>" SKIP
	    "   <TR>" SKIP
	    "       <TH colspan=2>Test Layout Maintenance (Sections)</TH>" SKIP
	    "   </TR>" SKIP
	    "   <TR>" SKIP
	    "       <TD>Test Type</TD>" SKIP
	    "       <TD class='REQ'>" SKIP
        "           <select name='h-testtype' value='" testtype "' REQUIRED>" SKIP.
        
        FOR EACH test_mstr WHERE 
		    (test_mstr.test_starteff <= TODAY OR
		    test_mstr.test_starteff = ?) AND 
		    (test_mstr.test_endeff >= TODAY OR 
		    test_mstr.test_endeff = ?) AND 
		    test_mstr.test_deleted = ? NO-LOCK 
		    BY test_mstr.test_type: 
		                
		    IF test_mstr.test_type = testtype THEN 
		        thismarker  = "SELECTED".
		    ELSE 
		        thismarker  = "".		    
                
    {&OUT}
    "               <option value='" test_mstr.test_type "' " thismarker " >" test_mstr.test_type "</option>" SKIP.
    
        END.    /** of 4ea test_mstr **/            
    
	{&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Section Description</TD>" SKIP
    "       <TD>" SKIP    
    "           <select name='h-sectid' value='" sectid "' DISABLED >" SKIP.
    FOR EACH tl_mstr WHERE tl_mstr.tl_testtype = testtype AND 
    tl_mstr.tl_deleted = ? NO-LOCK
    BY tl_mstr.tl_testtype BY tl_mstr.tl_section_desc: 
        
    IF tl_mstr.tl_sect_id = sectid THEN 
        ASSIGN 
            thismarker = "SELECTED"
            sectdesc   = tl_mstr.tl_section_desc. 
    ELSE 
        thismarker  = "".
            
    {&OUT}
    "               <option value='" tl_mstr.tl_sect_id "' " thismarker " > " tl_mstr.tl_section_desc " </option>" SKIP.
    END.  /** of 4ea. tl_mstr **/
    
{&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Start Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-start' value='" disp-start "' DISABLED /></TD>" SKIP                                    /* 1dot4 */
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>End Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-end' value='" disp-end "' DISABLED /></TD>" SKIP                                        /* 1dot4 */   
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Sort Order</TD>" SKIP
    "       <TD><input type='number' name='h-sortorder' value='" sortorder "' DISABLED /></TD>" SKIP
    "   </TR>" SKIP   
    "</TABLE>" SKIP
    "</DIV>         <!-- end of table_report -->" SKIP 
    "</DIV>     <!-- end of grid_6 -->" SKIP 
    "<DIV class='grid_3'> </DIV>" SKIP
    "</DIV>     <!-- end of row -->" SKIP
    "<BR>" SKIP                                                                                                                 /* 1dot3 */
    "<div class='row'>" SKIP                                                                                                    /* 1dot3 */                                                     
    "   <div class='grid_5'> </DIV>" SKIP                                                                                       /* 1dot3 */ 
    "<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                          /* 1dot3 */              
    "   <div class='grid_2'><button type='submit' name='h-act' value='FIND TEST' class='btn'>Find TEST</BUTTON></div>" SKIP     /* 1dot3 */
    "   <div class='grid_5'> </DIV>" SKIP                                                                                       /* 1dot3 */
    "</div>" SKIP.                                                                                                              /* 1dot3 */                  
/*        {TLsecmaintU-form.i "FIND TEST" "NOTHING" "DISABLED" "DISABLED" "NOTHING" "Maintenance"}.*/
        
    END.  /** of act = "INITIAL" **/ 
    
    WHEN "FIND TEST" THEN DO:
         
        FIND test_mstr WHERE test_mstr.test_type = testtype AND 
            test_mstr.test_deleted = ? 
                NO-LOCK NO-ERROR.
        IF AVAILABLE test_mstr THEN 
            ASSIGN 
                testname    = test_mstr.test_name. 

{&OUT} 
    "<div class='row'>" SKIP 
    "<div class='grid_3'> </DIV>" SKIP
    "<DIV class='grid_6'>" SKIP
    "<FORM>" SKIP 
    "<DIV class='table_col'>" SKIP
    "<TABLE>" SKIP 
    "   <TR>" SKIP
    "       <TH colspan=2>Test Layout Maintenance (Sections)</TH>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Type</TD>" SKIP
        "       <TD>" SKIP
        "           <select name='h-testtype' value='" testtype "' DISABLED>" SKIP.
        
        FOR EACH test_mstr WHERE 
            (test_mstr.test_starteff <= TODAY OR
            test_mstr.test_starteff = ?) AND 
            (test_mstr.test_endeff >= TODAY OR 
            test_mstr.test_endeff = ?) AND 
            test_mstr.test_deleted = ? NO-LOCK 
            BY test_mstr.test_type: 
                        
            IF test_mstr.test_type = testtype THEN 
                thismarker  = "SELECTED".
            ELSE 
                thismarker  = "".           
                
    {&OUT}
    "               <option value='" test_mstr.test_type "' " thismarker " >" test_mstr.test_type "</option>" SKIP.
    
        END.    /** of 4ea test_mstr **/            
    
    {&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Section Description</TD>" SKIP
    "       <TD class='REQ'>" SKIP
    "           <select name='h-sectid' value='" sectid "'>" SKIP.
    
    FOR EACH tl_mstr WHERE tl_mstr.tl_testtype = testtype AND 
    tl_mstr.tl_deleted = ? NO-LOCK
    BY tl_mstr.tl_testtype BY tl_mstr.tl_section_desc: 
        
    IF tl_mstr.tl_sect_id = sectid THEN 
        ASSIGN 
            thismarker = "SELECTED"
            sectdesc   = tl_mstr.tl_section_desc. 
    ELSE 
        thismarker  = "".
            
    {&OUT}
    "               <option value='" tl_mstr.tl_sect_id "' " thismarker " > " tl_mstr.tl_section_desc " </option>" SKIP.
    END.  /** of 4ea. tl_mstr **/
    
{&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Start Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-start' value='" disp-start "' DISABLED /></TD>" SKIP                                    /* 1dot4 */
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>End Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-end' value='" disp-end "' DISABLED /></TD>" SKIP                                        /* 1dot4 */   
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Sort Order</TD>" SKIP
    "       <TD><input type='number' name='h-sortorder' value='" sortorder "' DISABLED /></TD>" SKIP
    "   </TR>" SKIP   
    "</TABLE>" SKIP
    "</DIV>         <!-- end of table_report -->" SKIP 
    "</DIV>     <!-- end of grid_6 -->" SKIP 
    "<DIV class='grid_3'> </DIV>" SKIP
    "</DIV>     <!-- end of row -->" SKIP
        "<BR>"                                                                                                                      /* 1dot3 */                                                              
    "<div class='row'>" SKIP                                                                                                    /* 1dot3 */
    "   <div class='grid_3'> </DIV>" SKIP                                                                                       /* 1dot3 */
    "<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                          /* 1dot3 */
    "<INPUT type='hidden' name='h-testtype' value='" testtype "' />" SKIP                                          /* 1dot3 */   
    "   <div class='grid_2'><BUTTON type='submit' name='h-act' value='FIND SECTION' class='btn'>Find Section</BUTTON></div>" SKIP                 /* 1dot3 */
    "   <div class='grid_2'> </DIV>" SKIP                                                                                       /* 1dot3 */
    "   <div class='grid_2'><BUTTON type='submit' name='h-act' value='PROMPT' class='btn'>Add New Section to this Test</BUTTON></div>" SKIP /* 1dot3 */
    "   <div class='grid_3'> </DIV>" SKIP                                                                                       /* 1dot3 */
    "</div>" SKIP.                   
/*        {TLsecmaintU-form.i "FIND SECTION" "DISABLED" "NOTHING" "DISABLED" "NOTHING" "Maintenance"}.*/
                 
                                                                                IF ITshowmsg = YES THEN  
                                                                                    {&OUT}
                                                                                        "<P>Post FIND TEST</P>" SKIP  
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                        "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
         
    END.  /** of act = "FIND TEST" **/

    WHEN "FIND SECTION" THEN DO:
         
        FIND tl_mstr WHERE tl_mstr.tl_sect_id = sectid AND 
            tl_mstr.tl_testtype = testtype AND                                  /* 1dot2 */
            tl_mstr.tl_deleted = ? 
                NO-LOCK NO-ERROR. 
        IF AVAILABLE tl_mstr THEN  
            ASSIGN 
                sectdesc    = tl_mstr.tl_section_desc
                sortorder   = tl_mstr.tl_order
                starteff    = tl_mstr.tl_start_eff
                endeff      = tl_mstr.tl_end_eff. 
        
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            starteff,                                                                           /* 1dot4 */
            OUTPUT out-start                                                                    /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
 
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            endeff,                                                                             /* 1dot4 */
            OUTPUT out-end                                                                      /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
    
        ASSIGN                                                                                  /* 1dot4 */ 
            disp-start = out-start                                                              /* 1dot4 */    
            disp-end   = out-end.                                                               /* 1dot4 */    
        
{&OUT} 
    "<div class='row'>" SKIP 
    "<div class='grid_3'> </DIV>" SKIP
    "<DIV class='grid_6'>" SKIP
    "<FORM>" SKIP 
    "<DIV class='table_col'>" SKIP
    "<TABLE>" SKIP 
    "   <TR>" SKIP
    "       <TH colspan=2>Test Layout Maintenance (Sections)</TH>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Type</TD>" SKIP
        "       <TD>" SKIP
        "           <select name='h-testtype' value='" testtype "' DISABLED>" SKIP.
        
        FOR EACH test_mstr WHERE 
            (test_mstr.test_starteff <= TODAY OR
            test_mstr.test_starteff = ?) AND 
            (test_mstr.test_endeff >= TODAY OR 
            test_mstr.test_endeff = ?) AND 
            test_mstr.test_deleted = ? NO-LOCK 
            BY test_mstr.test_type: 
                        
            IF test_mstr.test_type = testtype THEN 
                thismarker  = "SELECTED".
            ELSE 
                thismarker  = "".           
                
    {&OUT}
    "               <option value='" test_mstr.test_type "' " thismarker " >" test_mstr.test_type "</option>" SKIP.
    
        END.    /** of 4ea test_mstr **/            
    
    {&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Section Description</TD>" SKIP
    "       <TD>" SKIP
    "           <select name='h-sectid' value='" sectid "' DISABLED>" SKIP.
    FOR EACH tl_mstr WHERE tl_mstr.tl_testtype = testtype AND 
    tl_mstr.tl_deleted = ? NO-LOCK
    BY tl_mstr.tl_testtype BY tl_mstr.tl_section_desc: 
        
    IF tl_mstr.tl_sect_id = sectid THEN 
        ASSIGN 
            thismarker = "SELECTED"
            sectdesc   = tl_mstr.tl_section_desc. 
    ELSE 
        thismarker  = "".
            
    {&OUT}
    "               <option value='" tl_mstr.tl_sect_id "' " thismarker " > " tl_mstr.tl_section_desc " </option>" SKIP.
    END.  /** of 4ea. tl_mstr **/
    
{&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Start Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-start' value='" disp-start "' /></TD>" SKIP                                    /* 1dot4 */
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>End Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-end' value='" disp-end "' /></TD>" SKIP                                        /* 1dot4 */   
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Sort Order</TD>" SKIP
    "       <TD><input type='number' name='h-sortorder' value='" sortorder "' /></TD>" SKIP
    "   </TR>" SKIP   
    "</TABLE>" SKIP
    "</DIV>         <!-- end of table_report -->" SKIP 
    "</DIV>     <!-- end of grid_6 -->" SKIP 
    "<DIV class='grid_3'> </DIV>" SKIP
    "</DIV>     <!-- end of row -->" SKIP
    "<BR>" SKIP                                                                                                                 /* 1dot3 */
    "<div class='row'>" SKIP                                                                                                    /* 1dot3 */                                                     
    "   <div class='grid_5'> </DIV>" SKIP                                                                                       /* 1dot3 */ 
    "<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                          /* 1dot3 */ 
    "<INPUT type='hidden' name='h-testtype' value='" testtype "' />" SKIP                                          /* 1dot3 */ 
    "<INPUT type='hidden' name='h-sectid' value='" sectid "' />" SKIP                                          /* 1dot3 */                
    "   <div class='grid_2'><button type='submit' name='h-act' value='UPDATE' class='btn'>Update</BUTTON></div>" SKIP                 /* 1dot3 */
    "   <div class='grid_5'> </DIV>" SKIP                                                                                       /* 1dot3 */
    "</div>" SKIP.                                                                                                              /* 1dot3 */        
        
               
/*        {TLsecmaintU-form.i "UPDATE" "DISABLED" "DISABLED" "NOTHING" "NOTHING" "Maintenance"}.*/
                
                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Post FIND SECTION</P>" SKIP  
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
         
    END.  /** of act = "FIND SECTION" **/
    
    WHEN "UPDATE" THEN DO:
        
                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Inside Update</P>" SKIP
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
        
        FIND test_mstr WHERE test_mstr.test_type = testtype AND
            test_mstr.test_deleted = ?
                NO-LOCK NO-ERROR.
        IF AVAILABLE test_mstr THEN
            ASSIGN
                testname    = test_mstr.test_name.
        
        FIND tl_mstr WHERE tl_mstr.tl_sect_id = sectid AND 
            tl_mstr.tl_testtype = testtype AND                                  /* 1dot2 */
            tl_mstr.tl_deleted = ?                                              /* 1dot2 */
                EXCLUSIVE-LOCK NO-ERROR.
        IF AVAILABLE tl_mstr THEN 
 
            ASSIGN  
                tl_mstr.tl_section_desc     = IF sectdesc <> "" THEN sectdesc ELSE tl_mstr.tl_section_desc /* 1dot5 */
                tl_mstr.tl_start_eff        = starteff
                tl_mstr.tl_end_eff          = endeff
                tl_mstr.tl_order            = sortorder
                tl_mstr.tl_modified_date    = TODAY 
                tl_mstr.tl_modified_by      = USERID("Modules")
                tl_mstr.tl_prog_name        = THIS-PROCEDURE:FILE-NAME.                         /* 1dot6 */
             
        ELSE 
            {&OUT} "<P>ERROR - tl_mstr not found for Section = " sectid ".</P>" SKIP. 

 
/*        ASSIGN               */
/*            sectid      = 0  */
/*            sectdesc    = "".*/
        
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            starteff,                                                                           /* 1dot4 */
            OUTPUT out-start                                                                    /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
 
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            endeff,                                                                             /* 1dot4 */
            OUTPUT out-end                                                                      /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
    
        ASSIGN                                                                                  /* 1dot4 */ 
            disp-start = out-start                                                              /* 1dot4 */    
            disp-end   = out-end.                                                               /* 1dot4 */    
{&OUT}
    "<div class='row'>" SKIP 
    "<div class='grid_3'> </DIV>" SKIP
    "<DIV class='grid_6'>" SKIP
    "<FORM>" SKIP 
    "<DIV class='table_col'>" SKIP
    "<TABLE>" SKIP 
    "   <TR>" SKIP
    "       <TH colspan=2>Test Layout Maintenance (Sections)</TH>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Type</TD>" SKIP
        "       <TD>" SKIP
        "           <select name='h-testtype' value='" testtype "' DISABLED>" SKIP.
        
        FOR EACH test_mstr WHERE 
            (test_mstr.test_starteff <= TODAY OR
            test_mstr.test_starteff = ?) AND 
            (test_mstr.test_endeff >= TODAY OR 
            test_mstr.test_endeff = ?) AND 
            test_mstr.test_deleted = ? NO-LOCK 
            BY test_mstr.test_type: 
                        
            IF test_mstr.test_type = testtype THEN 
                thismarker  = "SELECTED".
            ELSE 
                thismarker  = "".           
                
    {&OUT}
    "               <option value='" test_mstr.test_type "' " thismarker " >" test_mstr.test_type "</option>" SKIP.
    
        END.    /** of 4ea test_mstr **/            
    
    {&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Test Section Description</TD>" SKIP
    "       <TD>" SKIP
    "           <select name='h-sectid' value='" sectid "' DISABLED>" SKIP.
    FOR EACH tl_mstr WHERE tl_mstr.tl_testtype = testtype AND 
    tl_mstr.tl_deleted = ? NO-LOCK
    BY tl_mstr.tl_testtype BY tl_mstr.tl_section_desc: 
        
    IF tl_mstr.tl_sect_id = sectid THEN 
        ASSIGN 
            thismarker = "SELECTED".
/*            sectdesc   = tl_mstr.tl_section_desc.*/
    ELSE 
        thismarker  = "".
            
    {&OUT}
    "               <option value='" tl_mstr.tl_sect_id "' " thismarker " > " tl_mstr.tl_section_desc " </option>" SKIP.
    END.  /** of 4ea. tl_mstr **/
    
{&OUT} 
    "           </select>" SKIP
    "       </TD>" SKIP
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Start Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-start' value='" disp-start "' DISABLED /></TD>" SKIP                                    /* 1dot4 */
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>End Effective Date</TD>" SKIP
    "       <TD><input type='date' name='html5-end' value='" disp-end "' DISABLED /></TD>" SKIP                                        /* 1dot4 */   
    "   </TR>" SKIP
    "   <TR>" SKIP
    "       <TD>Sort Order</TD>" SKIP
    "       <TD><input type='number' name='h-sortorder' value='" sortorder "' DISABLED /></TD>" SKIP
    "   </TR>" SKIP   
    "</TABLE>" SKIP
    "</DIV>         <!-- end of table_report -->" SKIP 
    "</DIV>     <!-- end of grid_6 -->" SKIP 
    "<DIV class='grid_3'> </DIV>" SKIP
    "</DIV>     <!-- end of row -->" SKIP
    "<BR>" SKIP                                                                                                                 /* 1dot3 */
    "<div class='row'>" SKIP                                                                                                    /* 1dot3 */                                                     
    "   <div class='grid_5'> </DIV>" SKIP                                                                                       /* 1dot3 */ 
    "<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                          /* 1dot3 */              
    "   <div class='grid_2'><button type='submit' name='h-act' value='INITIAL' class='btn'>Initial</BUTTON></div>" SKIP                 /* 1dot3 */
    "   <div class='grid_5'> </DIV>" SKIP                                                                                       /* 1dot3 */
    "</div>" SKIP.                                                                                                              /* 1dot3 */    
            
/*        {TLsecmaintU-form.i "INITIAL" "DISABLED" "DISABLED" "DISABLED" "NOTHING" "Maintenance"}.*/
        
    END.  /** of act = "UPDATE" **/
    
    WHEN "PROMPT" THEN DO:
        
                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Inside Prompt</P>" SKIP
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
        
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            starteff,                                                                           /* 1dot4 */
            OUTPUT out-start                                                                    /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
 
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            endeff,                                                                             /* 1dot4 */
            OUTPUT out-end                                                                      /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
    
        ASSIGN                                                                                  /* 1dot4 */ 
            disp-start = out-start                                                              /* 1dot4 */    
            disp-end   = out-end.                                                               /* 1dot4 */    
        
        {&OUT}
            "<FORM>" SKIP
            "<DIV class='row'>" SKIP                                                                            /* 1dot3 */
			"<DIV class='grid_3'> </DIV>" SKIP                                                                  /* 1dot3 */
			"<DIV class='grid_6'>" SKIP                                                                         /* 1dot3 */
            "<DIV class='table_col'>" SKIP  
            "<TABLE>" SKIP 
            "   <TR>" SKIP  
            "       <TH colspan=4>Test Layout Maintenance (Sections)</TH>" SKIP
            "   <TR>" SKIP
            "       <TD>Test Type</TD>" SKIP 
            "       <TD>" SKIP
            "           <input type='hidden' name='h-testtype' value='" testtype "' />" testtype SKIP 
            "       </TD>" SKIP
            "   </TR>" SKIP 
            "   <TR>" SKIP
            "       <TD>Section Description</TD>" SKIP
            "       <TD>" SKIP
            "           <input type='text' name='h-sectdesc' value='" sectdesc "' />" SKIP
            "       </TD>" SKIP
            "   </TR>" SKIP
            
		    "   <TR>" SKIP 
		    "       <TD>Start Effective Date</TD>" SKIP
		    "       <TD><input type='date' name='html5-start' value=" disp-start " /></TD>" SKIP                  /* 1dot5 */
		    "   </TR>" SKIP
		    "   <TR>" SKIP
		    "       <TD>End Effective Date</TD>" SKIP
		    "       <TD><input type='date' name='html5-end' value=" disp-end " /></TD>" SKIP                      /* 1dot5 */
		    "   </TR>" SKIP
		    "   <TR>" SKIP
		    "       <TD>Sort Order</TD>" SKIP
		    "       <TD><input type='number' name='h-sortorder' value=" sortorder "/></TD>" SKIP
		    "   </TR>" SKIP   
            "</TABLE>" SKIP
            "</DIV>" SKIP                                                                                                                /* 1dot3 */
            "</DIV>         <!-- end of grid_6 -->" SKIP                                                                                 /* 1dot3 */
			"<DIV class='grid_3'> </DIV>" SKIP                                                                                           /* 1dot3 */
			"</DIV>     <!-- end of row -->" SKIP                                                                                        /* 1dot3 */
			"<BR>" SKIP                                                                                                                  /* 1dot3 */
			"<div class='row'>" SKIP                                                                                                     /* 1dot3 */
			"   <div class='grid_5'> </DIV>" SKIP                                                                                        /* 1dot3 */
			"<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                           /* 1dot3 */
			"   <div class='grid_2'><button type='submit' name='h-act' value='CREATE' class='btn'>Create Record</BUTTON></div>" SKIP     /* 1dot3 */
			"   <div class='grid_5'> </DIV>" SKIP                                                                                        /* 1dot3 */
			"</div>" SKIP                                                                                                                /* 1dot3 */
			
/* *** removed in 1dot3 ***
            "<center>"
            "<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                      /* 1dot1 */
            "<INPUT type='hidden' name='h-act' value='CREATE' />" SKIP
            "<INPUT type='submit' name='Submit' value='Create Record' /></center>" SKIP         
            "</DIV>" SKIP
    *** end of removal *** */
            "</FORM>" SKIP.  
        
    END.  /** of act = "PROMPT" **/
    
    WHEN "CREATE" THEN DO:
        
                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Inside Create</P>" SKIP
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
                
        FIND FIRST tl_mstr WHERE 
            tl_mstr.tl_section_desc = sectdesc AND                              /* 1dot6 */
/*            tl_mstr.tl_sect_id = sectid AND*/
            tl_mstr.tl_testtype = testtype AND                                  /* 1dot2 */
            tl_mstr.tl_deleted = ?                                              /* 1dot2 */
                NO-LOCK NO-ERROR.           
                /** actually commented out in 1dot2 **                                   
        IF NOT AVAILABLE (tl_mstr) THEN                                                             /* 1dot1 - bonus error checking */
            FIND FIRST tl_mstr WHERE tl_mstr.tl_section_desc = sectdesc AND 
                tl_mstr.tl_testtype = testtype AND                              /* 1dot2 */
                tl_mstr.tl_deleted = ?                                          /* 1dot2 */
                    NO-LOCK NO-ERROR.                                                               /* 1dot1 - bonus error checking */
                    **/
                    
        IF AVAILABLE tl_mstr THEN DO: 

                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Inside Avail tl_mstr</P>" SKIP
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
            {&OUT}
                "<CENTER>" 
                "<P class='errmsg'>ERROR! Section " tl_mstr.tl_section_desc " already exists for test type " tl_mstr.tl_testtype ".  Would you like to update the existing record?</P>" SKIP               
/*                "<P class='errmsg'>ERROR! Section " tl_mstr.tl_sect_id " already exists with a Section Description of " tl_mstr.tl_section_desc ".  Would you like to update the existing record?</P>" SKIP*/
                "<FORM>" SKIP
                "<input type='hidden' name='h-testtype' value='" tl_mstr.tl_testtype "' />" SKIP        /* 1dot1 - bonus error checking */
                "<input type='hidden' name='h-sectdesc' value='" tl_mstr.tl_section_desc "' />" SKIP    /* 1dot1 - bonus error checking */
                "<input type='hidden' name='h-act' value='FIND SECTION' />" SKIP                        /* 1dot1 - bonus error checking */
                "<button name='h-sectid' value=" tl_mstr.tl_sect_id " type='submit'>Yes</button>" SKIP 
                "<button name='h-sectid' value=0 type='submit'>No</button></FORM></CENTER>" SKIP.
                                                                                                    
            act = "ITEM EXISTS".    /* not actually used.  Was originally going to be tied to the OTHERWISE condition in the email */
        
        END.  /** of if avail tl_mstr **/
        
        ELSE DO:
            
                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Inside Not Avail tl_mstr</P>" SKIP
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
                    
            CREATE tl_mstr.
            ASSIGN 
                tl_mstr.tl_sect_id          = NEXT-VALUE(seq-tl) 
                tl_mstr.tl_testtype         = testtype
                tl_mstr.tl_section_desc     = sectdesc
                tl_mstr.tl_start_eff        = starteff
                tl_mstr.tl_end_eff          = endeff
                tl_mstr.tl_order            = sortorder
                tl_mstr.tl_created_by       = USERID("Modules")
                tl_mstr.tl_create_date      = TODAY 
                tl_mstr.tl_modified_by      = USERID("Modules")
                tl_mstr.tl_modified_date    = TODAY
                sectid                      = tl_mstr.tl_sect_id
                tl_mstr.tl_prog_name        = THIS-PROCEDURE:FILE-NAME.                         /* 1dot6 */
             
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            starteff,                                                                           /* 1dot4 */
            OUTPUT out-start                                                                    /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
 
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                                /* 1dot4 */
            endeff,                                                                             /* 1dot4 */
            OUTPUT out-end                                                                      /* 1dot4 */    
            ).                                                                                  /* 1dot4 */
    
        ASSIGN                                                                                  /* 1dot4 */ 
            disp-start = out-start                                                              /* 1dot4 */    
            disp-end   = out-end.                                                               /* 1dot4 */    
         
         {&OUT}
            "<FORM>" SKIP
            "<DIV class='row'>" SKIP                                                                            /* 1dot3 */
            "<DIV class='grid_3'> </DIV>" SKIP                                                                  /* 1dot3 */
            "<DIV class='grid_6'>" SKIP                                                                         /* 1dot3 */
            "<DIV class='table_col'>" SKIP  
            "<TABLE>" SKIP 
            "   <TR>" SKIP  
            "       <TH colspan=4>Test Layout Maintenance (Sections)</TH>" SKIP
            "   <TR>" SKIP
            "       <TD>Test Type</TD>" SKIP 
            "       <TD>" SKIP
            "           <input type='hidden' name='h-testtype' value='" testtype "' />" testtype SKIP 
            "       </TD>" SKIP
            "   </TR>" SKIP 
            "   <TR>" SKIP
            "       <TD>Section Description</TD>" SKIP
            "       <TD>" SKIP
            "           <input type='text' name='h-sectdesc' value='" sectdesc "' DISABLED/>" SKIP
            "       </TD>" SKIP
            "   </TR>" SKIP
            
            "   <TR>" SKIP 
            "       <TD>Start Effective Date</TD>" SKIP
            "       <TD><input type='date' name='html5-start' value=" disp-start " DISABLED /></TD>" SKIP                  /* 1dot5 */
            "   </TR>" SKIP
            "   <TR>" SKIP
            "       <TD>End Effective Date</TD>" SKIP
            "       <TD><input type='date' name='html5-end' value=" disp-end " DISABLED /></TD>" SKIP                      /* 1dot5 */
            "   </TR>" SKIP
            "   <TR>" SKIP
            "       <TD>Sort Order</TD>" SKIP
            "       <TD><input type='number' name='h-sortorder' value=" sortorder " DISABLED/></TD>" SKIP
            "   </TR>" SKIP   
            "</TABLE>" SKIP
            "</DIV>" SKIP                                                                                                                /* 1dot3 */
            "</DIV>         <!-- end of grid_6 -->" SKIP                                                                                 /* 1dot3 */
            "<DIV class='grid_3'> </DIV>" SKIP                                                                                           /* 1dot3 */
            "</DIV>     <!-- end of row -->" SKIP                                                                                        /* 1dot3 */
            "<BR>" SKIP                                                                                                                  /* 1dot3 */
            "<div class='row'>" SKIP                                                                                                     /* 1dot3 */
            "   <div class='grid_5'> </DIV>" SKIP                                                                                        /* 1dot3 */
            "<INPUT type='hidden' name='whattorun' value='" get-value('whattorun') "' />" SKIP                                           /* 1dot3 */                                    
            "   <div class='grid_2'><button type='submit' name='h-act' value='INITIAL' class='btn'>Initial</BUTTON></div>" SKIP     /* 1dot3 */
            "   <div class='grid_5'> </DIV>" SKIP                                                                                        /* 1dot3 */
            "</div>" SKIP.                                                                                                                /* 1dot3 */
                 
/*            {TLsecmaintU-form.i "INITIAL" "DISABLED" "DISABLED" "DISABLED" "NOTHING" "Maintenance"}.*/
                
        END.  /** of else do **/
        
    END.  /** of act = "CREATE" **/
      
    OTHERWISE DO: 
                       
                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT}
                                                                                        "<P>Inside Otherwise Do</P>" SKIP
                                                                                        "<P>Act = " act "</P>" SKIP
                                                                                       "<P>sectid = " sectid "</P>" SKIP    
                                                                                       "<P>sectdesc = " sectdesc "</P>" SKIP
                                                                                       "<P>testtype = " testtype "</P>" SKIP
                                                                                       "<P>sortorder = " sortorder "</P>" SKIP
                                                                                        "<hr width=90%>" SKIP.
                                           
        {&OUT} 
            "<P class='errmsg'>Unexpected Condition!  Please contact <a href='mailto:hhi.techsupport@mysolsource.com?subject=Error with TLsecmaintU.html -- " act "'>Solsource</a> immediately.</P>" SKIP             
            "<FORM method='post'>" SKIP
            "<center><INPUT type='hidden' name='h-act' value='INITIAL' />" SKIP 
            "<INPUT type='submit' name='Submit' value='Return to Menu' /></center>" SKIP  
            "</FORM>" SKIP.     
        
    END.  /** of otherwise **/
    
END CASE.  /*** case of act ***/

                                                                                IF ITshowmsg = YES THEN 
                                                                                    {&OUT} "<P>End OF LINE.</P>".

/*******************************  End of Program  **********************************/


</SCRIPT>
</BODY>
</HTML>