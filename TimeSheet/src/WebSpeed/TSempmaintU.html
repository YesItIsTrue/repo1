<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>Employee Maintenance</TITLE>
    <META NAME="AUTHOR" CONTENT="Andrew Garver">
    <META NAME="VERSION" CONTENT="2.0">
    <META NAME="COPYRIGHT" CONTENT="Solsource">
    <META NAME="CREATE_DATE" CONTENT="23/Dec/15">
    <META NAME="MODIFIED_DATE" CONTENT="11/Jul/16">
    <!--WSS {external-dependencies.i} -->
    
    <script>
        $(document).ready(function() {
            $('#empTable').DataTable({
                lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]]
            });
            
            // Address Picker
            function formatAddressResponse (data) {
               var display = "<div><p style='margin: 0px'>" + data.text + "</p>";
               if (data.addr2 != undefined) {
                 display += "<p style='margin: 0px'>" + data.addr2 + "</p>";
               }
               if (data.cityStateZip != undefined) {
                 display += "<p style='margin: 0px'>" + data.cityStateZip + "</p>";
               }
               display += "</div>";
               return display;
            }
        
            function formatAddressSelection (data) {
                var display = data.text;
                if (data.addr2 != undefined && data.addr2 != "") {
                    display += ", " + data.addr2;
                }
                if (data.cityStateZip != undefined && data.cityStateZip != "") {
                    display += ", " + data.cityStateZip;
                }
                return display;
            }
            
            $("#emp-address").select2({
                ajax: {
                    url: "AJAX-address-picker.r",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                      return {
                        addr1: params.term, // search term
                        page: params.page
                      };
                    },
                    processResults: function (data, params) {
                      params.page = params.page || 1;
                
                      return {
                        results: data.results,
                        pagination: {
                          more: (params.page * 30) < data.total_count
                        }
                      };
                    },
                    cache: true
                  },
                  escapeMarkup: function (markup) { return markup; },
                  minimumInputLength: 1,
                  templateResult: formatAddressResponse,
                  templateSelection: formatAddressSelection
            });
            
            function populateStateDropdown(){
                $.post("AJAX-populate-state-dropdown.r",
                {
                    countryISO: $("#country-picker").val() ? $("#country-picker").val() : "USA" 
                },
                function(response, status){
                    $("#state-picker").children('option').remove();
                    $.each(response, function (key, value) {
                        $("#state-picker").append("<option value='" + key + "'>" + value + "</option>");
                    });
                });
            }
            
            $("#country-picker").change(function() {
                populateStateDropdown();
            });
            
            $("#emp-address").change(function() {
                if ($(this).val() == "-1") {
                    $("#new-addr-modal").modal();
                    populateStateDropdown();
                }
            });
            
            $("#addr-modal-form").submit(function(e) {
                e.preventDefault();
                $.post("AJAX-create-address.r",
                    $("#addr-modal-form").serialize(),
                    function(data, success) {
                       if (data.success) {
                           let select = $('#emp-address');
                           let option = $('<option></option>').
                                attr('selected', true).
                                text(data.prettyAddress).
                                val(data.addrid);
                           option.appendTo(select);
                           select.trigger('change');
                           $("#new-addr-modal").modal("hide");
                       }
                       else {
                           swal(
                              'Whoops!',
                              data.error,
                              'error'
                            )
                       }
                });
            });
        });
    </script>
	
	<!--WSS
    PROCEDURE Output-Header:
        {cookie-check-permissions.i "TSlogin.r"}.
    END PROCEDURE.
    -->
</HEAD>
<BODY class='w3-theme-light'>

<!--WSS
{TSvert-menu.i}.
  /*------------------------------------------------------------------
    File:           TSempmaintU.html
    Description:    Employee Maintenance Screen
    Created:        Andrew Garver
    Version History:
        1.0 - Created by Andrew Garver 12/7/17 
  -------------------------------------------------------------------*/
DEFINE VARIABLE empid         LIKE Emp_Mstr.Emp_ID                NO-UNDO.
DEFINE VARIABLE empadmin      LIKE Emp_Mstr.Emp_admin             NO-UNDO. 
DEFINE VARIABLE empdept       LIKE Emp_Mstr.Emp_dept              NO-UNDO.
DEFINE VARIABLE emppayrate    LIKE Emp_Mstr.Emp_base_pay          NO-UNDO.
DEFINE VARIABLE loadedpay     LIKE Emp_Mstr.Emp_loaded_pay        NO-UNDO.
DEFINE VARIABLE translation   LIKE Emp_Mstr.Emp_trans_def         NO-UNDO.
DEFINE VARIABLE emptype       LIKE Emp_Mstr.Emp_type              NO-UNDO.

DEFINE VARIABLE t1            AS CHARACTER INITIAL "" NO-UNDO.
DEFINE VARIABLE t2            AS CHARACTER INITIAL "" NO-UNDO.

DEFINE VARIABLE firstname     LIKE people_mstr.people_firstname   NO-UNDO.
DEFINE VARIABLE lastname      LIKE people_mstr.people_lastname    NO-UNDO.
DEFINE VARIABLE company       LIKE people_mstr.people_company     NO-UNDO.
DEFINE VARIABLE gender        LIKE people_mstr.people_gender      NO-UNDO.
DEFINE VARIABLE homephone     LIKE people_mstr.people_homephone   NO-UNDO.
DEFINE VARIABLE cellphone     LIKE people_mstr.people_cellphone   NO-UNDO.
DEFINE VARIABLE workphone     LIKE people_mstr.people_workphone   NO-UNDO.
DEFINE VARIABLE workemail     LIKE people_mstr.people_email       NO-UNDO.
DEFINE VARIABLE otheremail    LIKE people_mstr.people_email2      NO-UNDO.
DEFINE VARIABLE prefname      LIKE people_mstr.people_prefname    NO-UNDO.  /* 1dot1 */

DEFINE VARIABLE progname      AS CHARACTER                        NO-UNDO.

DEFINE VARIABLE empname       AS CHARACTER                        NO-UNDO.

DEFINE VARIABLE emph-notes    LIKE Emph_hist.Emph_notes           NO-UNDO.
DEFINE VARIABLE emph-action   LIKE Emph_hist.Emph_action          NO-UNDO.
DEFINE VARIABLE actionlist    AS CHARACTER 
                              INITIAL "Hire,Update Info,Bonus,Raise,Promotion,Warning,Terminate,Retire,Quit,Abandon" NO-UNDO.      

DEFINE VARIABLE addr1         LIKE addr_mstr.addr_addr1           NO-UNDO.
DEFINE VARIABLE addr2         LIKE addr_mstr.addr_addr2           NO-UNDO.
DEFINE VARIABLE addr3         LIKE addr_mstr.addr_addr3           NO-UNDO.
DEFINE VARIABLE city          LIKE addr_mstr.addr_city            NO-UNDO.
DEFINE VARIABLE state         LIKE addr_mstr.addr_stateprov       NO-UNDO.
DEFINE VARIABLE zip           LIKE addr_mstr.addr_zip             NO-UNDO.
DEFINE VARIABLE cntry         LIKE addr_mstr.addr_country         NO-UNDO.
DEFINE VARIABLE addrid        LIKE addr_mstr.addr_id              NO-UNDO.

DEFINE VARIABLE act           AS CHARACTER                        NO-UNDO.
DEFINE VARIABLE itmessage     AS LOGICAL INITIAL NO               NO-UNDO.

DEFINE VARIABLE disp-dob      AS CHARACTER                        NO-UNDO.
DEFINE VARIABLE dob           LIKE people_mstr.people_DOB         NO-UNDO.
DEFINE VARIABLE empraise      LIKE Emp_Mstr.Emp_raise_date        NO-UNDO.
DEFINE VARIABLE disp-action   AS CHARACTER                        NO-UNDO.
DEFINE VARIABLE actiondate    LIKE Emph_hist.Emph_action_date     NO-UNDO.

DEFINE VARIABLE addrline      AS CHARACTER                        NO-UNDO.   
DEFINE VARIABLE x             AS INTEGER                          NO-UNDO.
DEFINE VARIABLE isdisabled    AS CHARACTER                        NO-UNDO.
DEFINE VARIABLE isreq         AS CHARACTER                        NO-UNDO.
DEFINE VARIABLE htmlreq       AS CHARACTER                        NO-UNDO.

DEFINE VARIABLE error-count   AS INTEGER                          NO-UNDO.

DEFINE VARIABLE o-create      AS LOGICAL                          NO-UNDO.
DEFINE VARIABLE o-update      AS LOGICAL                          NO-UNDO.
DEFINE VARIABLE o-avail       AS LOGICAL                          NO-UNDO. 
DEFINE VARIABLE o-successful  AS LOGICAL                          NO-UNDO.
DEFINE VARIABLE o-error       AS LOGICAL                          NO-UNDO.
DEFINE VARIABLE o-emph-action AS CHARACTER                        NO-UNDO.
DEFINE VARIABLE o-fpat-ran    AS LOGICAL                          NO-UNDO.
DEFINE VARIABLE o-addrid      AS INTEGER                          NO-UNDO.

DEFINE VARIABLE pp-passBack-peopid AS INTEGER                       NO-UNDO.                  
DEFINE VARIABLE pp-passBack-addrid AS INTEGER                       NO-UNDO.
DEFINE VARIABLE pass-act         AS CHARACTER                     NO-UNDO.

DEFINE VARIABLE defclient     LIKE Emp_Mstr.Emp_def_client        NO-UNDO.          /* 1dot2 */
DEFINE VARIABLE defproj       LIKE Emp_Mstr.Emp_def_proj          NO-UNDO.          /* 1dot2 */
DEFINE VARIABLE clientabbv    LIKE Client_Mstr.Client_abbv        NO-UNDO.          /* 1dot2 */
DEFINE VARIABLE cliproj       AS CHARACTER                        NO-UNDO.          /* 1dot2 */    
DEFINE VARIABLE isselected    AS CHARACTER                        NO-UNDO.          /* 1dot2 */    
DEFINE VARIABLE v-calling-prog AS CHARACTER                       NO-UNDO.

ASSIGN 
    empid         = INTEGER(html-encode(get-value("h-empid")))
    empadmin      = IF html-encode(get-value("h-empadmin")) = "Yes" THEN 
                        YES
                            ELSE 
                                NO 
    empdept       = html-encode(get-value("h-empdebt"))
    emppayrate    = DECIMAL(html-encode(get-value("h-emppayrate")))
    loadedpay     = DECIMAL(html-encode(get-value("h-loadedpay")))
    translation   = html-encode(get-value("h-translation"))
    
    emph-action    = html-encode(get-value("h-emph-action"))
    emph-notes     = html-encode(get-value("h-emph-notes"))
    emptype        = html-encode(get-value("h-emptype"))
    
    firstname     = html-encode(get-value("h-firstname"))
    lastname      = html-encode(get-value("h-lastname"))
    homephone     = html-encode(get-value("h-homephone"))
    cellphone     = html-encode(get-value("h-cellphone"))
    workphone     = html-encode(get-value("h-workphone"))
    workemail     = html-encode(get-value("h-workemail"))
    otheremail    = html-encode(get-value("h-otheremail"))
    company       = html-encode(get-value("h-company"))
    gender        = IF html-encode(get-value("h-gender")) = "YES" THEN 
                        YES 
                            ELSE 
                                NO    
    prefname      = html-encode(get-value("h-prefname"))                                      /* 1dot1 */
    
    addr1         = html-encode(get-value("h-addr1"))
    addr2         = html-encode(get-value("h-addr2"))
    addr3         = html-encode(get-value("h-addr3"))
    city          = html-encode(get-value("h-city"))
    state         = html-encode(get-value("h-state"))
    cntry         = html-encode(get-value("h-cntry"))
    addrid        = INTEGER(html-encode(get-value("h-address-id")))
      
    pp-passBack-peopid      = INTEGER(html-encode(get-value("h-pp-passBack-peopid")))             
    pp-passBack-addrid      = INTEGER(html-encode(get-value("h-pp-passBack-addrid")))
    
    act           = html-encode(get-value("h-act"))
    
    disp-dob      = html-encode(get-value("html5-dob"))
    disp-action   = html-encode(get-value("html5-action"))
    
    progname      = SUBSTRING(THIS-PROCEDURE:FILE-NAME,R-INDEX(THIS-PROCEDURE:FILE-NAME,"\") + 1)
    
    cliproj       = html-encode(get-value("h-cliproj"))                                  /* 1dot2 */
    v-calling-prog = html-encode(get-value("h-calling-prog"))
    .

IF disp-dob <> ? THEN     
	RUN VALUE(SEARCH("subr_CCYY_to_YY.r")) (                                           
		disp-dob,                                                               
		OUTPUT dob                                                             
		).                 

IF disp-action <> ? THEN 
	RUN VALUE(SEARCH("subr_CCYY_to_YY.r")) (                                   
	    disp-action,                                                                 
	    OUTPUT actiondate                                                               
	    ).   	                                    
    
IF act = "" THEN 
    ASSIGN 
        act = "INITIAL".    

FIND people_mstr WHERE people_mstr.people_id = empid OR people_mstr.people_id = pp-passBack-peopid NO-LOCK NO-ERROR.

IF AVAILABLE (people_mstr) THEN 
     ASSIGN
         firstname = people_mstr.people_firstname
         lastname = people_mstr.people_lastname  
         dob = people_mstr.people_DOB
         empname = people_mstr.people_lastname + ", " + people_mstr.people_firstname. 
/* *********************************** Body ************************************* */
-->
    
	<script>
	    $(document).ready(function() {
	        $("#deleteButton").click(function() {
	            $.post("AJAX-get-entries-by-employee.r",
	            {
	                employeeID: $("[name='h-empid']").val()
	            },
	            function(data, success) {
	                if (!$.isEmptyObject(data)) {
	                    swal(
	                        "Slow down there, Friend!",
	                        "You need to delete all time entries associated with `empname` before deleting their record.",
	                        "warning"
	                    );
	                }
	                else {
	                    swal({
	                      title: 'Are you sure?',
	                      text: "Do you really want to delete the employee, `empname`?",
	                      type: 'warning',
	                      showCancelButton: true,
	                      confirmButtonColor: '#3085d6',
	                      cancelButtonColor: '#d33',
	                      confirmButtonText: 'Yes, delete it!'
	                    }).then(function (result) {
	                      if (result.value) {
	                        $.post("AJAX-delete-employee.r",
	                        {
	                            employeeID: $("[name='h-empid']").val(),
	                            addressID: $("[name='h-address-id']").val()
	                        },
	                        function(data, success) {
	                            if (data.success) {
	                                swal("Success!",
	                                "`empname`, has been deleted.",
	                                "success")
	                                .then(function() {
	                                    if ($("#callingProgram").val() === "") {
	                                        window.location = "TSempmaintU.r";
                                        }
                                        else {
                                            window.location = "`v-calling-prog`.r";
                                        }
	                                });
	                            }
	                            else {
	                                swal("Whoops!", data.error, "error");
	                            }
	                        });
	                      }
	                    })
	                }
	            });
	        });
	    });
	</script>

    <div class="vert-nav-page">
        <div class="page-content">
        <br/><br/>
        
<!--WSS
CASE act:
    
    WHEN "INITIAL" THEN DO:
        
        IF html-encode(get-value("empUpdated")) <> "" THEN DO:
-->
        <script>
            $(document).ready(function() {
                $.notify({
                    // options
                    icon: 'fa fa-check',
                    message: '`empname` was successfully updated!'
                },{
                    // settings
                    type: "success",
                    delay: 2500
                });
            });
        </script>
<!--WSS
        END. /* IF html-encode(get-value("empUpdated")) <> "" */  
-->

        <h2 class='page-title'>Employee Maintenenace</h2>
            
        <div class='w3-content'>
            <div class='form-content w3-card-4 w3-white' style='padding-right:16px; padding-left:16px; overflow:auto;'>
                <div class='table_report'>
					<table id='empTable' class="stripe"> 
					    <thead> 
						    <tr> 
						        <td>Employee Name</td> 
						        <td>Date of Birth</td>    
						        <td>Start Date</td>  
						    </tr> 
					    </thead>
<!--WSS
        FOR EACH Emp_Mstr WHERE Emp_Mstr.Emp_deleted = ? NO-LOCK,
        EACH Emph_hist WHERE Emph_hist.Emph_emp_ID = Emp_Mstr.Emp_ID AND Emph_hist.Emph_action = "Hire" NO-LOCK,
        EACH people_mstr WHERE people_mstr.people_id = Emp_Mstr.Emp_ID AND 
        ((people_mstr.people_firstname BEGINS firstname) OR (firstname = "")) AND 
        ((people_mstr.people_lastname BEGINS lastname) OR (lastname = "")) AND people_mstr.people_deleted = ?
        NO-LOCK BREAK BY people_mstr.people_lastname BY people_mstr.people_firstname:
                                          
            ASSIGN 
                empname = people_mstr.people_lastname + ", " + people_mstr.people_firstname
                dob     = people_mstr.people_DOB
                empid   = Emp_Mstr.Emp_ID
                firstname = people_mstr.people_firstname
                lastname = people_mstr.people_lastname.    
           
          RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                           
		    dob,                                                               
		    OUTPUT disp-dob                                                             
		    ).       
                
-->
				        <tr> 
				            <td><a href='TSempmaintU.r?h-pp-passBack-peopid=`Emp_Mstr.Emp_ID`&h-pp-passBack-addrid=`addrid`&h-act=MAINTENANCE'>`empname`</a></td> 
				            <td>`dob`</td> 
				            <td>`Emph_hist.Emph_action_date`</td> 
				        </tr>
<!--WSS
        END. /* 4ea. emp_mstr */       
-->
				        </table> 
				    </div>
		            <br/> 
		            <form>
		                <center>
                            <button type='submit' name='h-act' value='NEW' class='btn w3-theme-accent'>Create a new Employee</button>
                        </center>
		            </form>
		        </div>
		    </div>   
            
<!--WSS
    END. /* RESULTS */ 
    WHEN "NEW" THEN DO:
-->
            <form>
                <div class='w3-content'>
                    <div class="form-content w3-card-4 w3-white">
                        <center><h3>First, what is the name and birthdate of your new employee?</h3></center>
                        <div class="row">
                            <div class="col-md-2"></div>
                            <div class="col-md-8">
                                <label>Last Name</label> 
                                <input type='text' name='h-lastname' class='form-control' required/> 
                                <label>First Name</label> 
                                <input type='text' name='h-firstname' class='form-control' required/>
                                <label>Date of Birth</label>
                                <input type='date' name='html5-dob' class='form-control' required/>
                            </div>
                            <div class="col-md-2"></div>
                        </div>
                        <br/>
                        <center>
                            <button type='submit' name='h-act' value='MAINTENANCE' class='btn w3-theme-dark'>Next</button>
                        </center>
                    </div>
                </div>
            </form>
<!--WSS
    END.       
    WHEN "MAINTENANCE" THEN DO:                       
        
        IF  pp-passBack-peopid > 0 THEN DO:                    
            ASSIGN  
                empid    = pp-passBack-peopid
                addrid   = pp-passBack-addrid.
        
            FIND people_mstr WHERE people_mstr.people_id = empid AND
                                   people_mstr.people_deleted = ?
                                   NO-LOCK NO-ERROR.
            
            IF AVAILABLE (people_mstr) THEN 
                ASSIGN 
                    firstname = people_mstr.people_firstname
                    lastname = people_mstr.people_lastname  
                    dob = people_mstr.people_DOB.
            
        END.
         	    
        RUN VALUE(SEARCH("SUBpeop-datefindR.r")) (
            "",                     /*people_mstr.people_prefix   */
            firstname,              /*people_mstr.people_firstname*/
            "",                     /*people_mstr.people_midname  */
            lastname,               /*people_mstr.people_lastname */
            "",                     /*people_mstr.people_suffix   */
            dob,                    /*people_mstr.people_DOB      */
             OUTPUT empid,             
             OUTPUT o-addrid,         
             OUTPUT o-error,                    
             OUTPUT o-fpat-ran                        
            ).
        
        IF empid > 0 THEN DO:
            FIND people_mstr WHERE people_mstr.people_id = empid
                NO-LOCK NO-ERROR.
                
            ASSIGN
	            homephone  = people_mstr.people_homephone 
			    cellphone  = people_mstr.people_cellphone
			    workphone  = people_mstr.people_workphone
			    workemail  = people_mstr.people_email
			    otheremail = people_mstr.people_email2
			    company    = people_mstr.people_company
			    gender     = people_mstr.people_gender
			    prefname   = people_mstr.people_prefname        /* 1dot1 */
			    addrid     = IF addrid > 0 THEN addrid ELSE people_mstr.people_addr_id.
		END. /* if empid > 0 */	    
		
		IF addrid > 0 THEN DO:
		    FIND addr_mstr WHERE addr_mstr.addr_id = addrid NO-ERROR.
		    IF AVAILABLE (addr_mstr) THEN DO:
                ASSIGN 
                    addrline = addr_mstr.addr_addr1 + " " + addr_mstr.addr_addr2 + " " + addr_mstr.addr_addr3 + " " + addr_mstr.addr_city + " " + addr_mstr.addr_stateprov + ", "  + addr_mstr.addr_zip + " " + addr_mstr.addr_country.
		    END.
		END. /* IF addrid > 0 */

        FIND Emp_Mstr WHERE Emp_Mstr.Emp_ID = empid AND Emp_Mstr.Emp_deleted = ? NO-LOCK NO-ERROR. 
            
        IF AVAILABLE (Emp_Mstr) THEN 
            ASSIGN 
                empadmin    = Emp_Mstr.Emp_admin
                emppayrate  = Emp_Mstr.Emp_base_pay
                empdept     = Emp_Mstr.Emp_dept
                translation = Emp_Mstr.Emp_trans_def
                loadedpay   = Emp_Mstr.Emp_loaded_pay
                emptype     = Emp_Mstr.Emp_type. 

            IF emptype = "SALARY" THEN 
                ASSIGN 
                    t1 = "CHECKED".
                    
            ELSE IF emptype = "HOURLY" THEN 
                ASSIGN  
                    t2 = "CHECKED".      
            
            ASSIGN 
                 isreq = "class='req'"
                 htmlreq = "required".
         
         
        IF dob <> ? THEN       
        RUN VALUE(SEARCH("subr_YY_to_CCYY.r")) (                                           
		    dob,                                                               
		    OUTPUT disp-dob                                                             
		).     
-->

                <form>
                    <input type="hidden" id="callingProgram" name="h-calling-prog" value="`v-calling-prog`"/> 
		            <div class='w3-content'>
                        <div class="form-content w3-card-4 w3-white">
                            <h2 class='page-title'>Employee Maintenance</h2>
                            <center>
	                            <h3>`lastname + ", " + firstname` - `dob`</h3>
	                            <h3>Employee ID: `empid`</h3>
                            </center>
                            <div class='row'>
								<label>Preferred Name</label>
								<input type='text' name='h-prefname' class='form-control' value='`prefname`' /> 
                            </div>
                            <div class='row'> 
								<label>Pay Scale</label> 
								<input type='number' step='.01' name='h-emppayrate' class='form-control' value='`emppayrate`' /> 
								<label>Admin Privileges</label> 
<!--WSS
        IF empid = 0 THEN DO:
-->
                                <div class='radio'>
                                    <label><input type='radio' value='YES' name='h-empadmin'/>Yes</label><br/>
                                    <label><input type='radio' value='NO' name='h-empadmin' />NO</label>
                                </div>
<!--WSS
        END.
        ELSE IF empadmin = YES THEN DO:
-->
                        	    <div class='radio'>
                                    <label><input type="radio" value="YES" name="h-empadmin" checked>Yes</label><br/>
                                    <label><input type='radio' value='NO' name='h-empadmin' />NO</label>
                                </div>
<!--WSS
        END.
		ELSE IF empadmin = NO THEN DO:
-->
                                <div class='radio'>
                                    <label><input type='radio' value='YES' name='h-empadmin'/>Yes</label><br/>
                                    <label><input type='radio' value='NO' name='h-empadmin' checked/>NO</label>
                                </div>
<!--WSS
        END.
-->
                            </div> 
                            <div class='row'> 
                                <label>Loaded Pay</label>             
                                <input type='number' step='.01' name='h-loadedpay' class='form-control' value='`loadedpay`'/> 
                                <label>Payment Type</label>
                                <div class='radio'>
                                    <label><input type='radio' name='h-emptype' value='SALARY'  `t1` />Salary</label><br/>
                                    <label><input type='radio' name='h-emptype' value='HOURLY'  `t2` />Hourly</label>
                                </div> 
                            </div> 
                            <div class='row'> 
                                <label>Gender</label>
<!--WSS
        IF empid = 0 THEN DO:
-->
                                <div class='radio'>
                                    <label><input type='radio' value='Yes' name='h-gender'/>Male</label><br/>
                                    <label><input type='radio' value='No' name='h-gender'/>Female</label>
                                </div>
<!--WSS
        END.
        ELSE IF gender = YES THEN DO:
-->
                                <div class='radio'>
                                    <label><input type='radio' value='Yes' name='h-gender' checked/>Male</label></br>
                                    <label><input type='radio' value='No' name='h-gender'/>Female</label>
                                </div>
<!--WSS
        END.
        ELSE IF gender = NO THEN DO:
-->
                                <div class='radio'>
                                    <label><input type='radio' value='Yes' name='h-gender'/>Male</label></br>
                                    <label><input type='radio' value='No' name='h-gender' checked/>Female</label>
                                </div>
<!--WSS
        END.
-->
                                <label>Company</label> 
                                <input type='text' name='h-company' class='form-control' value='`company`'> 
                            </div>  			
							<div class='row'>
                                <label>Address</label>
							    <select name='h-address-id' id='emp-address' class='form-control'>
                                    <option value='`STRING(addrid)`'>`addrline`</option>
                                </select> 
							</div>
			                 <div class='row'> 
			                     <label>Home phone</label> 
			                     <input type='text' name='h-homephone' class='form-control' placeholder='xxx-xxx-xxxx' value='`homephone`'/>  
			                     <label>Cell phone</label> 
			                     <input type='text' name='h-cellphone' class='form-control' placeholder='xxx-xxx-xxxx' value='`cellphone`'/> 
			                 </div>  
			                 <div class='row'> 
			                     <label>Work phone</label> 
			                     <input type='text' name='h-workphone' class='form-control' placeholder='xxx-xxx-xxxx' value='`workphone`'/>  
			                 </div>  			
			                 <div class='row'> 
			                     <label>Business Email</label> 
			                     <input type='email' name='h-workemail' class='form-control' value='`workemail`'/>
			                     <label>Other Email</label> 
			                     <input type='email' name='h-otheremail' class='form-control' value='`otheremail`'/> 
			                 </div> 
			                 <div class='row'>
			                     <label>Default Client & Project</label>
			                     <select name='h-cliproj' class='form-control'>
			                         <option value='' />
<!--WSS
            FOR EACH Proj_Mstr NO-LOCK,                                                                    
            EACH Client_Mstr WHERE Client_Mstr.Client_people_ID = Proj_Mstr.Proj_client_ID NO-LOCK     
            BREAK BY Client_Mstr.Client_abbv BY Proj_Mstr.Proj_sort:                               
                
                IF empid > 0 THEN DO:      
	                IF Proj_Mstr.Proj_client_ID = Emp_Mstr.Emp_def_client AND Proj_Mstr.Proj_name = Emp_Mstr.Emp_def_proj THEN                                   
	                    isselected = "SELECTED".                                                               
	                ELSE                                                                                   
	                    isselected = "".                                                                   
	           END. 
	           ELSE 
	                isselected = "".
-->
                                    <option name='h-cliproj' value='`STRING(Proj_Mstr.Proj_client_ID) + "/" + Proj_Mstr.Proj_name`' `isselected`/>`Client_Mstr.Client_abbv + ": " + Proj_Mstr.Proj_name`</option>                    
<!--WSS
            END. /* 4ea. proj_mstr */ 
-->
            
        {&OUT}
			                    </select>   
			                </div>
				            <div class='row'>
				                <label>Action</label>             
			                    <select name='h-emph-action' class='form-control' `htmlreq`> 
			                        <option value=''/>
<!--WSS
            DO x = 1 TO NUM-ENTRIES(actionlist):
-->
                                    <option name='h-emph-action' value='`ENTRY(x,actionlist)`'/>`ENTRY(x,actionlist)`</option>
<!--WSS
               END.  /** do x **/
-->
			                    </select> 
			                    <label>Action Date</label> 
			                    <input type='date' name='html5-action' class='form-control' value='`disp-action`' `htmlreq`/> 
				            </div>  
				            <div class='row'> 
				                <label>Notes</label> 
				                <textarea rows=4 name='h-emph-notes' class='form-control'>`emph-notes`</textarea> 
				            </div>        
				            <br/>                   	     
					        <div class='row'>
			                    <input type='hidden' name='h-firstname'  value='`firstname`'/> 
			                    <input type='hidden' name='h-lastname'  value='`lastname`'/> 
			                    <input type='hidden' name='html5-dob'  value='`disp-dob`'/> 
			                    <input type='hidden' name='h-empid'  value='`empid`'/> 
			                    <center>
			                        <button type='submit' name='h-act' value='UPDATE' class='btn w3-theme-dark'>Update Employee</button>
				                    <button type='button' id='deleteButton' class='btn w3-red'>Delete Employee</button>
				                    <button type='reset' class='btn'>Clear Changes</button>
			                    </center>
				            </div>
			            </div>                  
			        </div> 
			    </form> 
			    
			    <!-- Modal -->
	            <div id="new-addr-modal" class="modal fade" role="dialog">
	              <div class="modal-dialog">
	                <div class="modal-content">
	                  <form id="addr-modal-form">
	                      <div class="modal-header">
	                        <button type="button" class="close" data-dismiss="modal">&times;</button>
	                        <h4 class="modal-title">Create a New Address</h4>
	                      </div>
	                      <div class="modal-body">
	                            <label>Address Line 1</label> 
	                            <input type='text' name='h-addr1' class='form-control' required/> 
	                            <label>Address Line 2</label> 
	                            <input type='text' name='h-addr2' class='form-control'/> 
	                            <label>Address Line 3</label> 
	                            <input type='text' name='h-addr3' class='form-control'/> 
	                            <label>City</label> 
	                            <input type='text' name='h-city' class='form-control' required/> 
	                            <label>State</label> 
	                            <select name='h-stateprov' id='state-picker' class='form-control' required></select> 
	                            <label>Zipcode</label> 
	                            <input type='text' name='h-zip' class='form-control' required/> 
	                            <label>Country</label> 
	                            <select name='h-country' id='country-picker' class='form-control' required>
	                            <!--WSS
	                            FOR EACH country_mstr WHERE country_mstr.Country_Primary = TRUE AND country_mstr.country_deleted = ? NO-LOCK BY country_mstr.country_ISO:
	                                IF country_mstr.country_ISO = "USA" THEN DO:
	                            -->
	                                <option value="`country_mstr.country_ISO`" selected>`country_mstr.country_display_name`</option>
	                            <!--WSS
	                                END.
	                                ELSE DO: 
	                            -->
	                                <option value="`country_mstr.country_ISO`">`country_mstr.country_display_name`</option>
	                            <!--WSS
	                                END.
	                            END.
	                            -->
	                            </select>
	                      </div>
	                      <div class="modal-footer">
	                        <button type="submit" id="addr-modal-submit-button" class="btn w3-theme-dark">Create</button>
	                      </div>
	                  </form>
	                </div>
	              </div>
	            </div>
<!--WSS
    END. /* MAINTENANCE */
    WHEN "UPDATE" THEN DO: 
        ASSIGN 
            v-calling-prog = html-encode(get-value("h-calling-prog")).
-->
        <input type="hidden" id="callingProgram" name="h-calling-prog" value="`v-calling-prog`"/>
<!--WSS
                                                                                        
        IF emph-action = "Raise" THEN 
            empraise = actiondate.
        
        RUN VALUE(SEARCH("SUBpeop-datefindR.r")) (
			"",						/*people_mstr.people_prefix   */
			firstname,				/*people_mstr.people_firstname*/
			"",						/*people_mstr.people_midname  */
			lastname,				/*people_mstr.people_lastname */
			"",						/*people_mstr.people_suffix   */
			dob,					/*people_mstr.people_DOB      */
			OUTPUT empid,             
			OUTPUT o-addrid,         
			OUTPUT o-error,                    
			OUTPUT o-fpat-ran                        
        ).
                                                                       
        RUN VALUE(SEARCH("SUBpeop-ucU.r")) (
			empid,					/*people_mstr.people_id       */
			firstname,				/*people_mstr.people_firstname*/
			"",						/*people_mstr.people_midname  */
			lastname,				/*people_mstr.people_lastname */
			"",						/*people_mstr.people_prefix   */
			"",						/*people_mstr.people_suffix   */ 
			company,     			/*people_mstr.people_company  */
			gender,					/*people_mstr.people_gender   */
			homephone,				/*people_mstr.people_homephone*/
			workphone,				/*people_mstr.people_workphone*/
			cellphone,				/*people_mstr.people_cellphone*/
			"",						/*people_mstr.people_fax      */
			workemail,				/*people_mstr.people_email    */
			otheremail,				/*people_mstr.people_email2   */
			addrid,					/*people_mstr.people_addr_id  */
			"",						/*people_mstr.people_contact  */
			dob,					/*people_mstr.people_DOB      */
			"",						/*people_mstr.people_second_addr_ID   */
		    prefname,               /*people_mstr.people_prefname         */          
		    "",                     /*people_mstr.people_title            */
			OUTPUT empid,
			OUTPUT o-create, 
			OUTPUT o-update,
			OUTPUT o-avail,
			OUTPUT o-successful
        ).          

	    ASSIGN 
	        defclient = INTEGER(SUBSTRING(cliproj,1,INDEX(cliproj,"/") - 1))      
	        defproj   = SUBSTRING(cliproj,INDEX(cliproj,"/") + 1,LENGTH(cliproj)). 
	    
	    RUN VALUE(SEARCH("SUBemp-ucU.r")) (	   
			empid,					/*Emp_Mstr.Emp_ID           */
			empadmin,				/*Emp_Mstr.Emp_admin        */
			empdept,				/*Emp_Mstr.Emp_dept         */
			emppayrate,				/*Emp_Mstr.Emp_base_pay      */
			empraise,				/*Emp_Mstr.Emp_raise_date   */
			loadedpay,              /*Emp_Mstr.Emp_loaded_pay   */
			translation,            /*Emp_Mstr.Emp_trans_def    */
			"",						/*Emp_Mstr.Emp_created_by   */
			?,						/*Emp_Mstr.Emp_create_date  */
			"",						/*Emp_Mstr.Emp_modified_by  */
			?,						/*Emp_Mstr.Emp_modified_date*/
			defclient,              /*Emp_Mstr.Emp_def_client   */      
			defproj,                /*Emp_Mstr.Emp_def_proj     */ 		
			emptype,                /*Emp_Mstr.Emp_type         */	
			OUTPUT empid,         
			OUTPUT o-create,                  
			OUTPUT o-update,                   
			OUTPUT o-avail,                  
			OUTPUT o-successful,
			OUTPUT o-error
		).             	   
                                                                                                                                                                                                                     
        IF emph-action <> "" THEN DO:                                                                                        	    
																					       
		    RUN VALUE(SEARCH("SUBemph-ucU.r")) ( 
				empid,					/*Emph_hist.Emph_emp_ID       */
				emph-action,			/*Emph_hist.Emph_action       */
				actiondate,				/*Emph_hist.Emph_action_date  */
				emppayrate,				/*Emph_hist.Emph_payrate      */
				emph-notes,				/*Emph_hist.Emph_notes        */
				"",						/*Emph_hist.Emph_created_by   */
				?,						/*Emph_hist.Emph_create_date  */
				"",						/*Emph_hist.Emph_modified_by  */
				?,						/*Emph_hist.Emph_modified_date*/
				OUTPUT empid,       
				OUTPUT o-emph-action,       
				OUTPUT actiondate,   
				OUTPUT o-create,                  
	            OUTPUT o-update,                   
	            OUTPUT o-avail,                  
	            OUTPUT o-successful,
	            OUTPUT o-error                  	
	            ).
            
        END.            
                                    
        FIND people_mstr WHERE people_mstr.people_id = empid NO-LOCK NO-ERROR.
        
        IF AVAILABLE (people_mstr) THEN 
             ASSIGN 
                empname = people_mstr.people_lastname + ", " + people_mstr.people_firstname. 
        
        FIND Emp_Mstr WHERE Emp_Mstr.Emp_ID = empid AND Emp_Mstr.Emp_deleted = ? NO-LOCK NO-ERROR. 

        IF AVAILABLE (Emp_Mstr) THEN DO:                                                                 
-->
            <script>
                if ($("#callingProgram").val() === "") {
                    window.location = "TSempmaintU.html?empUpdated=true&h-empid=`empid`";
                }
                else {
                    window.location = "`v-calling-prog`.r";
                }
            </script>
<!--WSS
        END. /* if avail Emp_Mstr */
        ELSE DO:
            DISPLAY "Error in TSempmaintU.html: Emp_Mstr not found on line 869".
        END.
             
    END. /* UPDATE */     
    
END CASE.         
-->
	    </div>
	</div>
</BODY>
</HTML>