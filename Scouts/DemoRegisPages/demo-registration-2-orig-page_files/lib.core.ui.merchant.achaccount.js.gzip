"cm.ui.merchant.achaccount".namespace();cm.ui.merchant.achaccount.AchAccountEditConfigOptions=Class.create(cm.ConfigOptions,{title:"Ach Account Details",billingData:null,personID:0});cm.ui.merchant.achaccount.AchAccountEdit=Class.create(cm.ui.ComplexControl,{CancelEvent:null,SaveEvent:null,configureDefaultOptions:function(){return new cm.ui.merchant.achaccount.AchAccountEditConfigOptions()},initializeDAOs:function($super){$super()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}if(!$$CM.isNull(this._co.billingData)){this._billingData=this._co.billingData}},initializeUIElements:function(){this._divBody=$$P.div("AddAchAccount");this.AddChild(this._divBody);this._divBody.AddClassName("bd");this._divMessage=$$P.div("divAchAccountMessage_"+this._uniqueID);this._divBody.AddChild(this._divMessage);this._divMessage.AddClassName("mt10px mb20px");this._divMessage.UpdateInnerHtml("Please enter your name and address exactly as they appear on your bank statement.");this._divBilling=$$P.div("divAchAccountBilling_"+this._uniqueID);this._divBody.AddChild(this._divBilling);this._divBilling.AddClassName("mt10px mb20px");this._lblBillingMessage=$$P.span(null,"Your default Billing Address is:");this._divBilling.AddChild(this._lblBillingMessage);this._lblBillingAddress=$$P.span("lblAchAccountBillingAddress_"+this._uniqueID);this._divBilling.AddChild(this._lblBillingAddress);this._lblBillingAddress.AddClassName("cmBold ml5px mr5px");this._aUseBillingAddress=new $$A("aUseBillingAddress_"+this._uniqueID,{text:"use this address"});this._divBilling.AddChild(this._aUseBillingAddress);this._divBilling.Hide();this._divAccountInfo=$$P.div("divAccountInfo_"+this._uniqueID);this._divBody.AddChild(this._divAccountInfo);this._divAccountInfo.AddClassName("cmClear cmFormRow");this._ftxtRoutingNumber=new $$FTXT("ftxtRoutingNumber_"+this._uniqueID,{label:"Routing Number",isRequired:true,maxLength:9,minLength:9});this._divAccountInfo.AddChild(this._ftxtRoutingNumber);this._ftxtRoutingNumber.AddClassName("mb5px");this._ftxtRoutingNumber.GetTitleControl().AddClassName("w110px");this._ftxtAccountNumber=new $$FTXT("ftxtAchAccountAccountNumber_"+this._uniqueID,{label:"Account Number",isRequired:true});this._divAccountInfo.AddChild(this._ftxtAccountNumber);this._ftxtAccountNumber.AddClassName("mb5px");this._ftxtAccountNumber.GetTitleControl().AddClassName("w110px");this._fddlAccountType=new $$FDDL("fddlAccountType_"+this._uniqueID,{label:"Account Type",isRequired:true});this._divAccountInfo.AddChild(this._fddlAccountType);this._fddlAccountType.GetTitleControl().AddClassName("w110px");var a=$A();a.push({ID:cm.dao.Financial.Enums.BankAccountType.asEnum().GetId("Checking"),Name:"Checking"});a.push({ID:cm.dao.Financial.Enums.BankAccountType.asEnum().GetId("Savings"),Name:"Savings"});this._fddlAccountType.bindList(a,"","Select Type",false);this._divName=$$P.div("divAchAccountName_"+this._uniqueID);this._divBody.AddChild(this._divName);this._divName.AddClassName("cmClear cmFormRow");this._ftxtFirstName=new $$FTXT("ftxtAchAccountFirstName_"+this._uniqueID,{label:"First Name",isRequired:true});this._divName.AddChild(this._ftxtFirstName);this._ftxtFirstName.GetTitleControl().AddClassName("w110px");this._ftxtLastName=new $$FTXT("ftxtAchAccountLastName_"+this._uniqueID,{label:"Last Name",isRequired:true});this._divName.AddChild(this._ftxtLastName);this._ftxtLastName.GetTitleControl().AddClassName("w110px");var b={enabled:true,legendLabel:"",legendCssClass:"",controlTitleCssClass:"w110px",controlInputCssClass:"",groupFieldName:"",required:true};this._ctrAddress=new $$FADDRESS("divBIAddress_"+this._uniqueID,b);this._divBody.AddChild(this._ctrAddress);this._divFooter=$$P.div("divBIFooter_"+this._uniqueID);this.AddChild(this._divFooter);this._divFooter.AddClassName("ft");this._btnSave=new $$BTN("btnBISave_"+this._uniqueID,{text:"Save"});this._divFooter.AddChild(this._btnSave);this._btnSave.AddClassName("cmGoButton cmFloatRight");this._btnDelete=new $$BTN("btnBIDelete_"+this._uniqueID,{text:"Delete"});this._divFooter.AddChild(this._btnDelete);this._btnDelete.AddClassName("cmCancelDeleteButton cmFloatRight");this._btnDelete.Hide();this._btnCancel=new $$BTN("btnBICancel_"+this._uniqueID,{text:"Cancel"});this._divFooter.AddChild(this._btnCancel);this._btnCancel.AddClassName("cmCancelDeleteButton");this.SetTabIndex(100)},createEvents:function($super){$super();this.CancelEvent=new cm.event();this.SaveEvent=new cm.event();this._ftxtAccountNumber.AddChangeListener();this._ftxtRoutingNumber.AddChangeListener();this._fddlAccountType.AddChangeListener();this._ftxtFirstName.AddChangeListener();this._ftxtLastName.AddChangeListener()},wireEvents:function($super){$super();this._ftxtAccountNumber.Validator.addEvaluator($$EVAL.ACHACCOUNTNUMBERREPEATING(new cm.validation.AccountNumberRepeatingValidationConfigOptions()),this._ftxtAccountNumber.ChangeEvent);this._ftxtAccountNumber.Validator.addEvaluator($$EVAL.ACHACCOUNTNUMBERSEQUENTIAL(new cm.validation.AccountNumberSequentialValidationConfigOptions()),this._ftxtAccountNumber.ChangeEvent);this._ftxtRoutingNumber.Validator.addEvaluator($$EVAL.ACHROUTINGNUMBER(new cm.validation.RoutingNumberChecksumValidationConfigOptions()),this._ftxtRoutingNumber.ChangeEvent);this._fddlAccountType.Validator.addEvaluator($$EVAL.SELECT({FieldName:"Account Type",IsRequired:true}),this._fddlAccountType.ChangeEvent);this._ftxtFirstName.Validator.addEvaluator($$EVAL.TEXT({FieldName:"First Name",IsRequired:true}),this._ftxtFirstName.ChangeEvent);this._ftxtLastName.Validator.addEvaluator($$EVAL.TEXT({FieldName:"Last Name",IsRequired:true}),this._ftxtLastName.ChangeEvent);this._aUseBillingAddress.ClickEvent.subscribe(this.onUseBillingAddress,this);this._btnCancel.ClickEvent.subscribe(this.onCancel,this);this._btnSave.ClickEvent.subscribe(this.onSave,this)},BindBillingData:function(a){if(!$$CM.isNull(a)){this._co=this.GetConfigOptions();this._co.billingData=a;this._billingData=a}},BindObjectID:function(a){this._co=this.GetConfigOptions();this._co.objectID=a;this._objectID=a},toggleBillingAddress:function(){if(!$$CM.isNull(this._billingData)){var a="";if(!$$CM.isEmpty(this._billingData.MailingTitle)){if(!$$CM.isEmpty(a)){a+=", "}a+=this._billingData.MailingTitle}if(!$$CM.isNull(this._billingData.Address)){if(!$$CM.isEmpty(a)){a+=", "}a+=$$CM.getFormattedAddressInLine(this._billingData.Address)}if(!$$CM.isEmpty(a)){this._lblBillingAddress.UpdateInnerHtml(a);this._divBilling.Show()}}},onUseBillingAddress:function(b,a){if(!$$CM.isNull(this._billingData.Address)){this._ctrAddress.Bind(this._billingData.Address)}},onCancel:function(b,a){this.CancelEvent.fire(this,{})},onSave:function(c,a){if(this.IsValid(true)){var b=this.GetData();this.SaveEvent.fire(this,{data:b})}},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._divBilling.Hide();this._ftxtRoutingNumber.Bind(null);this._ftxtAccountNumber.Bind(null);this._fddlAccountType.Bind(null);this._ftxtFirstName.Bind(null);this._ftxtLastName.Bind(null);this._ctrAddress.Bind({Country:"US"});this._ftxtAccountNumber.Validator.Enable();this._ftxtAccountNumber.SetEnabled(true);this._ftxtRoutingNumber.Validator.Enable();this._ftxtRoutingNumber.SetEnabled(true);this._fddlAccountType.SetEnabled(true)},SetTabIndex:function(a){this._ftxtRoutingNumber.SetTabIndex(a++);this._ftxtAccountNumber.SetTabIndex(a++);this._fddlAccountType.SetTabIndex(a++);this._ftxtFirstName.SetTabIndex(a++);this._ftxtLastName.SetTabIndex(a++);this._ctrAddress.SetTabIndex(a);this._btnSave.SetTabIndex(a+=6);this._btnCancel.SetTabIndex(++a)},onDataUpdated:function(){this.ClearFields();this.toggleBillingAddress();var a=this.GetBoundData();if(!$$CM.isNull(a)){if(!(a.ID>0)){this._ftxtAccountNumber.Bind(a.AccountNumber);this._ftxtAccountNumber.SetEnabled(true)}else{if(!$$CM.isEmpty(a.AccountNumberLastFour)){this._ftxtAccountNumber.Bind(a.AccountNumberLastFour);this._ftxtAccountNumber.Validator.Disable();this._ftxtAccountNumber.SetEnabled(false)}else{this._ftxtAccountNumber.SetEnabled(true)}}if(!(a.ID>0)){this._ftxtRoutingNumber.Bind(a.RoutingNumber);this._ftxtRoutingNumber.SetEnabled(true)}else{if(!$$CM.isEmpty(a.RoutingNumberLastFour)){this._ftxtRoutingNumber.Bind(a.RoutingNumberLastFour);this._ftxtRoutingNumber.Validator.Disable();this._ftxtRoutingNumber.SetEnabled(false)}else{this._ftxtRoutingNumber.SetEnabled(true)}}if(!$$CM.isEmpty(a.AccountTypeID)){this._fddlAccountType.Bind(a.AccountTypeID);this._fddlAccountType.SetEnabled(false)}else{this._fddlAccountType.SetEnabled(true)}if(!$$CM.isEmpty(a.FirstName)){this._ftxtFirstName.Bind(a.FirstName)}if(!$$CM.isEmpty(a.LastName)){this._ftxtLastName.Bind(a.LastName)}if(!$$CM.isNull(a.Address)){a.Address.Country="US";this._ctrAddress.Bind(a.Address)}}this._ctrAddress.CountrySetEnabled(false)},GetData:function(){var b=this.GetBoundData();if($$CM.isNull(b)){b=new Object();b.ID=$$CM.uniqueNumber()*-1;b.AchAccountID=0;b.IsDefault=true;b.IsFamilyDefault=true}b.PersonID=this._co.personID;var c=this._ftxtRoutingNumber.GetData();if(c.indexOf("*")<=0){b.RoutingNumber=c}b.RoutingNumberLastFour=$$CM.obfuscate(c,1,3,10);var a=this._ftxtAccountNumber.GetData();if(a.indexOf("*")<=0){b.AccountNumber=a}b.AccountNumberLastFour=$$CM.obfuscate(a,1,3,10);b.AccountTypeID=this._fddlAccountType.GetData();b.FirstName=this._ftxtFirstName.GetData();b.LastName=this._ftxtLastName.GetData();b.Address=this._ctrAddress.GetData();return b}});