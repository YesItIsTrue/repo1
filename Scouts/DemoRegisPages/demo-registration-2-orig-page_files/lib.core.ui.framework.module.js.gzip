"cm.ui.framework.module".namespace();"cm.ui.framework.data".namespace();cm.ui.framework.module.Apps=Class.create(cm.ui.framework.Module,{_ls:null,AppLoadedEvent:null,AppLoadingEvent:null,AppCreatedEvent:null,AppUpdatedEvent:null,AppUpdatingEvent:null,AppCreateErrorEvent:null,AppDefinitionChangeEvent:null,onCreated:function(){this.AppDefinitions=$A();this.AppLoadedEvent=new cm.event();this.AppLoadingEvent=new cm.event();this.AppUpdatedEvent=new cm.event();this.AppUpdatingEvent=new cm.event();this.AppCreateErrorEvent=new cm.event();this.AppCreatedEvent=new cm.event();this.AppDefinitionChangeEvent=new cm.event();this._ls=new cm.browser.LocalStorage()},onHeadersLoaded:function(){if($$CM.isArray(this.AppDefinitions)){this.AppDefinitions=this.AppDefinitions.sortBy(function(a){return a.SortIndex});this.AppDefinitions.each(function(a){this.initializeAppDefinition(a)},this)}FW.ListenForMessages(MT_DefinitionResponseMessage,this.onDefinitionResponseMessage,this);FW.ListenForMessages(MT_VersionMatchMessage,this.onVersionMatchMessage,this);FW.ListenForMessages(MT_VersionUpdateMessage,this.onVersionUpdateMessage,this);this.Ready()},onDefinitionResponseMessage:function(b){var a=b.Definitions;if($$CM.isArray(a)){a.each(function(c){var e=this.AppDefinitions.find(function(d){return d.ID==c.ID});if(!$$CM.isNull(e)){this.AppDefinitions.remove(e)}this.AppDefinitions.push(c);this.initializeAppDefinition(c);this.AppDefinitionChangeEvent.fire(this,c)},this)}},onVersionMatchMessage:function(b){var a=this.GetDefinition(b.AppID);this.AppLoadedEvent.fire(this,a);a.LoadedEvent.fire(this,a)},onVersionUpdateMessage:function(b){var c=b.Data;var a=this.GetDefinition(c.ID);a.Version=b.Version;a.Name=c.Name;a.DisplayName=c.DisplayName;a.Tags=c.Tags;a.SortIndex=c.SortIndex;a.Packages=c.Packages;this.AppUpdatingEvent.fire(this,a);a.UpdatingEvent.fire(this,a);Framework.Resources.LoadStyle(b.Styles);Framework.Resources.LoadScript(b.Scripts,this.onScriptsUpdated,this,{app:c})},Load:function(a){if(!$$CM.isArray(a)){a=$A(arguments)}var b=a.collect(function(d){var c=this.GetDefinition(d);if($$CM.isNull(c)){this.log("Attempt to load invalid app ID "+d)}else{this.log("Loading '"+c.Name+"'");c.LoadingEvent.fire(this,c);this.AppLoadingEvent.fire(this,c);if(!$$CM.isNull(c)){this.CreateVersionCheckMessage(c)}}},this);FW.FlushMessages()},Create:function(appSelector,instanceID){var def=this.GetDefinition(appSelector);if($$CM.isNull(def)){this.log("Cannot get instance of undefined app '"+appSelector+"'")}else{if($$CM.isNull(def.Version)){this.log("Cannot create instance of '"+def.Name+"' -- the app has not been loaded yet")}else{try{eval("var app = new "+def.Namespace+"."+def.Name.replaceAll(" ","")+"(def);");app.InstanceID=instanceID;if(app.State==FW.Enums.AppState.Error&&!$$CM.isNull(app.Exception)){throw app.Exception}else{this.log("Created instance of app "+def.Name);this.AppCreatedEvent.fire(this,app);def.CreatedEvent.fire(this,app);app.LogEvent.subscribe(this.onAppLog,this);app.onCreate();return app}}catch(ex){this.error(ex,"Error creating instance of '"+def.Name+"': "+ex.message);this.AppCreateErrorEvent.fire(this,def);def.CreateErrorEvent.fire(this,ex)}}}},GetDefinition:function(a){return this.AppDefinitions.find(function(b){return(b.ID==a||b.Name==a)})},TagBase:function(){var a=$$CM.deepClone(this.AppDefinitions.collect(function(b){return{ID:b.ID,Name:b.Name,Tags:b.Tags,DisplayName:b.DisplayName,ChildApps:$A()}}));a.FilterTag=function(b){return FW.Apps.getTagGroupRecursive(b,a)};a.ExcludeTag=function(b){return FW.Apps.excludeTagGroupRecursive(b,a)};return a},FilterTag:function(a){return this.getTagGroupRecursive(a)},ExcludeTag:function(a){return this.excludeTagGroupRecursive(a)},IsLoaded:function(a){var b=this.GetDefinition(a);return(!$$CM.isNull(b)&&!$$CM.isNull(b.Version))},CreateVersionCheckMessage:function(a){this.CreateMessage(MT_VersionCheckMessage,{AppID:a.ID,Version:a.Version})},CreateDefinitionRequestMessage:function(a){if(!$$CM.isArray(a)){a=$A([a])}this.CreateMessage(MT_DefinitionRequestMessage,{Identifiers:a})},initializeAppDefinition:function(a){a.LoadingEvent=new cm.event();a.LoadedEvent=new cm.event();a.UpdatingEvent=new cm.event();a.UpdatedEvent=new cm.event();a.CreateErrorEvent=new cm.event();a.CreatedEvent=new cm.event();window["APP_"+a.Name.replace(/[\(\)]/gi,"").replace(/\s/gi,"_").toUpperCase()]=a.ID},getTagGroupRecursive:function(c,b){if($$CM.isNull(b)){b=this.AppDefinitions}var a=b.findAll(function(d){return d.Tags.indexOf(c)>=0});a.FilterTag=function(d){return FW.Apps.getTagGroupRecursive(d,a)};a.ExcludeTag=function(d){return FW.Apps.excludeTagGroupRecursive(d,a)};return a},excludeTagGroupRecursive:function(c,b){if($$CM.isNull(b)){b=this.AppDefinitions}var a=b.findAll(function(d){return d.Tags.indexOf(c)<0});a.FilterTag=function(d){return FW.Apps.getTagGroupRecursive(d,a)};a.ExcludeTag=function(d){return FW.Apps.excludeTagGroupRecursive(d,a)};return a},onScriptsUpdated:function(c){if(!$$CM.isObject(c)){c={}}var d=c.scope;var a=c.app;var b=this.GetDefinition(a.ID);this.log("'"+b.Name+"' has been updated to version "+b.Version);this.AppUpdatedEvent.fire(this,b);b.UpdatedEvent.fire(this,b)},onAppLog:function(b,a){this.log("("+b.Name+") "+a)}});cm.ui.framework.data.App=Class.create(cm.ui.Control,{ID:null,Name:null,Initialized:false,State:null,Guid:"",Error:null,LogEvent:null,StartEvent:null,ReadyEvent:null,StateChangeEvent:null,ErrorEvent:null,initialize:function($super,a){var c=this;this.AddClassName("cmApp");this.LogEvent=new cm.event();this.StartEvent=new cm.event();this.StateChangeEvent=new cm.event();this.ReadyEvent=new cm.event();this.ErrorEvent=new cm.event();this.ID=a.ID;this.Name=a.Name;this.Initialized=false;this.State=FW.Enums.AppState.GetId("Undefined");this.Guid=$$CM.rawGuid();try{$super()}catch(b){this.Crash(b)}},Log:function(a){this.LogEvent.fire(this,a)},Error:function(a){this.ErrorEvent.fire(this,a)},Crash:function(a){this.Exception=a;this.SetState("Error")},Start:function(){try{this.StartEvent.fire(this);this.onStart();this.Initialized=true;this.SetState("Active")}catch(a){this.Crash(a)}},IsState:function(a){return this.State==FW.Enums.AppState[a]},SetState:function(a){if($$CM.isNull(a)){this.State=FW.Enums.AppState.GetId("Undefined")}else{if(!$$CM.isNull(FW.Enums.AppState[a])){this.State=FW.Enums.AppState[a]}else{this.Log("Could not change app state: '"+a+"' is an invalid app state");return}}this.StateChangeEvent.fire(this,this.State)},Destroy:function(){this.onDestroy()},ready:function(){this.SetState("Ready")},readyCheck:function(){return true},onCreate:function(){},onStart:function(){},onReady:function(){},onDestroy:function(){},onLoaded:function(){},onActive:function(){$$GAT.trackPageView("/ui/person/record/"+this.Name)},onAjaxResponseError:function(a){this.Crash(a)}});"cm.ui.framework.data".namespace();"cm.ui.framework.module".namespace();cm.ui.framework.module.Core=Class.create(cm.ui.framework.Module,{_areListeners:null,onHeadersLoaded:function(){Framework.Modules=this.Modules;delete this.Modules;this._areListeners=new cm.ui.Hashtable();Framework.Enums=new Object();this.Enums.each(function(a){Framework.Enums[a.Name]=a.Array.asEnum()},this);delete this.Enums;Framework.MessageEvents=new cm.ui.Hashtable();this.MessageTypes.each(function(a){Framework.MessageEvents.put("m_"+a.ID,new cm.event());window["MT_"+a.Name]=a.ID},this);delete this.MessageTypes;Framework.Debug=this.Debug;delete this.Debug;this.Ready()},RegisterAjaxResponseErrorListener:function(d){var b=$$CM.rawGuid().replaceAll("-","");var a=new Error("An error occurred on the response from an AJAX call");var c=new Object();c.scope=d;c.err=a;this._areListeners.put(b,c);return b},FireAjaxResponseError:function(c,b){var a=this._areListeners.get(c);if($$CM.isFunction(a.scope.onAjaxResponseError)){a.scope.onAjaxResponseError.call(a.scope,b)}else{FW.error(b,b.message)}},ClearAjaxResponseErrorListener:function(a){this._areListeners.remove(a)}});"cm.ui.framework.data".namespace();"cm.ui.framework.module".namespace();cm.ui.framework.module.Data=Class.create(cm.ui.framework.Module,{DataStoreCreatedEvent:null,DataStoreChangedEvent:null,DataSubscribedEvent:null,onCreated:function($super){this.Initializers=$A();this.Enums=$A();this.DataStoreChangedEvent=new cm.event();this.DataStoreCreatedEvent=new cm.event();this.DataSubscribedEvent=new cm.event()},onStart:function(){this._dataStores=new cm.ui.Hashtable();this.createStore("Default");this.translateDAOs();this.Ready()},onEnumManipulateMessage:function(a){a.Enums.each(function(b){this.addEnum(b)},this)},onDataManipulateMessage:function(b){if($$CM.isNull(b.Store)){b.Store="Default"}this.createStore(b.Store);switch(b.Method){case FW.Enums.Method.Replace:this[b.Store].Replace(b.Array,b.Value);break;case FW.Enums.Method.Concat:this[b.Store].Concat(b.Array,b.Value);break;case FW.Enums.Method.Merge:this[b.Store].Merge(b.Array,b.Value,b.MergeKeys);break;case FW.Enums.Method.Strip:this[b.Store].Strip(b.Array,b.Value,b.MergeKeys);break}try{if($$CM.isNull(cm.dao[b.Store])){cm.dao[b.Store]={}}if($$CM.isNull(cm.dao[b.Store].Data)){cm.dao[b.Store].Data={}}cm.dao[b.Store].Data[b.Array]=b.Value}catch(a){this.log("Could not add legacy data reference to DAO '"+b.Store+"'")}},onHeadersLoaded:function(){FW.ListenForMessages(MT_EnumManipulateMessage,this.onEnumManipulateMessage,this);FW.ListenForMessages(MT_DataManipulateMessage,this.onDataManipulateMessage,this);this.Initializers.each(function(b){try{cm.dao[b.Store].Data[b.Array]=b.Value}catch(a){this.log("Could not add legacy data reference to DAO '"+b.Store+"'")}this.onDataManipulateMessage(b)},this);this.Enums.each(function(a){this.addEnum(a)},this);$$DATA=Framework.Data;$$ENUM=Framework.Enums;this.Ready()},Get:function(c,b,a){return this.GetStore(b).Get(c,a)},Set:function(c,b,a){this.GetStore(a).Set(c,b)},Convert:function(c,b,a){return this.GetStore(b).Convert(c,a)},Subscribe:function(b,a,c,d){this.GetStore(d).Subscribe(b,a,c)},GetStore:function(b){if($$CM.isNull(b)){b="Default"}var a=this[b];if($$CM.isNull(a)){a=this.createStore(b)}return a},GetDataStores:function(){var a=$A();for(var b in Framework.Data){if((Framework.Data[b] instanceof cm.ui.framework.data.DataStore)==true){a.push(this[b])}}return a},CreateLocalStore:function(){return new cm.ui.framework.data.DataStore("Local")},createStore:function(b){if($$CM.isNull(this[b])){var a=new cm.ui.framework.data.DataStore(b);this[b]=a;this.log("Created new data store '"+b+"'");a.DataUpdateEvent.subscribe(this.onDataStoreUpdate,this);a.DataSubscribedEvent.subscribe(this.onDataStoreSubscribed,this);this.DataStoreCreatedEvent.fire(this,a);return a}else{return this[b]}},addEnum:function(a){if(!$$CM.isNull(a.Store)){if($$CM.isNull(Framework.Enums[a.Store])){Framework.Enums[a.Store]={}}if($$CM.isNull(cm.dao[a.Store])){cm.dao[a.Store]={}}if($$CM.isNull(cm.dao[a.Store].Enums)){try{cm.dao[a.Store].Enums={}}catch(b){this.log("Could not add legacy enum reference to DAO '"+a.Store+"'")}}if(!$$CM.isNull(cm.dao[a.Store].Enums)){cm.dao[a.Store].Enums[a.Name]=a.Array}Framework.Enums[a.Store][a.Name]=a.Array.asEnum();this.log(a.Name+" was added to the Framework enumeration library under namespace '"+a.Store+"'")}Framework.Enums[a.Name]=a.Array.asEnum();this.log(a.Name+" was added to the Framework enumeration library")},translateDAOs:function(){for(var a in cm.dao){this.createStore(a);for(var b in cm.dao[a].Data){this.Set(b,cm.dao[a].Data[b],a)}}},onDataStoreUpdate:function(g,a){var f=g;var e=a.Operation;var c=a.Name;var b="";try{b=$$CM.stringify(a.Value)}catch(d){b="JSON_PARSE_ERROR ["+d+"]"}this.DataStoreChangedEvent.fire(g,a);this.log("Data store '"+f.Name+"' performed a '"+e+"' operation on entry '"+c+"'")},onDataStoreSubscribed:function(b,a){this.DataSubscribedEvent.fire(this,a)}});cm.ui.framework.data.DataStore=Class.create({DataUpdateEvent:null,DataSubscribedEvent:null,Name:"",Events:null,Monitors:null,initialize:function(a){this.Name=a;this.DataUpdateEvent=new cm.event();this.DataSubscribedEvent=new cm.event();this.Events={};this.Monitors=$A()},Set:function(a,b){return this.Replace(a,b)},SetSilent:function(a,b){if(!$$CM.isArray(b)){b=$A([b])}this.checkKey(a);this[a]=b;return this[a]},Get:function(a,b){this.checkKey(a);if(!$$CM.isNull(b)){return this.Search(a,b)}else{return this[a]}},HasData:function(a,d,b){this.checkKey(a);if($$CM.isNull(b)||!$$CM.isNumber(b)){b=0}else{b=b-1}var c=!$$CM.isNull(d)?this.Search(a,d):this[a];return(c.length>b==true)},Convert:function(c,b){var a=this.Get(c);var d=$A();if($$CM.isFunction(b)){d=a.collect(function(e){return b(e)},this).reject(function(e){return $$CM.isNull(e)})}else{d=a.collect(function(e){var g=new Object();for(var h in b){var f=b[h];g[f]=e[h]}return g},this)}return d},GetAny:function(){var a=$A(arguments);var b=a.first();a=a.removeAt(0);var c=$A();a.each(function(d){c=c.concat(this.Get(b,d))},this);return c.uniq()},GetExcept:function(a,c){var b=$A();b=this.Get(a);exclArr=this.Get(a,c);return b.filter(function(d){return !exclArr.exists(d)})},GetEvent:function(a){this.checkKey(a);return this.Events[a]},Subscribe:function(c,d,e){this.checkKey(c);var a=this.Get(c);var b=this.Events[c];b.subscribe(d,e);if(e instanceof cm.ui.Control){e.AddDataSubscriber(this.Name,c,d,b)}this.DataSubscribedEvent.fire(this,{Name:c,Value:this[c],Event:b})},Unsubscribe:function(c,d,e){this.checkKey(c);var a=this.Get(c);var b=this.Events[c];b.unsubscribe(d,e);if(e instanceof cm.ui.Control){e.RemoveDataSubscriber(this.Name,c,d,b)}},Monitor:function(b,e,c,d){this.checkKey(b);var f=this.Get(b,e);var a=this.Events[b];this.Monitors[b].push({Scope:d,Callback:c,LastValue:f,Search:e});a.subscribe(this.onMonitoredEventFired,this)},Replace:function(b,c,a){if($$CM.isNull(a)){a=true}if(!$$CM.isArray(c)){c=$A([c])}this.checkKey(b);this[b]=c;if(a){this.fireDataUpdated(b,"REPLACE")}return this[b]},Concat:function(a,b){if(!$$CM.isArray(b)){b=$A([b])}this.checkKey(a);this[a]=this[a].concat(b);this.fireDataUpdated(a,"CONCAT");return this[a]},Merge:function(a,f,d,c){if(!$$CM.isArray(f)){f=$A([f])}if(!$$CM.isArray(d)){d=$A([d])}if(!$$CM.isFunction(c)){c=function(g,h){return h}}this.checkKey(a);var e=$A();if($$CM.isNull(d)){var e=f.select(function(g){return this[a].indexOf(g)<0},this);this[a]=this[a].concat(e)}else{var b=false;f.each(function(h){var g=this[a].findAll(function(j){var i=d.find(function(k){return(j[k]!=h[k])},this);if($$CM.isNull(i)){return true}return false},this);if(g.length>0){g.each(function(j){var i=this[a].indexOf(j);if(this[a][i]!=h){this[a][i]=c(this[a][i],h);b=true}},this)}else{this[a]=this[a].concat(h);b=true}},this)}this.fireDataUpdated(a,"MERGE");return this[a]},GetFirst:function(a,c){var b=$A();this.checkKey();if(!$$CM.isNull(c)){b=this.Search(a,c)}else{b=this.Get(a)}if(b.length<=0){return null}else{return b.first()}},Search:function(b,d){var a=this.Get(b);if($$CM.isObject(d)){for(var c in d){a=a.findAll(function(e){return !$$CM.isNull(e[c])&&e[c]==d[c]})}}else{if($$CM.isFunction(d)){a=a.findAll(d)}else{a=a.findAll(function(e){return e==d})}}return a},Contains:function(a,c,b){this.checkKey(a)},Remove:function(a,c){this.checkKey(a);var b=this.Get(a,c);this[a]=this[a].reject(function(d){return b.exists(d)})},GetSorted:function(b,d){var a=this.Get(b);if($$CM.isObject(d)){for(var c in d){a=a.sort(function(e,f){if(e[c]<f[c]){return(d[c].toLowerCase()=="desc")?1:-1}else{if(e[c]>f[c]){return(d[c].toLowerCase()=="desc")?-1:1}else{return 0}}})}}else{if($$CM.isFunction(d)){a=a.sort(d)}}return a},checkKey:function(a){if($$CM.isNull(this[a])){this[a]=$A();this.Monitors[a]=$A();this.Events[a]=new cm.event()}},fireDataUpdated:function(a,b){this.DataUpdateEvent.fire(this,{Name:a,Value:this[a],Operation:b});this.Events[a].fire(this,{Name:a,Value:this[a],Operation:b})},onMonitoredEventFired:function(c,a){var b=a.Name;this.Monitors[b].each(function(d){var e=this.Get(b,d.Search);if(e.matches(d.LastValue)!=true){d.Callback.call(d.Scope,this,a.Value)}d.LastValue=e},this)}});$$DMON=cm.ui.framework.data.DataMonitor=Class.create({initialize:function(b,a){this._scope=b;this._store=null;this._key=null;this._srchObj=null;this._targetProperty=null;this._value=null;this._updaterFn=null;this._onUpdateFn=null;this.ChangeEvent=null;this.ChangeEvent=new cm.event();this.updateMonitor(this.configureDefaultOptions());this.updateMonitor(a);if(Framework._ready!=true){CMEnvironmentLoadEvent.subscribe(this.onEnvironmentReady,this)}else{this.wireEvents()}},Bind:function(a){FW.Data.GetStore(this._store).Replace(this._key,a)},BindNoEvent:function(a){FW.Data.GetStore(this._store).Replace(this._key,a,false);this.updateValue()},GetData:function(){return this.getValue()},SetQuery:function(a,b){if($$CM.isNull(b)){b=false}this._srchObj=a;if(b){this.updateValue()}else{this.onDataUpdated()}},Subscribe:function(a,b){this.ChangeEvent.subscribe(a,b)},Update:function(){this.onDataUpdated()},wireEvents:function(){FW.Data.GetStore(this._store).Subscribe(this._key,this.onDataUpdated,this)},configureDefaultOptions:function(){return{Store:"Default",Key:"Default",Search:{},Target:null,Updater:function(a){return a}}},updateMonitor:function(a){if(!$$CM.isNull(a)){this._store=(!$$CM.isNull(a.Store))?a.Store:this._store;this._key=(!$$CM.isNull(a.Key))?a.Key:this._key;this._srchObj=(!$$CM.isNull(a.Search))?a.Search:this._srchObj;this._targetProperty=(!$$CM.isNull(a.Target))?a.Target:this._targetProperty;this._updaterFn=(!$$CM.isNull(a.Updater))?a.Updater:this._updaterFn;this._onUpdateFn=(!$$CM.isNull(a.OnUpdate))?a.OnUpdate:this._onUpdateFn;this._value=null}},getValue:function(){var a=this._updaterFn(FW.Data.GetStore(this._store).Get(this._key,this._srchObj));return a},updateValue:function(a){if($$CM.isNull(a)){a=this.getValue()}if(!$$CM.isNull(this._targetProperty)){this._scope[this._targetProperty]=a}this._value=a},updateEvent:function(){FW.Data.GetStore(this._store).Subscribe(this._key,this.onDataUpdated,this)},onDataUpdated:function(c,a){var b=this.getValue();if($$CM.stringify(this._value)!=$$CM.stringify(b)){this.updateValue(b);this.ChangeEvent.fire(this,this._value);if($$CM.isFunction(this._onUpdateFn)){this._onUpdateFn.call(this._scope,this,this._value)}}else{this.updateValue(b)}},onEnvironmentReady:function(b,a){this.wireEvents()}});"cm.ui.framework.data".namespace();"cm.ui.framework.module".namespace();cm.ui.framework.data.CustomRequest=Class.create(Ajax.Request,{initialize:function($super,b,a){$super(b,a)},request:function(d){this.url=d;this.method=this.options.method;var b=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){b+=(b?"&":"")+"_method="+this.method;this.method="post"}if(b&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+b}if(!b.startsWith("data=")||this.method!=="post"){throw new Error("CustomRequest::request, Tried to send a framework message with unexpected format. Unable to send.")}this.parameters={data:b.substring(5)};try{var c=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(c)}Ajax.Responders.dispatch("onCreate",this,c);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||b):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(a){this.dispatchException(a)}}}),cm.ui.framework.module.DataAccessor=Class.create(cm.ui.framework.Module,{RequestEvent:null,ResponseEvent:null,onCreated:function(){DAO=new Object();this.Accessors=$A();this.RequestEvent=new cm.event();this.ResponseEvent=new cm.event()},onHeadersLoaded:function(){this.Accessors.each(function(a){this.Use(a.Name)},this);this.Ready()},onReceiveMessage:function(a){if(!$$CM.isNull(a.Data)){this.Update(a.Data)}},Get:function(a){return DAO[a]},GetLocal:function(a){if($$CM.isNull(DAO[a])){this.Use(a)}return new cm.dao.fw[a].DAO()},Use:function(b){var a=this.Accessors.find(function(c){return c.Name==b});if($$CM.isNull(DAO[b])){if($$CM.isNull(a)){this.error("No data accessor exists with name '"+b+"'")}DAO[b]=new cm.ui.framework.data.DataAccessor(a)}return a},Update:function(b){var a=this.Accessors.find(function(c){return c.Name==b.Name});if(!$$CM.isNull(a)){this.Accessors[this.Accessors.indexOf(a)]=b;delete DAO[b.Name];this.Use(b.Name);this.log("DataAccessor '"+b.Name+"' was updated to version '"+b.Version+"'")}},post:function(j,c,i,f,e,d,a){var g=this;if($$CM.isNull(a)){a=new Object()}a.errGuid=FW.Core.RegisterAjaxResponseErrorListener(i);var b=new Object();b.scope=i;b.onSuccess=f;b.onFailure=e;b.onComplete=d;b.ajaxArgs=a;var h=new Object();h.onSuccess=function(n){try{var o=JSON.parse(n.responseText);if($$CM.isNull(o.error)){g.onPostSuccess.call(g,o,b)}else{var k=o.error.Details;if(!$$CM.isEmpty(k)){k=k.replace(/at /g,"<br>at ")}if(b.ajaxArgs.errorPopup==true){var l={title:"Data Error",header:"An error occurred exchanging data with the server",message:o.error.Message,details:k,width:650};$$CMD.Alert(l)}g.onPostFailure.call(g,o,b)}}catch(m){FW.Core.FireAjaxResponseError(b.ajaxArgs.errGuid,m)}finally{FW.Core.ClearAjaxResponseErrorListener(b.ajaxArgs.errGuid)}};h.onFailure=function(m){var l=null;try{l=JSON.parse(m.responseText)}catch(k){$$CMD.Alert({title:"Server Error",message:"<b>An unknown error occured ("+m.status+") :</b> "+m.statusText})}g.onPostFailure.call(g,m,b)};h.onComplete=function(k){g.onPostComplete.call(g,null,b)};h.args=b;h.targetURL=j;if(a.attachMessages==true){FW.FlushMessagesTo(c)}c=new cm.data.AjaxData(c);if(!$$CM.isNull(c)&&$$CM.isFunction(c.AJAXDATA_IDENTITY)){h.parameters="data="+c.Value}else{h.parameters="data="+$$CM.stringify(c)}this.RequestEvent.fire(this,h);this.log("Method Called: "+j);new cm.ui.framework.data.CustomRequest(j,h)},onPostSuccess:function(b,a){b.args=a;this.ResponseEvent.fire(this,b);if(!$$CM.isNull(b.fwmsg)){Framework.broadcast(b.fwmsg,a.ajaxArgs)}a.ajaxArgs.data=b.data;a.onSuccess.call(a.scope,a.ajaxArgs)},onPostFailure:function(c,a){c.args=a;this.ResponseEvent.fire(this,c);var b=new Error();b.message=c.error.Message;b.stack="<b><font color='black'>"+c.error.Message+"</font></b>\n"+c.error.Details;a.onFailure.call(a.scope,a.ajaxArgs,b)},onPostComplete:function(b,a){b.args=a;this.ResponseEvent.fire(this,b);a.onComplete.call(a.scope,a.ajaxArgs)},getProxyNamespaces:function(){return $A([{Scope:window,Property:"DAO"}])}});cm.ui.framework.data.DataAccessor=Class.create({_model:null,ID:0,Name:"",Version:"",initialize:function(a){this._dmArray=$A();this._model=a;this.ID=this._model.ID;this.Name=this._model.Name;this.Version=this._model.Version;this._model.Methods.each(function(b){var c=this;this[b.Name]=function(e,d,h){if($$CM.isNull(d)){d=new Object()}if($$CM.isNull(d.wait)){d.wait=true}if($$CM.isNull(d.errorPopup)){d.errorPopup=true}if(d.wait==true){$$CMD.ShowWaitDialog();if(!$$CM.isEmpty(d.waitMessage)){var f=null;if(d.progress>=0){f=d.progress}$$CMD.SetProgressWaitDialog(d.waitMessage,f)}}if($$CM.isNull(d.context)){d.context={}}var g=null;if(!$$CM.isNull(h)){g=h}else{g=c}Framework.DataAccessor.post(c._model.Path+"/"+b.Name,e,g,c[b.Name].onSuccess,c[b.Name].onFailure,c[b.Name].onComplete,d)};this[b.Name].toString=function(){return"function (data) { [framework code] }"};this[b.Name].SuccessEvent=new cm.event();this[b.Name].FailureEvent=new cm.event();this[b.Name].CompleteEvent=new cm.event();this[b.Name].onSuccess=function(d){if(d.wait==true){$$CMD.HideWaitDialog()}if($$CM.isFunction(d.onSuccess)){d.onSuccess.call(d.scope,d)}c[b.Name].SuccessEvent.fire(c,d.data)};this[b.Name].onFailure=function(d,e){if(d.wait==true){$$CMD.HideWaitDialog()}if($$CM.isFunction(d.onFail)){d.onFail.call(d.scope,d,e)}c[b.Name].FailureEvent.fire(c,d.data)};this[b.Name].onComplete=function(d){if(d.wait==true){$$CMD.HideWaitDialog()}if($$CM.isFunction(d.onComplete)){d.onComplete(d)}c[b.Name].CompleteEvent.fire(c,d.data)}},this)}});"cm.ui.framework.module".namespace();"cm.ui.framework.data".namespace();cm.ui.framework.module.Object=Class.create(cm.ui.framework.Module,{onCreated:function(){this._objectTable=new cm.ui.Hashtable()},onHeadersLoaded:function(){if($$CM.isArray(this.ConfigOptionDefinitions)){this.ConfigOptionDefinitions.each(function(a){window["CFG_"+a.Name.replace(/[\(\)]/gi,"").replace(/\s/gi,"_").toUpperCase()]=a.ID},this)}if($$CM.isArray(this.ClassDefinitions)){this.ClassDefinitions.each(function(a){window["CLS_"+a.Name.replace(/[\(\)]/gi,"").replace(/\s/gi,"_").toUpperCase()]=a.ID},this)}this.Ready()},Clear:function(){this._objectTable=new cm.ui.Hashtable()},Render:function(id,cfg){var cls=this.GetClass(id);if($$CM.isNull(cls)){this.log("Could not find class ID '"+id+"', a null object was created instead.");return new cm.ui.framework.data.Object()}else{var obj;var domID=$$CM.rawGuid();var classID=id;try{eval(cls.Namespace+"."+cls.Name)}catch(ex){this.log("Could not find a definition for "+cls.Namespace+"."+cls.Name+" -- Make sure all scripts for the specified class definitions are initialized.");return new cm.ui.framework.data.Object()}try{eval("obj = new "+cls.Namespace+"."+cls.Name+"(domID, classID, cls.ConfigOptions, cfg)");this.log("An instance of '"+cls.Name+"' has been created.");return obj}catch(ex){this.error(ex,"An error occured while rendering object ("+cls.Namespace+"."+cls.Name+"): "+ex.message);return new cm.ui.framework.data.Object()}}},GetClassDefinition:function(b){var a=this.ClassDefinitions.find(function(c){return c.ID==b});if(!$$CM.isNull(a)){return $$CM.deepClone(a)}},GetClass:function(b){if(!$$CM.isArray(this.ClassDefinitions)){this.error("No active classes have been initialized")}var a=this._objectTable.get("class_"+b);if($$CM.isNull(a)){a=this.GetClassDefinition(b);if($$CM.isNull(a)){return null}this.log("Creating first instance of class '"+b+"'");a=this.buildInheritance(a);this._objectTable.put("class_"+a.ID,a)}return a},GetConfigOptionDefinition:function(b){var a=this.ConfigOptionDefinitions.find(function(c){return c.ID==b});if($$CM.isNull(a)){this.log("The requested config option does not exist.")}else{return a}},buildInheritance:function(b){if(!$$CM.isArray(this.ClassDefinitions)){this.error("No active classes have been initialized")}if(!$$CM.isNull(b.InheritID)){var c=this.GetClassDefinition(b.InheritID);if($$CM.isNull(c)){this.error("Could not build inheritance for class "+b.Name+".  Broken inheritance reference ID")}else{if(!$$CM.isNull(c.InheritID)){c=this.buildInheritance(c)}var a=c.ConfigOptions.select(function(d){return $$CM.isNull(b.ConfigOptions.find(function(e){return e.ID==d.ID}))});b.ConfigOptions=$$CM.deepClone(b.ConfigOptions.concat(a));this.log("Class '"+b.Name+"' inherited from class '"+c.Name+"'")}}return b}});cm.ui.framework.data.Object=Class.create(cm.ui.Control,{ClassID:0,ConfigOptions:null,Children:$A(),BeforeReloadEvent:null,AfterReloadEvent:null,initialize:function($super,d,a,c,b){if($$CM.isNull(a)){a=0}this._configTable=c;this._configOverride=b;this.ConfigOptions=$A();this.ClassID=a;this.Children=$A();this.BeforeReloadEvent=new cm.event();this.AfterReloadEvent=new cm.event();$super(d);this.AddClassName("cmFrameworkObject")},GetData:function(){return null},AddChildObject:function(a){this.Children.push(a);this.doAddChildObject(a)},RemoveChildObject:function(a){this.Children.remove(a);this.doRemoveChildObject(a)},SetConfig:function(b,c){var a=this.ConfigOptions.find(function(d){return d.ID==b});if(!$$CM.isNull(a)){a.Value=c}else{this.ConfigOptions.push({ID:b,Value:c})}},GetConfig:function(c){var a=Framework.Object.GetConfigOptionDefinition(c);var b=this.ConfigOptions.find(function(d){return d.ID==c});if(!$$CM.isNull(a)){if(!$$CM.isNull(b)){return this.convertToConfigType(a.Type,b.Value)}else{return this.convertToConfigType(a.Type,null)}}else{return""}},GetChildren:function(){var a=$A(this.Children);this.Children.each(function(b){a=a.concat(b.GetChildren())},this);return a},ToArray:function(){return $A([this]).concat(this.GetChildren())},Reload:function(){this.beforeReload();this.BeforeReloadEvent.fire(this);this.Reset();this.AfterReloadEvent.fire(this);this.afterReload()},IsTypeOf:function(b){if(this.ClassID>0){var a=Framework.Object.GetClass(this.ClassID);do{if(a.ID==b){return true}else{a=Framework.Object.GetClass(a.InheritID)}}while(!$$CM.isNull(a.InheritID))}return false},IsValid:function(){return this.ClassID!=0},getConfigDefinition:function(a){return this._configTable.find(function(b){return b.ID==a})},configureDefaultOptions:function(){this.ConfigOptions=$A();if($$CM.isArray(this._configTable)){this._configTable.each(function(a){var b=a.DefaultValue;b=this.convertToConfigType(FW.Object.GetConfigOptionDefinition(a.ID).Type,b);this.SetConfig(a.ID,b)},this)}if($$CM.isArray(this._configOverride)){this._configOverride.each(function(b){var d=this.getConfigDefinition(b.ID);if($$CM.isNull(d)||d.Static!=true){var a=this._configTable.find(function(c){return c.ID==b.ID});if(!$$CM.isNull(a)){this.SetConfig(b.ID,this.convertToConfigType(FW.Object.GetConfigOptionDefinition(a.ID).Type,b.Value))}}},this)}delete this._configOverride;delete this._configTable},convertToConfigType:function(c,d){try{var a=Framework.Enums.ConfigurationType;if($$CM.isEmpty(d)){switch(c){case a.Undefined:this.log("Can't initialize configuration option of type UNDEFINED");break;case a.Integer:return 0;case a.Float:return 0;case a.String:return"";case a.Boolean:return false;case a.Array:return $A();case a.Object:return new Object()}}else{switch(c){case a.Integer:return parseInt(d);case a.Float:return parseFloat(d);case a.String:try{return JSON.parse(d).toString()}catch(b){return d.toString()}case a.Boolean:return $$CM.parseBoolean(d);case a.Array:return(!$$CM.isArray(d)?JSON.parse(d):d);case a.Object:return(!$$CM.isObject(d)?JSON.parse(d):d)}}}catch(b){}Framework.Object.log("Could not convert configuration type :: (Type: "+c+", Value: "+d+")");return d},beforeReload:function(){},afterReload:function(){}});"cm.ui.framework.module".namespace();cm.ui.framework.module.Resources=Class.create(cm.ui.framework.Module,{ResourceLoadedEvent:null,ResourceLoadStartEvent:null,ResourceLoadFinishedEvent:null,Busy:false,onCreated:function(){this._cache=$A();this._queue=$A();this.ResourceDefinitions=$A();this.Busy=false;this.ResourceLoadedEvent=new cm.event();this.ResourceLoadStartEvent=new cm.event();this.ResourceLoadFinishedEvent=new cm.event()},onStart:function(){var a=$A(document.getElementsByTagName("script"));a.each(function(b){if(!$$CM.isEmpty(b.src)){this._cache.push(b.src)}},this);this.log("Scripts pre-loaded to cache: "+this._cache.length)},onHeadersLoaded:function(){if(!$$CM.isArray(this.Styles)){this.Styles=$A()}if(!$$CM.isArray(this.Scripts)){this.Scripts=$A()}FW.ListenForMessages(MT_ResourceManipulateMessage,this.onResourceManipulateMessage,this);if($$CM.isArray(this.Raw)){this.Raw.each(function(a){if(a.indexOf(".css")>0){this.Styles.push(a)}else{if(a.indexOf(".js")>0){this.Scripts.push(a)}}},this);delete this.Raw}this.LoadStyle(this.Styles);delete this.Styles;if(this.Scripts.length>0){this.LoadScript(this.Scripts,this.Ready,this);delete this.Scripts}else{this.Ready()}},onResourceManipulateMessage:function(a){switch(a.Type){case FW.Enums.ResourceType.Script:this.LoadScript(a.Urls);break;case FW.Enums.ResourceType.Style:this.LoadStyle(a.Urls);break}},Request:function(b,a){this.CreateMessage(MT_ResourceRequestMessage,{Location:b,Identifiers:a})},LoadScript:function(d,a,c,b){if(!$$CM.isArray(d)){d=$A([d])}this.load(d,FW.Enums.ResourceType.Script,a,c,b)},LoadStyle:function(d,a,c,b){if(!$$CM.isArray(d)){d=$A([d])}this.load(d,FW.Enums.ResourceType.Style,a,c,b)},load:function(d,h,a,c,b){if(h==FW.Enums.ResourceType.Style){d.each(function(i){if(!$$CM.isEmpty(i)){jQuery("head").append(jQuery('<link rel="stylesheet" type="text/css" />').attr("href",i));this.log("Stylesheet was requested: "+i)}},this)}else{var e=this;var f=$A();var g=new cm.Thread($$CM.rawGuid(),null,1);g.Start(function(){if(this._firstRun!=true){this._list=d}this._firstRun=true;if(this._list.length>0&&this._working!=true){this._working=true;var j=this._list[0];this._list.remove(j);if(e._cache.indexOf(j)<0&&!$$CM.isEmpty(j)){var i=jQuery.ajax({type:"GET",url:j,dataType:"script",cache:true});f.push(j);var k=this;i.done(function(){e._cache.push(j);e.log("Script was loaded: "+j);e.ResourceLoadedEvent.fire(e,j);k._working=false})}else{e.log("Request exists in cache and was skipped: "+j);this._working=false}}else{if(this._list.length==0&&this._working!=true){g.Stop();if($$CM.isFunction(a)){if($$CM.isNull(b)){b={}}if($$CM.isNull(c)){c=this}a.call(c,b)}e.ResourceLoadFinishedEvent.fire(this,f)}}},g)}}});"cm.ui.framework.module".namespace();cm.ui.framework.module.Scripting=Class.create(cm.ui.framework.Module,{_obfuscation:"",_scriptCache:null,_reqCallbacks:$A(),ScriptsReceivedEvent:null,ScriptErrorEvent:null,onCreated:function(){this._scriptCache=new cm.ui.Hashtable();this._groupEvents=new cm.ui.Hashtable();this._reqCallbacks=$A();this.ScriptsReceived=new cm.event();this.ScriptErrorEvent=new cm.event()},onHeadersLoaded:function(){this._obfState=false;this._cache=new cm.ui.Hashtable();this.resetObfuscation();if(!$$CM.isArray(this.Scripts)){this.Scripts=$A()}if(!$$CM.isArray(this.DomainCode)){this.DomainCode=$A()}if($$CM.isArray(this.Domains)){this.Domains.each(function(b){var a=this.DomainCode.find(function(c){return c.key==b.ID});if(!$$CM.isNull(a)){b.Code=a.value}if($$CM.isNull(b.IncludeDomains)){b.IncludeDomains=$A()}window["DOM"+b.Name.replace(/[\(\)]/gi,"").replace(/\s/gi,"_").toUpperCase()]=b.ID},this)}this.updateScripts(this.Scripts);FW.ListenForMessages(MT_ScriptResponseMessage,this.onScriptResponseMessage,this);this.Ready()},GetGroupEvent:function(b){var a=this._groupEvents.get("gid_"+b);if($$CM.isNull(a)){a=new cm.event();this._groupEvents.put("gid_"+b,a)}return a},GetScript:function(b,a){var c=this._scriptCache.get("gid_"+b);if(!$$CM.isNull(c)){return c.get(a)}},GetScriptList:function(a){var b=this._scriptCache.get("gid_"+a);return($$CM.isNull(b))?$A():b},GetDomain:function(a){return this.Domains.find(function(b){return b.ID==a||b.Name==a},this)},RequestScripts:function(b,a,d){var c=$$CM.rawGuid();if(!$$CM.isNull(a)){this._reqCallbacks.push({RequestID:c,Callback:a,Scope:((!$$CM.isNull(d))?d:window)})}this.CreateMessage(MT_ScriptRequestMessage,{GroupID:b,RequestID:c});if(autoFlush==true){FW.FlushMessages()}},WriteScripts:function(b,a){if(!$$CM.isArray(b)){b=$A([b])}this.CreateMessage(MT_ScriptResponseMessage,{Scripts:b});if(a==true){FW.FlushMessages()}},GetGroupScripts:function(a){var b=this._scriptCache.get("gid_"+a);if($$CM.isNull(b)){b=new cm.ui.Hashtable();this._scriptCache.put("gid_"+a,b)}return b.keys.collect(function(c){return b.get(c)})},splitFunction:function(c){c=c.replace("{","%FUNC_START");var a=c.split("%FUNC_START");var d=a[0];var g=d.split("(")[0].split(" ");var f=g[1];var e=d.split("(")[1].split(")")[0].split(",");a=a.removeAt(0);var b=a.join();return f+": function("+e.join(",")+") { "+b},updateScripts:function(a){var b=$A();if(!$$CM.isArray(a)){a=$A([a])}a.each(function(d){var c=this._scriptCache.get("gid_"+d.GroupID);if($$CM.isNull(c)){c=new cm.ui.Hashtable()}c.put(d.Filename,d);this._scriptCache.put("gid_"+d.GroupID,c);if(b.indexOf(d.GroupID)<0){b.push(d.GroupID)}this.log("Group ID: "+d.GroupID+" -- added '"+d.Filename+"'")},this);b.each(function(c){this.log("Group change event fired for group "+c);this.GetGroupEvent(c).fire(this,this.GetGroupScripts(c))},this)},CreateDomain:function(domain){var dom={};eval("var dom = {"+domain.Code+"}");return dom},Run:function(domain,depScr){Function.prototype._toString=Function.prototype.toString;Function.prototype.toString=function(){return"[locked]"};try{var me=this;eval("var dom = {"+domain.Code+"}");(function(){eval("var dp = {"+me.makeDeploymentString(depScr)+"};");eval(me.makeDomainRelays(dom));if(domain.Restricted==true){eval(me._obfuscation)}var fn=function(){dp.Main.call(dp)};try{fn()}catch(ex){var stack=ex.stack.split("\n");var exType=stack[0];var newEx={};if(exType.indexOf("is not a function")>=0){var fnName=exType.split("is")[0].trim();var err="Invalid function '"+fnName+"'";var lNum=stack[1].trim().split("<anonymous>:").last().split(":")[0];var chNum=stack[1].trim().split("<anonymous>:").last().split(":")[1].split(")")[0];throw {message:(err+" in script :: Line "+lNum+" Char "+chNum),name:"Invalid Function Error",stack:ex.stack,toString:function(){return this.name+": "+this.message}}}else{throw ex}}})()}catch(ex){this.ScriptErrorEvent.fire(this,ex);this.error(ex,"Error running script")}finally{Function.prototype.toString=Function.prototype._toString;this.cleanupDomain(dom)}},cleanupDomain:function(a){for(var b in a){delete window[b]}},makeDomainRelays:function(a){var c="";if(!$$CM.isNull(a._public)){for(var b in dom._public){a[b]=a._public[b]}delete a._public}for(var b in a){if(b!="private"){if(!$$CM.isNull(a[b].name)&&a[b].name=="klass"){c+=(b+' = Class.create(dom["'+b+'"],{});\n')}else{if($$CM.isFunction(a[b])){c+=(b+' = function() { return dom["'+b+'"].apply(dom, arguments); };\n')}else{c+=(b+' = dom["'+b+'"];\n')}}}}if(!$$CM.isNull(a._private)){for(var b in a._private){a[b]=a._private[b]}delete a._private}return c},makeDeploymentString:function(b){var a=$A(b.split("function"));if(a.length>0){var c="";a=a.removeAt(0);a.each(function(d){c+=this.splitFunction(d)+","},this);return c}},resetObfuscation:function(){var d="";var c=$A();for(var b in window){c.push(b)}var e=$A();d="var window = {},";for(var a=0;a<c.length;a++){e.push(c[a]+"=window."+c[a])}d+=e.join(",\n");this._obfuscation=(d+";")},onScriptResponseMessage:function(b){this.updateScripts(b.Scripts);var a=this._reqCallbacks.find(function(c){return c.RequestID==b.RequestID});if(!$$CM.isNull(a)){a.Callback.call(a.Scope,this,b.Scripts)}}});cm.ui.framework.data.Deployment=Class.create({initialize:function(a){}});cm.ui.framework.data.Domain=Class.create({WindowProperty:null,initialize:function(a){for(var b in a){this[b]=a[b]}}});