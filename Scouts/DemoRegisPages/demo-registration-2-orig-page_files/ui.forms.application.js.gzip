"cm.ui.forms.application".namespace();cm.ui.forms.application.ApplicationBaseConfigOptions=Class.create(cm.ui.forms.FormsBaseConfigOptions,{applicationType:0});cm.ui.forms.application.ApplicationBase=Class.create(cm.ui.forms.FormsBase,{configureDefaultOptions:function(){return new cm.ui.forms.application.ApplicationBaseConfigOptions()},GetApplicationType:function(){return this.GetConfigOptions().applicationType},BuildInstructionsDialog:function(m,c,l,a){var j=$A();j.push("<div>");j.push(" <ol class='"+l+"'>");var i=$A();var g=(!$$CM.isNull(m)&&!$$CM.isNull(m.GeneralSettings));if(g&&$$CM.isArray(m.GeneralSettings.AdditionalInstructionArray)){m.GeneralSettings.AdditionalInstructionArray.each(function(n){i.push(n)},this)}else{i.push("Use the <strong>Continue</strong> and <strong>Back</strong> buttons on each page to navigate through this online form.")}i.each(function(n){j.push("  <li>"+n+"</li>")},this);j.push(" </ol>");var b="If you have any questions, please contact the "+a+" office directly.";if(g){var e=m.GeneralSettings;var h=(!$$CM.isNull(e.ContactPhoneNumber)&&!$$CM.isEmpty(e.ContactPhoneNumber.Number));var f=(!$$CM.isNull(e.ContactEmailAddress)&&!$$CM.isEmpty(e.ContactEmailAddress.Email));if(h||f){b="If you have any questions, please contact the "+a+" office ";if(h){b+="at "+e.ContactPhoneNumber.Number}if(f){b+=(h?" or ":" via ")+"<a target='_top' id='aEmail' href='mailto:"+e.ContactEmailAddress.Email+"'>email</a>"}b+="."}}j.push("<p class='pl20px pr20px'>"+b+"</p>");j.push("</div>");var k=j.join("\n");var d={title:"Application Instructions",header:null,message:k,width:470,buttonOkText:"Close",cssClass:"cmBaseDialog"};return d}});"cm.ui.forms.application".namespace();cm.ui.forms.application.BillingDetailsConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),seasonID:0});cm.ui.forms.application.BillingDetails=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.application.BillingDetailsConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._invoiceDeliveryMethodEnum=cm.dao.Financial.Enums.InvoiceDeliveryMethodStringValue.asEnum();this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._enableInvoiceDeliveryMethod=this._settings.EnableInvoiceDeliveryMethod;this._defaultInvoiceDeliveryMethodID=this._settings.DefaultInvoiceDeliveryMethodID;this._isUPR=$$CADU.IsUPR()},initializeUIElements:function(){this.AddClassName("cmBillingDetails");this._fsBillingDetails=new $$FS("fsBillingDetails_"+this._uniqueID,{legendLabel:this._co.legendLabel,legendCssClass:this._co.legendCssClass});this.AddChild(this._fsBillingDetails);this._fsBillingDetails.AddClassName("pt10px");var c=this._settings.BillingHeaderMessage;if(!$$CM.isEmpty(c)){this._ctrSectionMessage=new cm.ui.forms.SectionMessage("divSectionMessage_"+this._uniqueID,{message:c,cssClass:"cmClear mt0px mb10px"});this._fsBillingDetails.AddChild(this._ctrSectionMessage);var d=this._settings.BillingHeaderMessageCssClass;if(!$$CM.isEmpty(d)){this._ctrSectionMessage.AddClassName(d)}}this._fsrblInvoiceDeliveryMethod=new $$FSRBL("fsrblInvoiceDeliveryMethod_"+this._uniqueID,{legendLabel:"How should invoices be sent?",legendCssClass:"cmFloatLeft w195px pt5px pr0px",isRequired:true});this._fsBillingDetails.AddChild(this._fsrblInvoiceDeliveryMethod);this._fsrblInvoiceDeliveryMethod.AddClassName("cmFormRow mb10px");this._fsrblInvoiceDeliveryMethod.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Billing Invoice Delivery Method",IsRequired:true}));var a=this._invoiceDeliveryMethodEnum.GetArrayWithout(null,["Undefined"]);if($$CM.isArray(a)){var b="InvoiceDeliveryMethod_"+$$CM.uniqueID();a.each(function(e){this._fsrblInvoiceDeliveryMethod.AddFormRadioButton({ID:e.ID,Name:e.Name,GroupName:b})},this)}if(this._enableInvoiceDeliveryMethod!=true){this._fsrblInvoiceDeliveryMethod.Hide()}this._divBillingSummaryMessage=$$P.div("divBillingSummaryMessage_"+this._uniqueID);this._fsBillingDetails.AddChild(this._divBillingSummaryMessage);this._divBillingSummaryMessage.AddClassName("cmFormRow mb10px");this._divBillingSummaryWrapper=$$P.div("divBillingSummaryWrapper_"+this._uniqueID);this._fsBillingDetails.AddChild(this._divBillingSummaryWrapper);this._divBillingSummaryWrapper.AddClassName("cmFormRow mb10px");this._divBillingSummaryEdit=$$P.div("divBillingSummaryEdit_"+this._uniqueID);this._divBillingSummaryWrapper.AddChild(this._divBillingSummaryEdit);this._divBillingSummaryEdit.AddClassName("w200px cmFloatRight");this._aBillingSummaryEdit=new $$A("aBillingSummaryEdit_"+this._uniqueID,{text:"Edit Billing Information"});this._divBillingSummaryEdit.AddChild(this._aBillingSummaryEdit);this._aBillingSummaryEdit.AddClassName("cmFloatRight");this._divBillingSummary=$$P.div("divBillingSummary_"+this._uniqueID);this._divBillingSummaryWrapper.AddChild(this._divBillingSummary);this._divBillingSummary.AddClassName("cmFloatLeft");this.initializeModals()},initializeModals:function(){this._divModals=$$P.div("divModals_"+this._uniqueID);this.AddChild(this._divModals);if(this._isUPR==true){this._ctrBillingDetailsEdit=new cm.ui.forms.application.BillingDetailsEditUPR("ctrBillingDetailsEdit_"+this._uniqueID,{settings:this._settings,seasonID:this._seasonID})}else{this._ctrBillingDetailsEdit=new cm.ui.forms.application.BillingDetailsEdit("ctrBillingDetailsEdit_"+this._uniqueID,{settings:this._settings,seasonID:this._seasonID})}this._ctrBillingDetailsEdit.SaveEvent.subscribe(this.onBillingDetailsModalSave,this);this._ctrBillingDetailsEdit.CancelEvent.subscribe(this.onBillingDetailsModalCancel,this);this._mdlBillingDetailsEdit=new cm.ui.dialog.ModalDialog("mdlBillingDetailsEdit_"+this._uniqueID,{title:"Billing Information",width:530,draggable:false,dialogClass:"cmEditDialog"});this._divModals.AddChild(this._mdlBillingDetailsEdit);this._mdlBillingDetailsEdit.AddChild(this._ctrBillingDetailsEdit);this._divModals.Hide()},createEvents:function($super){$super()},wireEvents:function($super){$super();this._aBillingSummaryEdit.ClickEvent.subscribe(this.onBillingDetailsEdit,this);this._fsrblInvoiceDeliveryMethod.SelectionChangedEvent.subscribe(this.onInvoiceDeliveryMethodChanged,this)},onBillingDetailsEdit:function(c,a){var b=this.GetData();this._ctrBillingDetailsEdit.SetFamilyData(this._familyData);this._ctrBillingDetailsEdit.Bind(b);this._mdlBillingDetailsEdit.Show()},onBillingDetailsModalSave:function(c,a){var b=a.data;this.Bind(b);this._mdlBillingDetailsEdit.Hide()},onBillingDetailsModalCancel:function(b,a){this._mdlBillingDetailsEdit.Hide()},onInvoiceDeliveryMethodChanged:function(){var a=this._fsrblInvoiceDeliveryMethod.GetData()},ToggleBillingAddress:function(d){this._familyData=d;var b=this.GetBoundData();if($$USER.PersonID<=0||$$CM.isNull(b)){var e=$$SETTINGSDU.GetFamilyMailingTitle(d);var a=!$$CM.isNull(d)?d.HomeAddress:null;var c=null;var f=false;if(!$$CM.isNull(d)){if(!$$CM.isNull(d.Parent1)){c=d.Parent1.LoginEmail}f=d.ReceivesInvoices}b={MailingTitle:e,Address:a,Email:c,ReceivesInvoices:f};this.Bind(b)}else{if(!$$CM.isNull(b)){if(!$$CM.addressExists(b.Address)){b.Address=d.HomeAddress}else{if(this._isUPR==true&&b.BillingAddressID>0){if(!$$CM.isNull(this._familyData.HomeEntityAddress)&&this._familyData.HomeEntityAddress.AddressID==b.BillingAddressID){b.Address=this._familyData.HomeAddress}else{if(!$$CM.isNull(this._familyData.SummerEntityAddress)&&this._familyData.SummerEntityAddress.AddressID==b.BillingAddressID){b.Address=this._familyData.SummerAddress}}}}if($$CM.isEmpty(b.MailingTitle)){b.MailingTitle=$$SETTINGSDU.GetFamilyMailingTitle(d)}this.Bind(b)}}},bindSummary:function(d){if(!$$CM.isNull(d)){var e="";if(this._enableInvoiceDeliveryMethod!=true){if(this._invoiceDeliveryMethodEnum.CompareByName("Both",this._defaultInvoiceDeliveryMethodID,2)){if(!$$CM.isEmpty(d.Email)){e+="email"}if(!$$CM.isEmpty(e)){e+=" and "}e+="standard mail"}else{if(this._invoiceDeliveryMethodEnum.CompareByName("Mail",this._defaultInvoiceDeliveryMethodID,2)){e+="standard mail"}else{if(this._invoiceDeliveryMethodEnum.CompareByName("Email",this._defaultInvoiceDeliveryMethodID,2)){if(!$$CM.isEmpty(d.Email)){e+="email"}}}}}var c="Your billing information is below. ";if(!$$CM.isEmpty(e)){c+="Invoices will be sent via "+e+"."}this._divBillingSummaryMessage.UpdateInnerHtml(c);var b="";if(!$$CM.isEmpty(d.MailingTitle)){b+=d.MailingTitle+"<br />"}if(!$$CM.isEmpty(d.Email)){b+="("+d.Email+")<br />"}var a=$$CM.getFormattedAddress(d.Address);if(!$$CM.isEmpty(a)){b+=a}if(!$$CM.isEmpty(b)){this._divBillingSummary.UpdateInnerHtml(b)}}},Validate:function(c){var d=new cm.validation.ValidationResult("",null);if(d.IsValid()){var b=this.GetData();var a=(this._invoiceDeliveryMethodEnum.CompareByName("Email",b.InvoiceDeliveryMethodID,2)||this._invoiceDeliveryMethodEnum.CompareByName("Both",b.InvoiceDeliveryMethodID,2));if(a==true){this._ctrBillingDetailsEdit.Bind(b);var e=this._ctrBillingDetailsEdit.Validate(true);if(!e.IsValid()){this._mdlBillingDetailsEdit.Show();d.AppendResult(e)}}}if(c==true){this.Validator.ShowErrors(d)}return d},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._divBillingSummary.UpdateInnerHtml("");if(this._enableInvoiceDeliveryMethod==true){this._fsrblInvoiceDeliveryMethod.Bind()}else{this._fsrblInvoiceDeliveryMethod.Bind(this._defaultInvoiceDeliveryMethodID)}},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this.bindSummary(a);if(this._enableInvoiceDeliveryMethod==true){var b=a.InvoiceDeliveryMethodID;if($$CM.isNumber(b)&&b>0){this._fsrblInvoiceDeliveryMethod.Bind(b)}}}},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}if(this._enableInvoiceDeliveryMethod==true){a.InvoiceDeliveryMethodID=this._fsrblInvoiceDeliveryMethod.GetData();a.ReceivesInvoices=true}else{a.InvoiceDeliveryMethodID=this._defaultInvoiceDeliveryMethodID;if(!this._invoiceDeliveryMethodEnum.CompareByName("Mail",a.InvoiceDeliveryMethodID,2)){a.ReceivesInvoices=true}}return a}});"cm.ui.forms.application".namespace();cm.ui.forms.application.BillingDetailsEditConfigOptions=Class.create(cm.ConfigOptions,{title:"Billing Information",settings:new Object(),seasonID:0});cm.ui.forms.application.BillingDetailsEdit=Class.create(cm.ui.ComplexControl,{CancelEvent:null,SaveEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.BillingDetailsEditConfigOptions()},initializeDAOs:function($super){$super()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._invoiceDeliveryMethodEnum=cm.dao.Financial.Enums.InvoiceDeliveryMethodStringValue.asEnum();this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._title=this._co.title;this._enableInvoiceDeliveryMethod=this._settings.EnableInvoiceDeliveryMethod;this._defaultInvoiceDeliveryMethodID=this._settings.DefaultInvoiceDeliveryMethodID},initializeUIElements:function(){this._divBody=$$P.div("divBIEBody_"+this._uniqueID);this.AddChild(this._divBody);this._divBody.AddClassName("bd");this._divHeaderMessage=$$P.div("divBIEHeaderMessage_"+this._uniqueID);this._divBody.AddChild(this._divHeaderMessage);this._divHeaderMessage.AddClassName("mt10px mb20px");this._divHeaderMessage.UpdateInnerHtml("If someone else is responsible for paying invoices for this participant, please enter their information below.");this._divMailingTitle=$$P.div("divBIEMailingTitle_"+this._uniqueID);this._divBody.AddChild(this._divMailingTitle);this._divMailingTitle.AddClassName("ldp");this._ftxtMailingTitle=new $$FTXT("ftxtBIEMailingTitle_"+this._uniqueID,{label:"Mail to",isRequired:true,inputWidth:385,fieldTip:"Ex: Mr. & Mrs. Matthew Henry",fieldTipClass:"w385px",maxLength:100});this._divMailingTitle.AddChild(this._ftxtMailingTitle);this._ftxtMailingTitle.SetPlaceholderText("Click to edit");this._ftxtMailingTitle.AddClassName("w100prct");this._ftxtMailingTitle.GetTitleControl().AddClassName("w105px");this._ftxtMailingTitle.GetInputControl().AddClassName("w385px");this._ftxtMailingTitle.Validator.addEvaluator($$EVAL.TEXT({FieldName:"Mailing Title",IsRequired:true}));this._divEmail=$$P.div("divBIEEmail_"+this._uniqueID);this._divBody.AddChild(this._divEmail);this._divEmail.AddClassName("ldp");this._ftxtEmail=new $$FEMAIL("ftxtBIEEmail_"+this._uniqueID,{label:"Email",isRequired:true,inputWidth:385,maxLength:50});this._divEmail.AddChild(this._ftxtEmail);this._ftxtEmail.SetPlaceholderText("Click to edit");this._ftxtEmail.AddClassName("w100prct");this._ftxtEmail.GetTitleControl().AddClassName("w105px");this._ftxtEmail.GetInputControl().AddClassName("w385px");this._ftxtEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:"Email",IsRequired:true}));var a={enabled:true,legendLabel:"",legendCssClass:"",groupFieldName:"",required:true,defaultCountry:$$CLIENT.Country};this._ctrAddress=new $$FADDRESS("divBIEAddress_"+this._uniqueID,a);this._divBody.AddChild(this._ctrAddress);this._fsrblbInvoiceCopyOptions=new $$FSRBLB("fsrblbBIEInvoiceCopyOptions_"+this._uniqueID,{legendLabel:"Would you like to receive a copy of the invoice at your home address?",legendCssClass:"cmFloatLeft w100prct pt5px",isRequired:false});this._divBody.AddChild(this._fsrblbInvoiceCopyOptions);this._fsrblbInvoiceCopyOptions.AddClassName("cmFormRow mb10px");this._fsrblbInvoiceCopyOptions.GetListControl().AddClassName("cmBold");this._fsrblbInvoiceCopyOptions.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Invoice Copy Options",IsRequired:true}));this._fsrblbInvoiceCopyOptions.Hide();if(this._enableInvoiceDeliveryMethod!=true&&this._invoiceDeliveryMethodEnum.CompareByName("Mail",this._defaultInvoiceDeliveryMethodID,2)){this._fsrblbInvoiceCopyOptions.Show()}this._divFooter=$$P.div("divBIEFooter_"+this._uniqueID);this.AddChild(this._divFooter);this._divFooter.AddClassName("ft");this._btnSave=new $$BTN("btnBIESave_"+this._uniqueID,{text:"Save"});this._divFooter.AddChild(this._btnSave);this._btnSave.AddClassName("cmGoButton cmFloatRight");this._btnDelete=new $$BTN("btnBIEDelete_"+this._uniqueID,{text:"Delete"});this._divFooter.AddChild(this._btnDelete);this._btnDelete.AddClassName("cmCancelDeleteButton cmFloatRight");this._btnDelete.Hide();this._btnCancel=new $$BTN("btnBIECancel_"+this._uniqueID,{text:"Cancel"});this._divFooter.AddChild(this._btnCancel);this._btnCancel.AddClassName("cmCancelDeleteButton")},createEvents:function($super){$super();this.CancelEvent=new cm.event();this.SaveEvent=new cm.event()},wireEvents:function($super){$super();this._btnCancel.ClickEvent.subscribe(this.onCancel,this);this._btnSave.ClickEvent.subscribe(this.onSave,this)},onCancel:function(b,a){this.CancelEvent.fire(this,{})},onSave:function(c,a){if(this.IsValid(false)){var b=this.GetData();this.SaveEvent.fire(this,{data:b})}},SetFamilyData:function(a){this._familyData=a},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ftxtMailingTitle.Bind(null);this._ftxtEmail.Bind(null);this._ftxtEmail.Validator.RemoveAll();this._ctrAddress.Bind(null);this._fsrblbInvoiceCopyOptions.Bind(null)},onDataUpdated:function(){this.ClearFields();var b=this.GetBoundData();if(!$$CM.isNull(b)){var c=this._defaultInvoiceDeliveryMethodID;if(this._enableInvoiceDeliveryMethod==true){c=b.InvoiceDeliveryMethodID}var a=(this._invoiceDeliveryMethodEnum.CompareByName("Email",c,2)||this._invoiceDeliveryMethodEnum.CompareByName("Both",c,2));if(a==true){this._ftxtEmail.GetTitleControl().UpdateInnerHtml("<span class='cmRequiredField'>Email</span>");this._ftxtEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:"Email",IsRequired:a}))}else{this._ftxtEmail.GetTitleControl().UpdateInnerHtml("Email")}if(!$$CM.isEmpty(b.MailingTitle)){this._ftxtMailingTitle.Bind(b.MailingTitle)}if(!$$CM.isEmpty(b.Email)){this._ftxtEmail.Bind(b.Email)}if(!$$CM.isNull(b.Address)){this._ctrAddress.Bind(b.Address)}this._fsrblbInvoiceCopyOptions.Bind(b.ReceivesInvoices==true)}},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}a.MailingTitle=this._ftxtMailingTitle.GetData();a.Email=this._ftxtEmail.GetData();a.Address=this._ctrAddress.GetData();if(this._enableInvoiceDeliveryMethod!=true&&this._invoiceDeliveryMethodEnum.CompareByName("Mail",this._defaultInvoiceDeliveryMethodID,2)){a.ReceivesInvoices=this._fsrblbInvoiceCopyOptions.GetData()}else{a.ReceivesInvoices=true}return a}});"cm.ui.forms.application".namespace();cm.ui.forms.application.BillingDetailsEditUPRConfigOptions=Class.create(cm.ConfigOptions,{title:"Billing Information",settings:new Object(),seasonID:0});cm.ui.forms.application.BillingDetailsEditUPR=Class.create(cm.ui.ComplexControl,{CancelEvent:null,SaveEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.BillingDetailsEditUPRConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._invoiceDeliveryMethodEnum=cm.dao.Financial.Enums.InvoiceDeliveryMethodStringValue.asEnum();this._enumAddressType=cm.dao.Lists.Enums.AddressType.asEnum();this._enumAddressEntityType=cm.dao.Lists.Enums.AddressEntityType.asEnum();this._enumEntityTypeFlag=cm.dao.Lists.Enums.EntityTypeFlag.asEnum();this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._title=this._co.title;this._enableInvoiceDeliveryMethod=this._settings.EnableInvoiceDeliveryMethod;this._defaultInvoiceDeliveryMethodID=this._settings.DefaultInvoiceDeliveryMethodID;this._ctrEntityAddressRowArray=$A()},initializeUIElements:function(){this.AddClassName("");this._ctrBillingDetails=$$P.div("ctrBillingDetails_"+this._uniqueID);this.AddChild(this._ctrBillingDetails);this._divBody=$$P.div("divBody_"+this._uniqueID);this._ctrBillingDetails.AddChild(this._divBody);this._divBody.AddClassName("bd");this._divHeaderMessage=$$P.div("divHeaderMessage_"+this._uniqueID);this._divBody.AddChild(this._divHeaderMessage);this._divHeaderMessage.AddClassName("mt10px mb20px");this._divHeaderMessage.UpdateInnerHtml("If someone else is responsible for paying invoices for this participant, please enter their information below.");this._divMailingTitle=$$P.div("divMailingTitle_"+this._uniqueID);this._divBody.AddChild(this._divMailingTitle);this._divMailingTitle.AddClassName("ldp");this._ftxtMailingTitle=new $$FTXT("ftxtMailingTitle_"+this._uniqueID,{label:"Address invoices to:",isRequired:true,fieldTip:"Ex: Mr. & Mrs. Matthew Henry",fieldTipClass:"w370px",maxLength:100});this._divMailingTitle.AddChild(this._ftxtMailingTitle);this._ftxtMailingTitle.SetPlaceholderText("Click to edit");this._ftxtMailingTitle.AddClassName("w100prct");this._ftxtMailingTitle.GetTitleControl().AddClassName("w130px");this._ftxtMailingTitle.GetInputControl().AddClassName("w370px");this._ftxtMailingTitle.GetFieldTipControl().AssignStyle("margin-left","133px");this._ftxtMailingTitle.Validator.addEvaluator($$EVAL.TEXT({FieldName:"Mailing Title",IsRequired:true}));this._divEmail=$$P.div("divEmail_"+this._uniqueID);this._divBody.AddChild(this._divEmail);this._divEmail.AddClassName("ldp");this._ftxtEmail=new $$FEMAIL("ftxtEmail_"+this._uniqueID,{label:"Billing Email Address:",isRequired:true,maxLength:50});this._divEmail.AddChild(this._ftxtEmail);this._ftxtEmail.SetPlaceholderText("Click to edit");this._ftxtEmail.AddClassName("w100prct");this._ftxtEmail.GetTitleControl().AddClassName("w130px");this._ftxtEmail.GetInputControl().AddClassName("w370px");this._ftxtEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:"Billing Email Address",IsRequired:true}));this._divEntityAddressListHeader=$$P.div("divEntityAddressListWrapper_"+this._uniqueID);this._divBody.AddChild(this._divEntityAddressListHeader);this._divEntityAddressListHeader.AddClassName("cmFormRow mt10px");this._divEntityAddressListLabel=$$P.div("divEntityAddressListLabel_"+this._uniqueID);this._divEntityAddressListHeader.AddChild(this._divEntityAddressListLabel);this._divEntityAddressListLabel.AddClassName("cmFloatLeft cmBold");this._divEntityAddressListLabel.UpdateInnerHtml("Please select your billing address:");this._btnAddEntityAddress=new $$BTN("btnAddEntityAddress_"+this._uniqueID,{text:"Add New Address"});this._divEntityAddressListHeader.AddChild(this._btnAddEntityAddress);this._btnAddEntityAddress.AddClassName("cmGoButton cmFloatRight");this._divEntityAddressList=$$P.div("divEntityAddressList_"+this._uniqueID);this._divBody.AddChild(this._divEntityAddressList);this._divEntityAddressList.AddClassName("cmFormRow min_h100px max_h300px cmScrollY");this._fsrblbInvoiceCopyOptions=new $$FSRBLB("fsrblbInvoiceCopyOptions_"+this._uniqueID,{legendLabel:"Would you like to receive a copy of the invoice at your home address?",legendCssClass:"cmFloatLeft w100prct pt5px",isRequired:false});this._divBody.AddChild(this._fsrblbInvoiceCopyOptions);this._fsrblbInvoiceCopyOptions.AddClassName("cmFormRow mb10px");this._fsrblbInvoiceCopyOptions.GetListControl().AddClassName("cmBold");this._fsrblbInvoiceCopyOptions.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Invoice Copy Options",IsRequired:true}));this._fsrblbInvoiceCopyOptions.Hide();if(this._enableInvoiceDeliveryMethod!=true&&this._invoiceDeliveryMethodEnum.CompareByName("Mail",this._defaultInvoiceDeliveryMethodID,2)){this._fsrblbInvoiceCopyOptions.Show()}this._divFooter=$$P.div("divFooter_"+this._uniqueID);this._ctrBillingDetails.AddChild(this._divFooter);this._divFooter.AddClassName("ft");this._btnSave=new $$BTN("btnSave_"+this._uniqueID,{text:"Save"});this._divFooter.AddChild(this._btnSave);this._btnSave.AddClassName("cmGoButton cmFloatRight");this._btnDelete=new $$BTN("btnDelete_"+this._uniqueID,{text:"Delete"});this._divFooter.AddChild(this._btnDelete);this._btnDelete.AddClassName("cmCancelDeleteButton cmFloatRight");this._btnDelete.Hide();this._btnCancel=new $$BTN("btnCancel_"+this._uniqueID,{text:"Cancel"});this._divFooter.AddChild(this._btnCancel);this._btnCancel.AddClassName("cmCancelDeleteButton");this._ctrEntityAddress=new cm.ui.common.EntityAddress("ctrEntityAddress_"+this._uniqueID,{settings:this._settings});this.AddChild(this._ctrEntityAddress);this._ctrEntityAddress.SaveEvent.subscribe(this.onEntityAddressSave,this);this._ctrEntityAddress.CancelEvent.subscribe(this.onEntityAddressCancel,this);this._ctrEntityAddress.Hide()},createEvents:function($super){$super();this.CancelEvent=new cm.event();this.SaveEvent=new cm.event()},wireEvents:function($super){$super();this._btnAddEntityAddress.ClickEvent.subscribe(this.onEntityAddressEdit,this);this._btnCancel.ClickEvent.subscribe(this.onCancel,this);this._btnSave.ClickEvent.subscribe(this.onSave,this)},onEntityAddressSelect:function(c,a){var b=a.data;this.selectEntityAddress(b)},onEntityAddressEdit:function(d,a){var c=null;if(!$$CM.isNull(a)&&!$$CM.isNull(a.data)){c=a.data}else{var e=this.getTempID();var b="US";if(!$$CM.isNull($$CLIENT.Country)){b=$$CLIENT.Country}c={ID:e,AddressID:e,Address:{ID:e,Country:b}}}this.toggleEntityAddress(c)},onEntityAddressSave:function(c,a){var b=a.data;this.modifyEntityAddress(b);this.toggleEntityAddress()},onEntityAddressCancel:function(b,a){this.toggleEntityAddress()},onEntityAddressDelete:function(c,a){var b=a.data;this.removeEntityAddress(b)},onCancel:function(b,a){this.CancelEvent.fire(this,{})},onSave:function(c,a){if(this.IsValid(false)){var b=this.GetData();this.SaveEvent.fire(this,{data:b})}},toggleEntityAddress:function(a){if(!$$CM.isNull(a)){this._ctrEntityAddress.BindStaticLists({addressEntityArray:this._addressEntityArray});this._ctrEntityAddress.SetMasterEntityAddressList(this._finalEntityAddressList);this._ctrEntityAddress.Bind(a);this._ctrBillingDetails.Hide(true);this._ctrEntityAddress.Show(true)}else{this._ctrBillingDetails.Show(true);this._ctrEntityAddress.Hide(true)}},getTempID:function(){var b=0;var a=this.GetData();a.ModifyEntityAddressArray.each(function(c){if(c.ID<b){b=c.ID}},this);return b-1},selectEntityAddress:function(b){if(!$$CM.isNull(b)){var a=this.GetData();a.BillingAddressID=b.AddressID;a.Address=b.Address;this.Bind(a)}},modifyEntityAddress:function(c){if(!$$CM.isNull(c)){var b=this.GetData();var d=$A();b.ModifyEntityAddressArray.each(function(e){if(e.ID!=c.ID){d.push(e)}},this);d.push(c);b.ModifyEntityAddressArray=d;var a=this._ctrEntityAddressRowArray.find(function(e){return e.IsChecked()==true&&e.GetData().ID==c.ID},this);if(!$$CM.isNull(a)){b.BillingAddressID=c.AddressID;b.Address=c.Address}this.Bind(b)}},removeEntityAddress:function(d){if(!$$CM.isNull(d)){var b=this.GetData();var e=$A();b.ModifyEntityAddressArray.each(function(f){if(f.ID!=d.ID){e.push(f)}},this);b.ModifyEntityAddressArray=e;var a=this._ctrEntityAddressRowArray.find(function(f){return f.IsChecked()==true&&f.GetData().ID==d.ID},this);if(!$$CM.isNull(a)){var c=this.getFamilyHomeEntityAddress();if(!$$CM.isNull(c)){b.BillingAddressID=c.AddressID;b.Address=c.Address}}this.Bind(b)}},SetFamilyData:function(a){this._familyData=a;this._addressEntityArray=$A();if(!$$CM.isNull(this._familyData)){var b=$$CM.isInteger(this._familyData.FamilyID)?this._familyData.FamilyID:0;this._addressEntityArray.push({ID:this._enumAddressEntityType.GetId("family1"),Name:"Household",EntityID:b,EntityTypeID:this._enumEntityTypeFlag.GetId("Family")});if(!$$CM.isNull(this._familyData.Parent1)){var c=this._familyData.Parent1;this._addressEntityArray.push({ID:this._enumAddressEntityType.GetId("parent1"),Name:c.Name.FirstName,EntityID:c.PersonID,EntityTypeID:this._enumEntityTypeFlag.GetId("Person")})}if(!$$CM.isNull(this._familyData.Parent2)){var d=this._familyData.Parent2;this._addressEntityArray.push({ID:this._enumAddressEntityType.GetId("parent2"),Name:d.Name.FirstName,EntityID:d.PersonID,EntityTypeID:this._enumEntityTypeFlag.GetId("Person")})}}},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ctrBillingDetails.Show();this._ctrEntityAddress.Hide();this._ftxtMailingTitle.Bind(null);this._ftxtEmail.Bind(null);this._ftxtEmail.Validator.RemoveAll();this._divEntityAddressList.DestroyChildControls(true);this._fsrblbInvoiceCopyOptions.Bind(null)},onDataUpdated:function(){this.ClearFields();var b=this.GetBoundData();if(!$$CM.isNull(b)){var c=this._defaultInvoiceDeliveryMethodID;if(this._enableInvoiceDeliveryMethod==true){c=b.InvoiceDeliveryMethodID}var a=(this._invoiceDeliveryMethodEnum.CompareByName("Email",c,2)||this._invoiceDeliveryMethodEnum.CompareByName("Both",c,2));if(a==true){this._ftxtEmail.GetTitleControl().UpdateInnerHtml("<span class='cmRequiredField'>Billing Email Address:</span>");this._ftxtEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:"Email",IsRequired:a}))}else{this._ftxtEmail.GetTitleControl().UpdateInnerHtml("Email")}if(!$$CM.isEmpty(b.MailingTitle)){this._ftxtMailingTitle.Bind(b.MailingTitle)}if(!$$CM.isEmpty(b.Email)){this._ftxtEmail.Bind(b.Email)}this.bindEntityAddresses(b);this._fsrblbInvoiceCopyOptions.Bind(b.ReceivesInvoices==true)}},bindEntityAddresses:function(d){this._divEntityAddressList.DestroyChildControls(true);this._ctrEntityAddressRowArray=$A();var m=$$CADU.GetHouseholdList(this._seasonID,$$USER.PersonID,16);var e=$$CADU.GetEntityAddressList(this._seasonID,$$USER.PersonID,16);var a=$$CADU.GetAddressList(this._seasonID,$$USER.PersonID,16);var h=0;var n=null;var p=null;if(!$$CM.isNull(this._familyData)){h=this._familyData.FamilyID;if(!$$CM.isNull(this._familyData.Parent1)){n=this._familyData.Parent1}if(!$$CM.isNull(this._familyData.Parent2)){p=this._familyData.Parent2}}var l=m.find(function(r){return r.TypeID==this._enumEntityTypeFlag.GetId("Family")&&Number(r.ID)==h},this);if(!$$CM.isNull(l)&&l.BillingAddressID>0){if(!$$CM.isNull(d)&&!$$CM.isInteger(d.BillingAddressID)){d.BillingAddressID=l.BillingAddressID}}var g=this.getFamilyHomeEntityAddress();var f=this.getFamilyEntityAddressArray();var j=$A();if(!$$CM.isNull(d)&&$$CM.isArray(d.ModifyEntityAddressArray)){d.ModifyEntityAddressArray.each(function(r){j.push(r)},this)}if(f){f.each(function(r){j.push(r)},this)}if(h>0){var i=e.findAll(function(r){return r.TypeID==this._enumEntityTypeFlag.GetId("Family")&&r.EntityID==h},this);if(i.length>0){i.each(function(s){var r=j.find(function(t){return t.ID==s.ID},this);if($$CM.isNull(r)){j.push(s)}},this)}if(!$$CM.isNull(n)){var o=e.findAll(function(r){return r.TypeID==this._enumEntityTypeFlag.GetId("Person")&&r.EntityID==n.PersonID},this);if(o.length>0){o.each(function(s){if(!$$CM.isNumber(s.ParentEntityAddressID)){var r=j.find(function(t){return t.ID==s.ID},this);if($$CM.isNull(r)){j.push(s)}}},this)}}if(!$$CM.isNull(p)){var q=e.findAll(function(r){return r.TypeID==this._enumEntityTypeFlag.GetId("Person")&&r.EntityID==p.PersonID},this);if(q.length>0){q.each(function(s){if(!$$CM.isNumber(s.ParentEntityAddressID)){var r=j.find(function(t){return t.ID==s.ID},this);if($$CM.isNull(r)){j.push(s)}}},this)}}}if(j.length>0){var k="entityAddress_"+this._uniqueID;j.each(function(v){if($$CM.isNull(v.Address)){var r=a.find(function(w){return Number(w.ID)==v.AddressID},this);if(!$$CM.isNull(r)){v.Address=$$CM.deepClone(r)}}var s=this._addressEntityArray.find(function(w){if(v.EntityID==0){return w.EntityTypeID==v.TypeID}else{return w.EntityID==v.EntityID}},this);if(!$$CM.isNull(s)){v.EntityName=s.Name}var u=new cm.ui.forms.application.EntityAddressRow("ctrEntityAddressRow_"+$$CM.uniqueID(),{data:v,groupName:k,cssClassName:"cmFormRow"});this._divEntityAddressList.AddChild(u);this._ctrEntityAddressRowArray.push(u);u.SelectEvent.subscribe(this.onEntityAddressSelect,this);u.EditEvent.subscribe(this.onEntityAddressEdit,this);u.DeleteEvent.subscribe(this.onEntityAddressDelete,this);var t=(!$$CM.isNull(d)&&!$$CM.isEmpty(d.BillingAddressID)&&d.BillingAddressID==v.AddressID);u.SetChecked(t)},this)}var c=this._ctrEntityAddressRowArray.find(function(r){return r.IsChecked()==true},this);if($$CM.isNull(c)&&!$$CM.isNull(g)){var b=this._ctrEntityAddressRowArray.find(function(r){var s=r.GetData();return s.TypeID==this._enumEntityTypeFlag.GetId("Family")&&s.AddressTypeID==this._enumAddressType.GetId("Home")},this);if(!$$CM.isNull(b)){b.SetChecked(true)}d.BillingAddressID=g.AddressID;d.Address=g.Address}this._finalEntityAddressList=j},getFamilyHomeEntityAddress:function(){var c=null;if(!$$CM.isNull(this._familyData)){var d=this._familyData.FamilyID;var e=this._enumEntityTypeFlag.GetId("Family");var b=this._enumAddressType.GetId("Home");var a=this._enumAddressEntityType.GetId("family1");c=$$CADU.SetEntityAddress(this._familyData.HomeEntityAddress,this._familyData.HomeAddress,d,e,b,a)}return c},getFamilyEntityAddressArray:function(){var b=$A();if(!$$CM.isNull(this._familyData)){var c=this._familyData.FamilyID;var d=this._enumEntityTypeFlag.GetId("Family");var a=this._enumAddressEntityType.GetId("family1");var e=this._enumAddressType.GetId("Home");var f=$$CADU.SetEntityAddress(this._familyData.HomeEntityAddress,this._familyData.HomeAddress,c,d,e,a);if(!$$CM.isNull(f)&&!$$CM.addressEmptyIgnoreCountry(f.Address)){b.push(f)}var g=this._enumAddressType.GetId("Summer");if(!(g>0)){g=this._enumAddressType.GetId("Vacation")}var h=$$CADU.SetEntityAddress(this._familyData.SummerEntityAddress,this._familyData.SummerAddress,c,d,g,a);if(!$$CM.isNull(h)&&!$$CM.addressEmptyIgnoreCountry(h.Address)){b.push(h)}}return b},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}if(!$$CM.isArray(a.ModifyEntityAddressArray)){a.ModifyEntityAddressArray=$A()}a.MailingTitle=this._ftxtMailingTitle.GetData();a.Email=this._ftxtEmail.GetData();if(this._enableInvoiceDeliveryMethod!=true&&this._invoiceDeliveryMethodEnum.CompareByName("Mail",this._defaultInvoiceDeliveryMethodID,2)){a.ReceivesInvoices=this._fsrblbInvoiceCopyOptions.GetData()}else{a.ReceivesInvoices=true}return a}});cm.ui.forms.application.EntityAddressRow=Class.create(cm.ui.Control,{SelectEvent:null,EditEvent:null,DeleteEvent:null,initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._groupName=this._co.groupName;this._enumAddressType=cm.dao.Lists.Enums.AddressType.asEnum();this._enumAddressEntityType=cm.dao.Lists.Enums.AddressEntityType.asEnum();this._enumEntityTypeFlag=cm.dao.Lists.Enums.EntityTypeFlag.asEnum();if($$CM.isEmpty(this._co.cssClassName)){this._co.cssClassName=""}this._data=this._co.data;this._atHomeID=this._enumAddressType.GetId("Home");this._atVacationID=this._enumAddressType.GetId("Vacation");if(!(this._atVacationID>0)){this._atVacationID=this._enumAddressType.GetId("Summer")}this._atBusinessID=this._enumAddressType.GetId("Business");this._atSchoolID=this._enumAddressType.GetId("School");this._atOtherID=this._enumAddressType.GetId("Other");this._editable=true;this._deletable=true;if(!$$CM.isNull(this._data)){if((this._data.AddressTypeID&this._atHomeID)==this._atHomeID||(this._data.AddressTypeID&this._atVacationID)==this._atVacationID){this._editable=false;this._deletable=false}else{if(this._data.ID>0){this._deletable=false}}}},initializeUIElements:function(){this.AddClassName(this._co.cssClassName);this._divWrapper=$$P.div("divWrapper_"+this._uniqueID);this.AddChild(this._divWrapper);this._divWrapper.AddClassName("cmFormRow");this._divAddress=$$P.div("divAddress_"+this._uniqueID);this._divWrapper.AddChild(this._divAddress);this._divAddress.AddClassName("cmFloatLeft w350px");var a="";if((this._data.AddressTypeID&this._atHomeID)==this._atHomeID){a="Home Address"}else{if((this._data.AddressTypeID&this._atVacationID)==this._atVacationID){a="Summer Address"}else{if((this._data.AddressTypeID&this._atBusinessID)==this._atBusinessID){a="Business Address"}else{if((this._data.AddressTypeID&this._atSchoolID)==this._atSchoolID){a="School Address"}else{if(!$$CM.isEmpty(this._data.Label)){a=this._data.Label}}}}}var b="";if(!$$CM.isEmpty((a))){if(this._data.TypeID==this._enumEntityTypeFlag.GetId("Person")&&!$$CM.isEmpty(this._data.EntityName)){a+=" ("+this._data.EntityName+")"}b+="<b>"+a+"</b>"}if(!$$CM.isNull((this._data.Address))){if(b.length>0){b+="<br/>"}b+=$$CM.getFormattedAddress(this._data.Address)}this._frbAddress=new $$FRB("frbAddress_"+this._uniqueID+"_"+this._data.AddressID,{value:this._data.AddressID,label:b,name:this._groupName,labelClass:"w100prct pt0px",labelCssClass:"w350px",inputCssClass:"mt4px",spanWidth:300});this._divAddress.AddChild(this._frbAddress);this._divButtons=$$P.div("divButtons_"+this._uniqueID);this._divWrapper.AddChild(this._divButtons);this._divButtons.AddClassName("cmFloatRight w100px");this._btnDelete=new $$A("btnDelete_"+this._uniqueID,{text:""});this._divButtons.AddChild(this._btnDelete);this._btnDelete.AddClassName("cmFloatRight cmIconDelete mr5px");if(this._deletable!=true){this._btnDelete.Hide()}this._btnEdit=new $$A("btnEdit_"+this._uniqueID,{text:""});this._divButtons.AddChild(this._btnEdit);this._btnEdit.AddClassName("cmFloatRight cmIconEdit mr5px");if(this._editable!=true){this._btnEdit.Hide()}var c=$$P.div("divSeparator");this.AddChild(c);c.AddClassName("w100prct cmSeparator")},createEvents:function($super){$super();this.SelectEvent=new cm.event();this.EditEvent=new cm.event();this.DeleteEvent=new cm.event()},wireEvents:function($super){$super();this._frbAddress.ChangeEvent.subscribe(this.onSelect,this);this._btnEdit.ClickEvent.subscribe(this.onEdit,this);this._btnDelete.ClickEvent.subscribe(this.onDelete,this)},onSelect:function(c,a){var b=this.GetData();this.SelectEvent.fire(this,{data:b})},onEdit:function(c,a){var b=this.GetData();this.EditEvent.fire(this,{data:b})},onDelete:function(c,a){var b={title:"Confirm",message:"This address will be deleted permanently.  Do you want to continue?",handlerOk:this.onDeleteOK,handlerCancel:this.onDeleteCancel,dialogClass:"alert",scope:this};$$CMD.Confirm(b)},onDeleteOK:function(c,a){var b=this.GetData();this.DeleteEvent.fire(this,{data:b})},onDeleteCancel:function(b,a){},IsChecked:function(){return this._frbAddress.IsChecked()},SetChecked:function(a){this._frbAddress.SetChecked(a)},GetData:function(){var a=this._data;return a}});"cm.ui.forms.application".namespace();cm.ui.forms.application.CamperDetailsConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object()});cm.ui.forms.application.CamperDetails=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.application.CamperDetailsConfigOptions()},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;if($$CM.isNull(this._settings)){this._settings=new Object()}this._camperSettings=$$SETTINGSDU.GetCamperSettings();this._entityLabelSettings=$$SETTINGSDU.GetEntityLabelSettings();this._seasonID=this._settings.SeasonID;this._userTypeFlag=cm.dao.Security.Enums.UserTypeFlag.asEnum();this._enableFirstName=true;this._enableMiddleName=true;this._enableLastName=true;this._enableNickName=true;this._enableSuffix=true;this._enableDOB=true;this._enableSchool=true;this._headerMessage=this._settings.CamperInformationHeaderMessage;this._headerMessageCssClass=this._settings.CamperInformationHeaderMessageCssClass;this._enableGender=this._settings.EnableGender;this._defaultGenderID=this._settings.DefaultGender;this._enableGrade=(this._settings.DisableGrade!=true);this._requireSchool=this._settings.RequireSchool;if(this._settings.DisableSchool==true){this._enableSchool=false}if($$CLIENT.ID==495){this._enableSchool=false}this._enableSSN=this._settings.EnableSSN;this._enableTShirtSize=this._settings.EnableTShirtSize;this._requireTShirtSize=this._settings.RequireTShirtSize;this._enabledTShirtSizeArray=this._settings.EnabledTShirtSizeArray;this._enableSkype=this._settings.SkypeEnabled;this._enableFacebook=this._settings.FacebookEnabled;this._enableTwitter=this._settings.TwitterEnabled;this._enableLinkedIn=this._settings.LinkedInEnabled;this._pricingIdentifierLabel="Pricing Identifier";this._pricingIdentifierArray=$A();if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true){this._pricingIdentifierArray=$$CADU.GetPricingIdentifierArray(this._settings.SeasonSessionGroupSettingsList);if(!$$CM.isNull(cm.dao.Lists.Data.PricingIdentifierLabelArray)&&$$CM.isArray(cm.dao.Lists.Data.PricingIdentifierLabelArray)){var d=cm.dao.Lists.Data.PricingIdentifierLabelArray;this._pricingIdentifierLabel=d[0]}}this._gradeArray=$A();if($$CM.isArray(cm.dao.Lists.Data.GradesArray)){var a=cm.dao.Lists.Data.GradesArray;a.each(function(e){this._gradeArray.push(Object.clone(e))},this)}var c=this._settings.MinGradeID;var b=this._settings.MaxGradeID;if($$CM.isNumber(c)&&$$CM.isNumber(b)){var a=$A();if(this._camperSettings.GradeCompleted!=true){c=c-1;if(b<14){b=b-1}}this._gradeArray.each(function(e){if(Number(e.ID)>=Number(c)&&Number(e.ID)<=Number(b)){a.push(Object.clone(e))}});this._gradeArray=a}},initializeUIElements:function(){this.AddClassName("cmCamperDetails");if(!$$CM.isEmpty(this._headerMessage)){this._ctrHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._headerMessage,cssClass:"cmClear mt0px mb10px"});this.AddChild(this._ctrHeaderMessage);if(!$$CM.isEmpty(this._headerMessageCssClass)){this._ctrHeaderMessage.AddClassName(this._headerMessageCssClass)}}this._ftxtFirstName=new $$FTXT("ftxtFirstName_"+this._uniqueID,{label:"First Name",isRequired:true,maxLength:50,spanWidth:95,inputWidth:160});this.AddChild(this._ftxtFirstName);this._ftxtFirstName.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtFirstName.GetTitleControl().AddClassName("w95px");this._ftxtFirstName.GetInputControl().AddClassName("w160px");this._ftxtFirstName.Validator.addEvaluator($$EVAL.STRING({FieldName:"First Name",IsRequired:true}));this._ftxtFirstName.AddBlurListener();this._ftxtMiddleName=new $$FTXT("ftxtMiddleName_"+this._uniqueID,{label:"Middle Name",isRequired:false,maxLength:50,spanWidth:95,inputWidth:160});this.AddChild(this._ftxtMiddleName);this._ftxtMiddleName.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtMiddleName.GetTitleControl().AddClassName("w95px");this._ftxtMiddleName.GetInputControl().AddClassName("w160px");this._ftxtMiddleName.Validator.addEvaluator($$EVAL.STRING({FieldName:"Middle Name",IsRequired:false}));this._ftxtLastName=new $$FTXT("ftxtLastName_"+this._uniqueID,{label:"Last Name",isRequired:true,maxLength:50,spanWidth:95,inputWidth:160});this.AddChild(this._ftxtLastName);this._ftxtLastName.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtLastName.GetTitleControl().AddClassName("w95px");this._ftxtLastName.GetInputControl().AddClassName("w160px");this._ftxtLastName.Validator.addEvaluator($$EVAL.STRING({FieldName:"Last Name",IsRequired:true}));this._ftxtNickName=new $$FTXT("ftxtNickname_"+this._uniqueID,{label:"Nickname",isRequired:true,fieldTip:$$CM.convertToEntityLabelString("Name camper goes by",cm.dao.Settings.Data.EntityLabelSettings),fieldTipClass:"cmCamperFieldTip",maxLength:50,spanWidth:95,inputWidth:160});this.AddChild(this._ftxtNickName);this._ftxtNickName.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtNickName.GetTitleControl().AddClassName("w95px");this._ftxtNickName.GetInputControl().AddClassName("w160px");this._ftxtNickName.Validator.addEvaluator($$EVAL.STRING({FieldName:"Nickname",IsRequired:true}));this._ftxtNickName.Show();this._fddlSuffix=new $$FDDL("fddlSuffix_"+this._uniqueID,{label:"Suffix",isRequired:false,spanWidth:95,inputWidth:160});this.AddChild(this._fddlSuffix);this._fddlSuffix.AddClassName("cmFloatLeft w100prct mb5px");this._fddlSuffix.GetTitleControl().AddClassName("w95px");this._fddlSuffix.GetInputControl().AddClassName("w160px");if(!$$CM.IsUPR()){this._fddlSuffix.Hide()}var d=FW.Enums.PersonSuffix.GetArray();this._fddlSuffix.bindList(d);this._fsrblGender=new $$FSRBL("fsrblGender_"+this._uniqueID,{legendLabel:"Gender",legendCssClass:"cmLegendBasic pt5px pr0px cmFloatLeft w95px",isRequired:this._enableGender,spanWidth:95,inputWidth:160,isInlineDiv:true});this.AddChild(this._fsrblGender);this._fsrblGender.AddClassName("cmFloatLeft w100prct mb10px");this._fsrblGender.GetListControl().AddClassName("w160px");if(this._enableGender==true){var b=cm.Enums.Gender.GetArrayWithout(null,["Both"]);if($$CM.isArray(b)){var c="Gender"+$$CM.uniqueID();b.each(function(f){this._fsrblGender.AddFormRadioButton({ID:f.ID,Name:f.Name,GroupName:c})},this);this._fsrblGender.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Gender",IsRequired:true}))}this._fsrblGender.Show()}else{this._fsrblGender.Hide()}this._ftxtDOB=new $$FTXT("ftxtDOB_"+this._uniqueID,{label:"Date of Birth",isRequired:true,fieldTip:"MM/DD/YYYY",fieldTipClass:"cmCamperFieldTip",spanWidth:95,inputWidth:160});this.AddChild(this._ftxtDOB);this._ftxtDOB.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtDOB.GetTitleControl().AddClassName("w95px");this._ftxtDOB.GetInputControl().AddClassName("w160px mb0px");this._ftxtDOB.Validator.addEvaluator($$EVAL.BIRTHDATE({FieldName:"Date of Birth",IsRequired:true}));var a="current school year";if(this._seasonID>0){a=(this._seasonID-1)+"-"+this._seasonID+" school year"}this._fddlGrade=new $$FDDL("fddlGrade_"+this._uniqueID,{label:"Grade",fieldTip:a,fieldTipClass:"cmCamperFieldTip",isRequired:true,spanWidth:95,inputWidth:165});this.AddChild(this._fddlGrade);this._fddlGrade.AddClassName("cmFloatLeft w100prct mb5px");this._fddlGrade.GetTitleControl().AddClassName("w95px");this._fddlGrade.GetInputControl().AddClassName("w160px");this._fddlGrade.bindList(this._gradeArray,"","Select",false);this._fddlGrade.Validator.addEvaluator($$EVAL.SELECT({FieldName:"Grade",IsRequired:true}));this._fddlGrade.Show();this._ftxtSchool=new $$FTXT("ftxtSchool_"+this._uniqueID,{label:"School",isRequired:this._requireSchool,maxLength:50,spanWidth:95,inputWidth:160});this.AddChild(this._ftxtSchool);this._ftxtSchool.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtSchool.GetTitleControl().AddClassName("w95px");this._ftxtSchool.GetInputControl().AddClassName("w160px");if(this._enableSchool==true){if(this._requireSchool==true){this._ftxtSchool.Validator.addEvaluator($$EVAL.STRING({FieldName:"School",IsRequired:this._requireSchool}))}}else{this._ftxtSchool.Hide()}this._ftxtSSN=new $$FTXT("ftxtSSN_"+this._uniqueID,{label:"SSN",isRequired:false,fieldTip:"XXX-XX-XXXX",fieldTipClass:"cmCamperFieldTip",maxLength:11,spanWidth:95,inputWidth:160});this.AddChild(this._ftxtSSN);this._ftxtSSN.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtSSN.GetTitleControl().AddClassName("w95px");this._ftxtSSN.GetInputControl().AddClassName("w160px mb0px");if(this._enableSSN==true){this._ftxtSSN.Show();this._ftxtSSN.Validator.addEvaluator($$EVAL.STRING({FieldName:"SSN",IsRequired:false}))}else{this._ftxtSSN.Hide()}this._fddlTShirt=new $$FDDL("fddlTShirt_"+this._uniqueID,{label:"T-Shirt",isRequired:this._requireTShirtSize==true,spanWidth:95,inputWidth:160});this.AddChild(this._fddlTShirt);this._fddlTShirt.AddClassName("cmFloatLeft w100prct mb5px");this._fddlTShirt.GetTitleControl().AddClassName("w95px");this._fddlTShirt.GetInputControl().AddClassName("w160px");var e=$A();if(this._enableTShirtSize==true){if($$CM.isArray(this._enabledTShirtSizeArray)){$A(this._enabledTShirtSizeArray).each(function(f){e.push({ID:f,Name:f})},this);this._fddlTShirt.bindList(e,"","Select",false)}this._fddlTShirt.Validator.addEvaluator($$EVAL.SELECT({FieldName:"T-Shirt Size",IsRequired:this._requireTShirtSize}));this._fddlTShirt.Show()}else{this._fddlTShirt.Hide()}this._ftxtSkype=new $$FTXT("ftxtSkype_"+this._uniqueID,{label:"Skype",isRequired:false,maxLength:50});this.AddChild(this._ftxtSkype);this._ftxtSkype.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtSkype.GetTitleControl().AddClassName("w95px");this._ftxtSkype.GetInputControl().AddClassName("w160px");if(this._enableSkype==true&&$$CM.IsUPR()){this._ftxtSkype.Validator.addEvaluator($$EVAL.STRING({FieldName:"Skype",IsRequired:false}));this._ftxtSkype.Show()}else{this._ftxtSkype.Hide()}this._ftxtFacebook=new $$FTXT("ftxtFacebook_"+this._uniqueID,{label:"Facebook",isRequired:false,maxLength:50});this.AddChild(this._ftxtFacebook);this._ftxtFacebook.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtFacebook.GetTitleControl().AddClassName("w95px");this._ftxtFacebook.GetInputControl().AddClassName("w160px");if(this._enableFacebook==true&&$$CM.IsUPR()){this._ftxtFacebook.Validator.addEvaluator($$EVAL.STRING({FieldName:"Facebook",IsRequired:false}));this._ftxtFacebook.Show()}else{this._ftxtFacebook.Hide()}this._ftxtTwitter=new $$FTXT("ftxtTwitter_"+this._uniqueID,{label:"Twitter",isRequired:false,maxLength:50});this.AddChild(this._ftxtTwitter);this._ftxtTwitter.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtTwitter.GetTitleControl().AddClassName("w95px");this._ftxtTwitter.GetInputControl().AddClassName("w160px");if(this._enableTwitter==true&&$$CM.IsUPR()){this._ftxtTwitter.Validator.addEvaluator($$EVAL.STRING({FieldName:"Twitter",IsRequired:false}));this._ftxtTwitter.Show()}else{this._ftxtTwitter.Hide()}this._ftxtLinkedIn=new $$FTXT("ftxtLinkedIn_"+this._uniqueID,{label:"LinkedIn",isRequired:false,maxLength:50});this.AddChild(this._ftxtLinkedIn);this._ftxtLinkedIn.AddClassName("cmFloatLeft w100prct mb5px");this._ftxtLinkedIn.GetTitleControl().AddClassName("w95px");this._ftxtLinkedIn.GetInputControl().AddClassName("w160px");if(this._enableLinkedIn==true&&$$CM.IsUPR()){this._ftxtLinkedIn.Validator.addEvaluator($$EVAL.STRING({FieldName:"LinkedIn",IsRequired:false}));this._ftxtLinkedIn.Show()}else{this._ftxtLinkedIn.Hide()}this._fddlPricingIdentifier=new $$FDDL("fddlPricingIdentifier_"+this._uniqueID,{label:this._pricingIdentifierLabel,isRequired:true,spanWidth:95,inputWidth:160});this.AddChild(this._fddlPricingIdentifier);this._fddlPricingIdentifier.AddClassName("cmFloatLeft w100prct mb5px");this._fddlPricingIdentifier.GetTitleControl().AddClassName("w95px");this._fddlPricingIdentifier.GetInputControl().AddClassName("w160px");if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true&&this._pricingIdentifierArray.length>0){this._fddlPricingIdentifier.bindList(this._pricingIdentifierArray,"","Select");this._fddlPricingIdentifier.Validator.addEvaluator($$EVAL.SELECT({FieldName:this._pricingIdentifierLabel,IsRequired:true}));this._fddlPricingIdentifier.Show()}else{this._fddlPricingIdentifier.Hide()}},createEvents:function($super){$super()},wireEvents:function($super){$super();this._ftxtFirstName.BlurEvent.subscribe(this.onFirstNameBlur,this)},onFirstNameBlur:function(){if(this._ftxtNickName.GetData()==""){this._ftxtNickName.Bind(this._ftxtFirstName.GetData())}},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ftxtFirstName.Bind();this._ftxtMiddleName.Bind();this._ftxtLastName.Bind();this._ftxtNickName.Bind();this._fddlSuffix.Bind();this._fsrblGender.Bind(this._defaultGenderID);this._ftxtDOB.Bind();this._fddlGrade.Bind();this._ftxtSchool.Bind();this._ftxtSSN.Bind();this._fddlTShirt.Bind();this._ftxtSkype.Bind();this._ftxtFacebook.Bind();this._ftxtTwitter.Bind();this._ftxtLinkedIn.Bind();this._fddlPricingIdentifier.SetEnabled(true);this._fddlPricingIdentifier.Bind()},SetSeasonID:function(b){this._seasonID=b;var a="current school year";if(this._seasonID>0){a=(this._seasonID-1)+"-"+this._seasonID+" school year"}this._fddlGrade.GetFieldTipControl().UpdateInnerHtml(a)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();var e=0;if(!$$CM.isNull(a)){var c=a;var e=c.PersonID;if($$CM.isNull(c.Name)){c.Name=new Object()}this._ftxtFirstName.Bind(($$CM.isEmpty(c.Name.FirstName)||c.Name.FirstName.toLowerCase()=="noname")?"":c.Name.FirstName);this._ftxtMiddleName.Bind(c.Name.MiddleName);this._ftxtLastName.Bind(c.Name.LastName);this._ftxtNickName.Bind(($$CM.isEmpty(c.Name.NickName)||c.Name.NickName.toLowerCase()=="noname")?"":c.Name.NickName);this._fddlSuffix.Bind(!$$CM.isNumber(c.Name.SuffixID)?"":c.Name.SuffixID);this._fsrblGender.Bind(c.GenderID);if(!$$CM.isEmpty(c.DOBAsString)){var b=new $$CMDATE(c.DOBAsString);var d=b.getFormattedDate(false,true,false,false,false);this._ftxtDOB.Bind(d)}var f=c.SchoolGradeID;if($$CM.isNumber(f)){var f=c.SchoolGradeID;if(this._camperSettings.GradeCompleted!=true){f=Number(f)-1}this._fddlGrade.Bind(f)}this._ftxtSchool.Bind(c.SchoolName);this._ftxtSSN.Bind(c.SSN);this._fddlTShirt.Bind(c.TShirtSize);if(this._settings.PricingIdentifierApplicable==true&&$$CM.isNumber(c.PricingIdentifierID)){this._fddlPricingIdentifier.Bind(c.PricingIdentifierID);if(c.ExistingSessionAssignmentsInDBCount>0){this._fddlPricingIdentifier.SetEnabled(false)}}this._ftxtSkype.Bind(c.Skype);this._ftxtFacebook.Bind(c.Facebook);this._ftxtTwitter.Bind(c.Twitter);this._ftxtLinkedIn.Bind(c.LinkedIn)}if(e>0){if(!$$CM.isEmpty(c.Name.FirstName)&&c.Name.FirstName.toLowerCase()!="noname"){this._ftxtFirstName.SetEnabled(false);this._ftxtFirstName.Validator.Disable();this._ftxtMiddleName.SetEnabled(false);this._ftxtMiddleName.Validator.Disable();this._ftxtNickName.SetEnabled(this._settings.AllowEditNickname);if(this._settings.AllowEditNickname){this._ftxtNickName.Validator.Enable()}else{this._ftxtNickName.Validator.Disable()}this._ftxtLastName.SetEnabled(false);this._ftxtLastName.Validator.Disable();this._fddlSuffix.SetEnabled(false)}}else{this._ftxtFirstName.SetEnabled(true);this._ftxtFirstName.Validator.Enable();this._ftxtMiddleName.SetEnabled(true);this._ftxtMiddleName.Validator.Enable();this._ftxtLastName.SetEnabled(true);this._ftxtLastName.Validator.Enable();this._ftxtNickName.SetEnabled(true);this._ftxtNickName.Validator.Enable();this._fddlSuffix.SetEnabled(true)}if(!$$CM.isNull(a)&&a.YearsAtCamp>0&&this._enableGrade==false&&$$CM.isInteger(a.SchoolGradeID)){this._fddlGrade.SetEnabled(false)}else{this._fddlGrade.SetEnabled(true)}},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object();a.PersonID=0}if($$CM.isNull(a.Name)){a.Name=new Object()}if(this._enableFirstName==true){a.Name.FirstName=this._ftxtFirstName.GetData()}if(this._enableMiddleName==true){a.Name.MiddleName=this._ftxtMiddleName.GetData()}if(this._enableLastName==true){a.Name.LastName=this._ftxtLastName.GetData()}if(this._enableNickName==true){a.Name.NickName=this._ftxtNickName.GetData()}if(this._enableSuffix==true){a.Name.SuffixID=this._fddlSuffix.GetData()}if(this._enableGender==true){a.GenderID=this._fsrblGender.GetData()}else{a.GenderID=this._defaultGenderID}a.DOBAsString=null;if(this._enableDOB==true){var c=this._ftxtDOB.GetData();if(!$$CM.isEmpty(c)){var i=$$CM.tryParseDate(c);if(i.Success==true){a.DOBAsString=moment(i.DateObject).format("YYYY-MM-DD")}else{a.DOBAsString=moment(c).format("YYYY-MM-DD")}}}if(this._userTypeFlag.CompareById($$USER.UserTypeFlag,1,0)!=true||this._enableGrade==true){var e=Number(this._fddlGrade.GetData());try{var f=parseInt(e);var b=0;if($$CM.isInteger(a.SchoolGradeID)&&$$CM.isInteger(a.CampGradeID)){var h=parseInt(a.SchoolGradeID);var g=parseInt(a.CampGradeID);b=g-h}newCampGradeID=f+b}catch(d){}a.SchoolGradeID=(this._camperSettings.GradeCompleted!=true)?++f:f;a.CampGradeID=(this._camperSettings.GradeCompleted!=true)?++newCampGradeID:newCampGradeID;if(a.SchoolGradeID>14){a.SchoolGradeID=14}if(a.CampGradeID>14){a.CampGradeID=14}}if(this._enableSchool==true){a.SchoolName=this._ftxtSchool.GetData()}if(this._enableSSN==true){a.SSN=this._ftxtSSN.GetData()}if(this._enableTShirtSize==true){a.TShirtSize=this._fddlTShirt.GetData()}a.PricingIdentifierID=0;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true&&$$CM.isInteger(this._fddlPricingIdentifier.GetData())){a.PricingIdentifierID=parseInt(this._fddlPricingIdentifier.GetData())}if(!$$CM.isNumber(a.YearsAtCamp)||a.YearsAtCamp<0){a.YearsAtCamp=0}if(this._enableSkype==true){a.Skype=this._ftxtSkype.GetData()}if(this._enableFacebook==true){a.Facebook=this._ftxtFacebook.GetData()}if(this._enableTwitter==true){a.Twitter=this._ftxtTwitter.GetData()}if(this._enableLinkedIn==true){a.LinkedIn=this._ftxtLinkedIn.GetData()}return a}});"cm.ui.forms.application".namespace();cm.ui.forms.application.FamilyDetailsConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),familyConfigOptions:new Object(),address1ConfigOptions:new Object(),address2ConfigOptions:new Object(),parent1ConfigOptions:new Object(),parent2ConfigOptions:new Object()});cm.ui.forms.application.FamilyDetails=Class.create(cm.ui.ComplexControl,{LoginEmailCheckEvent:null,RemoveFamilyEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.FamilyDetailsConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._coFamily=this._co.familyConfigOptions;this._coFamily.uniqueID=$$CM.uniqueID();this._coAddress1=this._co.address1ConfigOptions;this._coAddress1.uniqueID=$$CM.uniqueID();this._coAddress1.settings=this._settings;this._coAddress2=this._co.address2ConfigOptions;this._coAddress2.uniqueID=$$CM.uniqueID();this._coAddress2.settings=this._settings;this._coParent1=this._co.parent1ConfigOptions;this._coParent1.uniqueID=$$CM.uniqueID();this._coParent1.settings=this._settings;this._coParent1.primary=this._coFamily.primary;this._coParent2=this._co.parent2ConfigOptions;this._coParent2.uniqueID=$$CM.uniqueID();this._coParent2.settings=this._settings;this._coParent2.primary=this._coFamily.primary;this._familyName="";if(this._coFamily.primary==true){this._familyName+=$$USER.FullName+"'s ";this._familyName+=!$$CM.isEmpty(this._coFamily.name)?this._coFamily.name:"Household"}else{this._familyName+=!$$CM.isEmpty(this._coFamily.name)?this._coFamily.name:"Household #2"}this._familyTitleText=this._familyName.toUpperCase();this._familyRemoveText="Cancel Adding "+this._familyName;this._isUPR=$$CADU.IsUPR();if(this._isUPR==true){this._enumAddressType=cm.dao.Lists.Enums.AddressType.asEnum();this._enumAddressEntityType=cm.dao.Lists.Enums.AddressEntityType.asEnum();this._enumEntityTypeFlag=cm.dao.Lists.Enums.EntityTypeFlag.asEnum()}},initializeUIElements:function(){this.AddClassName("cmFamilyDetails");if(this._coFamily.primary!=true){this.AddClassName("cmExpand")}this._h4FamilyTitle=$$P.h4("h4"+this._coFamily.entityID+"Title_"+this._uniqueID,"");this.AddChild(this._h4FamilyTitle);this._h4FamilyTitle.AddClassName("cmFloatLeft mb0px");this._h4FamilyTitle.UpdateInnerHtml(this._familyTitleText);this._aFamilyRemove=new $$A("a"+this._coFamily.entityID+"Remove_"+this._uniqueID,{text:this._familyRemoveText});this.AddChild(this._aFamilyRemove);this._aFamilyRemove.AddClassName("cmHideLink");this._aFamilyRemove.Hide();if(this._coFamily.primary==true){this._aFamilyRemove.Hide()}var a=$$P.div();this.AddChild(a);a.AddClassName("cmClear");if(!$$CM.isEmpty(this._coFamily.headerMessage)){this._ctrSectionMessage=new cm.ui.forms.SectionMessage("div"+this._coFamily.entityID+"SectionMessage_"+this._uniqueID,{message:this._coFamily.headerMessage,cssClass:"cmClear mtb10px"});this.AddChild(this._ctrSectionMessage);if(!$$CM.isEmpty(this._coFamily.headerMessageCssClass)){this._ctrSectionMessage.AddClassName(this._coFamily.headerMessageCssClass)}}this._ctrHomeAddress=new $$FADDRESS("div"+this._coFamily.entityID+"HomeAddress_"+this._uniqueID,this._coAddress1);this.AddChild(this._ctrHomeAddress);this._ctrHomeAddress.AddClassName("pt10px");this._divHomePhoneAndFax=$$P.div("div"+this._coFamily.entityID+"HomePhoneAndFax_"+this._uniqueID);this.AddChild(this._divHomePhoneAndFax);this._divHomePhoneAndFax.AddClassName("cmFormRow");this._ftxtHomePhone=new $$FTXT("ftxt"+this._coFamily.entityID+"HomePhone_"+this._uniqueID,{label:"Home Phone",isRequired:this._settings.RequireFamilyHomePhone,fieldTip:"EX: 828-555-1212",maxLength:15});this._divHomePhoneAndFax.AddChild(this._ftxtHomePhone);this._ftxtHomePhone.Validator.addEvaluator($$EVAL.STRING({FieldName:"Home Phone",IsRequired:this._settings.RequireFamilyHomePhone}));this._ftxtHomeFax=new $$FTXT("ftxt"+this._coFamily.entityID+"HomeFax_"+this._uniqueID,{label:"Fax",isRequired:this._settings.RequireFamilyHomeFax,fieldTip:"EX: 828-555-2121",maxLength:15});this._divHomePhoneAndFax.AddChild(this._ftxtHomeFax);this._ftxtHomeFax.Validator.addEvaluator($$EVAL.STRING({FieldName:"Fax",IsRequired:this._settings.RequireFamilyHomeFax}));if(this._settings.ShowFamilyHomeFax==false){this._ftxtHomeFax.Hide()}this._ctrSummerAddress=new $$FADDRESS("div"+this._coFamily.entityID+"SummerAddress_"+this._uniqueID,this._coAddress2);this.AddChild(this._ctrSummerAddress);this._ctrSummerAddress.AddClassName("pt10px");if(this._coAddress2.enabled!=true){this._ctrSummerAddress.Hide()}this._divSummerPhoneAndFax=$$P.div("div"+this._coFamily.entityID+"SummerPhoneAndFax_"+this._uniqueID);this.AddChild(this._divSummerPhoneAndFax);this._divSummerPhoneAndFax.AddClassName("cmFormRow");this._ftxtSummerPhone=new $$FTXT("ftxt"+this._coFamily.entityID+"SummerPhone_"+this._uniqueID,{label:"Summer Phone",isRequired:this._settings.RequireFamilySummerPhone,fieldTip:"EX: 303-555-1212",maxLength:15});this._divSummerPhoneAndFax.AddChild(this._ftxtSummerPhone);this._ftxtSummerPhone.Validator.addEvaluator($$EVAL.STRING({FieldName:"Summer Phone",IsRequired:this._settings.RequireFamilySummerPhone}));if(this._settings.ShowFamilySummerPhone==false){this._ftxtSummerPhone.Hide()}this._fsrblbMailOption=new $$FSRBLB("fsrblb"+this._coFamily.entityID+"MailOption_"+this._uniqueID,{legendLabel:"Should this household receive mail from camp?",legendCssClass:"cmLegendBasic cmFloatLeft w350px pt5px",isRequired:this._coFamily.requireMailOption});this.AddChild(this._fsrblbMailOption);this._fsrblbMailOption.AddClassName("cmFormRow mtb5px");this._fsrblbMailOption.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Should this household receive mail from camp?",IsRequired:true}));if(this._coFamily.enableMailOption!=true){this._fsrblbMailOption.Hide()}this._fsrblbInvoiceOption=new $$FSRBLB("fsrblb"+this._coFamily.entityID+"InvoiceOption_"+this._uniqueID,{legendLabel:"Should this household receive invoice copies?",legendCssClass:"cmLegendBasic cmFloatLeft w350px pt5px",isRequired:this._coFamily.requireInvoiceOption});this.AddChild(this._fsrblbInvoiceOption);this._fsrblbInvoiceOption.AddClassName("cmFormRow mtb5px");this._fsrblbInvoiceOption.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Should this household receive invoice copies?",IsRequired:true}));if(this._coFamily.enableInvoiceOption!=true){this._fsrblbInvoiceOption.Hide()}this._ctrParent1Details=new cm.ui.forms.application.ParentDetails("div"+this._coFamily.entityID+"P1_"+this._uniqueID,this._coParent1);this.AddChild(this._ctrParent1Details);var c="parent/guardian";if(!$$CM.isEmpty(this._coParent2.name)){c=this._coParent2.name.toLowerCase()}var b="Add "+c;this._aParent2Add=new $$A("a"+this._coFamily.entityID+"P2Add_"+this._uniqueID,{text:b});this.AddChild(this._aParent2Add);this._aParent2Add.AddClassName("cmFloatLeft pb10px");this._aParent2Add.Hide();this._ctrParent2Details=new cm.ui.forms.application.ParentDetails("div"+this._coFamily.entityID+"P2_"+this._uniqueID,this._coParent2);this.AddChild(this._ctrParent2Details);this._ctrParent2Details.Hide();var d="Cancel adding "+c;this._aParent2Remove=new $$A("a"+this._coFamily.entityID+"P2Remove_"+this._uniqueID,{text:d});this.AddChild(this._aParent2Remove);this._aParent2Remove.AddClassName("cmHideLink pb10px");this._aParent2Remove.Hide();if(this._coParent2.pEnabled==true){this._ctrParent2Details.Show();this._aParent2Add.Hide();this._aParent2Remove.Show()}else{this._ctrParent2Details.Hide();this._aParent2Add.Show();this._aParent2Remove.Hide()}},createEvents:function($super){$super();this.LoginEmailCheckEvent=new cm.event();this.RemoveFamilyEvent=new cm.event()},wireEvents:function($super){$super();this._aFamilyRemove.ClickEvent.subscribe(this.onFamily2Remove,this);this._aParent2Add.ClickEvent.subscribe(this.onParent2Add,this);this._aParent2Remove.ClickEvent.subscribe(this.onParent2Remove,this);this._ctrParent1Details.LoginEmailCheckEvent.subscribe(this.onLoginEmailCheck,this);this._ctrParent2Details.LoginEmailCheckEvent.subscribe(this.onLoginEmailCheck,this)},onLoginEmailCheck:function(b,a){this.LoginEmailCheckEvent.fire(b,a)},onFamily2Remove:function(c,a){var b={title:"Confirm",message:"Are you sure you want to remove this family?  All data will be deleted.",handlerOk:this.onFamily2RemoveOK,handlerCancel:this.onFamily2RemoveCancel,dialogClass:"alert",scope:this};$$CMD.Confirm(b)},onFamily2RemoveOK:function(b,a){this._aFamilyRemove.Hide();this.RemoveFamilyEvent.fire(this,this.GetData())},onFamily2RemoveCancel:function(b,a){},onFamily2AnimationCompleted:function(a){if(a.expanded==true){this._aFamilyRemove.Show(true)}},onParent2Add:function(b,a){this._aParent2Add.Hide();this._ctrParent2Details.Show(true,1000,"blind",{direction:"vertical"},this.onParent2AnimationCompleted,this,{expanded:true})},onParent2Remove:function(c,a){var b={title:"Confirm",message:"Are you sure you want to remove this parent?  All data will be deleted.",handlerOk:this.onParent2RemoveOK,handlerCancel:this.onParent2RemoveCancel,dialogClass:"alert",scope:this};$$CMD.Confirm(b)},onParent2RemoveOK:function(b,a){this._aParent2Remove.Hide();this._ctrParent2Details.Hide(true,1000,"blind",{direction:"vertical"},this.onParent2AnimationCompleted,this,{expanded:false})},onParent2RemoveCancel:function(b,a){},onParent2AnimationCompleted:function(a){if(a.expanded==true){this._aParent2Remove.Show(true)}else{this._aParent2Add.Show(true)}},ClearFields:function(){this.Validator.Clear();this._ctrHomeAddress.Bind();this._ftxtHomePhone.Bind();this._ftxtHomeFax.Bind();this._ctrSummerAddress.Bind();this._ftxtSummerPhone.Bind();this._fsrblbMailOption.Bind();this._fsrblbInvoiceOption.Bind();this._ctrParent1Details.Bind();this._ctrParent2Details.Bind();if(this._coParent2.pEnabled==true){this._ctrParent2Details.Show();this._aParent2Add.Hide();this._aParent2Remove.Show()}else{this._ctrParent2Details.Hide();this._aParent2Add.Show();this._aParent2Remove.Hide()}if(this._coFamily.primary==true){this._aFamilyRemove.Hide()}},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this._ctrHomeAddress.Bind(a.HomeAddress);this._ftxtHomePhone.Bind(a.HomePhone);this._ftxtHomeFax.Bind(a.HomeFax);this._ctrSummerAddress.Bind(a.SummerAddress);this._ftxtSummerPhone.Bind(a.SummerPhone);if(this._coFamily.enableMailOption==true){this._fsrblbMailOption.Bind(a.ReceivesMail)}if(this._coFamily.enableInvoiceOption==true){this._fsrblbInvoiceOption.Bind(a.ReceivesInvoices)}if(!$$CM.isNull(a.Parent1)){this._ctrParent1Details.Bind(a.Parent1);if(a.Parent1.PersonID>0){this._ctrParent1Details.Show()}}if(!$$CM.isNull(a.Parent2)){this._ctrParent2Details.Bind(a.Parent2);if(a.Parent2.PersonID>0){this._aParent2Add.Hide();this._aParent2Remove.Hide();this._ctrParent2Details.Show()}}if(a.FamilyID>0){this._aFamilyRemove.Hide()}}},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object();a.FamilyID=0}a.HomeAddress=this._ctrHomeAddress.GetData();if(this._isUPR==true&&!$$CM.addressEmptyIgnoreCountry(a.HomeAddress)){var d=this._enumEntityTypeFlag.GetId("Family");var c=this._enumAddressType.GetId("Home");var b=this._enumAddressEntityType.GetId("family1");a.HomeEntityAddress=$$CADU.SetEntityAddress(a.HomeEntityAddress,a.HomeAddress,a.FamilyID,d,c,b)}a.HomePhone=this._ftxtHomePhone.GetData();a.HomeFax=this._ftxtHomeFax.GetData();if(this._coAddress2.enabled==true){if(this._isUPR==false){a.SummerAddress=this._ctrSummerAddress.GetData()}var h=this._ctrSummerAddress.GetData();if(this._isUPR==true&&!$$CM.isNull(h)&&!$$CM.addressEmptyIgnoreCountry(h)){a.SummerAddress=this._ctrSummerAddress.GetData();var g=this._enumEntityTypeFlag.GetId("Family");var f=this._enumAddressType.GetId("Summer");if(!(f>0)){f=this._enumAddressType.GetId("Vacation")}var e=this._enumAddressEntityType.GetId("family1");a.SummerEntityAddress=$$CADU.SetEntityAddress(a.SummerEntityAddress,a.SummerAddress,a.FamilyID,g,f,e)}}a.SummerPhone=this._ftxtSummerPhone.GetData();if(this._coFamily.primary==true){a.ReceivesMail=true;a.ReceivesInvoices=true}else{if(this._coFamily.enableMailOption==true){a.ReceivesMail=this._fsrblbMailOption.GetData()}else{a.ReceivesMail=this._coFamily.mailOptionDefaultValue}if(this._coFamily.enableInvoiceOption==true){a.ReceivesInvoices=this._fsrblbInvoiceOption.GetData()}else{a.ReceivesInvoices=this._coFamily.invoiceOptionDefaultValue}}if(this._ctrParent1Details.IsVisible()){a.Parent1=this._ctrParent1Details.GetData();a.Parent1.HomePhone=a.HomePhone;a.Parent1.HomeFax=a.HomeFax}if(this._ctrParent2Details.IsVisible()){a.Parent2=this._ctrParent2Details.GetData();a.Parent2.HomePhone=a.HomePhone;a.Parent2.HomeFax=a.HomeFax}return a}});"cm.ui.forms.application".namespace();cm.ui.forms.application.ParentDetailsConfigOptions=Class.create(cm.ConfigOptions,{entityID:"F1P1",legendLabel:"<h5>Parent Information</h5>",legendCssClass:"cmSectionHeader mb10px",settings:new Object(),requireLoginEmail:false,requireEmail2:false});cm.ui.forms.application.ParentDetails=Class.create(cm.ui.ComplexControl,{LoginEmailCheckEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.ParentDetailsConfigOptions()},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._requireFirstName=true;this._requireLastName=true;this._requireRelationship=true;this._requireLoginEmail=this._co.requireLoginEmail;this._requireEmail2=this._co.requireEmail2;if(!$$CM.isNull(this._settings)){this._requireWorkPhone=this._settings.RequireParentWorkPhone;this._requireCellPhone=this._settings.RequireParentCellPhone;this._requireOtherPhone=this._settings.RequireParentOtherPhone;this._enableMaritalStatus=this._settings.EnableMaritalStatus;this._requireMaritalStatus=this._settings.RequireMaritalStatus;this._enableOccupation=this._settings.EnableParentOccupation;this._requireOccupation=this._settings.RequireParentOccupation;this._enableParentSkype=this._settings.ParentSkypeEnabled;this._enableParentFacebook=this._settings.ParentFacebookEnabled;this._enableParentTwitter=this._settings.ParentTwitterEnabled;this._enableParentLinkedIn=this._settings.ParentLinkedInEnabled}this._relationshipArray=cm.dao.Lists.Data.RelationshipArray;if($$CM.isArray(cm.dao.Lists.Data.RelationshipArray)){this._relationshipArray=cm.dao.Lists.Data.RelationshipArray}this._maritalStatusArray=$A();if($$CM.isArray(cm.dao.Lists.Data.MaritalStatusArray)){this._maritalStatusArray=cm.dao.Lists.Data.MaritalStatusArray}},initializeUIElements:function(){this.AddClassName("cmParentDetails");this._fsParentDetails=new $$FS("fs"+this._co.entityID+"ParentDetails_"+this._uniqueID,{legendLabel:this._co.legendLabel,legendCssClass:this._co.legendCssClass});this.AddChild(this._fsParentDetails);this._fsParentDetails.AddClassName("pt10px");this._divParentDetails=$$P.div("div"+this._co.entityID+"ParentDetails_"+this._uniqueID);this._fsParentDetails.AddChild(this._divParentDetails);this._divParentDetails.AddClassName("cmFormRow");this._ftxtFirstName=new $$FTXT("ftxt"+this._co.entityID+"FirstName_"+this._uniqueID,{label:"First Name",isRequired:this._requireFirstName});this._divParentDetails.AddChild(this._ftxtFirstName);this._ftxtFirstName.AddClassName("mb5px w50prct");this._ftxtFirstName.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": First Name",IsRequired:this._requireFirstName}));this._ftxtLastName=new $$FTXT("ftxt"+this._co.entityID+"LastName_"+this._uniqueID,{label:"Last Name",isRequired:this._requireLastName});this._divParentDetails.AddChild(this._ftxtLastName);this._ftxtLastName.AddClassName("mb5px w50prct");this._ftxtLastName.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Last Name",IsRequired:this._requireLastName}));this._fddlTitle=new $$FDDL("fddl"+this._co.entityID+"Title_"+this._uniqueID,{label:"Title",isRequired:false});this._divParentDetails.AddChild(this._fddlTitle);this._fddlTitle.AddClassName("w50prct");var c=FW.Enums.PersonTitle.GetArray();this._fddlTitle.bindList(c);this._fddlSuffix=new $$FDDL("fddl"+this._co.entityID+"Suffix_"+this._uniqueID,{label:"Suffix",isRequired:false});this._divParentDetails.AddChild(this._fddlSuffix);this._fddlSuffix.AddClassName("mb5px w50prct");var b=FW.Enums.PersonSuffix.GetArray();this._fddlSuffix.bindList(b);if(!$$CM.IsUPR()){this._fddlTitle.Hide();this._fddlSuffix.Hide()}this._fddlRelationship=new $$FDDL("fddl"+this._co.entityID+"Relationship_"+this._uniqueID,{label:"Relationship",isRequired:this._requireRelationship});this._divParentDetails.AddChild(this._fddlRelationship);this._fddlRelationship.AddClassName("mb5px w50prct");this._genderedRelationshipArray=$A();this._relationshipArray.each(function(d){if(d.HierarchicalContextID==1){this._genderedRelationshipArray.push({ID:d.ID+"0",Name:d.FemaleContext,GenderID:0,OrderIndex:d.OrderIndex});this._genderedRelationshipArray.push({ID:d.ID+"1",Name:d.MaleContext,GenderID:1,OrderIndex:d.OrderIndex})}},this);this._genderedRelationshipArray=this._genderedRelationshipArray.sort($$CM.sortByID);this._fddlRelationship.bindList(this._genderedRelationshipArray,"","Select",false);this._fddlRelationship.Validator.addEvaluator($$EVAL.SELECT({FieldName:this._co.entityID+": Relationship",IsRequired:this._requireRelationship}));this._fddlMaritalStatus=new $$FDDL("fddl"+this._co.entityID+"MaritalStatus_"+this._uniqueID,{label:"Marital Status",isRequired:this._requireMaritalStatus});this._divParentDetails.AddChild(this._fddlMaritalStatus);this._fddlMaritalStatus.AddClassName("mb5px w50prct");var a=$A();this._maritalStatusArray.each(function(d){if(Number(d.ID)>0){a.push(d)}});this._fddlMaritalStatus.bindList(a,"","Select",false);this._fddlMaritalStatus.Validator.addEvaluator($$EVAL.SELECT({FieldName:this._co.entityID+": Marital Status",IsRequired:this._requireMaritalStatus}));if(this._enableMaritalStatus!=true){this._fddlMaritalStatus.Hide()}this._ftxtWorkPhone=new $$FTXT("ftxt"+this._co.entityID+"WorkPhone_"+this._uniqueID,{label:"Work Phone",isRequired:this._requireWorkPhone,maxLength:15});this._divParentDetails.AddChild(this._ftxtWorkPhone);this._ftxtWorkPhone.AddClassName("mb5px w50prct");this._ftxtWorkPhone.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Work Phone",IsRequired:this._requireWorkPhone}));this._ftxtLoginEmail=new $$FEMAIL("ftxt"+this._co.entityID+"LoginEmail_"+this._uniqueID,{label:"Login Email",isRequired:this._requireLoginEmail});this._divParentDetails.AddChild(this._ftxtLoginEmail);this._ftxtLoginEmail.AddClassName("mb5px w50prct");this._ftxtLoginEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:this._co.entityID+": Login Email",IsRequired:this._requireLoginEmail}));this._ftxtCellPhone=new $$FTXT("ftxt"+this._co.entityID+"CellPhone_"+this._uniqueID,{label:"Cell Phone",isRequired:this._requireCellPhone,maxLength:15});this._divParentDetails.AddChild(this._ftxtCellPhone);this._ftxtCellPhone.AddClassName("mb5px w50prct");this._ftxtCellPhone.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Cell Phone",IsRequired:this._requireCellPhone}));this._ftxtOtherEmail=new $$FEMAIL("ftxt"+this._co.entityID+"OtherEmail_"+this._uniqueID,{label:"Other Email",isRequired:this._requireEmail2});this._divParentDetails.AddChild(this._ftxtOtherEmail);this._ftxtOtherEmail.AddClassName("mb5px w50prct");this._ftxtOtherEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:this._co.entityID+": Other Email",IsRequired:this._requireEmail2}));this._ftxtOtherPhone=new $$FTXT("ftxt"+this._co.entityID+"OtherPhone_"+this._uniqueID,{label:"Other Phone",isRequired:this._requireOtherPhone,maxLength:15});this._divParentDetails.AddChild(this._ftxtOtherPhone);this._ftxtOtherPhone.AddClassName("mb5px w50prct");this._ftxtOtherPhone.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Other Phone",IsRequired:this._requireOtherPhone}));this._ftxtOccupation=new $$FTXT("ftxt"+this._co.entityID+"Occupation_"+this._uniqueID,{label:"Occupation",isRequired:this._requireOccupation});this._divParentDetails.AddChild(this._ftxtOccupation);this._ftxtOccupation.AddClassName("mb5px w50prct");this._ftxtOccupation.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Occupation",IsRequired:this._requireOccupation}));if(this._enableOccupation!=true){this._ftxtOccupation.Hide()}this._ftxtSkype=new $$FTXT("ftxtSkype_"+this._co.entityID,{label:"Skype",isRequired:false,maxLength:50});this._divParentDetails.AddChild(this._ftxtSkype);this._ftxtSkype.AddClassName("mb5px w50prct");if(this._enableParentSkype==true&&$$CM.IsUPR()){this._ftxtSkype.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Skype",IsRequired:false}));this._ftxtSkype.Show()}else{this._ftxtSkype.Hide()}this._ftxtFacebook=new $$FTXT("ftxtFacebook_"+this._co.entityID,{label:"Facebook",isRequired:false,maxLength:50});this._divParentDetails.AddChild(this._ftxtFacebook);this._ftxtFacebook.AddClassName("mb5px w50prct");if(this._enableParentFacebook==true&&$$CM.IsUPR()){this._ftxtFacebook.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Facebook",IsRequired:false}));this._ftxtFacebook.Show()}else{this._ftxtFacebook.Hide()}this._ftxtTwitter=new $$FTXT("ftxtTwitter_"+this._co.entityID,{label:"Twitter",isRequired:false,maxLength:50});this._divParentDetails.AddChild(this._ftxtTwitter);this._ftxtTwitter.AddClassName("mb5px w50prct");if(this._enableParentTwitter==true&&$$CM.IsUPR()){this._ftxtTwitter.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": Twitter",IsRequired:false}));this._ftxtTwitter.Show()}else{this._ftxtTwitter.Hide()}this._ftxtLinkedIn=new $$FTXT("ftxtLinkedIn_"+this._co.entityID,{label:"LinkedIn",isRequired:false,maxLength:50});this._divParentDetails.AddChild(this._ftxtLinkedIn);this._ftxtLinkedIn.AddClassName("mb5px w50prct");if(this._enableParentLinkedIn==true&&$$CM.IsUPR()){this._ftxtLinkedIn.Validator.addEvaluator($$EVAL.STRING({FieldName:this._co.entityID+": LinkedIn",IsRequired:false}));this._ftxtLinkedIn.Show()}else{this._ftxtLinkedIn.Hide()}},createEvents:function($super){$super();this.LoginEmailCheckEvent=new cm.event()},wireEvents:function($super){$super();this._ftxtLoginEmail.BlurEvent.subscribe(this.onLoginEmailCheck,this)},onLoginEmailCheck:function(b,a){this.LoginEmailCheckEvent.fire(b,{})},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ftxtFirstName.Bind();this._ftxtLastName.Bind();this._fddlTitle.Bind();this._fddlSuffix.Bind();this._fddlRelationship.Bind();this._fddlMaritalStatus.Bind();this._ftxtLoginEmail.Bind();this._ftxtOtherEmail.Bind();this._ftxtWorkPhone.Bind();this._ftxtCellPhone.Bind();this._ftxtOtherPhone.Bind();this._ftxtOccupation.Bind();this._ftxtSkype.Bind();this._ftxtFacebook.Bind();this._ftxtTwitter.Bind();this._ftxtLinkedIn.Bind()},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){var b=a.Name;if(!$$CM.isNull(b)){this._ftxtFirstName.Bind(b.FirstName);this._ftxtLastName.Bind(b.LastName);if($$CM.IsUPR()){this._fddlTitle.Bind(b.TitleID);this._fddlSuffix.Bind(b.SuffixID)}if(a.PersonID>0&&this._settings.AllowParentNameChanges==false){this._ftxtFirstName.SetEnabled(false);this._ftxtLastName.SetEnabled(false);this._fddlTitle.SetEnabled(false);this._fddlSuffix.SetEnabled(false)}}if($$CM.isEmpty(a.RelationshipIDGenderID)){if(!$$CM.isEmpty(a.RelationshipID)&&!$$CM.isEmpty(a.GenderID)){a.RelationshipIDGenderID=a.RelationshipID+""+a.GenderID}}this._fddlRelationship.Bind(a.RelationshipIDGenderID);if(this._enableMaritalStatus==true){this._fddlMaritalStatus.Bind(a.MaritalStatusID)}if(!$$CM.isEmpty(a.LoginEmail)){this._ftxtLoginEmail.Bind(a.LoginEmail);if(a.PersonID>0||a.LoginEmail.toLowerCase()==$$USER.Email.toLowerCase()){this._ftxtLoginEmail.SetEnabled(false)}}this._ftxtOtherEmail.Bind(a.Email2);this._ftxtWorkPhone.Bind(a.WorkPhone);this._ftxtCellPhone.Bind(a.CellPhone);this._ftxtOtherPhone.Bind(a.OtherPhone);if(this._enableOccupation==true){this._ftxtOccupation.Bind(a.Occupation)}this._ftxtSkype.Bind(a.Skype);this._ftxtFacebook.Bind(a.Facebook);this._ftxtTwitter.Bind(a.Twitter);this._ftxtLinkedIn.Bind(a.LinkedIn)}},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object();a.PersonID=0}if($$CM.isNull(a.Name)){a.Name=new Object()}var f=this._fddlRelationship.GetData();var e=Number(f.substring(0,f.length-1));var c=Number(f.substring(f.length-1,f.length));a.Name.FirstName=this._ftxtFirstName.GetData();a.Name.LastName=this._ftxtLastName.GetData();if($$CM.IsUPR()){a.Name.TitleID=this._fddlTitle.GetData();a.Name.SuffixID=this._fddlSuffix.GetData()}a.RelationshipIDGenderID=f;a.RelationshipID=e;a.GenderID=c;var b=this._genderedRelationshipArray.find(function(g){return Number(g.ID)==Number(f)},this);if(!$$CM.isNull(b)){a.RelationshipName=b.Name}var d=0;if(this._enableMaritalStatus==true){d=this._fddlMaritalStatus.GetData()}if($$CM.isInteger(d)){a.MaritalStatusID=d}else{a.MaritalStatusID=0}a.LoginEmail=this._ftxtLoginEmail.GetData();a.Email2=this._ftxtOtherEmail.GetData();a.WorkPhone=this._ftxtWorkPhone.GetData();a.CellPhone=this._ftxtCellPhone.GetData();a.OtherPhone=this._ftxtOtherPhone.GetData();if(this._enableOccupation==true){a.Occupation=this._ftxtOccupation.GetData()}a.Skype=this._ftxtSkype.GetData();a.Facebook=this._ftxtFacebook.GetData();a.Twitter=this._ftxtTwitter.GetData();a.LinkedIn=this._ftxtLinkedIn.GetData();return a}});"cm.ui.forms.application".namespace();cm.ui.forms.application.PaymentDetailsConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),seasonID:0,creditCardVaultCategoryTypeID:0});cm.ui.forms.application.PaymentDetails=Class.create(cm.ui.ComplexControl,{PayInFullEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.PaymentDetailsConfigOptions()},initializeDAOs:function($super){$super();this._financialDAO=new cm.dao.Financial.DAO();this._listsDAO=new cm.dao.Lists.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._financialSettings=this._co.financialSettings;this._billingPreferencesEnabled=this._settings.EnableBillingPreferenceMethod;this._payInFullEnabled=this._settings.EnablePayInFull;this._payInFullRequired=this._settings.RequirePayInFull;this._depositOptionsEnabled=(this._settings.DisableDepositPaymentMethodSection!=true);this._billingPreferencePaymentMethodEnabled=this._settings.EnableBillingPreferenceMethod;this._hideLedger=this._settings.HideTuitionAndDepositAmounts;this._hideDueNow=this._settings.HideDueNow;this._enumPaymentMethodTypeFlag=this._financialDAO.GetEnum("PaymentMethodTypeFlagStringValue");this._enumCreditCardCategory=this._financialDAO.GetEnum("CreditCardCategory");this._enumCreditCardGatewayType=this._financialDAO.GetEnum("CreditCardGatewayType");var b=this._settings.DepositPaymentMethodIDArray;this._depositPaymentMethodArray=$A();if(!$$CM.isNull(b)&&$$CM.isArray(b)){b.each(function(d){var e=this._enumPaymentMethodTypeFlag.GetName(d);this._depositPaymentMethodArray.push({ID:d,Name:e})},this)}this._billingPreferenceArray=$A();var a=this._listsDAO.GetDataArray("FinancialBillingPreferenceDefinitionArray");if($$CM.isArray(a)){this._billingPreferenceArray=a}var c=this._settings.PayInFullPaymentMethodIDArray;this._payInFullPaymentMethodArray=$A();if(!$$CM.isNull(c)&&$$CM.isArray(c)){c.each(function(d){var e=this._enumPaymentMethodTypeFlag.GetName(d);this._payInFullPaymentMethodArray.push({ID:d,Name:e})},this)}this._lineItemArray=$$FDU.GetLineItemDefinitionArray();this._lineItemTypeEnum=this._financialDAO.GetEnum("LineItemTypeStringValue");this._pricingPackageArray=$A();if(!$$CM.isNull(cm.dao.Lists.Data.PricingPackageArray)&&$$CM.isArray(cm.dao.Lists.Data.PricingPackageArray)){this._pricingPackageArray=cm.dao.Lists.Data.PricingPackageArray}this._balanceAmount=0;this._dueNowAmount=0;this._payInFull=false;this._ccSelectorApplicable=false;this._achSelectorApplicable=false},initializeUIElements:function(){this.AddClassName("cmPaymentDetails");this._fsPaymentDetails=new $$FS("fsPaymentDetails_"+this._uniqueID,{legendLabel:this._co.legendLabel,legendCssClass:this._co.legendCssClass});this.AddChild(this._fsPaymentDetails);this._fsPaymentDetails.AddClassName("pt10px");var b=$$P.div();this._fsPaymentDetails.AddChild(b);b.AddClassName("cmClear");var d=this._settings.PaymentHeaderMessage;if(!$$CM.isEmpty(d)){this._ctrSectionMessage=new cm.ui.forms.SectionMessage("divPDSectionMessage_"+this._uniqueID,{message:d,cssClass:"cmClear cmInfo mt0px mb10px"});this._fsPaymentDetails.AddChild(this._ctrSectionMessage);var e=this._settings.PaymentHeaderMessageCssClass;if(!$$CM.isEmpty(e)){this._ctrSectionMessage.AddClassName(e)}}this._divFamilyFinancial=$$P.div("divFamilyFinancial_"+this._uniqueID);this._fsPaymentDetails.AddChild(this._divFamilyFinancial);if(this._hideLedger==true){this._divFamilyFinancial.Hide()}this._divPaymentOptions=$$P.div("divPaymentOptions_"+this._uniqueID);this._fsPaymentDetails.AddChild(this._divPaymentOptions);this._divPaymentOptions.AddClassName("cmFormRow w100prct");this._divPayInFullOptions=$$P.div("divPayInFullOptions_"+this._uniqueID);this._divPaymentOptions.AddChild(this._divPayInFullOptions);this._divPayInFullOptions.AddClassName("cmFloatLeft w260px mr10px");this._divPayInFullOptions.Hide();this._h5PayInFullOptions=$$P.h5("h5PayInFullOptions_"+this._uniqueID,"Pay In Full");this._divPayInFullOptions.AddChild(this._h5PayInFullOptions);this._h5PayInFullOptions.AddClassName("fs16px mb10px");var d=this._settings.PayInFullHeaderMessage;if(!$$CM.isEmpty(d)){this._ctrPayInFullSectionMessage=new cm.ui.forms.SectionMessage("divPIFSectionMessage_"+this._uniqueID,{message:d,cssClass:"mt0px mb10px"});this._divPayInFullOptions.AddChild(this._ctrPayInFullSectionMessage);var e=this._settings.PayInFullHeaderMessageCssClass;if(!$$CM.isEmpty(e)){this._ctrPayInFullSectionMessage.AddClassName(e)}}this._fsrblPayInFullOption=new $$FSRBL("fsrblPayInFullOption_"+this._uniqueID,{legendLabel:"What form of payment will you use?",legendCssClass:"w100prct mb10px",labelCssClass:"w100prct",titleCssClass:"pt1px w235px",isRequired:true});this._divPayInFullOptions.AddChild(this._fsrblPayInFullOption);this._fsrblPayInFullOption.AddClassName("cmFormRow mt0px mb20px");this._fsrblPayInFullOption.GetListControl().AddClassName("cmClear");this._fsrblPayInFullOption.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Pay In Full Option",IsRequired:true}));var c="PayInFullOption_"+$$CM.uniqueID();this._payInFullPaymentMethodArray.each(function(f){this._fsrblPayInFullOption.AddFormRadioButton({ID:f.ID,Name:f.Name,GroupName:c,cssClass:"cmClear cmBold"})},this);this._divDepositOptions=$$P.div("divDepositOptions_"+this._uniqueID);this._divPaymentOptions.AddChild(this._divDepositOptions);this._divDepositOptions.AddClassName("cmFloatLeft w260px mr10px");this._h5DepositOptions=$$P.h5("h5DepositOptions_"+this._uniqueID,"Deposit");this._divDepositOptions.AddChild(this._h5DepositOptions);this._h5DepositOptions.AddClassName("fs16px mb10px");var d=this._settings.DepositHeaderMessage;if(!$$CM.isEmpty(d)){this._ctrDepositSectionMessage=new cm.ui.forms.SectionMessage("divPDSectionMessage_"+this._uniqueID,{message:d,cssClass:"mt0px mb10px"});this._divDepositOptions.AddChild(this._ctrDepositSectionMessage);var e=this._settings.DepositHeaderMessageCssClass;if(!$$CM.isEmpty(e)){this._ctrDepositSectionMessage.AddClassName(e)}}this._fsrblDepositOption=new $$FSRBL("fsrblDepositOption_"+this._uniqueID,{legendLabel:"What form of payment will you use for the <b>deposit</b>?",legendCssClass:"w100prct mb10px",isRequired:true});this._divDepositOptions.AddChild(this._fsrblDepositOption);this._fsrblDepositOption.AddClassName("cmFormRow mt0px mb20px");this._fsrblDepositOption.GetListControl().AddClassName("cmClear");this._fsrblDepositOption.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Deposit Option",IsRequired:true}));var a="DepositOption_"+$$CM.uniqueID();this._depositPaymentMethodArray.each(function(f){this._fsrblDepositOption.AddFormRadioButton({ID:f.ID,Name:f.Name,GroupName:a,cssClass:"cmClear cmBold"})},this);this._divBillingPreferences=$$P.div("divBP_"+this._uniqueID);this._divPaymentOptions.AddChild(this._divBillingPreferences);this._divBillingPreferences.AddClassName("cmFloatLeft w260px");this._h5PaymentScheduleOptions=$$P.h5("h5BP_"+this._uniqueID,"Payment Schedule for Balance");this._divBillingPreferences.AddChild(this._h5PaymentScheduleOptions);this._h5PaymentScheduleOptions.AddClassName("fs16px mb10px");var d=this._settings.PaymentScheduleHeaderMessage;if(!$$CM.isEmpty(d)){this._ctrPaymentScheduleSectionMessage=new cm.ui.forms.SectionMessage("divPSSectionMessage_"+this._uniqueID,{message:d,cssClass:"mtb0px"});this._divBillingPreferences.AddChild(this._ctrPaymentScheduleSectionMessage);var e=this._settings.PaymentScheduleHeaderMessageCssClass;if(!$$CM.isEmpty(e)){this._ctrPaymentScheduleSectionMessage.AddClassName(e)}}this._fsrblBillingPreferences=new $$FSRBL("fsrblBP_"+this._uniqueID,{legendLabel:"",legendCssClass:"w100prct mb10px",labelCssClass:"w100prct",titleCssClass:"pt1px w235px",isRequired:true});this._divBillingPreferences.AddChild(this._fsrblBillingPreferences);this._fsrblBillingPreferences.AddClassName("cmFormRow mt5px mb20px");this._fsrblBillingPreferences.GetListControl().AddClassName("cmClear cmBillingPreferences");this._fsrblBillingPreferences.Validator.addEvaluator($$EVAL.GROUP({FieldName:"Payment Schedule Option",IsRequired:true}));this._divCCAndACHSelector=$$P.div("divCCAndACHSelector_"+this._uniqueID);this._fsPaymentDetails.AddChild(this._divCCAndACHSelector);this._divCCAndACHSelector.AddClassName("cmFormRow w100prct");this.RenderCCAndACHSelectors(0)},createEvents:function($super){$super();this.PayInFullEvent=new cm.event()},wireEvents:function($super){$super();this._fsrblDepositOption.SelectionChangedEvent.subscribe(this.onPaymentMethodChanged,this);this._fsrblBillingPreferences.SelectionChangedEvent.subscribe(this.onPaymentMethodChanged,this);this._fsrblPayInFullOption.SelectionChangedEvent.subscribe(this.onPaymentMethodChanged,this)},RenderCCAndACHSelectors:function(c){if(!$$CM.isInteger(c)||c<0){c=0}this._divCCAndACHSelector.DestroyChildControls(false);var b={uniqueID:this._uniqueID,legendLabel:"<h5 class='fs16px'>Credit Card</h5>",legendCssClass:"w100prct mb10px",vaultType:1,objectID:c,creditCardGatewayTypeID:this._enumCreditCardGatewayType.GetId("Camp"),creditCardCategoryID:this._enumCreditCardCategory.GetId("Family"),creditCardTypeIDArray:this._settings.CreditCardTypeIDArray,disabled:this._settings.DisableCreditCardEntry,disabledText:this._settings.DisableCreditCardEntryText,creditCardVaultCategoryTypeID:this._co.creditCardVaultCategoryTypeID,financialSettings:this._financialSettings};this._ctrCreditCardSelector=new cm.ui.forms.CreditCardSelector("ctrPDCreditCardSelector_"+this._uniqueID,b);this._divCCAndACHSelector.AddChild(this._ctrCreditCardSelector);this._ctrCreditCardSelector.AddClassName("cmFormRow w100prct mb20px");this._ctrCreditCardSelector.Hide();this._ctrCreditCardSelector.Bind();var a={uniqueID:this._uniqueID,legendLabel:"<h5 class='fs16px'>eCheck Accounts</h5>",legendCssClass:"w100prct mb10px",personID:$$USER.PersonID,achArray:$A(),disabled:this._settings.DisableAchAccountEntry,disabledText:this._settings.DisableAchAccountEntryText};this._ctrAchAccountSelector=new cm.ui.forms.AchAccountSelector("ctrPDAchAccountSelector_"+this._uniqueID,a);this._divCCAndACHSelector.AddChild(this._ctrAchAccountSelector);this._ctrAchAccountSelector.AddClassName("cmFormRow w100prct mb20px");this._ctrAchAccountSelector.Hide();this._ctrAchAccountSelector.Bind()},getLineItem:function(b){var a=this._lineItemArray.find(function(c){return Number(c.LineItemID)==Number(b)},this);return a},getSeasonLineItem:function(a){var b=this._seasonLineItemArray.find(function(c){return Number(c.LineItemSeasonID)==Number(a)},this);return b},getFinancialItemEntityArray:function(a){var b=$A();if($$CM.isArray(a)){a.each(function(g){var d=g.FamilyID;var j=g.PersonID;if(g.CamperFinancialItem==true){var e=$A();var f=b.find(function(k){return k.ID=="P"+j},this);if($$CM.isNull(f)){var i=this._personArray.find(function(k){return k.PersonID==j},this);var h=null;if(!$$CM.isNull(i)){h=i.Name}else{if(!$$CM.isNull(this._camperData)){h=this._camperData.Name}}var c="";if(!$$CM.isNull(h)){if($$CM.IsUPR()){c=$$CM.getFormattedPersonNameUPR(h,true,true,true,true,true)}else{if(!$$CM.isEmpty(h.FullName)){c=h.FullName}else{c=h.FirstName+" "+h.LastName}}}f={ID:"P"+j,Name:c,FinancialItemArray:e};b.push(f)}f.FinancialItemArray.push(g)}else{var e=$A();var f=b.find(function(k){return k.ID=="F"+d},this);if($$CM.isNull(f)){f={ID:"F"+d,Name:"Family",FinancialItemArray:e};b.push(f)}f.FinancialItemArray.push(g)}},this)}return b},getItemizedFinancialItemArray:function(a){var b=$A();if($$CM.isArray(a)){a=a.sort(function(d,i){var f=new $$CMDATE(d.PostDateAsString);var k=new $$CMDATE(i.PostDateAsString);var h=f.getDateObject(true);var m=k.getDateObject(true);var c=((h<m)?-1:((h>m)?1:0));var g=d.IsCharge;var l=i.IsCharge;c=c!=0?c:((l<g)?-1:((l>g)?1:0));var e=Math.abs(d.Amount);var j=Math.abs(i.Amount);c=c!=0?c:((j<e)?-1:((j>e)?1:0));return c});a.each(function(c){var h=this.getLineItem(c.LineItemID);if(!$$CM.isNull(h)){var f="";var g=h.Name;var k=c.PricingRule;if(!$$CM.isNull(k)){var j=($$CM.isInteger(k.PackageID))?$$DDU.GetPackageData(k.PackageID):null;var o=($$CM.isInteger(k.SessionGroupID))?$$DDU.GetSessionGroupData(k.SessionGroupID):null;var n=null;var l=null;var m=this._sessionAssignmentArray.find(function(p){return Number(p.PricingRuleID)==Number(k.RuleID)},this);if(!$$CM.isNull(m)){n=($$CM.isInteger(m.SessionID))?$$DDU.GetSessionData(m.SessionID):null;l=($$CM.isInteger(m.ProgramID))?$$DDU.GetProgramData(m.ProgramID):null}if(!$$CM.isNull(o)){if(f.length>0){f+="/"}f+=o.Name}if(!$$CM.isNull(j)){if(!$$CM.isNull(l)){if(f.length>0){f+="/"}f+=l.Name}if(f.length>0){f+="/"}f+=j.Name}else{if(!$$CM.isNull(n)){if(f.length>0){f+=" - "}f+=n.Name}if(!$$CM.isNull(l)){if(f.length>0){f+="/"}f+=l.Name}}}else{var i=this._lineItemTypeEnum.GetName(h.LineItemTypeID);f=i}}else{f="Transactions";g=c.Description}var e=b.find(function(p){return p.Name==f},this);if(!$$CM.isNull(e)){if($$CM.isArray(e.ItemArray)){e.ItemArray.push({Name:g,FinancialItem:c})}else{e.ItemArray=$A();e.ItemArray.push({Name:g,FinancialItem:c})}}else{var d={Name:f,ItemArray:$A()};d.ItemArray.push({Name:g,FinancialItem:c});b.push(d)}},this)}return b},getFinancialItemEntityArrayHtml:function(b){var a=$$P.div();a.AddClassName("cmFormRow mt0px mb5px");var c=this.getFinancialItemEntityArray(b);if($$CM.isArray(c)&&c.length>0){c.each(function(g){var f=g.FinancialItemArray;if($$CM.isArray(f)&&f.length>0){var d=$$P.div();a.AddChild(d);d.AddClassName("cmFloatLeft cmBold cmFinancialItemEntity");d.UpdateInnerHtml(g.Name);var e=this.getFinancialItemArrayHtml(f);a.AddChild(e)}},this)}return a},getFinancialItemArrayHtml:function(b){var a=$$P.div();a.AddClassName("cmFloatLeft w500px mb5px pl10px");var c=this.getItemizedFinancialItemArray(b);if($$CM.isArray(c)){c.each(function(j){if(j.ItemArray.length==1&&j.Name==j.ItemArray[0].Name){var k=j.ItemArray[0];var h=k.FinancialItem;var l=this.getLineItem(h.LineItemID);var n=this.getSeasonLineItem(h.LineItemSeasonID);var e=$$P.div();a.AddChild(e);e.AddClassName("cmFormRow mt0px mb5px");var g=$$P.div();e.AddChild(g);g.AddClassName("cmFloatLeft");var m=k.Name;if(!$$CM.isNull(h)&&$$CM.isNumber(h.Quantity)&&$$CM.isNumber(h.UnitAmount)&&(!$$CM.isNull(l)&&l.LineItemTypeID==this._lineItemTypeEnum.GetId("Additional Option"))){if(m.length>0){m+=" "}m+="("+h.Quantity+" x "+$$CM.getFormattedCurrency(h.UnitAmount,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false)+")"}g.UpdateInnerHtml(m);var f=$$P.div();e.AddChild(f);f.AddClassName("cmFloatRight");var i=$$CM.getFormattedCurrency(h.Amount,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false);f.UpdateInnerHtml(i)}else{var d=$$P.div();a.AddChild(d);d.AddClassName("cmFloatLeft cmBold fcGray");d.UpdateInnerHtml(j.Name);j.ItemArray.each(function(t){var r=t.FinancialItem;var u=this.getLineItem(r.LineItemID);var w=this.getSeasonLineItem(r.LineItemSeasonID);var o=$$P.div();a.AddChild(o);o.AddClassName("cmFormRow mt0px mb5px");var q=$$P.div();o.AddChild(q);q.AddClassName("cmFloatLeft");var v=t.Name;if(!$$CM.isNull(r)&&$$CM.isNumber(r.Quantity)&&$$CM.isNumber(r.UnitAmount)&&(!$$CM.isNull(u)&&u.LineItemTypeID==this._lineItemTypeEnum.GetId("Additional Option"))){if(v.length>0){v+=" "}v+="("+r.Quantity+" x "+$$CM.getFormattedCurrency(r.UnitAmount,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false)+")"}q.UpdateInnerHtml(v);var p=$$P.div();o.AddChild(p);p.AddClassName("cmFloatRight");var s=$$CM.getFormattedCurrency(r.Amount,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false);p.UpdateInnerHtml(s)},this)}},this)}return a},BindSeasonalListsData:function(a){this._seasonBillingPreferenceArray=$A();if(!$$CM.isNull(a)){if($$CM.isArray(a.SeasonBillingPreferenceList)){this._seasonBillingPreferenceArray=a.SeasonBillingPreferenceList.findAll(function(b){return b.IsOnline==true},this)}}this.toggleSeasonBillingPreferences()},toggleSeasonBillingPreferences:function(){this._fsrblBillingPreferences.GetListControl().DestroyChildControls(true);this._fsrblBillingPreferences.ResetFormControlArray();if(this._seasonBillingPreferenceArray.length==0){this._divBillingPreferences.Hide()}if(this._seasonBillingPreferenceArray.length>0){var b="BillingPreferences_"+$$CM.uniqueID();var a=$A();this._seasonBillingPreferenceArray.each(function(j){var f=this._billingPreferenceArray.find(function(k){return Number(k.ID)==Number(j.BillingPreferenceID)},this);if(!$$CM.isNull(f)){var e=Object.clone(f);if(!$$CM.isNull(f.PaymentMethodID)){var i=this._enumPaymentMethodTypeFlag.GetName(f.PaymentMethodID);if(!$$CM.isEmpty(i)){e.PaymentMethodName=i}}var h=$$CM.isInteger(f.OrderIndex)?f.OrderIndex:0;var g=!$$CM.isEmpty(f.Name)?f.Name:"";e.SortKey=$$CM.getFormattedOrderIndex(h,10)+"_"+g;a.push(e)}},this);if(a.length>0){a=a.sort($$CM.sortBySortKey);a.each(function(e){if(!$$CM.isNull(e)){var g=e.ID;var h="<span class='cmBold'>"+e.Name+"</span>";if(this._billingPreferencePaymentMethodEnabled==true&&!$$CM.isEmpty(e.PaymentMethodName)){h+="<em class='cmClear'>("+e.PaymentMethodName+")</em>"}this._fsrblBillingPreferences.AddFormRadioButton({ID:g,Name:h,GroupName:b,cssClass:"cmClear"});if(!$$CM.isEmpty(e.Description)){var f=$$P.div(null);this._fsrblBillingPreferences.GetListControl().AddChild(f);f.UpdateInnerHtml(e.Description)}}},this)}var d=this._seasonBillingPreferenceArray.find(function(e){return e.IsDefault==true},this);if(!$$CM.isNull(d)){this._fsrblBillingPreferences.Bind(d.BillingPreferenceID)}var c=this.GetBoundData();if(!$$CM.isNull(c)&&c.BillingPreferenceID>0){this._fsrblBillingPreferences.Bind(c.BillingPreferenceID)}}},onPaymentMethodChanged:function(e,a){this._ccSelectorApplicable=false;this._achSelectorApplicable=false;var d=0;var c=0;if(this._payInFull==true){if(this._payInFullEnabled==true&&this._dueNowAmount>0&&(this._payInFullApplicable==true||this._payInFullRequired==true)){d=this._fsrblPayInFullOption.GetData()}}else{if(this._depositOptionsEnabled==true&&this._dueNowAmount>0){d=this._fsrblDepositOption.GetData()}if(this._balanceAmount>0){c=this._fsrblBillingPreferences.GetData()}}var b=this._billingPreferenceArray.find(function(f){return f.BillingPreferenceID==c},this);if($$CM.isNull(b)){b=new Object()}if(d==this._enumPaymentMethodTypeFlag.GetId("Credit Card")||b.PaymentMethodID==this._enumPaymentMethodTypeFlag.GetId("Credit Card")){this._ccSelectorApplicable=true}else{this._ccSelectorApplicable=false}if(this._ccSelectorApplicable==true){if(!this._ctrCreditCardSelector.IsVisible()){this._ctrCreditCardSelector.Show()}}else{if(this._ctrCreditCardSelector.IsVisible()){this._ctrCreditCardSelector.Hide()}}if(d==this._enumPaymentMethodTypeFlag.GetId("eCheck")||b.PaymentMethodID==this._enumPaymentMethodTypeFlag.GetId("eCheck")){this._achSelectorApplicable=true}else{this._achSelectorApplicable=false}if(this._achSelectorApplicable==true){if(!this._ctrAchAccountSelector.IsVisible()){this._ctrAchAccountSelector.Show()}}else{if(this._ctrAchAccountSelector.IsVisible()){this._ctrAchAccountSelector.Hide()}}},BindFamilyFinancial:function(c){this._seasonID=null;this._personID=null;this._camperData=null;this._sessionAssignmentArray=$A();this._promotionAssignmentArray=$A();this._sessionAssignmentArray=$A();this._familyFinancial=null;this._totals={LedgerBalance:0,AdjustmentsTotal:0,DiscountsTotal:0,ChargesTotal:0};if(!$$CM.isNull(c)){this._seasonID=c.seasonID;this._personID=c.personID;this._camperData=c.camperData;this._sessionAssignmentArray=c.sessionAssignmentArray;this._promotionAssignmentArray=c.promotionAssignmentArray;this._additionalOptionAssignmentArray=c.additionalOptionAssignmentArray;this._familyFinancial=c.familyFinancial}var g="";if(!$$CM.isNull(this._camperData)){var H=this._camperData.Name;if(!$$CM.isNull(H)){if($$CM.IsUPR()){g=$$CM.getFormattedPersonNameUPR(H,true,true,true,true,true)}else{if(!$$CM.isEmpty(H.FullName)){g=H.FullName}else{g=H.FirstName+" "+H.LastName}}}}this._divFamilyFinancial.DestroyChildControls(true);this._divFamilyFinancial.Hide();this._ctrLedger=new cm.ui.forms.SectionBlock("divSectionBlockLedger_"+this._uniqueID,{expandable:true,cssClass:"cmFormRow w510px mb10px pl10px pr10px",headerCssClass:"cmFormRow bb1px",dividerCssClass:"cmFormRow h15px mt0px mb5px ptb0px",contentCssClass:"cmFormRow mtb0px"});this._divFamilyFinancial.AddChild(this._ctrLedger);this._ctrLedger.Hide();this._ctrAdjustments=new cm.ui.forms.SectionBlock("divAdjustments_"+this._uniqueID,{expandable:true,cssClass:"cmFormRow w510px mb10px pl10px pr10px",headerCssClass:"cmFormRow bb1px",dividerCssClass:"cmFormRow h15px mt0px mb5px ptb0px",contentCssClass:"cmFormRow mtb0px"});this._divFamilyFinancial.AddChild(this._ctrAdjustments);this._ctrAdjustments.Hide();this._ctrCharges=new cm.ui.forms.SectionBlock("divSectionBlockCharges_"+this._uniqueID,{expandable:true,cssClass:"cmFormRow w510px mb10px pl10px pr10px",headerCssClass:"cmFormRow bb1px",dividerCssClass:"cmFormRow h15px mt0px mb5px ptb0px",contentCssClass:"cmFormRow mtb0px"});this._divFamilyFinancial.AddChild(this._ctrCharges);this._ctrCharges.Hide();this._ctrDiscounts=new cm.ui.forms.SectionBlock("divSectionBlockDiscounts_"+this._uniqueID,{expandable:true,cssClass:"cmFormRow w510px mb10px pl10px pr10px ",headerCssClass:"cmFormRow bb1px",dividerCssClass:"cmFormRow h15px mt0px mb5px ptb0px",contentCssClass:"cmFormRow mtb0px"});this._divFamilyFinancial.AddChild(this._ctrDiscounts);this._ctrDiscounts.Hide();this._ctrFinalBalance=new cm.ui.forms.SectionBlock("divSectionBlockFinalBalance_"+this._uniqueID,{expandable:false,cssClass:"cmFormRow cmExpand mb15px ",headerCssClass:"cmFormRow mtb0px",contentCssClass:"cmFormRow mtb0px"});this._divFamilyFinancial.AddChild(this._ctrFinalBalance);this._ctrFinalBalance.Hide();this._personArray=$$CADU.GetPersonList(this._seasonID,$$USER.PersonID,16);this._seasonLineItemArray=$$CADU.GetSeasonLineItemAllArray(this._familyFinancial.SeasonID);if(!$$CM.isNull(this._familyFinancial)){var d=this._familyFinancial.AmountDue;var F=this._familyFinancial.LedgerBalance;var G=this._familyFinancial.LedgerItemArray;var a=$A();if($$CM.isArray(G)){a=G.findAll(function(K){return K.IsReversal==true},this)}var y=this._familyFinancial.FinancialItemArray;var h=$A();var j=$A();if($$CM.isArray(y)){h=y.findAll(function(K){return K.IsCharge==true},this);j=y.findAll(function(K){return K.IsCharge!=true},this)}if(($$CM.isNumber(F)&&F>0)||($$CM.isArray(G)&&G.length>0)){this._ctrLedger.Show();var D=$$P.h5("h5PBName_"+this._uniqueID,"Previous Balance");D.AddClassName("cmFloatLeft fs16px mb0px");this._ctrLedger.AddHeaderControl(D);var w=$$P.div("divPBAmount_"+this._uniqueID);w.AddClassName("cmFloatRight cmBold");w.UpdateInnerHtml($$CM.getFormattedCurrency(F,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false));this._ctrLedger.AddHeaderControl(w);var v=this.getFamilyFinancialEntityArrayHtml(G);this._ctrLedger.AddContentControl(v);this._ctrLedger.ToggleExpandable(false);this._ctrLedger.Expand(false)}var b=0;if($$CM.isArray(a)&&a.length>0){this._ctrAdjustments.Show();a.each(function(K){K.Amount*=(-1);K.UnitAmount*=(-1)},this);var z=$$P.h5("h5ATName_"+this._uniqueID,"Adjustments");this._ctrAdjustments.AddHeaderControl(z);z.AddClassName("cmFloatLeft fs16px mb0px");var m=$$P.div("divATAmount_"+this._uniqueID);this._ctrAdjustments.AddHeaderControl(m);m.AddClassName("cmFloatRight cmBold");var l=this.getFamilyFinancialEntityArrayHtml(a);this._ctrAdjustments.AddContentControl(l);this._ctrAdjustments.ToggleExpandable(false);this._ctrAdjustments.Expand(false);a.each(function(K){b+=K.Amount},this);m.UpdateInnerHtml($$CM.getFormattedCurrency(b,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false))}b=Math.round(b*100)/100;var i=0;if($$CM.isArray(h)&&h.length>0){this._ctrCharges.Show();var A=$$P.h5("h5CTName_"+this._uniqueID,"Charges");A.AddClassName("cmFloatLeft fs16px mb0px");this._ctrCharges.AddHeaderControl(A);var p=$$P.div("divCTAmount_"+this._uniqueID);p.AddClassName("cmFloatRight cmBold");this._ctrCharges.AddHeaderControl(p);var n=this.getFamilyFinancialEntityArrayHtml(h);this._ctrCharges.AddContentControl(n);this._ctrCharges.ToggleExpandable(false);this._ctrCharges.Expand(false);h.each(function(K){i+=K.Amount},this);p.UpdateInnerHtml($$CM.getFormattedCurrency(i,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false))}var k=0;if($$CM.isArray(j)&&j.length>0){this._ctrDiscounts.Show();var B=$$P.h5("h5DTName_"+this._uniqueID,"Discounts");B.AddClassName("cmFloatLeft fs16px mb0px");this._ctrDiscounts.AddHeaderControl(B);var r=$$P.div("divDTAmount_"+this._uniqueID);r.AddClassName("cmFloatRight cmBold");this._ctrDiscounts.AddHeaderControl(r);var q=this.getFamilyFinancialEntityArrayHtml(j);this._ctrDiscounts.AddContentControl(q);this._ctrDiscounts.ToggleExpandable(false);this._ctrDiscounts.Expand(false);j.each(function(K){k+=K.Amount},this);r.UpdateInnerHtml($$CM.getFormattedCurrency(k,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false))}this._totals={LedgerBalance:F,AdjustmentsTotal:b,DiscountsTotal:k,ChargesTotal:i};var x=F+i+k+b;this._ctrFinalBalance.Show();var f=0;y.each(function(K){f+=K.Amount},this);if(((f+b)==0)||((f+b)==(d-b))){d-=b}this._ctrBalance=$$P.div("divFBBalance_"+this._uniqueID);this._ctrFinalBalance.AddHeaderControl(this._ctrBalance);this._ctrBalance.AddClassName("cmClear");var C=$$P.h5("h5FBName_"+this._uniqueID,"New Family Balance");this._ctrBalance.AddChild(C);C.AddClassName("cmFloatLeft fs16px mb0px pb0px");var u=$$P.div("divFBAmount_"+this._uniqueID);this._ctrBalance.AddChild(u);u.AddClassName("cmFloatRight cmBold");u.UpdateInnerHtml($$CM.getFormattedCurrency(x,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false));var o=$$P.div();this._ctrBalance.AddChild(o);o.AddClassName("cmClear mb0px");this._ctrDueNow=$$P.div("divDueNow_"+this._uniqueID);this._ctrFinalBalance.AddHeaderControl(this._ctrDueNow);this._ctrDueNow.AddClassName("cmClear mt10px");var E="Due Now";if(!$$CM.isEmpty(g)){E+=" for "+g}var s=$$P.h5("divDueNowLabel_"+this._uniqueID,E);this._ctrDueNow.AddChild(s);s.AddClassName("cmFloatLeft fs16px mb0px pb0px");var t=$$P.div("divDueNowValue_"+this._uniqueID);this._ctrDueNow.AddChild(t);t.AddClassName("cmFloatRight cmBold");t.UpdateInnerHtml($$CM.getFormattedCurrency(d,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false));var o=$$P.div();this._ctrDueNow.AddChild(o);o.AddClassName("cmClear mb0px");if(this._hideDueNow==true){this._ctrDueNow.Hide()}this._balanceAmount=x;this._dueNowAmount=d;this._payInFull=this._familyFinancial.PayInFull;if(this._payInFullEnabled==true&&(this._payInFullApplicable==true||this._payInFullRequired==true)){var I=this._settings.PayInFullDescription;if(!$$CM.isEmpty(I)){ctrPayInFullMessage=new cm.ui.forms.SectionMessage("divPIFMessage_"+this._uniqueID,{message:I,cssClass:"mt10px mb0px cmInfo"});this._ctrFinalBalance.AddHeaderControl(ctrPayInFullMessage);var J=this._settings.PayInFullDescriptionCssClass;if(!$$CM.isEmpty(J)){ctrPayInFullMessage.AddClassName(J)}}if(this._payInFull==true){btnDoNotPayInFull=new $$BTN("btnDoNotPayInFull_"+this._uniqueID,{text:"Do Not Pay in Full"});this._ctrFinalBalance.AddHeaderControl(btnDoNotPayInFull);btnDoNotPayInFull.AddClassName("cmGoButton mt10px ml0px mr0px cmFloatRight");btnDoNotPayInFull.ClickEvent.subscribe(this.onDoNotPayInFull,this);if(this._payInFullRequired==true){btnDoNotPayInFull.Hide()}}else{var e=new $$BTN("btnPayInFull_"+this._uniqueID,{text:"Pay in Full"});this._ctrFinalBalance.AddHeaderControl(e);e.AddClassName("cmGoButton mt10px ml0px mr0px cmFloatRight");e.ClickEvent.subscribe(this.onPayInFull,this);if(this._payInFullRequired==true){e.Hide()}}}}this.togglePayInFull()},getFamilyFinancialEntityArrayHtml:function(c){var a=$$P.div();a.AddClassName("cmFormRow mt0px mb5px");var b=this.getFamilyFinancialEntityArray(c);if($$CM.isArray(b)&&b.length>0){b.each(function(f){var g=f.FinancialItemArray;if($$CM.isArray(g)&&g.length>0){var d=$$P.div();a.AddChild(d);d.AddClassName("cmFloatLeft cmBold cmFamilyFinancialEntity");d.UpdateInnerHtml(f.Name);var e=this.getFamilyFinancialItemArrayHtml(g);a.AddChild(e)}},this)}return a},getFamilyFinancialEntityArray:function(b){var a=$A();if($$CM.isArray(b)){b.each(function(g){var d=g.FamilyID;var j=g.PersonID;if(g.CamperFinancialItem==true){var e=$A();var f=a.find(function(l){return l.ID=="P"+j},this);if($$CM.isNull(f)){var i=this._personArray.find(function(l){return l.PersonID==j},this);var h=null;if(!$$CM.isNull(i)){h=i.Name}else{if(!$$CM.isNull(this._camperData)){h=this._camperData.Name}}var c="";var k="";if(!$$CM.isNull(h)){if($$CM.IsUPR()){c=$$CM.getFormattedPersonNameUPR(h,true,true,true,true,true)}else{if(!$$CM.isEmpty(h.FullName)){c=h.FullName}else{c=h.FirstName+" "+h.LastName}}k=h.FirstName+"_"+h.LastName}f={ID:"P"+j,Name:c,FinancialItemArray:e,SortKey:"1_"+k};a.push(f)}f.FinancialItemArray.push(g)}else{var e=$A();var f=a.find(function(l){return l.ID=="F"+d},this);if($$CM.isNull(f)){f={ID:"F"+d,Name:"Family",FinancialItemArray:e,SortKey:"2_Family"};a.push(f)}f.FinancialItemArray.push(g)}},this)}a=a.sort(function(d,e){var c=((d.SortKey<e.SortKey)?-1:((d.SortKey>e.SortKey)?1:0));return c});return a},getFamilyFinancialItemArrayHtml:function(b){var a=$$P.div();a.AddClassName("cmFloatLeft w500px mb5px pl10px");if($$CM.isArray(b)){b=$$FDU.SortFinancialItemArray(b);b.each(function(f){var h=this.getLineItem(f.LineItemID);var j=this.getSeasonLineItem(f.LineItemSeasonID);var c=$$P.div();a.AddChild(c);c.AddClassName("cmFormRow mt0px mb5px");var e=$$P.div();c.AddChild(e);e.AddClassName("cmFloatLeft");var i="";if(!$$CM.isNull(h)){i=h.Name}else{i=f.Description}if($$CM.isNumber(f.Quantity)&&$$CM.isNumber(f.UnitAmount)&&(!$$CM.isNull(h)&&h.LineItemTypeID==this._lineItemTypeEnum.GetId("Additional Option"))){if(i.length>0){i+=" "}i+="("+f.Quantity+" x "+$$CM.getFormattedCurrency(f.UnitAmount,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false)+")"}e.UpdateInnerHtml(i);var d=$$P.div();c.AddChild(d);d.AddClassName("cmFloatRight");var g=$$CM.getFormattedCurrency(f.Amount,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol,false);d.UpdateInnerHtml(g)},this)}return a},togglePayInFull:function(){this._divPayInFullOptions.Hide();this._divDepositOptions.Hide();this._divBillingPreferences.Hide();if(this._payInFull==true){if(this._payInFullEnabled==true&&this._dueNowAmount>0&&(this._payInFullApplicable==true||this._payInFullRequired==true)){this._divPayInFullOptions.Show()}}else{if(this._depositOptionsEnabled==true&&this._dueNowAmount>0){this._divDepositOptions.Show()}if(this._balanceAmount>0&&this._seasonBillingPreferenceArray.length>0){this._divBillingPreferences.Show()}}if(this._hideLedger==true){this._divFamilyFinancial.Hide()}else{this._divFamilyFinancial.Show()}this.onPaymentMethodChanged()},onPayInFull:function(b,a){this._payInFull=true;this.PayInFullEvent.fire(this,{payInFull:this._payInFull})},onDoNotPayInFull:function(b,a){this._payInFull=false;this.PayInFullEvent.fire(this,{payInFull:this._payInFull})},SetPayInFullApplicable:function(a){this._payInFullApplicable=a},ToggleBillingAddress:function(b){var a=this.GetBoundData();if($$CM.isNull(a)||$$CM.isNull(a.Address)||$$CM.isEmpty(a.Address.AddressLine1)||$$CM.isEmpty(a.Address.City)||$$CM.isEmpty(a.Address.StateProvince)||$$CM.isEmpty(a.Address.Country)){if(!$$CM.isNull(b.HomeAddress)){a={Address:b.HomeAddress,ReceivesInvoices:b.ReceivesInvoices};this._ctrCreditCardSelector.BindBillingData(a);this._ctrAchAccountSelector.BindBillingData(a)}}},Validate:function(g){var h=new cm.validation.ValidationResult("",null);if(h.IsValid()){if(this._ctrCreditCardSelector.IsVisible()){var d=this._ctrCreditCardSelector.GetData();if(!$$CM.isArray(d)||d.length<=0){h.AddError("You must provide a credit card")}else{var e=this._ctrCreditCardSelector.GetDefaultCreditCard();if(!$$CM.isNull(e)){var f=new Date();var c=new $$CMDATE();c.bindFromDate(new Date());var b=new $$CMDATE(e.ExpirationAsString);if(Number(c.getUTCYear())>Number(b.getUTCYear())||(Number(c.getUTCYear())==Number(b.getUTCYear())&&Number(c.getUTCMonth())>Number(b.getUTCMonth()))){h.AddError("Your default <b>Family Credit Card</b> is expired.")}}else{h.AddError("You must select a default credit card")}}}if(this._ctrAchAccountSelector.IsVisible()){var a=this._ctrAchAccountSelector.GetData();if(!$$CM.isArray(a)||a.length<=0){h.AddError("You must provide an echeck account")}}}if(g==true){this.Validator.ShowErrors(h)}return h},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._fsrblPayInFullOption.Bind();this._fsrblDepositOption.Bind();this._fsrblBillingPreferences.Bind()},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)&&a.FamilyID>0){this.RenderCCAndACHSelectors(a.FamilyID)}if(!$$CM.isNull(a)){this._fsrblPayInFullOption.Bind(a.DepositPaymentMethodID);this._fsrblDepositOption.Bind(a.DepositPaymentMethodID);this._fsrblBillingPreferences.Bind(a.BillingPreferenceID);this._ctrCreditCardSelector.Bind(a.CreditCardArray);this._ctrCreditCardSelector.BindBillingData(a);this._ctrAchAccountSelector.Bind(a.AchAccountArray);this._ctrAchAccountSelector.BindBillingData(a)}this.onPaymentMethodChanged()},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}a.PayInFull=this._payInFull||this._payInFullRequired;if(this._payInFull==true){if(this._payInFullEnabled==true&&this._dueNowAmount>0&&(this._payInFullApplicable==true||this._payInFullRequired==true)){a.DepositPaymentMethodID=this._fsrblPayInFullOption.GetData()}}else{if(this._depositOptionsEnabled==true&&this._dueNowAmount>0){a.DepositPaymentMethodID=this._fsrblDepositOption.GetData()}if(this._balanceAmount>0){a.BillingPreferenceID=this._fsrblBillingPreferences.GetData()}}if(!$$CM.isNumber(a.DepositPaymentMethodID)||Number(a.DepositPaymentMethodID)==0){a.DepositPaymentMethodID=0}if(this._ctrCreditCardSelector.IsVisible()){a.CreditCardArray=this._ctrCreditCardSelector.GetData()}else{if($$CM.isArray(a.CreditCardArray)){a.CreditCardArray=a.CreditCardArray.findAll(function(b){return b.IsModified==true},this)}else{a.CreditCardArray=$A()}}if(this._ctrAchAccountSelector.IsVisible()){a.AchAccountArray=this._ctrAchAccountSelector.GetData()}else{if($$CM.isArray(a.AchAccountArray)){a.AchAccountArray=a.AchAccountArray.findAll(function(b){return b.IsModified==true},this)}else{a.AchAccountArray=$A()}}return a},GetTotals:function(){return this._totals}});