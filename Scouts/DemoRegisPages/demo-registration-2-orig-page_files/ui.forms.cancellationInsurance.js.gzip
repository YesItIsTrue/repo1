"cm.ui.forms.cancellationInsurance".namespace();cm.ui.forms.cancellationInsurance.CancellationInsuranceWidgetConfigOptions=Class.create(cm.ConfigOptions,{legendLabel:"",legendCssClass:"",headerMessage:null,headerMessageCssClass:null,ccObjectID:0,ccVaultType:1,ccLegendLabel:"<h5 class='fs16px mb0px'>Program Protector Credit Card(s)</h5>",ccLegendCssClass:"w100prct mb0px",ccCreditCardGatewayTypeID:0,ccCreditCardGatewayCategoryID:0,ccCreditCardCategoryID:0,ccCreditCardTypeIDArray:$A()});cm.ui.forms.cancellationInsurance.CancellationInsuranceWidget=Class.create(cm.ui.ComplexControl,{InsurancePlanPurchaseEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.cancellationInsurance.CancellationInsuranceWidgetConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._providerID=0;if(this._co.providerID>0){this._providerID=this._co.providerID}this._providerPlanIDArray=$A();if($$CM.isArray(this._co.providerPlanIDArray)){this._providerPlanIDArray=this._co.providerPlanIDArray}this._providerPlanArray=$A();if($$CM.isArray(this._providerPlanIDArray)&&this._providerPlanIDArray.length>0){var a=FW.Data.GetStore("Lists").Get("CancellationInsuranceProviderPlanArray");a.each(function(b){var c=this._providerPlanIDArray.find(function(d){return d==b.ID},this);if(c>0){this._providerPlanArray.push($$CM.deepClone(b))}},this)}this._vaultType=0;if(this._co.ccVaultType>0){this._vaultType=this._co.ccVaultType}this._legendLabel=null;if(!$$CM.isEmpty(this.ccLegendLabel)){this._legendLabel=this._co.ccLegendLabel}this._legendCssClass=null;if(!$$CM.isEmpty(this.ccLegendCssClass)){this._legendCssClass=this._co.ccLegendCssClass}this._creditCardGatewayTypeID=0;if(this._co.ccCreditCardGatewayTypeID>0){this._creditCardGatewayTypeID=this._co.ccCreditCardGatewayTypeID}this._creditCardGatewayCategoryID=0;if(this._co.ccCreditCardGatewayCategoryID>0){this._creditCardGatewayCategoryID=this._co.ccCreditCardGatewayCategoryID}this._creditCardCategoryID=0;if(this._co.ccCreditCardCategoryID>0){this._creditCardCategoryID=this._co.ccCreditCardCategoryID}this._creditCardTypeIDArray=$A();if($$CM.isArray(this._co.ccCreditCardTypeIDArray)&&this._co.ccCreditCardTypeIDArray.length>0){this._creditCardTypeIDArray=this._co.ccCreditCardTypeIDArray}this._amountToBeInsured=0;this._ctrProviderPlanArray=$A()},initializeUIElements:function(){this.AddClassName("cancellationInsurance");this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:this._co.legendLabel,legendCssClass:this._co.legendCssClass});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");this._divWrapper=$$P.div("divWrapper_"+this._uniqueID);this._fsWrapper.AddChild(this._divWrapper);this._divWrapper.AddClassName("wrapper");this._ctrHeadeMessage=new cm.ui.forms.SectionMessage("ctrHeadeMessage_"+this._uniqueID,{message:this._co.headerMessage,cssClass:this._co.headerMessageCssClass+" mt0px"});this._divWrapper.AddChild(this._ctrHeadeMessage);this._divProviderPlansBox=$$P.div("divProviderPlansBox_"+this._uniqueID);this._divWrapper.AddChild(this._divProviderPlansBox);this._divProviderPlansBox.AddClassName("providerPlansBox");this._divProviderPlans=$$P.div("divProviderPlans_"+this._uniqueID);this._divProviderPlansBox.AddChild(this._divProviderPlans);this._divProviderPlans.AddClassName("providerPlans");this._divLogo=$$P.div("divLogo_"+this._uniqueID);this._divProviderPlans.AddChild(this._divLogo);this._divLogo.AddClassName("logoWrapper");this._divProviderPlansLogo=$$P.div("divProviderPlansLogo"+this._uniqueID);this._divLogo.AddChild(this._divProviderPlansLogo);this._divProviderPlansLogo.AddClassName("logo");this._divProviderPlansMessage=$$P.div("divProviderPlansMessage_"+this._uniqueID);this._divProviderPlans.AddChild(this._divProviderPlansMessage);this._divProviderPlansMessage.AddClassName("message");this._divProviderPlansMessage.UpdateInnerHtml("Protect your program arrangements, your belongings, and most importantly you!");this._divProviderPlanList=$$P.div("divProviderPlanList_"+this._uniqueID);this._divProviderPlans.AddChild(this._divProviderPlanList);this._divProviderPlanList.AddClassName("list");this.renderProviderPlanArray(this._providerPlanArray);this.divNoCancellationInsurance=$$P.div("divNoCancellationInsurance_"+this._uniqueID);this._divProviderPlans.AddChild(this.divNoCancellationInsurance);this.divNoCancellationInsurance.AddClassName("noPlan");this._fcbNoCancellationInsurance=new $$FCB("fcbNoCancellationInsurance_"+this._uniqueID,{name:"NoCancellationInsurance",label:"I do not want protection for my program"});this.divNoCancellationInsurance.AddChild(this._fcbNoCancellationInsurance);this._fcbNoCancellationInsurance.AddClassName("label");this._fcbNoCancellationInsurance.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this.divNoCancellationInsuranceNote=$$P.div("divNoCancellationInsurance_"+this._uniqueID);this.divNoCancellationInsurance.AddChild(this.divNoCancellationInsuranceNote);this.divNoCancellationInsuranceNote.AddClassName("note");this.divNoCancellationInsuranceNote.UpdateInnerHtml("Please note: you cannot come back at a later date to purchase for this program.");this.renderCreditCardSelector(this._co.ccObjectID,null)},renderProviderPlanArray:function(a){this._divProviderPlanList.DestroyChildControls(true);this._ctrProviderPlanArray=$A();this._providerPlanArray=a;if($$CM.isArray(this._providerPlanArray)&&this._providerPlanArray.length>0){this._providerPlanArray.each(function(c){var d=$$CM.uniqueID();var b=new cm.ui.forms.cancellationInsurance.ProviderPlan("ctrProviderPlan_"+d,{uniqueID:d,definition:c});this._divProviderPlanList.AddChild(b);this._ctrProviderPlanArray.push(b);b.PurchaseEvent.subscribe(this.onProviderPlanPurchase,this);b.CancelEvent.subscribe(this.onProviderPlanCancel,this);b.MoreDetailsEvent.subscribe(this.onProviderPlanMoreDetails,this)},this)}},renderCreditCardSelector:function(e,c){if(!$$CM.isNull(this._ctrCreditCardSelector)){this._divWrapper.RemoveChildControl(this._ctrCreditCardSelector);this._ctrCreditCardSelector.DestroyChildControls(true)}this._personID=e;this._creditCradArray=c;var d={RequiresEmail:false,ProcessesCards:true};var a=["1","2","3","4"];var b={uniqueID:this._uniqueID,disabled:false,disabledText:null,objectID:this._personID,vaultType:this._vaultType,legendLabel:this._legendLabel,legendCssClass:this._legendCssClass,creditCardGatewayTypeID:this._creditCardGatewayTypeID,creditCardGatewayCategoryID:this._creditCardGatewayCategoryID,creditCardCategoryID:this._creditCardCategoryID,creditCardTypeIDArray:a,financialSettings:d};this._ctrCreditCardSelector=new cm.ui.forms.CreditCardSelectorUPR("ctrCreditCardSelector_"+this._uniqueID,b);this._divWrapper.AddChild(this._ctrCreditCardSelector);this._ctrCreditCardSelector.AddClassName("payment");this._ctrCreditCardSelector.Bind(this._creditCradArray);this._ctrCreditCardSelector.Hide();this._ctrCreditCardSelector.CreditCardModifiedEvent.subscribe(this.onCreditCardModified,this);this.toggleCreditCardSelector(false)},createEvents:function($super){$super();this.InsurancePlanPurchaseEvent=new cm.event();this.CreditCardModifiedEvent=new cm.event()},wireEvents:function($super){$super();this._fcbNoCancellationInsurance.ChangeEvent.subscribe(this.onNoCancellationInsurance,this)},onProviderPlanPurchase:function(c,a){var b=c.GetData();this._currentProviderPlanID=b.ProviderPlanID;this._ctrProviderPlanArray.each(function(d){var e=(d.GetData().ProviderPlanID==this._currentProviderPlanID);d.toggleState(e)},this);this._ctrCreditCardSelector.Show(true)},onProviderPlanCancel:function(c,a){var b=c.GetData();this._currentProviderPlanID=0;this._ctrProviderPlanArray.each(function(d){d.toggleState(false)},this);this._ctrCreditCardSelector.Hide(true)},onProviderPlanMoreDetails:function(b,a){alert("onProviderPlanMoreDetails: "+$$CM.stringify(a))},onCreditCardModified:function(b,a){this.CreditCardModifiedEvent.fire(b,a)},onNoCancellationInsurance:function(b,a){this.toggleCreditCardSelector(true)},toggleCreditCardSelector:function(a){var c=this._fcbNoCancellationInsurance.GetData();if(c==true){var b=this._ctrProviderPlanArray.find(function(d){return d.IsSelected()==true},this);if(!$$CM.isNull(b)){this._currentProviderPlanID=b.GetData().ProviderPlanID}else{this._currentProviderPlanID=0}this._ctrProviderPlanArray.each(function(d){d.toggleState(false)},this);this._divProviderPlanList.SetEnabled(false);this._ctrCreditCardSelector.Hide(a)}else{this._ctrProviderPlanArray.each(function(d){var e=(this._currentProviderPlanID>0&&this._currentProviderPlanID==d.GetData().ProviderPlanID);d.toggleState(e)},this);this._divProviderPlanList.SetEnabled(true);if(this._currentProviderPlanID>0){this._ctrCreditCardSelector.Show(a)}}},BindProviderID:function(a){this._providerID=a;this._co.providerID=a},BindAmountToBeInsured:function(a){this._amountToBeInsured=a},BindCreditCardSelector:function(b,a){this.renderCreditCardSelector(b,a)},BindStateCode:function(a){this._stateCode=a;this._ctrProviderPlanArray.each(function(b){return b.BindStateCode(this._stateCode)},this)},ToggleApplicability:function(){if(this.IsApplicable()){this.Show()}else{this.Hide()}},IsApplicable:function(){var a=(this._amountToBeInsured>0&&$$CM.isArray(this._providerPlanArray)&&this._providerPlanArray.length>0);return a},HasApplicablePlans:function(){var a=this._ctrProviderPlanArray.find(function(c){return c.IsApplicable()==true},this);var b=!$$CM.isNull(a);return b},Toggle:function(){var a=this.IsApplicable()&&this.HasApplicablePlans();if(a){this.Show()}else{this.Hide()}},Validate:function(f){var g=this.Validator.validate();if(g.IsValid()){var h=new cm.validation.ValidationResult("",null);var d=this.GetData();if(d.NoCancellationInsurance!=true&&this.HasApplicablePlans()){var e=d.Order;if(!$$CM.isNull(e)&&e.ProviderPlanID>0){var b=d.CreditCardArray;var c=0;if($$CM.isArray(b)){var a=b.find(function(i){return i.IsDefault==true},this);if(!$$CM.isNull(a)){c=a.ID}}if(c<=0){h.AddError("<div class='mt5px'>You must add a default credit card.</div>")}}else{h.AddError("<div class='mt5px'>Please select a protection plan or select <i>\"I do not want protection for my program\"<i>.</div>")}}g.AppendResult(h)}if(f==true){this.Validator.ShowErrors(g)}return g},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ctrProviderPlanArray.each(function(a){a.Bind()},this)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if($$CM.isArray(a)){var b=a;b.each(function(d){var c=this._ctrProviderPlanArray.find(function(e){return e.GetDefinition().ID==d.ProviderPlanID},this);if(!$$CM.isNull(c)){c.Bind(d)}},this)}this.Toggle()},GetData:function(){var b={ProviderID:this._providerID,CreditCardArray:this._ctrCreditCardSelector.GetData(),NoCancellationInsurance:this._fcbNoCancellationInsurance.GetData()};var a=this._ctrProviderPlanArray.find(function(d){return d.IsSelected()==true},this);if(!$$CM.isNull(a)){var c=a.GetData();if(!$$CM.isNull(c)){b.Order={ID:0,ProviderPlanID:c.ProviderPlanID,Premium:c.Amount,TripCost:this._amountToBeInsured}}}return b}});cm.ui.forms.cancellationInsurance.ProviderPlan=Class.create(cm.ui.ComplexControl,{PurchaseEvent:null,CancelEvent:null,initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._definition={};if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._selected=false},initializeUIElements:function(){this.AddClassName("providerPlan");this._divNameWrapper=$$P.div("divNameWrapper_"+this._uniqueID);this.AddChild(this._divNameWrapper);this._divNameWrapper.AddClassName("nameWrapper");this._divPriceButtonWrapper=$$P.div("divPriceButtonWrapper_"+this._uniqueID);this.AddChild(this._divPriceButtonWrapper);this._divPriceButtonWrapper.AddClassName("priceButtonWrapper");this._divPriceAndButton=$$P.div("divPriceAndButton"+this._uniqueID);this._divPriceButtonWrapper.AddChild(this._divPriceAndButton);this._divPriceAndButton.AddClassName("nameAndPrice");this._spAmount=$$P.span("spAmount_"+this._uniqueID);this._divPriceAndButton.AddChild(this._spAmount);this._spAmount.AddClassName("amount");if(!$$CM.isEmpty(this._definition.Amount)){var a=$$CM.getFormattedCurrency(this._definition.Amount,true,false);this._spAmount.UpdateInnerHtml(a)}this._btnPurchase=new $$BTN("btnPurchase_"+this._uniqueID,{text:"Purchase"});this._divPriceAndButton.AddChild(this._btnPurchase);this._btnPurchase.AddClassName("cmGoButton cmFloatRight_");this._btnRemove=new $$BTN("btnRemove_"+this._uniqueID,{text:"Remove"});this._divPriceAndButton.AddChild(this._btnRemove);this._btnRemove.AddClassName("cmGoButton cmFloatRight_");this._btnRemove.Hide();this._divNameAndPrice=$$P.div("divNameAndPrice"+this._uniqueID);this._divNameWrapper.AddChild(this._divNameAndPrice);this._divNameAndPrice.AddClassName("nameAndPrice");this._spName=$$P.span("spName_"+this._uniqueID);this._divNameAndPrice.AddChild(this._spName);this._spName.AddClassName("name");if(!$$CM.isEmpty(this._definition.Name)){this._spName.UpdateInnerHtml(this._definition.Name)}if(!$$CM.isEmpty(this._definition.PlanDescription)){this._divDescription=$$P.div("divDescription_"+this._uniqueID);this._divNameWrapper.AddChild(this._divDescription);this._divDescription.AddClassName("description");this._divDescription.UpdateInnerHtml(this._definition.PlanDescription)}this._divMoreDetails=$$P.div("divMoreDetails_"+this._uniqueID);this._divNameWrapper.AddChild(this._divMoreDetails);this._divMoreDetails.AddClassName("moreDetailsLink");this._divMoreDetails.AddChild($$P.span(null,"("));this._lnkMoreDetails=new $$A("lnkMoreDetails_"+this._uniqueID,{text:"click here for full details",link:"#",target:"new"});this._divMoreDetails.AddChild(this._lnkMoreDetails);this._divMoreDetails.AddChild($$P.span(null,")"));if($$CM.isEmpty(this._definition.TermsURL)){this._divMoreDetails.Hide()}},createEvents:function($super){$super();this.PurchaseEvent=new cm.event();this.CancelEvent=new cm.event();this.MoreDetailsEvent=new cm.event()},wireEvents:function($super){$super();this._btnPurchase.ClickEvent.subscribe(this.onPurchase,this);this._btnRemove.ClickEvent.subscribe(this.onRemove,this)},onPurchase:function(c,a){this.toggleState(true);var b=this.GetData();this.PurchaseEvent.fire(this,{data:b})},onRemove:function(c,a){this.toggleState(false);var b=this.GetData();this.CancelEvent.fire(this,{data:b})},onMoreDetails:function(c,a){var b=this.GetDefinition().PlanDescription;$$CMD.AlertGo({title:"More Details",message:b})},toggleState:function(a){this.RemoveClassName("selected");this._selected=a;if(this._selected==true){this.AddClassName("selected");this._btnPurchase.Hide();this._btnRemove.Show()}else{this._btnPurchase.Show();this._btnRemove.Hide()}},BindStateCode:function(c){this._stateCode=c;var a=this.GetData();if(!$$CM.isNull(a)&&!$$CM.isEmpty(a.ProviderTermsURL)){var b=a.ProviderTermsURL;if(!$$CM.isEmpty(this._stateCode)){if(b.substring(b.length-1,b.legth)!="/"){b+="/"}b+=this._stateCode}if(!$$CM.isEmpty(a.ProviderPlanKey)){if(b.substring(b.length-1,b.legth)!="/"){b+="/"}b+=a.ProviderPlanKey}this._lnkMoreDetails.SetLinkUrl(b)}},IsSelected:function(){return(this._selected==true)},IsApplicable:function(){var a=false;var b=this.GetData();if(!$$CM.isNull(b)&&b.ProviderID>0&&b.ProviderPlanID>0&&b.Amount>0){a=true}return a},ToggleApplicability:function(){if(this.IsApplicable()){this.Show()}else{this.Hide()}},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._amount=0;this._spAmount.UpdateInnerHtml()},onDataUpdated:function(){this.ClearFields();var b=this.GetBoundData();if(!$$CM.isNull(b)){if(!$$CM.isEmpty(b.Amount)){this._amount=b.Amount;var a=$$CM.getFormattedCurrency(b.Amount,true,false);this._spAmount.UpdateInnerHtml(a)}}this.BindStateCode(this._stateCode);this.ToggleApplicability()},GetDefinition:function(){if($$CM.isNull(this._definition)){this._definition={}}return this._definition},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a={ProviderID:this._definition.ProviderID,ProviderPlanID:this._definition.ID,ProviderPlanKey:this._definition.PlanKey,Amount:this._amount}}a.ProviderID=this._definition.ProviderID;a.ProviderPlanID=this._definition.ID;a.ProviderPlanKey=this._definition.PlanKey;a.ProviderTermsURL=this._definition.TermsURL;a.Amount=this._amount;return a}});