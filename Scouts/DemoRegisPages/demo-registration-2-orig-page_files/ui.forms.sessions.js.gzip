"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.PBPricingPackageConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),definition:new Object(),programID:0,pricingIdentifierID:0,groupName:"PP_"+$$CM.uniqueID(),pricingSettings:new Object(),pricingRuleArray:$A(),seasonSessionArray:$A(),capacityResultArray:$A(),tier1Name:"",tier2Name:""});cm.ui.forms.sessions.PBPricingPackage=Class.create(cm.ui.ComplexControl,{SelectionChangedEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.sessions.PBPricingPackageConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._programID=0;if($$CM.isNumber(this._co.programID)&&this._co.programID>0){this._programID=this._co.programID}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="PP_"+$$CM.uniqueID()}this._pricingSettings=new Object();if(!$$CM.isNull(this._co.pricingSettings)){this._pricingSettings=this._co.pricingSettings}this._pricingRuleArray=$A();if($$CM.isArray(this._co.pricingRuleArray)&&this._co.pricingRuleArray.length>0){this._pricingRuleArray=this._co.pricingRuleArray}this._seasonSessionArray=$A();if(!$$CM.isNull(this._co.seasonSessionArray)&&$$CM.isArray(this._co.seasonSessionArray)){this._seasonSessionArray=this._co.seasonSessionArray}this._capacityResultArray=$A();if(!$$CM.isNull(this._co.capacityResultArray)&&$$CM.isArray(this._co.capacityResultArray)&&this._co.capacityResultArray.length>0){this._capacityResultArray=this._co.capacityResultArray}this._isSelected=false;this._inDB=false},getApplicablePricingRule:function(){var a=null;if(!$$CM.isNull(this._definition)&&!$$CM.isNull(this._pricingRuleArray)&&$$CM.isArray(this._pricingRuleArray)){a=this._pricingRuleArray.find(function(b){return Number(b.PackageID)==Number(this._definition.PackageID)},this)}return a},initializeUIElements:function(){this.AddClassName("cmPBPricingPackage");this._divName=$$P.div("divPBPPName_"+this._uniqueID);this.AddChild(this._divName);this._divName.AddClassName("cmPBPricingPackageName");this._frbPricingPackage=new $$FRB("frbPBPP_"+this._uniqueID,{value:this._definition.ID,label:this._definition.Name,name:this._co.groupName});this._divName.AddChild(this._frbPricingPackage);this._frbPricingPackage.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this._frbPricingPackage.GetTitleControl().AddClassName("cmPBPricingPackageTitle");this._frbPricingPackage.GetInputControl().AddClassName("pt0px");this._pricingRule=this.getApplicablePricingRule();this.RenderPricingRule(this._pricingRule);this._divFees=$$P.div("divPPFees_"+this._uniqueID);this.AddChild(this._divFees);this._divFees.AddClassName("cmPBPricingPackageParagraph");this._divFees.Hide();this._divDescription=$$P.div("divPPDescription_"+this._uniqueID);this.AddChild(this._divDescription);this._divDescription.AddClassName("cmPBPricingPackageParagraph");if(!$$CM.isEmpty(this._definition.Description)){var a=$$CM.getCMFormattedText(this._definition.Description);this._divDescription.UpdateInnerHtml(a)}else{this._divDescription.Hide()}this._divItemList=$$P.div("divItemList_"+this._uniqueID,null,{classNames:"mb0px"});this.AddChild(this._divItemList);this._divItemList.Hide();var b=$$P.div();this.AddChild(b);b.AddClassName("cmClear mb10px")},RenderPricingRule:function(a){var d="";if(!$$CM.isNull(a)&&(this._settings.EnableSessionCost==true||this._settings.EnableSessionDeposit==true)){var b=$$CADU.GetSeasonLineItemArray(a.SeasonID);d=$$FDU.GetPricingRuleTuitionAndDeposit(a,b,true,this._settings.EnableSessionCost,this._settings.EnableSessionDeposit)}var c="<span class='cmFloatRight'>"+d+"</span><span class='input_'>"+this._definition.Name+"</span>";this._frbPricingPackage.GetTitleControl().UpdateInnerHtml(c)},_ctrItemArray:$A(),_ssArrayHasBeenRendered:false,RenderSeasonSessionArray:function(){if(this._ssArrayHasBeenRendered==false){this._ssArrayHasBeenRendered=true}else{return}this._divItemList.DestroyChildControls(true);this._ctrItemArray=$A();if($$CM.isArray(this._seasonSessionArray)){var a="PBSS_"+this._uniqueID;this._seasonSessionArray.each(function(c){var e=$$CM.uniqueID();var d={uniqueID:e,settings:this._settings,definition:c,programID:this._programID,pricingIdentifierID:this._pricingIdentifierID,groupName:a,pricingSettings:this._pricingSettings,capacityResultArray:this._capacityResultArray,tier1Name:this._co.tier1Name,tier2Name:this._co.tier2Name,tier3Name:this._definition.Name};var b=new cm.ui.forms.sessions.PBSeasonSession("divPBSS_"+e,d);this._divItemList.AddChild(b);this._ctrItemArray.push(b)},this)}},ShowSeasonSessionArray:function(a){this.RenderSeasonSessionArray();this._divItemList.Show(a)},HideSeasonSessionArray:function(a){this._divItemList.Hide(a)},createEvents:function($super){$super();this.SelectionChangedEvent=new cm.event()},wireEvents:function($super){$super();this._frbPricingPackage.ClickEvent.subscribe(this.onPricingPackageClicked,this)},onPricingPackageClicked:function(c,a){if(this._inDB==true){var b=$$SETTINGSDU.GetFormattedCallUsMessage("This camper has already applied for this package.  If you would like to make changes",this._settings.GeneralSettings);b=$$CM.convertToEntityLabelString(b,$$SETTINGSDU.GetEntityLabelSettings());$$CMD.AlertCancel({title:"Error",header:"",message:b});return}this.SelectionChangedEvent.fire(this,{animate:true})},SelectionChanged:function(d,a){this._isSelected=!this._isSelected;if(this._isSelected==true){this.Select(a)}else{this.Deselect(a)}this.SetEnabled(this._isSelected);if($$CM.isArray(d)&&d.length>0){this._ctrItemArray.each(function(e){var f=d.find(function(g){return Number(g.SessionID)==Number(e._definition.SessionID)},this);e.Bind(f)},this);var b=this._ctrItemArray.find(function(e){return e.InDB()==true},this);this._inDB=!$$CM.isNull(b);var c=this._ctrItemArray.find(function(e){return e.IsSelected()==true},this);if(!$$CM.isNull(c)){this.Select()}}},Select:function(a){this._isSelected=true;this._frbPricingPackage.RemoveClassName("cmCustomValidationError");this.ShowSeasonSessionArray(a);this._frbPricingPackage.Bind(this._isSelected);this._frbPricingPackage.RemoveClassName("cmSelected");this._frbPricingPackage.AddClassName("cmSelected");this.SetEnabled(this._isSelected)},Deselect:function(a){this._isSelected=false;this._inDB=false;this._frbPricingPackage.RemoveClassName("cmCustomValidationError");this.HideSeasonSessionArray(a);this._frbPricingPackage.Bind(this._isSelected);this._frbPricingPackage.RemoveClassName("cmSelected");this.SetEnabled(this._isSelected);this._ctrItemArray.each(function(b){b.Deselect(false)},this)},SetEnabled:function(a){},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},Validate:function(c){this._frbPricingPackage.RemoveClassName("cmCustomValidationError");var d=new cm.validation.ValidationResult("",null);if(this.IsSelected()){var a=this.GetData();var b=this._definition.NumberOfSessions;if(a.length<=0){d.AddError("You must select <b>"+b+"</b> session"+((b==1)?"":"s")+" or uncheck <b>"+this.GetPathLabel()+"</b>.")}else{this._ctrItemArray.each(function(e){var f=e.Validate();d.AppendResult(f)},this);if(a.length!=b){d.AddError("You must select <b>"+b+"</b> session"+((b==1)?"":"s")+" or uncheck <b>"+this.GetPathLabel()+"</b>.")}}if(d.IsValid()!=true){this._frbPricingPackage.AddClassName("cmCustomValidationError")}}if(c==true){this.Validator.ShowErrors(d)}return d},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this.Deselect();this._ctrItemArray.each(function(a){a.Bind(null)},this)},onDataUpdated:function(){this.ClearFields();var c=this.GetBoundData();if($$CM.isArray(c)&&c.length>0){this.RenderSeasonSessionArray();var d=c.findAll(function(e){return e},this);this._ctrItemArray.each(function(e){var f=d.find(function(g){return Number(g.SessionID)==Number(e._definition.SessionID)},this);e.Bind(f)},this);var a=this._ctrItemArray.find(function(e){return e.InDB()==true},this);this._inDB=!$$CM.isNull(a);var b=this._ctrItemArray.find(function(e){return e.IsSelected()==true},this);if(!$$CM.isNull(b)){this.Select()}}},GetPathLabel:function(){var a="";if(!$$CM.isEmpty(this._co.tier1Name)){a+=this._co.tier1Name+" - "}if(!$$CM.isEmpty(this._co.tier2Name)){a+=this._co.tier2Name+" - "}a+=this._definition.Name;return a},GetData:function(){var a=$A();this._ctrItemArray.each(function(b){if(b.IsSelected()==true){var c=b.GetData();if(!$$CM.isNull(c)){if(!$$CM.isNull(this._pricingRule)){c.PricingRuleID=this._pricingRule.RuleID}a.push(c)}}},this);return a}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.PBSeasonSessionConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),definition:new Object(),programID:0,groupName:"PBSS_"+$$CM.uniqueID(),pricingSettings:new Object(),capacityResultArray:$A()});cm.ui.forms.sessions.PBSeasonSession=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.sessions.PBSeasonSessionConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._programID=0;if($$CM.isNumber(this._co.programID)&&this._co.programID>0){this._programID=this._co.programID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="PBSS_"+$$CM.uniqueID()}this._pricingSettings=new Object();if(!$$CM.isNull(this._co.pricingSettings)){this._pricingSettings=this._co.pricingSettings}this._capacityResultArray=$A();if(!$$CM.isNull(this._co.capacityResultArray)&&$$CM.isArray(this._co.capacityResultArray)&&this._co.capacityResultArray.length>0){this._capacityResultArray=this._co.capacityResultArray}this._seasonSessionProgramArray=$A();if(!$$CM.isNull(this._definition.ProgramArray)&&$$CM.isArray(this._definition.ProgramArray)&&this._definition.ProgramArray.length>0){this._seasonSessionProgramArray=this._definition.ProgramArray}this._seasonSessionProgram=null;if(this._programID>0){this._seasonSessionProgram=this._seasonSessionProgramArray.find(function(b){return Number(b.ProgramID)==Number(this._programID)},this)}this._programAffectsPricing=(this._pricingSettings.ProgramsAffectPricing==true);this._sessionGroupSettings=$$CADU.GetSessionGroupSettings(101,this._definition.SeasonID,this._definition.SessionGroupID);this._atOrOverCapacityCssClass="";this._atOrOverCapacityLabel="";this._seasonSessionProgramIDNameList=$A();if(this._programAffectsPricing!=true&&this._seasonSessionProgramArray.length>0){this._seasonSessionProgramArray.each(function(c){var d=c.ID;var e=c.Name;if(c.UsesDaily!=true){var b=this.getCapacityResult(this._definition.SessionID,d);var f=this.getAtOrOverCapacityDDLLabel(b);if(!$$CM.isEmpty(f)){e+=f}}this._seasonSessionProgramIDNameList.push({ID:d,Name:e})},this)}else{if(this._definition.UsesDaily!=true){var a=this.getCapacityResult(this._definition.SessionID,this._programID);this._atOrOverCapacityCssClass=this.getAtOrOverCapacityCssClass(a);this._atOrOverCapacityLabel=this.getAtOrOverCapacityLabel(a)}}this._isSelected=false;this._inDB=false},getCapacityResult:function(c,b){var a=null;if($$CM.isArray(this._capacityResultArray)){a=this._capacityResultArray.find(function(e){var d=true;if($$CM.isInteger(c)&&c>0){d=d&&Number(e.SessionID)==Number(c)}if($$CM.isInteger(b)&&b>0){d=d&&Number(e.ProgramID)==Number(b)}return d},this)}return a},getAtOrOverCapacityCssClass:function(a){var b="";if(!$$CM.isNull(a)&&a.UsesDaily!=true&&a.IsAtOrOverCapacity==true&&!$$CADU.PersonIDStatusCheck(a)){b="cmAtOrOverCapacity"}return b},getAtOrOverCapacityLabel:function(a){var b="";if(!$$CM.isNull(a)&&a.UsesDaily!=true&&a.IsAtOrOverCapacity==true&&!$$CADU.PersonIDStatusCheck(a)){if(this._settings.EnableCapacityLegend==true&&Number(a.FullSessionOptionID)==2){b=" (Wait List)"}}return b},getAtOrOverCapacityDDLLabel:function(a){var b="";if(!$$CM.isNull(a)&&a.IsAtOrOverCapacity==true&&!$$CADU.PersonIDStatusCheck(a)){b=" (full)";if(this._settings.EnableCapacityLegend==true&&Number(a.FullSessionOptionID)==2){b=" (full - Wait List)"}}return b},initializeUIElements:function(){this.AddClassName("cmPBSeasonSession");this._divName=$$P.div("divPBSSName_"+this._uniqueID);this.AddChild(this._divName);this._divName.AddClassName("cmPBSeasonSessionName");var e=$$P.span();var c=this._definition.Name+this._atOrOverCapacityLabel;var d="";if(this._settings.ShowTimes==true){if(this._programAffectsPricing&&!$$CM.isNull(this._seasonSessionProgram)){d=$$CM.getFormattedTimeRange(this._seasonSessionProgram.StartDateAsString,this._seasonSessionProgram.EndDateAsString,false)}else{d=$$CM.getFormattedTimeRange(this._definition.StartDateAsString,this._definition.EndDateAsString,false)}d="("+d+")"}e.AddChild($$P.span("",d,{classNames:"ml5px cmFloatRight cmBasicText"}));var b="";if(this._settings.HideDates!=true){if(this._programAffectsPricing&&!$$CM.isNull(this._seasonSessionProgram)){b=$$CM.getFormattedDateRange(this._seasonSessionProgram.StartDateAsString,this._seasonSessionProgram.EndDateAsString,true,false,true,true,true)}else{b=$$CM.getFormattedDateRange(this._definition.StartDateAsString,this._definition.EndDateAsString,true,false,true,true,true)}}e.AddChild($$P.span("",b,{classNames:"cmFloatRight"}));e.AddChild($$P.span("",c,{classNames:"input "+this._atOrOverCapacityCssClass}));this._fcbSeasonSession=new $$FCB("fcbPBSS_"+this._uniqueID,{value:this._definition.ID,label:e.GetHtmlElement().outerHTML,name:this._definition.GroupName});this._divName.AddChild(this._fcbSeasonSession);this._fcbSeasonSession.AddClassName("cmSession");this._fcbSeasonSession.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this._fcbSeasonSession.GetTitleControl().AddClassName("cmPBSeasonSessionTitle");this._fcbSeasonSession.GetInputControl().AddClassName("pt0px");this._fddlSeasonSessionProgram=new $$FDDL("fddlPBSSP_"+this._uniqueID,{label:"",isRequired:true,inputWidth:3000});this._divName.AddChild(this._fddlSeasonSessionProgram);this._fddlSeasonSessionProgram.AddClassName("cmProgram");this._fddlSeasonSessionProgram.RemoveChildControl(this._fddlSeasonSessionProgram.GetTitleControl());this._fddlSeasonSessionProgram.GetInputControl().AddClassName("w300px");this._fddlSeasonSessionProgram.bindList(this._seasonSessionProgramIDNameList,"","Select",false);this._fddlSeasonSessionProgram.Validator.addEvaluator($$EVAL.SELECT({FieldName:this.GetPathLabel(),IsRequired:true}));this._fddlSeasonSessionProgram.Hide();var a={uniqueID:this._uniqueID,cssWrapper:"cmSBSeasonSessionProgramDaysOfWeek mt5px",cssLabel:"cmFloatLeft",cssCheckBoxList:"cmFloatLeft",cssCheckBox:"",settings:this._settings};this._ctrDaysOfWeek=new cm.ui.common.DaysOfWeek("divSBSeasonSessionProgramDaysOfWeek_"+this._uniqueID,a);this.AddChild(this._ctrDaysOfWeek);this._ctrDaysOfWeek.Hide(false)},wireEvents:function($super){$super();this._fcbSeasonSession.ClickEvent.subscribe(this.onSeasonSessionClicked,this);this._fddlSeasonSessionProgram.ChangeEvent.subscribe(this.onSeasonSessionProgramChanged,this)},onSeasonSessionClicked:function(d,a){if(this._inDB==true){var c=$$SETTINGSDU.GetFormattedCallUsMessage("This camper has already applied for this session.  If you would like to make changes",this._settings.GeneralSettings);c=$$CM.convertToEntityLabelString(c,$$SETTINGSDU.GetEntityLabelSettings());$$CMD.AlertCancel({title:"Error",header:"",message:c});this.Select();var b=this.GetBoundData();this.BindDaysOfWeek(b.DayOfWeekFlagID);return}this._isSelected=!this._isSelected;if(this._isSelected==true){this.Select()}else{this.Deselect()}this.SetEnabled(this._isSelected)},onSeasonSessionProgramChanged:function(d,a){if(this.InDB()==true){var c=$$SETTINGSDU.GetFormattedCallUsMessage("This camper has already applied for this program.  If you would like to make changes",this._settings.GeneralSettings);c=$$CM.convertToEntityLabelString(c,$$SETTINGSDU.GetEntityLabelSettings());$$CMD.AlertCancel({title:"Error",header:"",message:c});var b=this.GetBoundData();if(!$$CM.isNull(b)&&b.ProgramID>0){this._fddlSeasonSessionProgram.Bind(b.ProgramID)}return}this.toggleDaysOfWeek(true)},Select:function(a){this._isSelected=true;if(this._programAffectsPricing!=true&&this._seasonSessionProgramArray.length>0){this._fddlSeasonSessionProgram.Show(a)}this._fcbSeasonSession.Bind(this._isSelected);this._divName.RemoveClassName("cmSelected");this._divName.AddClassName("cmSelected");this.toggleDaysOfWeek(a)},Deselect:function(a){this._isSelected=false;this._inDB=false;if(this._programAffectsPricing!=true&&this._seasonSessionProgramArray.length>0){this._fddlSeasonSessionProgram.Hide(a)}this._fcbSeasonSession.Bind(this._isSelected);this._divName.RemoveClassName("cmSelected");this.toggleDaysOfWeek(a)},toggleDaysOfWeek:function(a){if(this._isSelected==true){var d=null;var b=null;if(this._programAffectsPricing==true){d=this._seasonSessionProgramArray.find(function(e){return Number(e.ProgramID)==Number(this._programID)},this);b=this.getCapacityResult(this._definition.SessionID,this._programID)}else{if(this._programAffectsPricing!=true){if(this._seasonSessionProgramArray.length>0){this._programID=Number(this._fddlSeasonSessionProgram.GetValue());d=this._seasonSessionProgramArray.find(function(e){return Number(e.ProgramID)==Number(this._programID)},this);b=this.getCapacityResult(this._definition.SessionID,this._programID)}else{d=this._definition;b=this.getCapacityResult(this._definition.SessionID,this._programID)}}}this._usesDaily=false;this._daysOption=0;this._daysCount=0;this._enabledDaysFlag=0;this._fullSessionOptionFlag=0;this._atOrOverCapacityDaysFlag=0;this._atOrOverCapacityDaysHideOnAppEnabled=true;this._showDaysFlag=0;if(!$$CM.isNull(d)){this._usesDaily=d.UsesDaily;this._daysOption=Number(d.DaysRegistrationOption);this._daysCount=Number(d.DaysRegistrationOptionAmount);this._enabledDaysFlag=Number(d.DaysOfOperationFlag);this._fullSessionOptionFlag=(!$$CM.isNull(b))?b.FullSessionOptionID:0;this._atOrOverCapacityDaysFlag=$$CADU.GetAtOrOverCapacityDaysFlag(b);if(!$$CM.isNull(this._sessionGroupSettings)){this._showDaysFlag=Number(this._sessionGroupSettings.DailyID)}}if(this._usesDaily==true){var c={fieldName:this.GetPathLabel(),daysOption:this._daysOption,daysCount:this._daysCount,enabledDaysFlag:this._enabledDaysFlag,fullSessionOptionFlag:this._fullSessionOptionFlag,atOrOverCapacityDaysFlag:this._atOrOverCapacityDaysFlag,atOrOverCapacityDaysHideOnAppEnabled:this._atOrOverCapacityDaysHideOnAppEnabled,showDaysFlag:this._showDaysFlag};this._ctrDaysOfWeek.BindSettings(c);this._ctrDaysOfWeek.Show(a)}else{this._ctrDaysOfWeek.Hide(a)}}else{this._ctrDaysOfWeek.Hide(a)}},SetEnabled:function(a){},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},Validate:function(a){var b=this.Validator.validate();if(b.IsValid()==true&&this.IsSelected()){if(this._usesDaily==true){var c=this._ctrDaysOfWeek.Validate();b.AppendResult(c)}}if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this.Deselect();this._fddlSeasonSessionProgram.Bind(null)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this._originalData=Object.clone(a);if(this._programAffectsPricing!=true&&this._seasonSessionProgramArray.length>0&&a.ProgramID>0){this._fddlSeasonSessionProgram.Bind(a.ProgramID)}this._inDB=(a.InDB==true);this.Select();this.BindDaysOfWeek(a.DayOfWeekFlagID)}},BindDaysOfWeek:function(a){if(this._usesDaily==true){this._ctrDaysOfWeek.Bind(a);if(this._inDB==true){this._ctrDaysOfWeek.SetDayOfWeekFlagIDInDB(a)}}},GetPathLabel:function(){var a="";if(!$$CM.isEmpty(this._co.tier1Name)){a+=this._co.tier1Name+" - "}if(!$$CM.isEmpty(this._co.tier2Name)){a+=this._co.tier2Name+" - "}if(!$$CM.isEmpty(this._co.tier3Name)){a+=this._co.tier3Name+" - "}a+=this._definition.Name;return a},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}if(this.IsSelected()==true){var b=0;if(this._usesDaily==true){b=this._ctrDaysOfWeek.GetData()}if(b>0){a.DayOfWeekFlagID=b}a.SessionID=this._definition.SessionID;if(this._programAffectsPricing!=true&&this._seasonSessionProgramArray.length>0){a.ProgramID=Number(this._fddlSeasonSessionProgram.GetValue())}}return a}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.PBSeasonSessionProgramConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),definition:new Object(),pricingIdentifierID:0,groupName:"PBSSP_"+$$CM.uniqueID(),pricingSettings:new Object(),pricingRuleArray:$A(),pricingPackageArray:$A(),seasonSessionArray:$A(),capacityResultArray:$A(),tier1Name:""});cm.ui.forms.sessions.PBSeasonSessionProgram=Class.create(cm.ui.ComplexControl,{SelectionChangedEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.sessions.PBSeasonSessionProgramConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="PBSSP_"+$$CM.uniqueID()}this._pricingSettings=new Object();if(!$$CM.isNull(this._co.pricingSettings)){this._pricingSettings=this._co.pricingSettings}this._pricingRuleArray=$A();if(!$$CM.isNull(this._co.pricingRuleArray)&&$$CM.isArray(this._co.pricingRuleArray)){this._pricingRuleArray=this._co.pricingRuleArray;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){this._pricingRuleArray=this._pricingRuleArray.findAll(function(a){return !$$CM.isInteger(a.IdentifierID)||(Number(a.IdentifierID)==Number(this._pricingIdentifierID))},this)}}this._pricingPackageArray=$A();if(!$$CM.isNull(this._co.pricingPackageArray)&&$$CM.isArray(this._co.pricingPackageArray)){this._pricingPackageArray=this._co.pricingPackageArray}this._seasonSessionArray=$A();if(!$$CM.isNull(this._co.seasonSessionArray)&&$$CM.isArray(this._co.seasonSessionArray)){this._seasonSessionArray=this._co.seasonSessionArray}this._capacityResultArray=$A();if(!$$CM.isNull(this._co.capacityResultArray)&&$$CM.isArray(this._co.capacityResultArray)&&this._co.capacityResultArray.length>0){this._capacityResultArray=this._co.capacityResultArray}this._isSelected=false;this._inDB=false},initializeUIElements:function(){this.AddClassName("cmPBSeasonSessionProgram");this._divName=$$P.div("divSSPName_"+this._uniqueID);this.AddChild(this._divName);this._divName.AddClassName("cmPBSeasonSessionProgramName");this._divName.UpdateInnerHtml(this._definition.Name);this._divDescription=$$P.div("divSSPDescription_"+this._uniqueID);this.AddChild(this._divDescription);this._divDescription.AddClassName("cmPBSeasonSessionProgramDescription");if(!$$CM.isEmpty(this._definition.Description)){var b=$$CM.getCMFormattedText(this._definition.Description);this._divDescription.UpdateInnerHtml(b)}else{this._divDescription.Hide()}this._divCustomAdvisory=$$P.div("divSSPCustomAdvisory_"+this._uniqueID);this.AddChild(this._divCustomAdvisory);this._divCustomAdvisory.AddClassName("cmPBSeasonSessionProgramCustomAdvisory");if(this._settings.EnableSessionAdvisory==true&&!$$CM.isEmpty(this._definition.CustomAdvisory)){var a=$$CM.getCMFormattedText(this._definition.CustomAdvisory);this._divCustomAdvisory.UpdateInnerHtml(a)}else{this._divCustomAdvisory.Hide()}this._divItemList=$$P.div("divItemList_"+this._uniqueID);this.AddChild(this._divItemList);this._divItemList.AddClassName("mb10px");this.RenderPricingPackageArray()},RenderPricingPackageArray:function(){this._divItemList.DestroyChildControls(true);this._ctrItemArray=$A();if($$CM.isArray(this._pricingPackageArray)){this._pricingPackageArray.each(function(d){var f=$$CM.uniqueID();var e=this._pricingRuleArray.findAll(function(g){return Number(g.ProgramID)==Number(this._definition.ProgramID)&&Number(g.PackageID)==Number(d.PackageID)},this);var a=this._capacityResultArray.findAll(function(g){return Number(g.ProgramID)==Number(this._definition.ProgramID)},this);if($$CM.isArray(e)&&e.length>0){var c={uniqueID:f,settings:this._settings,pricingSettings:this._pricingSettings,groupName:this._co.groupName,definition:d,programID:this._definition.ProgramID,pricingIdentifierID:this._pricingIdentifierID,pricingRuleArray:e,seasonSessionArray:this._seasonSessionArray,capacityResultArray:a,tier1Name:this._co.tier1Name,tier2Name:this._definition.Name};var b=new cm.ui.forms.sessions.PBPricingPackage("divPBPP_"+f,c);this._divItemList.AddChild(b);this._ctrItemArray.push(b);b.SelectionChangedEvent.subscribe(this.onPricingPackageSelectionChanged,this)}},this)}},createEvents:function($super){$super();this.SelectionChangedEvent=new cm.event()},wireEvents:function($super){$super()},onPricingPackageSelectionChanged:function(c,a){var b=c;this.SelectionChangedEvent.fire(this,{ctrPricingPackage:b,animate:a.animate})},SelectionChanged:function(a){this._isSelected=!this._isSelected},SetEnabled:function(a){},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},Validate:function(a){var b=this.Validator.validate();if(b.IsValid()==true){this._ctrItemArray.each(function(c){var d=c.Validate();b.AppendResult(d)},this)}if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._isSelected=false;this._inDB=false;this._ctrItemArray.each(function(a){a.Bind(null)},this)},onDataUpdated:function(){this.ClearFields();var d=this.GetBoundData();if($$CM.isArray(d)&&d.length>0){var e=d.findAll(function(f){return Number(f.ProgramID)==Number(this._definition.ProgramID)},this);var a=null;this._ctrItemArray.each(function(f){var g=f._definition.NumberOfSessions;if(Number(e.length)<=Number(g)){if($$CM.isNull(a)||Number(f._definition.NumberOfSessions)<Number(a._definition.NumberOfSessions)){a=f}}},this);if(!$$CM.isNull(a)){a.Bind(e)}var c=this._ctrItemArray.find(function(f){return f.IsSelected()==true},this);this._isSelected=!$$CM.isNull(c);var b=this._ctrItemArray.find(function(f){return f.InDB()==true},this);this._inDB=!$$CM.isNull(b)}},GetPathLabel:function(){var a="";if(!$$CM.isEmpty(this._co.tier1Name)){a+=this._co.tier1Name+" - "}a+=this._definition.Name;return a},GetData:function(){var a=$A();this._ctrItemArray.each(function(b){if(b.IsSelected()==true){var c=b.GetData();if(!$$CM.isNull(c)&&$$CM.isArray(c)){c.each(function(d){d.ProgramID=this._definition.ProgramID;a.push(d)},this)}}},this);return a}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.PBSessionGroupConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),sessionGroupSettings:new Object(),definition:new Object(),pricingIdentifierID:0,groupName:"SG_"+$$CM.uniqueID(),pricingSettings:new Object(),pricingRuleArray:$A(),seasonSessionArray:$A()});cm.ui.forms.sessions.PBSessionGroup=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.sessions.PBSessionGroupConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._sessionGroupSettings=new Object();if(!$$CM.isNull(this._co.sessionGroupSettings)){this._sessionGroupSettings=this._co.sessionGroupSettings}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="SG_"+$$CM.uniqueID()}this._co.groupName="PB"+this._co.groupName+"_"+this._definition.ID;this._programDefinitionArray=$A();if(!$$CM.isNull(cm.dao.Lists.Data.ProgramDefinitionArray)&&$$CM.isArray(cm.dao.Lists.Data.ProgramDefinitionArray)){this._programDefinitionArray=cm.dao.Lists.Data.ProgramDefinitionArray}this._pricingPackageArray=$A();if(!$$CM.isNull(cm.dao.Lists.Data.PricingPackageArray)&&$$CM.isArray(cm.dao.Lists.Data.PricingPackageArray)){this._pricingPackageArray=cm.dao.Lists.Data.PricingPackageArray}this._pricingSettings=new Object();this._pricingRuleArray=$A();this._seasonSessionArray=$A();this._seasonSessionProgramArray=$A();this._capacityResultArray=$A();if(!$$CM.isNull(this._definition)){if(!$$CM.isNull(this._definition.PricingSettings)){this._pricingSettings=this._definition.PricingSettings}if(!$$CM.isNull(this._definition.PricingRuleArray)&&$$CM.isArray(this._definition.PricingRuleArray)){this._pricingRuleArray=this._definition.PricingRuleArray;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){this._pricingRuleArray=this._pricingRuleArray.findAll(function(a){return !$$CM.isInteger(a.IdentifierID)||(Number(a.IdentifierID)==Number(this._pricingIdentifierID))},this)}}if(!$$CM.isNull(this._definition.SessionGroupSettings)){this._sessionGroupSettings=this._definition.SessionGroupSettings}if(!$$CM.isNull(this._definition.CapacityResultList)){this._capacityResultList=this._definition.CapacityResultList}if(!$$CM.isNull(this._definition.SeasonSessionArray)&&$$CM.isArray(this._definition.SeasonSessionArray)){this._seasonSessionArray=this._definition.SeasonSessionArray}if(this._seasonSessionArray.length>0){this._seasonSessionArray.each(function(a){var b=a.ProgramArray;if(!$$CM.isNull(b)&&$$CM.isArray(b)){b.each(function(c){var d=this._seasonSessionProgramArray.find(function(e){return Number(e.ProgramID)==Number(c.ProgramID)},this);if($$CM.isNull(d)){this._seasonSessionProgramArray.push(c)}},this)}},this)}if(!$$CM.isNull(this._definition.CapacityResultArray)&&$$CM.isArray(this._definition.CapacityResultArray)){this._capacityResultArray=this._definition.CapacityResultArray}}this._programsAffectPricing=(this._pricingSettings.ProgramsAffectPricing==true);this._mainEntityLabel=(this._programsAffectPricing==true)?"Programs":"Packages";this._collapsedDefault=true;this._isSelected=false;this._inDB=false;this._ctrItemArray=$A()},getApplicablePricingPackageArray:function(){var a=$A();if(!$$CM.isNull(this._pricingSettings)&&!$$CM.isNull(this._pricingSettings.PackageIDArray)&&$$CM.isArray(this._pricingSettings.PackageIDArray)){this._pricingSettings.PackageIDArray.each(function(b){var c=this._pricingPackageArray.find(function(d){return d.PackageID==b},this);if(!$$CM.isNull(c)&&this.isApplicablePricingPackage(c)){a.push(c)}},this)}if($$CM.isArray(a)){a=a.sort($$CM.sortBySortOrder)}return a},isApplicablePricingPackage:function(b){var a=false;if(!$$CM.isNull(b)){if(!$$CM.isNull(this._seasonSessionArray)&&$$CM.isArray(this._seasonSessionArray)){a=(this._seasonSessionArray.length>=b.NumberOfSessions)}}return a},getApplicableSeasonSessionProgramArray:function(){},initializeUIElements:function(){this.AddClassName("cmPBSessionGroup");this._h5Name=$$P.h5("h5PBSGName_"+this._uniqueID);this.AddChild(this._h5Name);if(!$$CM.isEmpty(this._co.definition.Name)){this._h5Name.UpdateInnerHtml(this._definition.Name)}this._pDescription=$$P.p("pPBSGDescription_"+this._uniqueID);this.AddChild(this._pDescription);this._pDescription.AddClassName("mb10px");if(!$$CM.isEmpty(this._definition.Description)){var a=$$CM.getCMFormattedText(this._definition.Description);this._pDescription.UpdateInnerHtml(a)}else{this._pDescription.Hide()}this._divCapacityLegend=$$P.div("divPBSGCapacityLegend_"+this._uniqueID);this.AddChild(this._divCapacityLegend);this._divCapacityLegend.AddClassName("mt0px mb15px");this._divCapacityLegend.Hide();this._spCapacityLegend=$$P.span("spPBSGCapacityLegend_"+this._uniqueID);this._divCapacityLegend.AddChild(this._spCapacityLegend);this._spCapacityLegend.AddClassName("cmAtOrOverCapacity cmItalic");if(this._settings.EnableCapacityLegend==true&&(this._sessionGroupSettings.MasterCapacity>0||this._sessionGroupSettings.CapacityTypeID>1)){if(this._sessionGroupSettings.FullSessionOptionID==2){this._spCapacityLegend.UpdateInnerHtml('Sessions/programs with this icon are at capacity. Applications will be marked as "wait list"')}else{if(this._sessionGroupSettings.FullSessionOptionID==3){this._spCapacityLegend.UpdateInnerHtml('Sessions/programs with this icon are at capacity. Applications will be marked as "applied"')}}}this._divItemList=$$P.div("divItemList_"+this._uniqueID);this.AddChild(this._divItemList);this._divItemList.AddClassName("mb10px");if(this._programsAffectPricing==true){this.RenderSeasonSessionProgramArray()}else{this.RenderPricingPackageArray()}if(this._settings.DisableSessionsExpandCollapse!=true){this.RenderToggleLink()}},RenderPricingPackageArray:function(){this._divItemList.DestroyChildControls(true);this._ctrItemArray=$A();var a=this.getApplicablePricingPackageArray();if($$CM.isArray(a)){a.each(function(e){var g=$$CM.uniqueID();var f=this._pricingRuleArray.findAll(function(h){return Number(h.PackageID)==Number(e.PackageID)},this);var b=this._capacityResultArray;if($$CM.isArray(f)&&f.length>0){var d={uniqueID:g,settings:this._settings,groupName:this._co.groupName,definition:e,pricingIdentifierID:this._pricingIdentifierID,pricingSettings:this._pricingSettings,pricingRuleArray:f,seasonSessionArray:this._seasonSessionArray,capacityResultArray:b,tier1Name:this._definition.Name};var c=new cm.ui.forms.sessions.PBPricingPackage("divPBPP_"+g,d);this._divItemList.AddChild(c);this._ctrItemArray.push(c);c.SelectionChangedEvent.subscribe(this.onPricingPackageSelectionChanged,this)}},this)}},RenderSeasonSessionProgramArray:function(){this._divItemList.DestroyChildControls(true);this._ctrItemArray=$A();if($$CM.isArray(this._seasonSessionProgramArray)){this._seasonSessionProgramArray.each(function(f){var h=$$CM.uniqueID();var d=this._pricingRuleArray.findAll(function(i){return Number(i.ProgramID)==Number(f.ProgramID)},this);var c=this.getApplicablePricingPackageArray();var a=this._capacityResultArray.findAll(function(i){return Number(i.ProgramID)==Number(f.ProgramID)},this);var e=this._seasonSessionArray.findAll(function(i){var k=false;if($$CM.isArray(i.ProgramArray)&&i.ProgramArray.length>=0){var j=i.ProgramArray.find(function(l){return l.ProgramID==f.ProgramID},this);var k=!$$CM.isNull(j)}return k},this);if($$CM.isArray(d)&&d.length>0){var g={uniqueID:h,settings:this._settings,pricingSettings:this._pricingSettings,groupName:this._co.groupName,definition:f,pricingIdentifierID:this._pricingIdentifierID,pricingRuleArray:d,pricingPackageArray:c,seasonSessionArray:e,capacityResultArray:a,tier1Name:this._definition.Name};var b=new cm.ui.forms.sessions.PBSeasonSessionProgram("divPBSSP_"+h,g);this._divItemList.AddChild(b);this._ctrItemArray.push(b);b.SelectionChangedEvent.subscribe(this.onSeasonSessionProgramSelectionChanged,this)}},this)}},RenderToggleLink:function(){this._divToggle=$$P.div();this.AddChild(this._divToggle);this._divToggle.AddClassName("cmFormRow mt0px mb0px");this._aToggle=new $$A("aPBSGToggle_"+this._uniqueID,{text:"Show "+this._mainEntityLabel});this._divToggle.AddChild(this._aToggle);this._aToggle.ClickEvent.subscribe(this.onToggleClicked,this);if(this._collapsedDefault==true){this.Collapse(false)}},SetAsSingleGroup:function(){this._h5Name.Hide();if(!$$CM.isNull(this._divToggle)){this._divToggle.Hide()}this.Expand(false)},wireEvents:function($super){$super()},onPricingPackageSelectionChanged:function(d,a){var b=d;var c=null;this._ctrItemArray.each(function(e){if(e.IsSelected()==true&&e._uniqueID!=b._uniqueID){c=e.GetData();e.Deselect()}},this);b.SelectionChanged(c,a.animate)},onSeasonSessionProgramSelectionChanged:function(e,a){var c=e;var b=a.ctrPricingPackage;var d=null;this._ctrItemArray.each(function(f){f._ctrItemArray.each(function(g){if(g.IsSelected()==true&&g._uniqueID!=b._uniqueID){d=g.GetData();g.Deselect()}},this)},this);b.SelectionChanged(d,a.animate);c.SelectionChanged(d)},onToggleClicked:function(b,a){if(this._isCollapsed){this.Expand(true)}else{this.Collapse(true)}},Collapse:function(a){this._divCapacityLegend.Hide();if(!$$CM.isNull(this._aToggle)){this._aToggle.Hide()}var b={expanded:false,animate:a};this._divItemList.Hide(a,1000,"blind",{direction:"vertical"},this.onAnimationCompleted,this,b);if(a!=true){this.onAnimationCompleted(b)}},Expand:function(a){if(this._settings.EnableCapacityLegend==true&&(this._sessionGroupSettings.MasterCapacity>0||this._sessionGroupSettings.CapacityTypeID>1)){if(this._sessionGroupSettings.FullSessionOptionID==2||this._sessionGroupSettings.FullSessionOptionID==3){this._divCapacityLegend.Show()}}if(!$$CM.isNull(this._aToggle)){this._aToggle.Hide()}var b={expanded:true,animate:a};this._divItemList.Show(a,1000,"blind",{direction:"vertical"},this.onAnimationCompleted,this,{expanded:true,animate:a});if(a!=true){this.onAnimationCompleted(b)}},onAnimationCompleted:function(a){if(!$$CM.isNull(this._aToggle)){if(a.expanded==true){this._isCollapsed=false;this._aToggle.UpdateInnerHtml("Hide "+this._mainEntityLabel)}else{this._isCollapsed=true;this._aToggle.UpdateInnerHtml("Show "+this._mainEntityLabel)}this._aToggle.Show(a.animate)}},onDescriptionShowMoreClicked:function(){var a=this._definition.Description;this._spDescription.UpdateInnerHtml(a);this._lnkDescriptionShowMore.Hide()},onDescriptionShowLessClicked:function(){var a=definition.Description.substring(0,160);this._spDescription.UpdateInnerHtml(a);this._lnkDescriptionShowMore.Show()},IsCollapsed:function(){return this._isCollapsed},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},IsApplicable:function(){var a=($$CM.isArray(this._ctrItemArray)&&this._ctrItemArray.length>0);if(a!=true){this.Hide()}else{this.Show()}return a},Validate:function(a){var b=this.Validator.validate();if(b.IsValid()==true){this._ctrItemArray.each(function(c){var d=c.Validate();b.AppendResult(d)},this)}if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._isSelected=false;this._isinDB=false;this._ctrItemArray.each(function(a){a.Bind(null)},this)},onDataUpdated:function(){this.ClearFields();var d=this.GetBoundData();if($$CM.isArray(d)&&d.length>0){var e=d;var a=null;if(e.length>0){this._ctrItemArray.each(function(f){if(this._programsAffectPricing==true){if($$CM.isNull(a)){var h=f._definition.ID;if(Number(e[0].ProgramID)==Number(h)){a=f}}}else{var g=f._definition.NumberOfSessions;if(Number(e.length)<=Number(g)){if($$CM.isNull(a)||Number(f._definition.NumberOfSessions)<Number(a._definition.NumberOfSessions)){a=f}}}},this);if(!$$CM.isNull(a)){a.Bind(e)}}var c=this._ctrItemArray.find(function(f){return f.IsSelected()==true},this);if(!$$CM.isNull(c)){this._isSelected=true;this.Expand(false)}var b=this._ctrItemArray.find(function(f){return f.InDB()==true},this);if(!$$CM.isNull(b)){this._inDB=true}this.ToggleApplicableControls()}},ToggleApplicableControls:function(){var a=this._ctrItemArray.find(function(b){return b.InDB()==true},this);if(!$$CM.isNull(a)){this._inDB=true;this._ctrItemArray.each(function(b){var c;if(this._programsAffectPricing==true&&b.InDB()!=true){b.Hide()}else{if(Number(b._definition.NumberOfSessions)<Number(a._definition.NumberOfSessions)){b.Hide()}}},this)}},GetData:function(){var a=$A();this._ctrItemArray.each(function(b){if((this._programsAffectPricing!=true&&b.IsSelected()==true)||this._programsAffectPricing==true){var c=b.GetData();if(!$$CM.isNull(c)&&$$CM.isArray(c)){c.each(function(d){d.SessionGroupID=Number(this._definition.ID);a.push(d)},this)}}},this);return a}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.SBSeasonSessionConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),definition:new Object(),pricingIdentifierID:0,groupName:"SBSS_"+$$CM.uniqueID(),pricingSettings:new Object(),pricingRuleArray:$A(),capacityResultArray:$A(),tier1Name:""});cm.ui.forms.sessions.SBSeasonSession=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.sessions.SBSeasonSessionConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="SBSS_"+$$CM.uniqueID()}this._pricingSettings=new Object();if(!$$CM.isNull(this._co.pricingSettings)){this._pricingSettings=this._co.pricingSettings}this._pricingRuleArray=$A();if(!$$CM.isNull(this._co.pricingRuleArray)&&$$CM.isArray(this._co.pricingRuleArray)){this._pricingRuleArray=this._co.pricingRuleArray;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){this._pricingRuleArray=this._pricingRuleArray.findAll(function(a){return !$$CM.isInteger(a.IdentifierID)||(Number(a.IdentifierID)==Number(this._pricingIdentifierID))},this)}}this._seasonSessionProgramArray=$A();if(!$$CM.isNull(this._definition.ProgramArray)&&$$CM.isArray(this._definition.ProgramArray)&&this._definition.ProgramArray.length>0){this._seasonSessionProgramArray=this._definition.ProgramArray}this._capacityResultArray=$A();if(!$$CM.isNull(this._co.capacityResultArray)&&$$CM.isArray(this._co.capacityResultArray)&&this._co.capacityResultArray.length>0){this._capacityResultArray=this._co.capacityResultArray}this._programAffectsPricing=(this._pricingSettings.ProgramsAffectPricing==true);this._isSelected=false;this._inDB=false},getApplicablePricingRule:function(a){var b=null;if(!$$CM.isNull(this._definition)&&!$$CM.isNull(this._pricingRuleArray)&&$$CM.isArray(this._pricingRuleArray)){b=this._pricingRuleArray.find(function(c){return Number(c.SessionID)==Number(this._definition.SessionID)&&(!$$CM.isNumber(a)||!$$CM.isNumber(c.RegistrationDays)||Number(c.RegistrationDays)==Number(a))},this)}return b},getCapacityResult:function(){var a=null;if($$CM.isArray(this._capacityResultArray)){a=this._capacityResultArray.find(function(c){var b=Number(c.SessionID)==Number(this._definition.SessionID);return b},this)}return a},getAtOrOverCapacityCssClass:function(a){var b="";if(this._seasonSessionProgramArray.length<=0&&this._definition.UsesDaily!=true){if(!$$CM.isNull(a)&&a.IsAtOrOverCapacity==true&&(a.PersonIDStatus!=2&&a.PersonIDStatus!=4&&a.PersonIDStatus!=8)){b="cmAtOrOverCapacity"}}return b},getAtOrOverCapacityLabel:function(a){var b="";if(this._seasonSessionProgramArray.length<=0&&this._definition.UsesDaily!=true){if(!$$CM.isNull(a)&&a.IsAtOrOverCapacity==true&&(a.PersonIDStatus!=2&&a.PersonIDStatus!=4&&a.PersonIDStatus!=8)){if(this._settings.EnableCapacityLegend==true&&Number(a.FullSessionOptionID)==2){b=" (Wait List)"}}}return b},initializeUIElements:function(){this.AddClassName("cmSBSeasonSession");var c=this.getCapacityResult();var a=this.getAtOrOverCapacityCssClass(c);var b=this.getAtOrOverCapacityLabel(c);this._divName=$$P.div("divSSName_"+this._uniqueID);this.AddChild(this._divName);this._divName.AddClassName("cmSBSeasonSessionName");var j=this._definition.Name+b;var i="";if(!$$CM.isNull(this._settings)&&this._settings.HideDates!=true){i=$$CM.getFormattedDateRange(this._definition.StartDateAsString,this._definition.EndDateAsString,true,false,true,true,true)}var k="";if(!$$CM.isNull(this._settings)&&this._settings.ShowTimes==true&&this._seasonSessionProgramArray.length<=0){k=$$CM.getFormattedTimeRange(this._definition.StartDateAsString,this._definition.EndDateAsString,false);k="("+k+")"}var l="<span style='font-weight:normal' class='ml5px cmFloatRight'>"+k+"</span><span class='cmFloatRight'>"+i+"</span><span class='input "+a+"'>"+j+"</span>";this._fcbSeasonSession=new $$FCB("fcbSS_"+this._uniqueID,{value:this._definition.ID,label:l,name:this._definition.GroupName});this._divName.AddChild(this._fcbSeasonSession);this._fcbSeasonSession.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this._fcbSeasonSession.GetTitleControl().AddClassName("cmSBSeasonSessionTitle");this._fcbSeasonSession.GetInputControl().AddClassName("pt0px");var e={uniqueID:this._uniqueID,cssWrapper:"cmSBSeasonSessionDaysOfWeek",cssLabel:"cmFloatLeft",cssCheckBoxList:"cmFloatLeft",cssCheckBox:"",settings:this._settings};this._ctrDaysOfWeek=new cm.ui.common.DaysOfWeek("divDaysOfWeek_"+this._uniqueID,e);this.AddChild(this._ctrDaysOfWeek);this._ctrDaysOfWeek.Hide();if(this._seasonSessionProgramArray.length<=0&&this._definition.UsesDaily==true){var m=$$CADU.GetSessionGroupSettings(101,this._definition.SeasonID,this._definition.SessionGroupID);var f={fieldName:this.GetPathLabel(),daysOption:Number(this._definition.DaysRegistrationOption),daysCount:Number(this._definition.DaysRegistrationOptionAmount),enabledDaysFlag:Number(this._definition.DaysOfOperationFlag),fullSessionOptionFlag:(!$$CM.isNull(c))?c.FullSessionOptionID:0,atOrOverCapacityDaysFlag:$$CADU.GetAtOrOverCapacityDaysFlag(c),atOrOverCapacityDaysHideOnAppEnabled:true,showDaysFlag:Number(m.DailyID)};this._ctrDaysOfWeek.BindSettings(f);this._ctrDaysOfWeek.SelectionChangedEvent.subscribe(this.onDaysOfWeekChanged,this);this._ctrDaysOfWeek.Show()}this._divPricingInfo=$$P.div("divSSPricingInfo_"+this._uniqueID);this.AddChild(this._divPricingInfo);this._divPricingInfo.AddClassName("cmSBSeasonSessionFees cmClearfix");this._divPricingInfo.Hide();if(this._seasonSessionProgramArray.length<=0&&this._definition.DaysRegistrationOption!=2){this._pricingRule=this.getApplicablePricingRule();this.RenderPricingRuleDiv(this._pricingRule)}this._divDescription=$$P.div("divSSDescription_"+this._uniqueID);this.AddChild(this._divDescription);this._divDescription.AddClassName("cmSBSeasonSessionDescription");if(!$$CM.isEmpty(this._definition.Description)){var g=$$CM.getCMFormattedText(this._definition.Description);this._divDescription.UpdateInnerHtml(g)}else{this._divDescription.Hide()}this._divCustomAdvisory=$$P.div("divSSCustomAdvisory_"+this._uniqueID);this.AddChild(this._divCustomAdvisory);this._divCustomAdvisory.AddClassName("cmSBSeasonSessionCustomAdvisory");if(this._settings.EnableSessionAdvisory==true&&!$$CM.isEmpty(this._definition.CustomAdvisory)){var d=$$CM.getCMFormattedText(this._definition.CustomAdvisory);this._divCustomAdvisory.UpdateInnerHtml(d)}else{this._divCustomAdvisory.Hide()}this._divSeasonSessionProgramList=$$P.div("divSSPList_"+this._uniqueID);this.AddChild(this._divSeasonSessionProgramList);this._divSeasonSessionProgramList.AddClassName("mt0px");this._divSeasonSessionProgramList.Hide();if(this._seasonSessionProgramArray.length>0){this.RenderSeasonSessionProgramArray(this._seasonSessionProgramArray)}var h=$$P.div();this.AddChild(h);h.AddClassName("cmClear");this.SetEnabled(this._isSelected)},RenderPricingRuleDiv:function(c){this._divPricingInfo.UpdateInnerHtml("");this._divPricingInfo.Hide();var f=false;if(!$$CM.isNull(c)&&(this._settings.EnableSessionCost==true||this._settings.EnableSessionDeposit==true)){var e=$$CADU.GetSeasonLineItemArray(c.SeasonID);var d=$$FDU.GetPricingRuleTuitionAndDeposit(c,e,false,this._settings.EnableSessionCost,this._settings.EnableSessionDeposit,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol);if(!$$CM.isEmpty(d)){this._divPricingInfo.AddChild($$P.span("",d,{classNames:"cmFloatLeft"}));f=true}}if(this._settings.ShowSpaceAvailable==true){var b=this.getCapacityResult();var a="Spaces left: ";if(!$$CM.isNull(b)){if(b.UsesDaily==true){}else{if(!$$CM.isNull(b.Capacity)){a+=b.IsAtOrOverCapacity?0:b.Available}else{}}if(a.length>13){this._divPricingInfo.AddChild($$P.span("spAvailability_"+this._definition.ID,a,{classNames:"cmFloatRight"}));f=true}}}if(f==true&&this._noPricingRuleInDB!=true){this._divPricingInfo.Show()}},RenderSeasonSessionProgramArray:function(b){this._divSeasonSessionProgramList.DestroyChildControls(true);this._ctrItemArray=$A();this._seasonSessionProgramArray=b;var a="SBSSP_"+this._definition.ID+"_"+this._uniqueID;if(this._seasonSessionProgramArray.length>0){this._seasonSessionProgramArray.each(function(f){var h=$$CM.uniqueID();var e=this._pricingRuleArray.findAll(function(i){return Number(i.SessionID)==Number(f.SessionID)&&((this._programAffectsPricing==true&&Number(i.ProgramID)==Number(f.ProgramID))||this._programAffectsPricing!=true)},this);var c=this._capacityResultArray.findAll(function(i){return Number(i.ProgramID)==Number(f.ProgramID)},this);if(e.length>0||f.AssignedToCamper){var g={parent:this,uniqueID:h,settings:this._settings,definition:f,sessionSeason:this._definition,pricingIdentifierID:this._pricingIdentifierID,groupName:a,pricingSettings:this._pricingSettings,pricingRuleArray:e,capacityResultArray:c,tier1Name:this._co.tier1Name,tier2Name:this._definition.Name};var d=new cm.ui.forms.sessions.SBSeasonSessionProgram("divSBSSP_"+h,g);this._divSeasonSessionProgramList.AddChild(d);this._ctrItemArray.push(d);d.SelectionChangedEvent.subscribe(this.onSeasonSessionProgramSelectionChanged,this)}},this)}},wireEvents:function($super){$super();this._fcbSeasonSession.ClickEvent.subscribe(this.onSeasonSessionClicked,this)},onSeasonSessionClicked:function(c,a){if(this._inDB==true){var b=$$SETTINGSDU.GetFormattedCallUsMessage("This camper has already applied for this session.  If you would like to make changes",this._settings.GeneralSettings);b=$$CM.convertToEntityLabelString(b,$$SETTINGSDU.GetEntityLabelSettings());$$CMD.AlertCancel({title:"Error",header:"",message:b});this.Select();return}this._isSelected=!this._isSelected;if(this._isSelected==true){this.Select(true)}else{this.Deselect(true)}},onDaysOfWeekChanged:function(b,a){this.toggleDaysOfWeek()},toggleDaysOfWeek:function(){if(!$$CM.isNull(this._ctrDaysOfWeek)){var c=this._ctrDaysOfWeek.GetDaysOption();if(c==2){var b=this._ctrDaysOfWeek.GetData();var e=this._ctrDaysOfWeek.GetNumberOfDays(b);this._pricingRule=this.getApplicablePricingRule(e);this.RenderPricingRuleDiv(this._pricingRule);this._ctrDaysOfWeek.RemoveErrorClass();if(this._seasonSessionProgramArray.length<=0){var f=this.GetData();var a=null;if($$CM.isArray(f)&&f.length>0){a=f[0]}if(a.InDB==true&&a.PricingRuleID!=this._pricingRule.RuleID){var d=$$SETTINGSDU.GetFormattedCallUsMessage("You may not change the number of days for <b>"+this.GetPathLabel()+"</b> due to price changes.  If you would like to add more days",this._settings.GeneralSettings);$$CMD.AlertCancel({title:"Important Note",header:"",message:d});this._ctrDaysOfWeek.AddErrorClass()}}}}},onSeasonSessionProgramSelectionChanged:function(c,a){var b=c;this._ctrItemArray.each(function(d){if(d.IsSelected()==true&&d._uniqueID!=b._uniqueID){d.Deselect()}},this)},Select:function(a){this._isSelected=true;this._divName.RemoveClassName("cmCustomValidationError");if(this._seasonSessionProgramArray.length>0){this._divSeasonSessionProgramList.Show(a)}this._fcbSeasonSession.Bind(this._isSelected);this._fcbSeasonSession.RemoveClassName("cmSelected");this._fcbSeasonSession.AddClassName("cmSelected");this.SetEnabled(this._isSelected);if(this._seasonSessionProgramArray.length==1){this._ctrItemArray[0].Select()}},Deselect:function(a){this._isSelected=false;this._inDB=false;this._divName.RemoveClassName("cmCustomValidationError");if(this._seasonSessionProgramArray.length>0){this._divSeasonSessionProgramList.Hide(a)}this._fcbSeasonSession.Bind(this._isSelected);this._fcbSeasonSession.RemoveClassName("cmSelected");this.SetEnabled(this._isSelected)},SetEnabled:function(a){this._ctrDaysOfWeek.ToggleSettings(true);this._ctrDaysOfWeek.ToggleEnabledState(a)},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},IsApplicable:function(){var a=true;if(this._seasonSessionProgramArray.length>0){a=($$CM.isArray(this._ctrItemArray)&&this._ctrItemArray.length>0)}if(a!=true){this.Hide()}else{this.Show()}return a},Validate:function(e){var f=this.Validator.validate();if(f.IsValid()==true&&this.IsSelected()){var d=this.GetData();if(this._seasonSessionProgramArray.length>0){if(d.length<=0){var c="You must select a program or uncheck <b>"+this.GetPathLabel()+"</b>.";var i=new cm.validation.ValidationResult("",null);i.AddError(c);f.AppendResult(i);this._divName.AddClassName("cmCustomValidationError")}else{if(this._ctrItemArray.length>0){this._ctrItemArray.each(function(j){var k=j.Validate();f.AppendResult(k)},this)}}}else{if(this._definition.UsesDaily==true){var g=this._ctrDaysOfWeek.Validate();f.AppendResult(g);var b=this._ctrDaysOfWeek.GetDaysOption();if(b==2){var a=null;if($$CM.isArray(d)&&d.length>0){a=d[0]}if(!$$CM.isNull(a)&&a.InDB==true&&a.PricingRuleID!=this._pricingRule.RuleID){var c=$$SETTINGSDU.GetFormattedCallUsMessage("You may not change the number of days for <b>"+this.GetPathLabel()+"</b> due to price changes.  If you would like to add more days",this._settings.GeneralSettings);var h=new cm.validation.ValidationResult("",null);h.AddError(c);f.AppendResult(h);this._ctrDaysOfWeek.AddErrorClass()}else{this._ctrDaysOfWeek.RemoveErrorClass()}}}}}if(e==true){this.Validator.ShowErrors(f)}return f},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this.Deselect();if(this._seasonSessionProgramArray.length>0){this._ctrItemArray.each(function(a){a.Bind(null)},this)}},onDataUpdated:function(){this.ClearFields();var c=this.GetBoundData();if($$CM.isArray(c)&&c.length>0){if(this._seasonSessionProgramArray.length>0){this._ctrItemArray.each(function(e){var f=c.find(function(g){return Number(g.SessionID)==Number(e._definition.SessionID)&&Number(g.ProgramID)==Number(e._definition.ProgramID)},this);e.Bind(f);if(!$$CM.isNull(f)){this._statusID=f.StatusID}},this);var a=this._ctrItemArray.find(function(e){return e.InDB()==true},this);this._inDB=!$$CM.isNull(a);this.Select();if(this._inDB==true){var b=this._ctrItemArray.find(function(e){return e.IsSelected()==true},this);if(!$$CM.isNull(b)){this._ctrItemArray.each(function(e){if(e.IsSelected()!=true){e._selectable=false}},this)}}}else{var d=c.find(function(e){return Number(e.SessionID)==Number(this._definition.SessionID)},this);if(!$$CM.isNull(d)){this._statusID=d.StatusID;this._inDB=(d.InDB==true);this._noPricingRuleInDB=(d.InDB==true&&d.PricingRuleID<=0);this.Select();if(this._definition.UsesDaily==true){this._ctrDaysOfWeek.Bind(d.DayOfWeekFlagID);if(this._inDB==true){this._ctrDaysOfWeek.SetDayOfWeekFlagIDInDB(d.DayOfWeekFlagID)}this.toggleDaysOfWeek()}if(this._noPricingRuleInDB==true){this._divPricingInfo.Hide()}}}}},GetPathLabel:function(){var a="";if(!$$CM.isEmpty(this._co.tier1Name)){a+=this._co.tier1Name+" - "}a+=this._definition.Name;return a},GetData:function(){var b=$A();var a=this.GetBoundData();var c=0;if(this._definition.UsesDaily==true){c=this._ctrDaysOfWeek.GetData()}if(this._seasonSessionProgramArray.length>0){this._ctrItemArray.each(function(e){if(e.IsSelected()==true){var f=e.GetData();b.push(f)}},this)}else{var d=null;var a=this.GetBoundData();if($$CM.isArray(a)){d=a.find(function(e){return Number(e.SessionID)==Number(this._definition.SessionID)},this)}if($$CM.isNull(d)){d=new Object()}d.SessionID=this._definition.SessionID;if(!$$CM.isNull(this._pricingRule)){if(this._inDB!=true&&this._noPricingRuleInDB!=true){d.PricingRuleID=this._pricingRule.RuleID}}if(c>0){d.DayOfWeekFlagID=c}b.push(d)}return b}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.SBSeasonSessionProgramConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),definition:new Object(),pricingIdentifierID:0,groupName:"SBSSP_"+$$CM.uniqueID(),pricingSettings:new Object(),pricingRuleArray:$A(),capacityResultArray:$A(),tier1Name:"",tier2Name:""});cm.ui.forms.sessions.SBSeasonSessionProgram=Class.create(cm.ui.ComplexControl,{SelectionChangedEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.sessions.SBSeasonSessionProgramConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._parent=new Object();if(!$$CM.isNull(this._co.parent)){this._parent=this._co.parent}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._sessionSeason=new Object();if(!$$CM.isNull(this._co.sessionSeason)){this._sessionSeason=this._co.sessionSeason}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="SBSSP_"+$$CM.uniqueID()}this._pricingSettings=new Object();if(!$$CM.isNull(this._co.pricingSettings)){this._pricingSettings=this._co.pricingSettings}this._pricingRuleArray=$A();if(!$$CM.isNull(this._co.pricingRuleArray)&&$$CM.isArray(this._co.pricingRuleArray)){this._pricingRuleArray=this._co.pricingRuleArray;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){this._pricingRuleArray=this._pricingRuleArray.findAll(function(a){return !$$CM.isInteger(a.IdentifierID)||(Number(a.IdentifierID)==Number(this._pricingIdentifierID))},this)}}this._capacityResultArray=$A();if(!$$CM.isNull(this._co.capacityResultArray)&&$$CM.isArray(this._co.capacityResultArray)){this._capacityResultArray=this._co.capacityResultArray}this._programAffectsPricing=(this._pricingSettings.ProgramsAffectPricing==true);this._selectable=true;this._isSelected=false;this._inDB=false},getApplicablePricingRule:function(a){var b=null;if(!$$CM.isNull(this._definition)&&!$$CM.isNull(this._pricingRuleArray)&&$$CM.isArray(this._pricingRuleArray)){b=this._pricingRuleArray.find(function(d){var c=Number(d.SessionID)==Number(this._definition.SessionID);if(this._programAffectsPricing==true){c=Number(d.ProgramID)==Number(this._definition.ProgramID)&&(!$$CM.isNumber(a)||!$$CM.isNumber(d.RegistrationDays)||Number(d.RegistrationDays)==Number(a))}return c},this)}return b},getCapacityResult:function(){var a=null;if($$CM.isArray(this._capacityResultArray)){a=this._capacityResultArray.find(function(c){var b=Number(c.SessionID)==Number(this._definition.SessionID)&&Number(c.ProgramID)==Number(this._definition.ProgramID);return b},this)}return a},getAtOrOverCapacityCssClass:function(a){var b="";if(this._definition.UsesDaily!=true){if(!$$CM.isNull(a)&&a.IsAtOrOverCapacity==true&&(a.PersonIDStatus!=2&&a.PersonIDStatus!=4&&a.PersonIDStatus!=8)){b="cmAtOrOverCapacity"}}return b},getAtOrOverCapacityLabel:function(a){var b="";if(this._definition.UsesDaily!=true){if(!$$CM.isNull(a)&&a.IsAtOrOverCapacity==true&&(a.PersonIDStatus!=2&&a.PersonIDStatus!=4&&a.PersonIDStatus!=8)){if(this._settings.EnableCapacityLegend==true&&Number(a.FullSessionOptionID)==2){b=" (Wait List)"}}}return b},initializeUIElements:function(){this.AddClassName("cmSBSeasonSessionProgram");var c=this.getCapacityResult();var a=this.getAtOrOverCapacityCssClass(c);var b=this.getAtOrOverCapacityLabel(c);this._divName=$$P.div("divSSPName_"+this._uniqueID);this.AddChild(this._divName);this._divName.AddClassName("cmSBSeasonSessionProgramName");var j=this._definition.Name+b;var i="";if(!$$CM.isNull(this._settings)&&this._settings.HideDates!=true){i=$$CM.getFormattedDateRange(this._definition.StartDateAsString,this._definition.EndDateAsString,true,false,true,true,true)}var k="";if(!$$CM.isNull(this._settings)&&this._settings.ShowTimes==true){k=$$CM.getFormattedTimeRange(this._definition.StartDateAsString,this._definition.EndDateAsString,false);k="("+k+")"}var l="<span style='font-weight:normal' class='ml5px cmFloatRight'>"+k+"</span><span class='cmFloatRight'>"+i+"</span><span class='input "+a+"'>"+j+"</span>";this._fcbSeasonSessionProgram=new $$FCB("fcbSSP_"+this._uniqueID,{value:this._definition.ID,label:l,name:this._definition.GroupName});this._divName.AddChild(this._fcbSeasonSessionProgram);this._fcbSeasonSessionProgram.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this._fcbSeasonSessionProgram.GetTitleControl().AddClassName("cmSBSeasonSessionProgramTitle");this._fcbSeasonSessionProgram.GetInputControl().AddClassName("pt0px");var e={uniqueID:this._uniqueID,cssWrapper:"cmSBSeasonSessionProgramDaysOfWeek",cssLabel:"cmFloatLeft",cssCheckBoxList:"cmFloatLeft",cssCheckBox:"",settings:this._settings};this._ctrDaysOfWeek=new cm.ui.common.DaysOfWeek("divSBSeasonSessionProgramDaysOfWeek_"+this._uniqueID,e);this.AddChild(this._ctrDaysOfWeek);if(this._definition.UsesDaily==true){var m=$$CADU.GetSessionGroupSettings(101,this._sessionSeason.SeasonID,this._sessionSeason.SessionGroupID);var f={fieldName:this.GetPathLabel(),daysOption:Number(this._definition.DaysRegistrationOption),daysCount:Number(this._definition.DaysRegistrationOptionAmount),enabledDaysFlag:Number(this._definition.DaysOfOperationFlag),fullSessionOptionFlag:(!$$CM.isNull(c))?c.FullSessionOptionID:0,atOrOverCapacityDaysFlag:$$CADU.GetAtOrOverCapacityDaysFlag(c),atOrOverCapacityDaysHideOnAppEnabled:true,showDaysFlag:Number(m.DailyID)};this._ctrDaysOfWeek.BindSettings(f);this._ctrDaysOfWeek.SelectionChangedEvent.subscribe(this.onDaysOfWeekChanged,this)}else{this._ctrDaysOfWeek.Hide()}this._divPricingInfo=$$P.div("divSSPPricingInfo_"+this._uniqueID);this.AddChild(this._divPricingInfo);this._divPricingInfo.AddClassName("cmSBSeasonSessionProgramFees cmClearfix");this._divPricingInfo.Hide();if(this._definition.DaysRegistrationOption!=2||this._programAffectsPricing!=true){this._pricingRule=this.getApplicablePricingRule();this.RenderPricingRuleDiv(this._pricingRule)}this._divDescription=$$P.div("divSSPDescription_"+this._uniqueID);this.AddChild(this._divDescription);this._divDescription.AddClassName("cmSBSeasonSessionProgramDescription");if(!$$CM.isEmpty(this._definition.Description)){var g=$$CM.getCMFormattedText(this._definition.Description);this._divDescription.UpdateInnerHtml(g)}else{this._divDescription.Hide()}this._divCustomAdvisory=$$P.div("divSSPCustomAdvisory_"+this._uniqueID);this.AddChild(this._divCustomAdvisory);this._divCustomAdvisory.AddClassName("cmSBSeasonSessionProgramCustomAdvisory");if(this._settings.EnableSessionAdvisory==true&&!$$CM.isEmpty(this._definition.CustomAdvisory)){var d=$$CM.getCMFormattedText(this._definition.CustomAdvisory);this._divCustomAdvisory.UpdateInnerHtml(d)}else{this._divCustomAdvisory.Hide()}var h=$$P.div();this.AddChild(h);h.AddClassName("cmClear")},RenderPricingRuleDiv:function(c){this._divPricingInfo.UpdateInnerHtml("");this._divPricingInfo.Hide();var f=false;if(!$$CM.isNull(c)&&(this._settings.EnableSessionCost==true||this._settings.EnableSessionDeposit==true)){var e=$$CADU.GetSeasonLineItemArray(c.SeasonID);var d=$$FDU.GetPricingRuleTuitionAndDeposit(c,e,false,this._settings.EnableSessionCost,this._settings.EnableSessionDeposit,cm.dao.Settings.Data.FinancialSettings.CurrencySymbol);if(!$$CM.isEmpty(d)){this._divPricingInfo.AddChild($$P.span("",d,{classNames:"cmFloatLeft"}));f=true}}if(this._settings.ShowSpaceAvailable==true){var b=this.getCapacityResult();var a="Spaces left: ";if(!$$CM.isNull(b)){if(b.UsesDaily==true){}else{if(!$$CM.isNull(b.Capacity)){a+=b.IsAtOrOverCapacity?0:b.Available}else{}}if(a.length>13){this._divPricingInfo.AddChild($$P.span("spAvailability_"+this._definition.ID,a,{classNames:"cmFloatRight"}));f=true}}}if(f==true&&this._noPricingRuleInDB!=true){this._divPricingInfo.Show()}},createEvents:function($super){$super();this.SelectionChangedEvent=new cm.event()},wireEvents:function($super){$super();this._fcbSeasonSessionProgram.ClickEvent.subscribe(this.onSeasonSessionProgramClicked,this)},onSeasonSessionProgramClicked:function(f,a){if(this._inDB==true||this._selectable!=true){var d="";var c=this._settings.GeneralSettings;if(!$$CM.isNull(c)){if(!$$CM.isNull(c.ContactPhoneNumber)&&!$$CM.isEmpty(c.ContactPhoneNumber.Number)){d+=" call us at "+c.ContactPhoneNumber.Number}if(!$$CM.isNull(c.ContactEmailAddress)&&!$$CM.isEmpty(c.ContactEmailAddress.Email)){d+=' or email us at <a target="_self" href=\'mailto:'+c.ContactEmailAddress.Email+"'>"+c.ContactEmailAddress.Email+"</a>"}}if(d.length>0){d="If you would like to make changes, please"+d+"."}else{d="If you would like to make changes, please call us at camp."}if(this._inDB==true){d="This camper has already applied for this session program.  "+d;this.Select()}else{if(this._selectable!=true){var e="registered in";if(this._parent._statusID==4){e="applied for"}else{if(this._parent._statusID==8){e="waitlisted in"}}d="This camper is already "+e+" another program in this session.  "+d;this.Deselect()}}d=$$CM.convertToEntityLabelString(d,$$SETTINGSDU.GetEntityLabelSettings());var b={title:"Error",header:"",message:d};$$CMD.AlertCancel(b);return}this._isSelected=!this._isSelected;if(this._isSelected==true){this.Select()}else{this.Deselect()}this.SetEnabled(this._isSelected);this.SelectionChangedEvent.fire(this,{})},onDaysOfWeekChanged:function(b,a){this.toggleDaysOfWeek()},toggleDaysOfWeek:function(){if(!$$CM.isNull(this._ctrDaysOfWeek)){var c=this._ctrDaysOfWeek.GetDaysOption();if(c==2){var b=this._ctrDaysOfWeek.GetData();var e=this._ctrDaysOfWeek.GetNumberOfDays(b);this._pricingRule=this.getApplicablePricingRule(e);this.RenderPricingRuleDiv(this._pricingRule);var a=this.GetData();if(a.InDB==true&&a.PricingRuleID!=this._pricingRule.RuleID){var d=$$SETTINGSDU.GetFormattedCallUsMessage("You may not change the number of days for <b>"+this.GetPathLabel()+"</b> due to price changes.  If you would like to add more days",this._settings.GeneralSettings);$$CMD.AlertCancel({title:"Important Note",header:"",message:d});this._ctrDaysOfWeek.AddErrorClass()}else{this._ctrDaysOfWeek.RemoveErrorClass()}}}},Select:function(){this._isSelected=true;this._fcbSeasonSessionProgram.Bind(this._isSelected);this._divName.RemoveClassName("cmSelected");this._divName.AddClassName("cmSelected");this.SetEnabled(this._isSelected)},Deselect:function(){this._isSelected=false;this._fcbSeasonSessionProgram.Bind(this._isSelected);this._divName.RemoveClassName("cmSelected");this.SetEnabled(this._isSelected)},SetEnabled:function(a){this._ctrDaysOfWeek.ToggleSettings(true);this._ctrDaysOfWeek.ToggleEnabledState(a)},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},Validate:function(d){var e=this.Validator.validate();if(e.IsValid()==true&&this.IsSelected()){if(this._definition.UsesDaily==true){var f=this._ctrDaysOfWeek.Validate();e.AppendResult(f);var b=this._ctrDaysOfWeek.GetDaysOption();if(b==2){var a=this.GetData();if(a.InDB==true&&a.PricingRuleID!=this._pricingRule.RuleID){var c=$$SETTINGSDU.GetFormattedCallUsMessage("You may not change the number of days for <b>"+this.GetPathLabel()+"</b> due to price changes.  If you would like to add more days",this._settings.GeneralSettings);var g=new cm.validation.ValidationResult("",null);g.AddError(c);e.AppendResult(g);this._ctrDaysOfWeek.AddErrorClass()}else{this._ctrDaysOfWeek.RemoveErrorClass()}}}}if(d==true){this.Validator.ShowErrors(e)}return e},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this.Deselect()},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this._inDB=(a.InDB==true);this._noPricingRuleInDB=(a.InDB==true&&a.PricingRuleID<=0);this.Select();if(this._definition.UsesDaily==true){this._ctrDaysOfWeek.Bind(a.DayOfWeekFlagID);if(this._inDB==true){this._ctrDaysOfWeek.SetDayOfWeekFlagIDInDB(a.DayOfWeekFlagID)}this.toggleDaysOfWeek()}if(this._noPricingRuleInDB==true){this._divPricingInfo.Hide()}}},GetPathLabel:function(){var a="";if(!$$CM.isEmpty(this._co.tier1Name)){a+=this._co.tier1Name+" - "}if(!$$CM.isEmpty(this._co.tier2Name)){a+=this._co.tier2Name+" - "}a+=this._definition.Name;return a},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}var b=0;if(this._definition.UsesDaily==true){b=this._ctrDaysOfWeek.GetData()}a.SessionID=this._definition.SessionID;a.ProgramID=this._definition.ProgramID;if(!$$CM.isNull(this._pricingRule)){if(this._inDB!=true&&this._noPricingRuleInDB!=true){a.PricingRuleID=this._pricingRule.RuleID}}if(b>0){a.DayOfWeekFlagID=b}return a}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.SBSessionGroupConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),sessionGroupSettings:new Object(),definition:new Object(),pricingIdentifierID:0,groupName:"SG_"+$$CM.uniqueID()});cm.ui.forms.sessions.SBSessionGroup=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.sessions.SBSessionGroupConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._sessionGroupSettings=new Object();if(!$$CM.isNull(this._co.sessionGroupSettings)){this._sessionGroupSettings=this._co.sessionGroupSettings}this._definition=new Object();if(!$$CM.isNull(this._co.definition)){this._definition=this._co.definition}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}if($$CM.isEmpty(this._co.groupName)){this._co.groupName="SG_"+$$CM.uniqueID()}this._co.groupName="PB"+this._co.groupName+"_"+this._definition.ID;this._pricingSettings=new Object();this._pricingRuleArray=$A();this._seasonSessionArray=$A();this._capacityResultArray=$A();if(!$$CM.isNull(this._definition)){if(!$$CM.isNull(this._definition.PricingSettings)){this._pricingSettings=this._definition.PricingSettings}if(!$$CM.isNull(this._definition.PricingRuleArray)&&$$CM.isArray(this._definition.PricingRuleArray)){this._pricingRuleArray=this._definition.PricingRuleArray;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){this._pricingRuleArray=this._pricingRuleArray.findAll(function(a){return !$$CM.isInteger(a.IdentifierID)||(Number(a.IdentifierID)==Number(this._pricingIdentifierID))},this)}}if(!$$CM.isNull(this._definition.SessionGroupSettings)){this._sessionGroupSettings=this._definition.SessionGroupSettings}if(!$$CM.isNull(this._definition.SeasonSessionArray)&&$$CM.isArray(this._definition.SeasonSessionArray)){this._seasonSessionArray=this._definition.SeasonSessionArray}if(!$$CM.isNull(this._definition.CapacityResultArray)&&$$CM.isArray(this._definition.CapacityResultArray)){this._capacityResultArray=this._definition.CapacityResultArray}}this._collapsedDefault=true;this._isCollapsed=false;this._ctrItemArray=$A();this._sessionLabel="session";if(!$$CM.isNull(this._settings)&&!$$CM.isNull(this._settings.SessionLabel)&&$$CM.isString(this._settings.SessionLabel)){this._sessionLabel=this._settings.SessionLabel}this._showText="Show Sessions";this._hideText="Hide Sessions";this._showText=this.replaceSessionWithSessionLabel(this._showText);this._hideText=this.replaceSessionWithSessionLabel(this._hideText)},replaceSessionWithSessionLabel:function(a){return a.replace(/session/ig,this._sessionLabel)},initializeUIElements:function(){this.AddClassName("cmSBSessionGroup");this._h5Name=$$P.h5("h5SGName_"+this._uniqueID);this.AddChild(this._h5Name);if(!$$CM.isEmpty(this._co.definition.Name)){this._h5Name.UpdateInnerHtml(this._definition.Name)}this._pDescription=$$P.p("pSGDescription_"+this._uniqueID);this.AddChild(this._pDescription);this._pDescription.AddClassName("mb10px");if(!$$CM.isEmpty(this._definition.Description)){var a=$$CM.getCMFormattedText(this._definition.Description);this._pDescription.UpdateInnerHtml(a)}else{this._pDescription.Hide()}this._divCapacityLegend=$$P.div("divSGCapacityLegend_"+this._uniqueID);this.AddChild(this._divCapacityLegend);this._divCapacityLegend.AddClassName("mt0px mb15px");this._divCapacityLegend.Hide();this._spCapacityLegend=$$P.span("spSGCapacityLegend_"+this._uniqueID);this._divCapacityLegend.AddChild(this._spCapacityLegend);this._spCapacityLegend.AddClassName("cmAtOrOverCapacity cmItalic");if(this._settings.EnableCapacityLegend==true&&(this._sessionGroupSettings.MasterCapacity>0||this._sessionGroupSettings.CapacityTypeID>1)){if(this._sessionGroupSettings.FullSessionOptionID==2){this._spCapacityLegend.UpdateInnerHtml('Sessions/programs with this icon are at capacity. Applications will be marked as "wait list"')}else{if(this._sessionGroupSettings.FullSessionOptionID==3){this._spCapacityLegend.UpdateInnerHtml('Sessions/programs with this icon are at capacity. Applications will be marked as "applied"')}}}this._divSeasonSessionList=$$P.div("divSSList_"+this._uniqueID);this.AddChild(this._divSeasonSessionList);this._divSeasonSessionList.AddClassName("mtb0px");this.RenderSeasonSessionArray(this._seasonSessionArray);var b=$$P.div();this.AddChild(b);b.AddClassName("cmClear mb10px");if(this._settings.DisableSessionsExpandCollapse!=true){this.RenderToggleLink()}},RenderSeasonSessionArray:function(b){this._divSeasonSessionList.DestroyChildControls(true);this._ctrItemArray=$A();this._seasonSessionArray=b;var a="SBSS_"+this._uniqueID;if($$CM.isArray(this._seasonSessionArray)){this._seasonSessionArray.each(function(f){var h=$$CM.uniqueID();var e=this._pricingRuleArray.findAll(function(i){return Number(i.SessionID)==Number(f.SessionID)},this);var c=this._capacityResultArray.findAll(function(i){return Number(i.SessionID)==Number(f.SessionID)},this);if(e.length>0||f.AssignedToCamper){var g={uniqueID:h,settings:this._settings,groupName:a,definition:f,pricingIdentifierID:this._pricingIdentifierID,pricingSettings:this._pricingSettings,pricingRuleArray:e,capacityResultArray:c,tier1Name:this._definition.Name};var d=new cm.ui.forms.sessions.SBSeasonSession("divSBSS_"+h,g);if(d.IsApplicable()==true){this._divSeasonSessionList.AddChild(d);this._ctrItemArray.push(d)}}},this)}},RenderToggleLink:function(){this._divToggle=$$P.div();this.AddChild(this._divToggle);this._divToggle.AddClassName("cmFormRow mt0px mb0px");this._aToggle=new $$A("aSGToggle_"+this._uniqueID,{text:this._showText});this._divToggle.AddChild(this._aToggle);this._aToggle.ClickEvent.subscribe(this.onToggleClicked,this);if(this._collapsedDefault==true){this.Collapse(false)}},SetAsSingleGroup:function(){this._h5Name.Hide();if(!$$CM.isNull(this._divToggle)){this._divToggle.Hide()}this.Expand(false)},onToggleClicked:function(b,a){if(this._isCollapsed){this.Expand(true)}else{this.Collapse(true)}},Collapse:function(a){this._divCapacityLegend.Hide();if(!$$CM.isNull(this._aToggle)){this._aToggle.Hide()}var b={expanded:false,animate:a};this._divSeasonSessionList.Hide(a,1000,"blind",{direction:"vertical"},this.onAnimationCompleted,this,b);if(a!=true){this.onAnimationCompleted(b)}},Expand:function(a){if(this._settings.EnableCapacityLegend==true&&(this._sessionGroupSettings.MasterCapacity>0||this._sessionGroupSettings.CapacityTypeID>1)){if(this._sessionGroupSettings.FullSessionOptionID==2||this._sessionGroupSettings.FullSessionOptionID==3){this._divCapacityLegend.Show()}}if(!$$CM.isNull(this._aToggle)){this._aToggle.Hide()}var b={expanded:true,animate:a};this._divSeasonSessionList.Show(a,1000,"blind",{direction:"vertical"},this.onAnimationCompleted,this,b);if(a!=true){this.onAnimationCompleted(b)}},onAnimationCompleted:function(a){if(!$$CM.isNull(this._aToggle)){if(a.expanded==true){this._isCollapsed=false;this._aToggle.UpdateInnerHtml(this._hideText)}else{this._isCollapsed=true;this._aToggle.UpdateInnerHtml(this._showText)}this._aToggle.Show(a.animate)}},onDescriptionShowMoreClicked:function(){var a=this._definition.Description;this._spDescription.UpdateInnerHtml(a);this._lnkDescriptionShowMore.Hide()},onDescriptionShowLessClicked:function(){var a=definition.Description.substring(0,160);this._spDescription.UpdateInnerHtml(a);this._lnkDescriptionShowMore.Show()},IsCollapsed:function(){return this._isCollapsed},IsSelected:function(){return this._isSelected},InDB:function(){return this._inDB},IsApplicable:function(){var a=($$CM.isArray(this._ctrItemArray)&&this._ctrItemArray.length>0);if(a!=true){this.Hide()}else{this.Show()}return a},Validate:function(a){var b=this.Validator.validate();if(b.IsValid()==true){this._ctrItemArray.each(function(c){var d=c.Validate();b.AppendResult(d)},this)}if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._isSelected=false;this._inDB=false;this._ctrItemArray.each(function(a){a.Bind(null)},this)},onDataUpdated:function(){this.ClearFields();var c=this.GetBoundData();if($$CM.isArray(c)&&c.length>0){this._ctrItemArray.each(function(d){var e=c.findAll(function(f){return Number(f.SessionID)==Number(d._definition.SessionID)},this);d.Bind(e)},this);var b=this._ctrItemArray.find(function(d){return d.IsSelected()==true},this);if(!$$CM.isNull(b)){this._isSelected=true;this.Expand(false)}var a=this._ctrItemArray.find(function(d){return d.InDB()==true},this);if(!$$CM.isNull(a)){this._inDB=true}}},GetData:function(){var a=$A();this._ctrItemArray.each(function(b){if(b.IsSelected()==true){var c=b.GetData();if(!$$CM.isNull(c)&&$$CM.isArray(c)){c.each(function(d){d.SessionGroupID=Number(this._definition.ID);a.push(d)},this)}}},this);return a}});"cm.ui.forms.sessions".namespace();cm.ui.forms.sessions.SessionSelectorConfigOptions=Class.create(cm.ConfigOptions,{settings:new Object(),existingStatus:0,legendLabel:"Sessions",legendCssClass:"",sectionMessage:"",sectionMessageCssClass:"",camperData:new Object(),pricingIdentifierID:0,applicableSessionGroupArray:$A(),seasonSessionArray:$A(),sessionGroupSettingsArray:$A(),enrollmentSessionGroupArray:$A(),pricingRuleArray:$A()});cm.ui.forms.sessions.SessionSelector=Class.create(cm.ui.ComplexControl,{configureDefaultOptions:function(){return new cm.ui.forms.sessions.SessionSelectorConfigOptions()},initializeDAOs:function($super){$super();this._formsDAO=new cm.dao.Forms.DAO();this._settingsDAO=new cm.dao.Settings.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=new Object();if(!$$CM.isNull(this._co.settings)){this._settings=this._co.settings}this._enumFullSessionOptions=this._settingsDAO.GetEnum("FullSessionOptions");this._entityLabelSettings=$$SETTINGSDU.GetEntityLabelSettings();this._camperData=null;if(!$$CM.isNull(this._co.camperData)){this._camperData=this._co.camperData}this._pricingIdentifierID=0;if($$CM.isNumber(this._co.pricingIdentifierID)&&this._co.pricingIdentifierID>0){this._pricingIdentifierID=this._co.pricingIdentifierID}this._sessionGroupArray=this._co.sessionGroupArray;if((!$$CM.isNull(this._sessionGroupArray)||this._sessionGroupArray.length<=0)){this._sessionGroupArray=$$CADU.GetSessionGroupArray()}this._pricingTableSettingsArray=$A();if(!$$CM.isNull(this._co.pricingTableSettingsArray)&&$$CM.isArray(this._co.pricingTableSettingsArray)){this._pricingTableSettingsArray=this._co.pricingTableSettingsArray}this._pricingRuleArray=$A();if(!$$CM.isNull(this._co.pricingRuleArray)&&$$CM.isArray(this._co.pricingRuleArray)){this._pricingRuleArray=this._co.pricingRuleArray}this._seasonSessionArray=$A();if(!$$CM.isNull(this._co.seasonSessionArray)&&$$CM.isArray(this._co.seasonSessionArray)){this._seasonSessionArray=this._co.seasonSessionArray}this._sessionGroupSettingsArray=$A();if(!$$CM.isNull(this._co.sessionGroupSettingsArray)&&$$CM.isArray(this._co.sessionGroupSettingsArray)){this._sessionGroupSettingsArray=this._co.sessionGroupSettingsArray}this._enrollmentSessionGroupArray=$A();if(!$$CM.isNull(this._co.enrollmentSessionGroupArray)&&$$CM.isArray(this._co.enrollmentSessionGroupArray)){this._enrollmentSessionGroupArray=this._co.enrollmentSessionGroupArray}this._pricingIdentifierLabel="Pricing Identifier";this._pricingIdentifierArray=$A();if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){if(!$$CM.isNull(cm.dao.Lists.Data.PricingIdentifierLabelArray)&&$$CM.isArray(cm.dao.Lists.Data.PricingIdentifierLabelArray)){var a=cm.dao.Lists.Data.PricingIdentifierLabelArray;this._pricingIdentifierLabel=a[0]}this._pricingIdentifierArray=$$CADU.GetPricingIdentifierArray(this._settings.SeasonSessionGroupSettingsList)}this._sessionLabel="session";if(!$$CM.isNull(this._settings)&&!$$CM.isNull(this._settings.SessionLabel)&&$$CM.isString(this._settings.SessionLabel)){this._sessionLabel=this._settings.SessionLabel}this._ctrItemArray=$A()},isApplicablePricingTableSettings:function(d){var a=false;if(!$$CM.isNull(d)){if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){var b=d.IdentifierArray;if($$CM.isArray(b)&&b.length>0){var c=b.find(function(e){return Number(e)==Number(this._pricingIdentifierID)},this);if($$CM.isNumber(c)&&c>0){a=true}}else{a=true}}else{a=true}}return a},getApplicablePricingRules:function(b){var a=$A();if(!$$CM.isNull(this._pricingRuleArray)&&$$CM.isArray(this._pricingRuleArray)){a=this._pricingRuleArray.findAll(function(c){return c.SessionGroupID==Number(b)&&this.isApplicablePricingRule(c)},this)}return a},isApplicablePricingRule:function(b){var a=false;if(!$$CM.isNull(b)){if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){a=$$CM.isNull(b.IdentifierID)||(Number(b.IdentifierID)==Number(this._pricingIdentifierID))}else{a=true}}return a},getApplicableSeasonSessionArray:function(b){var a=$A();if(!$$CM.isNull(this._seasonSessionArray)&&$$CM.isArray(this._seasonSessionArray)){a=this._seasonSessionArray.findAll(function(e){if(e.SessionGroupID==Number(b)){var d=false;if($$CM.isArray(e.ProgramArray)&&e.ProgramArray.length>0){var c=e.ProgramArray.findAll(function(f){return f.OnlineFormEnabled},this);return c.length>0}else{return e.OnlineFormEnabled}}else{return false}},this)}return a},getCapacityResultArray:function(e,f,d){var b=$A();var c=this._enrollmentSessionGroupArray.find(function(g){return Number(g.SessionGroupID)==Number(e)},this);var a=this._camperData;if(!$$CM.isNull(c)&&!$$CM.isNull(f)&&$$CM.isArray(d)){d.each(function(h){var g=$$CADU.GetSessionProgramSeasonCapacityList(h,c,f,a);if(g.length>0){g.each(function(i){b.push(i)},this)}},this)}return b},initializeUIElements:function(){this._fsSelector=new $$FS("fsSS_"+this._uniqueID,{legendLabel:this._co.legendLabel,legendCssClass:this._co.legendCssClass});this.AddChild(this._fsSelector);if(!$$CM.isEmpty(this._co.sectionMessage)){var b=$$CM.convertToEntityLabelString(this._co.sectionMessage,this._entityLabelSettings);this._ctrSectionMessage=new cm.ui.forms.SectionMessage("divSSSectionMessage_"+this._uniqueID,{message:b,cssClass:"cmClear mt0px mb15px"});this._fsSelector.AddChild(this._ctrSectionMessage);if(!$$CM.isEmpty(this._co.sectionMessageCssClass)){this._ctrSectionMessage.AddClassName(this._co.sectionMessageCssClass)}}this._divPricingIdentifier=$$P.div("divPricingIdentifier_"+this._uniqueID);this._fsSelector.AddChild(this._divPricingIdentifier);this._fddlPricingIdentifier=new $$FDDL("fddlPricingIdentifier_"+this._uniqueID,{label:this._pricingIdentifierLabel,isRequired:false,inputWidth:160});this._divPricingIdentifier.AddChild(this._fddlPricingIdentifier);this._fddlPricingIdentifier.AddClassName("cmFloatLeft w100prct mb5px");this._fddlPricingIdentifier.GetInputControl().AddClassName("w160px");this._fddlPricingIdentifier.GetTitleControl().AssignStyle("width","auto !important");this._divPricingIdentifierSeparator=$$P.hr();this._divPricingIdentifier.AddChild(this._divPricingIdentifierSeparator);this._divSessionGroupList=$$P.div("divSGList_"+this._uniqueID);this._fsSelector.AddChild(this._divSessionGroupList);if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true&&this._pricingIdentifierArray.length>0){this._fddlPricingIdentifier.bindList(this._pricingIdentifierArray,"","Select");this._fddlPricingIdentifier.Validator.addEvaluator($$EVAL.SELECT({FieldName:this._pricingIdentifierLabel,IsRequired:true}));this._divPricingIdentifier.Show();this._fddlPricingIdentifier.Bind(this._pricingIdentifierID);this.onPricingIdentifierChanged(this._fddlPricingIdentifier,{})}else{this._divPricingIdentifier.Hide();var a=this.GetApplicableSessionGroupArray();this.RenderApplicableSessionGroupArray(a)}},validateCapacityResult:function(b,d,c){var a=b.find(function(e){var f=false;if(Number(d)>0){f=Number(e.SessionID)==Number(d);if(f==true&&Number(c)>0){f=Number(e.ProgramID)==Number(c)}}if(f==true){if(e.UsesDaily==true){f=(e.AreDaysAvailable==true);if(f!=true){f=$$CADU.PersonIDStatusCheck(e)}}else{f=(e.IsAtOrOverCapacity!=true);if(f!=true){f=$$CADU.PersonIDStatusCheck(e)}}}return f},this);return !$$CM.isNull(a)},getSeasonSessionArrayFilteredByCapacity:function(c,a){var b=$A();if($$CM.isArray(c)&&c.length>0){if($$CM.isArray(a)&&a.length>0){c.each(function(f){var g=f.ProgramArray;if($$CM.isArray(g)&&g.length>0){var e=$A();g.each(function(i){if(this.validateCapacityResult(a,i.SessionID,i.ProgramID)){var h=Object.clone(i);e.push(h)}},this);if(e.length>0){var d=Object.clone(f);d.ProgramArray=e;b.push(d)}}else{if(this.validateCapacityResult(a,f.SessionID,null)){var d=Object.clone(f);b.push(d)}}},this)}else{b=c}}return b},GetApplicableSessionGroupArray:function(){var a=$A();if($$CM.isArray(this._sessionGroupSettingsArray)){this._sessionGroupSettingsArray.each(function(l){var k=Number(l.SessionGroupID);var e=a.find(function(m){return Number(m.ID)==Number(k)},this);if($$CM.isNull(e)){var j=this._sessionGroupArray.find(function(m){return Number(m.ID)==Number(k)},this);var h=this._pricingTableSettingsArray.find(function(m){return Number(m.SessionGroupID)==Number(k)},this);if($$CM.isNull(h)){h={SessionBased:true,ProgramsAffectPricing:false}}if(!$$CM.isNull(j)){var b=this.getApplicablePricingRules(k);var c=this.getApplicableSeasonSessionArray(k);var f=(l.MasterCapacity>0||l.CapacityTypeID>1);var g=$A();g=this.getCapacityResultArray(k,l,c);var i=$A();if(l.FullSessionOptionID==1&&(f==true||($$CM.isArray(g)&&g.length>0))){i=this.getSeasonSessionArrayFilteredByCapacity(c,g)}else{i=c}if(c.length>0){var d=Object.clone(j);d.SessionGroupSettings=l;d.SeasonSessionGroup=l;d.PricingSettings=Object.clone(h);d.PricingRuleArray=b;d.SeasonSessionArray=i;d.CapacityResultArray=g;a.push(d)}}}},this)}if($$CM.isArray(a)){a=a.sort($$CM.sortByNameProperty)}return a;var a=$A();if($$CM.isArray(this._pricingTableSettingsArray)){this._pricingTableSettingsArray.each(function(g){if(this.isApplicablePricingTableSettings(g)){var l=a.find(function(m){return Number(m.ID)==Number(g.SessionGroupID)},this);if($$CM.isNull(l)){var i=this._sessionGroupArray.find(function(m){return Number(m.ID)==Number(g.SessionGroupID)},this);if(!$$CM.isNull(i)){var j=Number(i.ID);var k=this._sessionGroupSettingsArray.find(function(m){return Number(m.SessionGroupID)==j},this);var b=this.getApplicablePricingRules(j);var c=this.getApplicableSeasonSessionArray(j);var e=(k.MasterCapacity>0||k.CapacityTypeID>1);var f=$A();if(e==true){f=this.getCapacityResultArray(j,k,c)}var h=$A();if(k.FullSessionOptionID==1&&e==true){h=this.getSeasonSessionArrayFilteredByCapacity(c,f)}else{h=c}if(b.length>0&&c.length>0){var d=Object.clone(i);d.SessionGroupSettings=k;d.PricingSettings=Object.clone(g);d.PricingRuleArray=b;d.SeasonSessionArray=h;d.CapacityResultArray=f;a.push(d)}}}}},this)}if($$CM.isArray(a)){a=a.sort($$CM.sortByNameProperty)}return a},RenderApplicableSessionGroupArray:function(a){this._divSessionGroupList.DestroyChildControls(true);this._ctrItemArray=$A();this._applicableSessionGroupArray=a;this._applicableSessionGroupArray=this._applicableSessionGroupArray.sort($$CM.sortBySortOrder);if($$CM.isArray(this._applicableSessionGroupArray)){var b="SG_"+this._uniqueID;this._applicableSessionGroupArray.each(function(c){var f=$$CM.uniqueID();var d=null;var e=c.PricingSettings;if(!$$CM.isNull(e)){if(e.SessionBased==true){d=new cm.ui.forms.sessions.SBSessionGroup("divSBSG_"+f,{settings:this._settings,uniqueID:f,groupName:b,definition:c,pricingIdentifierID:this._pricingIdentifierID})}else{if(e.PackageIDArray.length>0){d=new cm.ui.forms.sessions.PBSessionGroup("divPBSG_"+f,{settings:this._settings,uniqueID:f,groupName:b,definition:c,pricingIdentifierID:this._pricingIdentifierID})}}}if(!$$CM.isNull(d)&&d.IsApplicable()==true){this._divSessionGroupList.AddChild(d);this._ctrItemArray.push(d)}},this);if(this._applicableSessionGroupArray.length==1){this._ctrItemArray.each(function(c){c.SetAsSingleGroup()},this)}}},wireEvents:function($super){$super();this._fddlPricingIdentifier.ChangeEvent.subscribe(this.onPricingIdentifierChanged,this)},onPricingIdentifierChanged:function(g,b){var c=this.GetData();var e=this._fddlPricingIdentifier.GetData();if($$CM.isNumber(e)){e=parseInt(e,10)}else{e=0}this._pricingIdentifierID=e;if(this._pricingIdentifierID>0){this._divSessionGroupList.Show();var a=this.GetApplicableSessionGroupArray();this.RenderApplicableSessionGroupArray(a);if(a.length==0){var d={title:"Alert",header:"",message:"There are no sessions that match this applicant's age, grade, or gender information. Please contact us with any questions you may have.",width:500};$$CMD.Alert(d)}}else{this._divSessionGroupList.Hide()}var f=$A();if(!$$CM.isNull(c)&&$$CM.isArray(c.SessionAssignmentArray)&&c.SessionAssignmentArray.length>0){f=c.SessionAssignmentArray}if(!$$CM.isNull(this._originalData)&&$$CM.isArray(this._originalData.SessionAssignmentArray)&&this._originalData.SessionAssignmentArray.length>0){this._originalData.SessionAssignmentArray.each(function(h){var i=f.find(function(j){return j.SessionID==h.SessionID&&((!$$CM.isInteger(j.ProgramID)&&!$$CM.isInteger(h.ProgramID))||j.ProgramID==h.ProgramID)},this);if($$CM.isNull(i)){f.push(h)}},this)}this.BindSessionAssignmentArray(f)},BindSessionAssignmentArray:function(b){this._ctrItemArray.each(function(c){c.Bind(null)},this);if($$CM.isArray(b)&&b.length>0){b=b.findAll(function(c){return c.IsDeleted!=true});this._ctrItemArray.each(function(c){var d=$A();b.each(function(e){var f=c._seasonSessionArray.find(function(g){return Number(g.SessionID)==Number(e.SessionID)},this);if(!$$CM.isNull(f)){d.push(e)}},this);c.Bind(d)},this);if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){var a=this._ctrItemArray.find(function(c){return c.InDB()==true},this);if(!$$CM.isNull(a)){this._fddlPricingIdentifier.SetEnabled(false)}}}},IsApplicable:function(){var b=($$CM.isArray(this._ctrItemArray)&&this._ctrItemArray.length>0);if(b==true){var a=this._ctrItemArray.find(function(c){return c.IsApplicable()==true},this);b=!$$CM.isNull(a)}return b},Validate:function(g){var h=new cm.validation.ValidationResult("",null);this._ctrItemArray.each(function(j){var k=j.Validate();h.AppendResult(k)},this);var a=this.GetData();var e=a.SessionAssignmentArray;if(this._settings.EnableSessionOverlap!=true&&e.length>0){var i=$$CADU.ValidateSessionAssignmentsOverlap(e,this._seasonSessionArray);h.AppendResult(i)}var f=this._settings.SessionSelectionLimit;if(f>0&&e.length>f){h.AddError("You may only select a maximum of "+f+" session"+((f==1)?"":"s"))}if(h.IsValid()==true){if(e.length>0){if(this._settings.DoNotRequireSessionChange!=true){var c=$A();if(!$$CM.isNull(this._originalData)&&$$CM.isArray(this._originalData.SessionAssignmentArray)){c=this._originalData.SessionAssignmentArray}var d=$$CADU.SessionAssignmentsChanged(c,e);if(d!=true){var b=$$SETTINGSDU.GetFormattedCallUsMessage("You must select at least one new session.  If you are trying to change a session you are already enrolled in",this._settings.GeneralSettings);h.AddError(b)}}}else{h.AddError("You must select at least one session")}}if(g==true){this.Validator.ShowErrors(h)}return h},replaceSessionWithSessionLabel:function(a){return a.replace(/session/ig,this._sessionLabel)},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){this._fddlPricingIdentifier.Bind()}this._ctrItemArray.each(function(a){a.Bind(null)},this)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this._originalData=Object.clone(a);if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true&&$$CM.isNumber(a.PricingIdentifierID)){this._fddlPricingIdentifier.Bind(a.PricingIdentifierID);this.onPricingIdentifierChanged(this,{})}else{this.BindSessionAssignmentArray(a.SessionAssignmentArray)}}},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true&&$$CM.isInteger(this._fddlPricingIdentifier.GetData())){a.PricingIdentifierID=parseInt(this._fddlPricingIdentifier.GetData())}var c=$A();if($$CM.isArray(a.SessionAssignmentArray)){c=a.SessionAssignmentArray.findAll(function(d){return d.InDB==true},this)}var b=$A();this._ctrItemArray.each(function(d){var e=d.GetData();if(!$$CM.isNull(e)&&$$CM.isArray(e)){e.each(function(f){if(!$$CM.isNull(this._camperData)){f.PersonID=this._camperData.PersonID}f.IsDeleted=false;b.push(f);var g=c.find(function(i){var h=Number(f.SessionID)==Number(i.SessionID)&&Number(f.ProgramID)==Number(i.ProgramID);if(h==true){h=i.PricingRuleID>0&&f.PricingRuleID>0&&Number(i.PricingRuleID)!=Number(f.PricingRuleID)}return h},this);if(!$$CM.isNull(g)){g.IsDeleted=true;b.push(g)}},this)}},this);if($$CM.isArray(c)&&c.length>0){c.each(function(e){var d=b.find(function(f){return Number(f.PricingRuleID)==Number(e.PricingRuleID)&&Number(f.SessionID)==Number(e.SessionID)&&Number(f.ProgramID)==Number(e.ProgramID)},this);if($$CM.isNull(d)){b.push(e)}},this)}a.SessionAssignmentArray=b;return a}});