"cm.ui.framework".namespace();cm.ui.framework.Environment=Class.create({LS_STATE_ISOPEN:"fwDebug:IsOpen",_messages:$A(),_modules:$A(),_debuggerDialog:null,ReadyEvent:null,LogEvent:null,OpenDebugger:function(){if(Framework.Debug==true){if($$CM.isNull(this._debuggerDialog)){this._debuggerDialog=new cm.ui.dialog.Dialog(null,{dialogClass:"cmFrameworkDebugger",title:"Framework Debug",width:820,height:600});this._debuggerDialog.ShowEvent.subscribe(this.onDebuggerShow,this);this._debuggerDialog.HideEvent.subscribe(this.onDebuggerHide,this);$$PAGE.Body.AddChild(this._debuggerDialog);var a=new cm.ui.framework.module.debug.Debugger("fwDebugger");this._debuggerDialog.AddChild(a)}this._debuggerDialog.Show()}},AddMessage:function(a){this._messages.push(a);this.log("A message was added to the buffer")},FlushMessages:function(){if(this._messages.length>0){DAO.Framework.SendMessages({__FWMSG:this._messages},{wait:false});this._messages=$A();this.log("Message buffer flushed")}},FlushMessagesTo:function(a){a.__FWMSG=$$CM.deepClone(this._messages);this._messages=$A();this.log("Message buffer flushed")},GetModule:function(a){return this._modules.find(function(b){return b.ID==a||b.Name==a})},ListenForMessages:function(a,b,c){this.log("["+c.Name+"] Listening for messages of type '"+a+"'");this.MessageEvents.get("m_"+a).subscribe(b,c)},initialize:function(){this._ready=false;this._ls=new cm.browser.LocalStorage();this.LogEvent=new cm.event();this.ReadyEvent=new cm.event()},start:function(){if(this._ready!=true){this.log("Building modules...");this.buildModules()}},log:function(b,c){var a=null;if(this._ls.IsSupported()==true){a=this._ls.GetValueAsObject(this.LS_KEY_LOGGING)}if(!$$CM.isNull(c)&&$$CM.isObject(c)&&$$CM.isFunction(c.GetName)){c=c.GetName()}else{c="Core"}if(Framework.Debug==true){console.log("["+c+"] "+b)}this.LogEvent.fire(this,{Source:c,Message:b,Level:0})},error:function(a,b,c){if(!$$CM.isNull(c)&&$$CM.isObject(c)&&$$CM.isFunction(c.GetName)){c=c.GetName()}else{c="Core"}this.LogEvent.fire(this,{Source:c,Message:b,Level:2});console.error(a.message+"\n"+a.stack)},buildModules:function(){this._modules=$A();for(var b in cm.ui.framework.module){if($$CM.isFunction(cm.ui.framework.module[b])){var a=new cm.ui.framework.module[b](b);a.Name=b;this[b]=a;this._modules.push(a);a.onCreated();this.log("Module added: "+b)}}this.Core.Start();this._modules.remove(this.Core);this._modules.each(function(c){var e=this.Modules.find(function(g){return g.Name==c.Name});c.ID=e.ID;c.Version=e.Version;if(e.Enabled==true){c.ReadyEvent.subscribe(this.checkModulesReady,this);c.Start()}else{c.IsReady=true;if(Prototype.Browser.IE!=true){var d=this;this.__defineGetter__(e.Name,function(){throw"["+c.Name+"] This module is disabled"});var f=c.getProxyNamespaces();f.each(function(g){g.Scope.__defineGetter__(g.Property,function(){throw"["+c.Name+"] This module is disabled"})},this)}this.checkModulesReady()}},this)},checkModulesReady:function(){if($$CM.isNull(this._modules.find(function(a){return(a.IsReady!=true)}))){if(Framework.Debug!=true){delete __FWHEADERS;this.OpenDebugger=null;cm.ui.framework.Debugger=null}this.log("Framework started!");this._ready=true;this.ReadyEvent.fire(this)}},constant:function(env,name,val){env=env.toUpperCase().replaceAll(" ","_");name=name.toUpperCase().replaceAll(" ","_");eval(env+"_"+name+" = val")},broadcast:function(b,a){if($$CM.isArray(b)){b.each(function(d){var c=JSON.parse(d);this.MessageEvents.get("m_"+c.Type).fire(JSON.parse(c.Message))},this)}},onDebuggerShow:function(b,a){new cm.browser.LocalStorage().SetValue(this.LS_STATE_ISOPEN,true)},onDebuggerHide:function(b,a){new cm.browser.LocalStorage().SetValue(this.LS_STATE_ISOPEN,false)}});cm.ui.Control.prototype.destroyEvents=function(){};window.FW=window.Framework=new cm.ui.framework.Environment();delete cm.ui.framework.Environment;$(document).stopObserving("dom:loaded",____onCMEnvironmentLoad);____onCMEnvironmentLoad=function(){Framework.ReadyEvent.subscribe(function(){CMEnvironmentLoadEvent.fire(window);if(Prototype.Browser.IE!=true&&Framework.Debug==true){setTimeout(function(){var a=new $$BTN("btnDebug",{classNames:"cmEditButton p5px",text:"FW Debug"});a.Hide();a.ClickEvent.subscribe(Framework.OpenDebugger,Framework);$$PAGE.Body.AddChild(a);$$JQ(a).show("fade",{duration:200});var b=new cm.browser.LocalStorage();if(b.GetValue(FW.LS_STATE_ISOPEN)=="true"){FW.OpenDebugger()}},1000)}},window);Framework.start()};$(document).observe("dom:loaded",____onCMEnvironmentLoad);"cm.ui.framework".namespace();cm.ui.framework.Module=Class.create({LS_KEY:"",ID:-1,Name:"",Version:null,LogMute:false,IsReady:false,ReadyEvent:null,UpdateEvent:null,initialize:function(a){this._ls=new cm.browser.LocalStorage();this.Name=a;this.LS_KEY="fwModSettings_"+this.Name;this.IsReady=false;this.LogMute=false;this.ReadyEvent=new cm.event();this.UpdateEvent=new cm.event()},GetName:function(){return this.Name},Start:function(){this.buildSettings();this.log("'"+this.Name+"' is starting...");this.onStart();var a=this.getHeaders();if(!$$CM.isNull(a)){a.Value.each(function(b){b.Value.each(function(c){this.bindHeader(b.Key,c)},this)},this)}this.log("Unpacked headers for "+this.Name);this.onHeadersLoaded()},Ready:function(){this.IsReady=true;this.log("'"+this.Name+"' is ready!");this.ReadyEvent.fire(this)},SetLogMute:function(a){this.LogMute=a},SetConfig:function(a){for(var b in a){this.Config[b]=a[b]}},CreateMessage:function(b,a){FW.AddMessage({Type:b,Message:$$CM.stringify(a)})},getHeaders:function(){return __FWHEADERS.find(function(a){return a.Key==this.Name},this)},bindHeader:function(c,b){if($$CM.isArray(this[c])){var a=JSON.parse(b);if($$CM.isArray(a)){a.each(function(d){var e=this[c].find(function(f){return $$CM.stringify(f)==$$CM.stringify(d)},this);if($$CM.isNull(e)){this[c].push(d)}},this)}else{this[c]=this[c].concat(a)}}else{this[c]=JSON.parse(b)}},poll:function(a){return $A()},log:function(a){if(FW.Debug==true&&this._settings.Logging==true){Framework.log(a,this)}},error:function(a,b){Framework.error(a,b,this)},buildSettings:function(){var a=FW._modules.find(function(b){return b.Name==this.Name},this);this.ID=a.ID;this.updateSettings()},updateSettings:function(){this._settings=this._ls.GetValueAsObject(this.LS_KEY);if($$CM.isNull(this._settings)){this._settings={Logging:Framework.Debug}}},getProxyNamespaces:function(){return $A()},onCreated:function(){},onStart:function(){},onHeadersLoaded:function(){},toString:function(){return this.Name}});