"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.AppConfigOptions=Class.create(cm.ui.forms.application.ApplicationBaseConfigOptions,{controllerDataProperty:"PersonFormArray",mvcController:"application/Camper",seasonID:0,formID:101,registrationLockMode:10001,FINANCIAL_MVC1:2097152});cm.ui.forms.application.camper.App=Class.create(cm.ui.forms.application.ApplicationBase,{isGoogleAnalyticsLoaded:false,googlePageTracker:null,iFrameGoogle:null,iFrameYahoo:null,iFrameMicrosoft:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.AppConfigOptions()},initializeGoogleAnalytics:function(){$$GAT.initializeGAT(true)},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO();this._settingsDAO=new cm.dao.Settings.DAO();this._listsDAO=new cm.dao.Lists.DAO();this._camperDAO=new cm.dao.Camper.DAO();this._commonDAO=new cm.dao.Common.DAO();this._maintenanceDAO=new cm.dao.Maintenance.DAO();this._formsDAO=this.GetControllerDAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();this._maintenanceDAO.MaintenanceMessageFetch();this._submitLock=false;this._userTypeFlag=cm.dao.Security.Enums.UserTypeFlag.asEnum();this._daysOfWeekFlag=this._listsDAO.GetEnum("DaysOfWeek");this.FINANCIAL_MVC1=2097152;this._versionBranch=$$CLIENT.VersionBranch;this._isFinancialMVC1=(this._versionBranch&this.FINANCIAL_MVC1)==this.FINANCIAL_MVC1;this._clientSettings=$$SETTINGSDU.GetClientSettings();this._clientGeneralSettings=$$SETTINGSDU.GetClientGeneralSettings();this._camperSettings=$$SETTINGSDU.GetCamperSettings();this._financialSettings=$$SETTINGSDU.GetFinancialSettings();this._entityLabelSettings=$$SETTINGSDU.GetEntityLabelSettings();this._v3FinancialSeasonID=0;if(!$$CM.isNull(this._clientSettings)){this._v3FinancialSeasonID=Number(this._clientSettings.V3FinancialSeasonID)}this._test="test";this._existingStatus=1;this._applicationStatus=0;this._saveForLaterEnabled=true;this._showInstructionsAtStart=false;if($$CM.GetQueryStringParam("noInstructions")!="true"){this._showInstructionsAtStart=true}this._seasonID=this._co.seasonID;var a=Number($$CM.GetQueryStringParam("seasonID"));if(a>0){this._seasonID=a}this._formID=this._co.formID;this._seasonArray=$A();if($$CM.isArray(cm.dao.Settings.Data.CamperApplicationSeasonArray)){this._seasonArray=cm.dao.Settings.Data.CamperApplicationSeasonArray}this._page0A_Applicable=(this._seasonArray.length<=0||this._seasonArray.length>1);this._sessionGroupArray=$A();if(!$$CM.isNull(cm.dao.Lists.Data.SessionGroupArray)&&$$CM.isArray(cm.dao.Lists.Data.SessionGroupArray)){this._sessionGroupArray=cm.dao.Lists.Data.SessionGroupArray}this._pageNameEnum=null;if($$CM.isArray(cm.dao.Forms.Enums.PageName)){this._pageNameEnum=cm.dao.Forms.Enums.PageName.asEnum()}this._cmDivModals=$$P.div("divModals");this.AddChild(this._cmDivModals);this._accountLoginSessionExpired=new cm.ui.forms.AccountLoginSessionExpired("AccountLoginSessionExpired");this._accountLoginSessionExpired.LoginSessionExpiredEvent.subscribe(this.onAccountLoginSessionExpired_Login,this);this._accountLoginSessionExpired.CloseSessionExpiredEvent.subscribe(this.onAccountLoginSessionExpired_Close,this);this._accountLoginSessionExpired.ResetAccountSessionExpiredEvent.subscribe(this.onAccountLoginSessionExpired_ResetAccount,this);this._accountLoginSessionExpiredDialog=new cm.ui.dialog.ModalDialog("AccountLoginSessionExpiredDialog",{title:"Account Login",width:350,draggable:false,dialogClass:"cmGoDialog"});this._cmDivModals.AddChild(this._accountLoginSessionExpiredDialog);this._accountLoginSessionExpiredDialog.AddChild(this._accountLoginSessionExpired);this._camperData=null;this._family1=null;this._family2=null;this._saveForLaterInit=null;this._seasonSessionList=$A();this._sessionGroupSettingsList=$A();this._seasonHoldGroupSettings=new Object()},initializeUIElements:function(){this._divSubHeader=$$P.div("divSubHeader");this.AddChild(this._divSubHeader);this._divSubHeader.AddClassName("hd");this._divTitle=$$P.div("divTitle");this._divSubHeader.AddChild(this._divTitle);this._divTitle.AssignStyle("width","450px");this._divTitle.AssignStyle("display","inline-block");var a=$$P.h4("HeadingTitle");this._divTitle.AddChild(a);a.AddClassName("cmPageHeader");var g=$$CM.convertToEntityLabelString("Camper Application",cm.dao.Settings.Data.EntityLabelSettings);try{g=cm.dao.Forms.Data.Forms[101].FormName}catch(c){}a.UpdateInnerHtml(g);a.AssignStyle("border","0");this._divTicketMaster=$$P.div("divTimer");this._divSubHeader.AddChild(this._divTicketMaster);this._divTicketMaster.AssignStyle("display","inline-block");this._divTicketMaster.AssignStyle("float","right");this._ctrHoldGroupTokenTimer=new $$TIMER("holdGroupTokenTimer",{durationInMinutes:0,startNow:false});this._divTicketMaster.AddChild(this._ctrHoldGroupTokenTimer);this._ctrHoldGroupTokenTimer.Hide();this._divInfoLinks=$$P.div("divInfoLinks");this.AddChild(this._divInfoLinks);this._divInfoLinks.Hide();this._divInfoLinksLeft=$$P.div("divInfoLinksLeft");this._divInfoLinks.AddChild(this._divInfoLinksLeft);this._divInfoLinksLeft.AddClassName("cmFloatLeft");this._divCamperShortInfo=$$P.div("divShortInfo");this._divInfoLinksLeft.AddChild(this._divCamperShortInfo);this._divCamperShortInfo.AddClassName("cmSubtle");this._divInfoLinksRight=$$P.div("divInfoLinksRight");this._divInfoLinks.AddChild(this._divInfoLinksRight);this._divInfoLinksRight.AddClassName("cmFloatRight");this._aInstructions=new $$A("aInstructions",{text:"Instructions"});this._divInfoLinksRight.AddChild(this._aInstructions);this._aInstructions.UpdateInnerHtml("Instructions");var b=$$P.div();this.AddChild(b);b.AddClassName("cmClear");this._divLoading=$$P.div("divLoading");this.AddChild(this._divLoading);this._divLoading.AddClassName("mt20px mb20px");var d="";var f="";if(!$$CM.isEmpty(cm.hosts.common)){f=cm.hosts.common}d=f+"/common/lib/core/ui/common/images/loading.gif";this._imgLoading=$$P.img();this._imgLoading.SetAttribute("src",d);this._divLoading.UpdateInnerHtml("Preparing your application...");this._divLoading.AddChild(this._imgLoading);this._divLoading.AddClassName("cmExpand");this._divWrapper=$$P.div("divWrapper");this.AddChild(this._divWrapper);this._divWrapper.AddClassName("w100prct mt20px mb10px");this._divWrapper.Hide();this._divMessageWrapper=$$P.div("divMessageWrapper");this.AddChild(this._divMessageWrapper);this._divMessageWrapper.Hide();this.iFrameGoogle=$$P.iframe("iFrameGoogle","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameGoogle);this.iFrameGoogle.Hide();this.iFrameYahoo=$$P.iframe("iFrameYahoo","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameYahoo);this.iFrameYahoo.Hide();this.iFrameMicrosoft=$$P.iframe("iFrameMicrosoft","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameMicrosoft);this.iFrameMicrosoft.Hide();switch($$CLIENT.ID){case 532:$$CLIENT.gtm="GTM-TVQWVD";break;case 534:$$CLIENT.gtm="GTM-MJ7FMX";break;case 637:$$CLIENT.gtm="GTM-PPWQBF";break;case 835:$$CLIENT.gtm="GTM-5L678V";break;case 191:$$CLIENT.gtm="GTM-TJ5PTJN";break;case 830:$$CLIENT.gtm="GTM-WFJ994";break;case 258:$$CLIENT.gtm="GTM-TNVHPWH";break;case 742:$$CLIENT.gtm="GTM-TNVHPWH";break}this._dataLayerProp="dataLayer";function e(p,k,o,h,m){p[h]=p[h]||[];p[h].push({"gtm.start":new Date().getTime(),event:"gtm.js"});var l=k.getElementsByTagName(o)[0],n=k.createElement(o),i=h!="dataLayer"?"&l="+h:"";n.async=false;n.src="https://www.googletagmanager.com/gtm.js?id="+m+i;l.parentNode.insertBefore(n,l)}e(window,document,"script",this._dataLayerProp,$$CLIENT.gtm)},wireEvents:function($super){$super();this._securityDAO.LoginEmailChecked.subscribe(this.onLoginEmailChecked,this);this._securityDAO.UserSessionValidated.subscribe(this.onUserSessionValidated,this);this._securityDAO.UserSessionRetrieved.subscribe(this.onUserSessionRetrieved,this);this._securityDAO.CITUserLoggedIn.subscribe(this.onCITUserLoggedIn,this);this._securityDAO.UserInviteCITUserV3Sent.subscribe(this.onUserInviteCITUserV3Sent,this);this._maintenanceDAO.MaintenanceMessageReceivedEvent.subscribe(this.onMaintenanceMessage_received,this);this._camperDAO.FamilyInfoFetchedEvent.subscribe(this.onFamilyInfoFetched,this);this._commonDAO.TokenizedTimestampFetchedEvent.subscribe(this.onTokenizedTimestampFetched,this);this._commonDAO.HoldGroupTokenFetchedEvent.subscribe(this.onHoldGroupTokenFetched,this);this._commonDAO.HoldGroupTokenDeletedEvent.subscribe(this.onHoldGroupTokenDeleted,this);this._formsDAO.CamperRegistrationLockFetchedEvent.subscribe(this.onCamperRegistrationLockFetched,this);this._aInstructions.ClickEvent.subscribe(this.onInstructionsClicked,this);this._ctrHoldGroupTokenTimer.TimeRemainingEvent.subscribe(this.onHoldGroupTokenTimeRemaining,this);this._ctrHoldGroupTokenTimer.ExpiredEvent.subscribe(this.onHoldGroupTokenExpired,this)},fetchCamperRegistrationLock:function(){var a={};a.objectID=this._familyID;a.seasonID=this._seasonID;a.registrationLockMode=this._co.registrationLockMode;this._formsDAO.CamperRegistrationLockFetch(a)},onCamperRegistrationLockFetched:function(c,a){var b=this;setTimeout(function(){b.fetchCamperRegistrationLock()},30000)},onLoginEmailCheck:function(m,a){var b=m;var g=b.GetData();var c=this.GetData();this._personFormData=c;var h=$A();if(!$$CM.isNull(c.Page3Data)){var e=c.Page3Data.Family1;if(!$$CM.isNull(e)){var k=e.Parent1;if(!$$CM.isNull(k)&&!$$CM.isEmpty(k.LoginEmail)){h.push(k.LoginEmail)}var l=e.Parent2;if(!$$CM.isNull(l)&&!$$CM.isEmpty(l.LoginEmail)){h.push(l.LoginEmail)}}var f=c.Page3Data.Family2;if(!$$CM.isNull(f)){var k=f.Parent1;if(!$$CM.isNull(k)&&!$$CM.isEmpty(k.LoginEmail)){h.push(k.LoginEmail)}var l=f.Parent2;if(!$$CM.isNull(l)&&!$$CM.isEmpty(l.LoginEmail)){h.push(l.LoginEmail)}}}if(!$$CM.isNull(c.Page5Data)&&!$$CM.isEmpty(c.Page5Data.CamperLoginEmail)){h.push(c.Page5Data.CamperLoginEmail)}var i=h.findAll(function(n){return n.toLowerCase()==g.toLowerCase()},this);if(i.length>1){var j=g+" has already been used for this family. Please enter a different login email address.";var d={title:"Alert",header:"Login Email In-Use",message:j};$$CMD.Alert(d);b.Bind()}else{this._securityDAO.LoginEmailCheck([g],{ctrEmail:m})}},onLoginEmailChecked:function(e,a){var d=null;if(a.success==true){var b=a.ctrEmail;if(!$$CM.isEmpty(a.data)){d=a.data+" is in-use! Please choose different email address.";b.Bind()}}else{d="An error occurred validating email address."}if(!$$CM.isEmpty(d)){var c={title:"Alert",header:"Login Email In-Use",message:d};$$CMD.Alert(c)}},bindCamperShortInfo:function(){var b="";if(!$$CM.isNull(this._camperData)){var a=this._camperData.Name;if(!$$CM.isNull(a)){if($$CM.IsUPR()){b+="for "+$$CM.getFormattedPersonNameUPR(a,true,true,true,true,true)}else{if(!$$CM.isEmpty(a.FullName)){b+="for "+a.FullName}else{b+="for "+a.FirstName+" "+a.LastName}if(!$$CM.isNull(this._seasonID)&&this._seasonID>0){b+=", "+this._seasonID+" Season"}}}}this._divCamperShortInfo.UpdateInnerHtml(b)},bindCamperDetails:function(){if(!$$CM.isNull(this._page1)){this._page1.BindCamper(this._camperData);this._page1.CamperDetailsShow({animate:true,callback:this.TogglePaginationFooter,scope:this})}},renderPages:function(){this._divWrapper.ClearChildControls(false);var b=this.GetSettings();this._saveForLaterEnabled=!b.NoSaveForLater;if(this._userTypeFlag.CompareById($$USER.UserTypeFlag,0,0)==true||this._userTypeFlag.CompareById($$USER.UserTypeFlag,4,0)==true){this._divInfoLinks.Hide();this._divLoading.Hide();this._divWrapper.Show();this._divMessageWrapper.Hide();this._page0=new cm.ui.forms.application.camper.Page0("LoginDetails",{index:0,existingStatus:this._existingStatus,settings:b,controller:this});this._divWrapper.AddChild(this._page0);this._page0.LoggedInEvent.subscribe(this.onLoggedIn,this);this._page0.SetFocus()}else{this._divInfoLinks.Show();this._divWrapper.DestroyChildControls(true);if(!$$CM.isNull(this._paginator)){if(!$$CM.isNull(this._page5)){this._page5.DestroyAvatarControl()}this.ResetPaginator()}else{this._paginator=new cm.ui.pagination.ApplicationNumberPaginator("divNumberPaginator",{toggleTabIndex:true,saveForLaterMessage:"<br>You must complete this page before saving for later.</br>"});this._paginator.PageShownEvent.subscribe(this.onPageShownEvent,this)}this._divWrapper.AddChild(this._paginator);this._ctrCustomFormPaginationWrapper=new cm.ui.customforms.pagination.CustomFormPaginationWrapper(this._pageNameEnum.GetName(99),{pageHeader:""});this._divMessageWrapper.Hide();if(this._seasonArray.length>0){this._aInstructions.Show()}else{this._aInstructions.Hide();this._showInstructionsAtStart=false}this._ctrCustomFormPaginationWrapper.GetConfigOptions().Set("saveForLaterEnabled",this._saveForLaterEnabled);this._ctrCustomFormPaginationWrapper.SetPageHeaderMessage(b.CustomQuestionsPageHeaderMessage,b.CustomQuestionsPageHeaderMessageCssClass);this._ctrCustomFormPaginationWrapper.SetSectionHeaderMessage(b.CustomQuestionsHeaderMessage,b.CustomQuestionsHeaderMessageCssClass);this._page1Applicable=true;if(this._page1Applicable==true){this._page1=new cm.ui.forms.application.camper.Page1(this._pageNameEnum.GetName(1),{index:100,continueEnabled:false,continueLabel:"Begin Application",seasonID:this.GetSeasonID(),seasonArray:this._seasonArray,settings:b,existingStatus:this._existingStatus,applicationStatus:this._applicationStatus,visible:true});this._paginator.AddPage(this._page1);this._page1.BeforeLoadEvent.subscribe(this.onCamperInformationPageBeforeLoad,this);this._page1.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page1.SeasonChangedEvent.subscribe(this.onSeasonChanged,this);this._page1.CamperChangedEvent.subscribe(this.onCamperChanged,this);this._page1.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page1.BeforeUnLoadEvent.subscribe(this.onCamperInformationPageBeforeUnLoad,this);this._page1.SetVisible(false)}this._page2Applicable=true;if(this._page2Applicable==true){this._page2=new cm.ui.forms.application.camper.Page2(this._pageNameEnum.GetName(2),{index:200,backEnabled:true,settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page2);this._page2.BeforeLoadEvent.subscribe(this.onSessionSelectorPageBeforeLoad,this);this._page2.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page2.BeforeContinueEvent.subscribe(this.onSessionSelectorPageBeforeContinue,this);this._page2.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page2.BeforeUnLoadEvent.subscribe(this.onSessionSelectorPageBeforeUnLoad,this);this._page2.Page2BindCompleteEvent.subscribe(this.onPage2BindSeasonalListsDataComplete,this)}this._page3Applicable=true;if(this._page3Applicable==true){this._page3=new cm.ui.forms.application.camper.Page3(this._pageNameEnum.GetName(3),{index:300,backEnabled:true,saveForLaterEnabled:this._saveForLaterEnabled,settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page3);this._page3.BeforeLoadEvent.subscribe(this.onParentInformationPageBeforeLoad,this);this._page3.AfterLoadEvent.subscribe(this.onParentInformationPageAfterLoad,this);this._page3.BeforeBackEvent.subscribe(this.onParentInformationPageBeforeBack,this);this._page3.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page3.LoginEmailCheckEvent.subscribe(this.onLoginEmailCheck,this);this._page3.ApplyPromotionCodeEvent.subscribe(this.onApplyPromotionCode,this);this._page3.BeforeUnLoadEvent.subscribe(this.onParentInformationPageBeforeUnLoad,this)}this._page4Applicable=true;if(this._page4Applicable==true){this._page4=new cm.ui.forms.application.camper.Page4(this._pageNameEnum.GetName(4),{index:400,backEnabled:true,saveForLaterEnabled:this._saveForLaterEnabled,settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page4);this._page4.BeforeLoadEvent.subscribe(this.onAdditionalOptionsPageBeforeLoad,this);this._page4.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page4.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page4.BeforeUnLoadEvent.subscribe(this.onAdditionalOptionsPageBeforeUnLoad,this);this._page4.SetApplicable(false)}this._page5Applicable=true;if(this._page5Applicable==true){this._page5=new cm.ui.forms.application.camper.Page5(this._pageNameEnum.GetName(5),{index:500,backEnabled:true,saveForLaterEnabled:this._saveForLaterEnabled,settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page5);this._page5.BeforeLoadEvent.subscribe(this.onAdditionalInformationPageBeforeLoad,this);this._page5.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page5.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page5.VerifyUser.subscribe(this.onVerifyUser,this);this._page5.AvatarChangeEvent.subscribe(this.onCamperAvatarChanged,this);this._page5.LoginEmailCheckEvent.subscribe(this.onLoginEmailCheck,this);this._page5.BeforeUnLoadEvent.subscribe(this.onAdditionalInformationPageBeforeUnLoad,this)}var a=600;this._ctrCustomFormPaginationWrapper.GetPages().each(function(c){c.SetIndex(a++);this._paginator.AddPage(c);c.BeforeLoadEvent.subscribe(this.onCustomFormPageBeforeLoad,this);c.AfterLoadEvent.subscribe(this.onAfterLoad,this);c.SaveForLaterEvent.subscribe(this.onSaveForLater,this);c.BeforeUnLoadEvent.subscribe(this.onCustomFormPageBeforeUnLoad,this)},this);this._page6Applicable=(b.DisableBillingPage!=true);if(this._page6Applicable==true){this._page6=new cm.ui.forms.application.camper.Page6(this._pageNameEnum.GetName(6),{index:700,backEnabled:true,saveForLaterEnabled:this._saveForLaterEnabled,settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page6);this._page6.BeforeLoadEvent.subscribe(this.onBillingPageBeforeLoad,this);this._page6.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page6.PayInFullEvent.subscribe(this.onPayInFull,this);this._page6.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page6.BeforeUnLoadEvent.subscribe(this.onBillingPageBeforeUnLoad,this)}this._page7Applicable=true;if(this._page7Applicable==true){this._page7=new cm.ui.forms.application.camper.Page7(this._pageNameEnum.GetName(7),{index:800,backEnabled:true,continueLabel:"Submit",settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page7);this._page7.BeforeLoadEvent.subscribe(this.onSignaturePageBeforeLoad,this);this._page7.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page7.BeforeContinueEvent.subscribe(this.onSignaturePageBeforeContinue,this);this._page7.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page7.BeforeUnLoadEvent.subscribe(this.onSignaturePageBeforeUnLoad,this)}this._appSummary=new cm.ui.forms.application.camper.AppSummary(this._pageNameEnum.GetName(100),{index:900,settings:b,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus});this._divWrapper.AddChild(this._appSummary);this._appSummary.Hide()}},postInitialize:function(){this.getTokenizedTimestamp({refreshExpired:true});this._securityDAO.TokenizedUserFetch(10080)},onCamperInformationPageBeforeLoad:function(c,a){var b=c;this.HidePaginationHeader();this.ToggleHoldGroupTokenTimer({activate:false});if(!$$CM.isNull(this._camperData)&&this._camperData.PersonID<=0){this._camperData=null;this.bindCamperShortInfo()}},onCamperInformationPageBeforeUnLoad:function(d,a){var b=d;var c=b.GetData();if(!$$CM.isNull(c)){this._camperData=c.Camper}this.bindCamperShortInfo();if(this._paginator.IsForward()){this.ShowPaginationHeader()}this.getSeasonalListsData()},onSessionSelectorPageBeforeLoad:function(c,a){var b=c;this.ShowPaginationHeader();this.ToggleHoldGroupTokenTimer({activate:false});this._page2.SetCamper(this._camperData);this.clearHoldGroupToken()},onSessionSelectorPageBeforeContinue:function(c,a){var b=c;if(this._paginator.IsForward()){this.fetchHoldGroupToken(a)}},onSessionSelectorPageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){this.toggleConditionalPages()}},onParentInformationPageBeforeLoad:function(c,a){var b=c;this.ShowPaginationHeader();this._page3.SetCamper(this._camperData)},onParentInformationPageAfterLoad:function(e,a){var b=e;var c=b.GetData();if(this._paginator.IsForward()){if(!$$CM.isNull(c)&&$$CM.isArray(c.PromotionAssignmentArray)){var d=c.PromotionAssignmentArray;this.validatePromotionAssignments(d)}}this.onAfterLoad(e,a)},onParentInformationPageBeforeBack:function(d,b){var c=d;if(this._paginator.IsForward()){}else{var a={seasonID:this._seasonID,holdGroupToken:this._holdGroupToken};if(!$$CM.isNull(b)){a.scope=b.scope;a.callback=b.callback}this.dismissHoldGroupToken(a)}},onParentInformationPageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){}},onAdditionalOptionsPageBeforeLoad:function(c,a){var b=c;this.ShowPaginationHeader();this._page4.SetCamper(this._camperData)},onAdditionalOptionsPageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){}},onAdditionalInformationPageBeforeLoad:function(c,a){var b=c;this.ShowPaginationHeader();this._page5.SetCamper(this._camperData);this._page5.BindAvatar(this._camperData)},onAdditionalInformationPageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){}},onCustomFormPageBeforeLoad:function(c,a){var b=c;this.ShowPaginationHeader()},onCustomFormPageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){}},onBillingPageBeforeLoad:function(g,a){var b=g;this.ShowPaginationHeader();if(!$$CM.isNull(this._page2)){var c=this._page2.GetData();var f=c.SessionAssignmentArray;if($$CM.isArray(f)){var e=$$CADU.IsPayInFullApplicable(this._seasonID,f);b.SetPayInFullApplicable(e)}}if(!$$CM.isNull(this._page3)){var d=this._page3.GetData();if(!$$CM.isNull(d)&&!$$CM.isNull(d.Family1)){b.ToggleBillingAddress(d.Family1)}}this.getFamilyFinancial(false)},onBillingPageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){}},onSignaturePageBeforeLoad:function(l,b){var e=l;this.ShowPaginationHeader();if(!$$CM.isNull(this._page6)&&!$$CM.isNull(this._page7)){var d=null;var k=null;var g=this._page3.GetData();if(!$$CM.isNull(g)&&!$$CM.isNull(g.Family1)&&!$$CM.isNull(g.Family1.HomeAddress)){d=g.Family1.HomeAddress.Country;k=g.Family1.HomeAddress.StateProvince}var a=0;var m=this._page6.GetTotals();if(!$$CM.isNull(m)){if($$CM.isNumber(m.ChargesTotal)){a+=m.ChargesTotal}if($$CM.isNumber(m.AdjustmentsTotal)){a+=m.AdjustmentsTotal}if($$CM.isNumber(m.DiscountsTotal)){a+=m.DiscountsTotal}}var h=this._settings.CancellationInsuranceProviderID;var i=this._settings.CancellationInsurancePlanIDsEnabled;if(!$$CM.isNull(this._page2)){var f=this._page2.GetData();var j=f.SessionAssignmentArray;if($$CM.isArray(j)){this._page7.BindSessionAssignments(j)}}this._page7.BindCancellationInsuranceProviderID(h);this._page7.BindCancellationInsuranceAmountToBeInsured(a);if(this._page7.CancellationInsuranceIsApplicable()){var c=$$CADU.GetCustomCreditCardArray($$USER.PersonID,"CancellationCreditCardArray");this._page7.BindCancellationCreditCardSelector({PersonID:$$USER.PersonID,CreditCardArray:c});this.getProviderPlanAmountArray(h,a,i,d,k)}}},onSignaturePageBeforeContinue:function(e,a){var c=e;if(this._page7.IsValid(true)){this.ToggleHoldGroupTokenTimer({activate:false});var d=a.scope;var b=a.callback;if(!$$CM.isNull(d)&&!$$CM.isNull(b)){b.call(d)}}else{}},onSignaturePageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){this.submit()}},onSaveForLater:function(d,a){var b=d;var c=b.ID();this.saveForLater(c)},onAfterLoad:function(c,a){var b=c;window.scrollTo(0,0)},getSessionProgramHoldRequests:function(a){var b=$A();if($$CM.isArray(a)&&a.length>0){a.each(function(g){if(g.InDB!=true){var c=false;var h=this._sessionGroupSettingsList.find(function(i){return Number(i.SessionGroupID)==Number(g.SessionGroupID)},this);if(!$$CM.isNull(h)&&(h.CapacityTypeID>1||h.IncludeMasterCapacity==true)){c=true}if(!c){var f=this._seasonSessionList.find(function(i){return Number(i.SessionID)==Number(g.SessionID)},this);if(!$$CM.isNull(f)){if($$CM.isNumber(g.ProgramID)&&g.ProgramID>0&&$$CM.isArray(f.ProgramArray)){var e=f.ProgramArray.find(function(i){return Number(i.ProgramID)==Number(g.ProgramID)},this);if($$CM.isNumber(e.ItemizedBasicCapacityTypeID)&&Number(e.ItemizedBasicCapacityTypeID)>0){c=true}}else{if($$CM.isNumber(f.ItemizedBasicCapacityTypeID)&&Number(f.ItemizedBasicCapacityTypeID)>0){c=true}}}}if(c){var d=g.DayOfWeekFlagID;b.push({SessionGroupID:g.SessionGroupID,SessionID:g.SessionID,ProgramID:g.ProgramID,RegistrationDays:d})}}},this)}return b},dismissHoldGroupToken:function(a){if(!$$CM.isNull(a)&&!$$CM.isNull(a.holdGroupToken)&&$$CM.isArray(a.holdGroupToken.SessionProgramHoldRequests)&&a.holdGroupToken.SessionProgramHoldRequests.length>0){var b={title:"Alert",message:"You will lose your reservation if you go back from this page. Are you sure you want to continue?",handlerOk:this.onHoldGroupTokenDismissOK,handlerCancel:this.onHoldGroupTokenDismissCancel,cssClass:"cmAlertDialog",scope:this,args:a};$$CMD.Confirm(b)}else{this.onHoldGroupTokenDismissRedirect(a)}},onHoldGroupTokenDismissOK:function(c,b){var a={seasonID:this._seasonID,holdGroupToken:this._holdGroupToken};if(!$$CM.isNull(b)){a.scope=b.scope;a.callback=b.callback}this.deleteHoldGroupToken(a)},onHoldGroupTokenDismissCancel:function(b,a){if(!$$CM.isNull(this._paginator)){this._paginator.EnableFooter(true)}},deleteHoldGroupToken:function(a){if(!$$CM.isNull(a)&&!$$CM.isNull(a.holdGroupToken)){this._commonDAO.HoldGroupTokenDelete(a)}else{this.onHoldGroupTokenDismissRedirect(a)}},onHoldGroupTokenDeleted:function(b,a){if(a.success==true){this._holdGroupToken=null}else{}this.onHoldGroupTokenDismissRedirect(a)},onHoldGroupTokenDismissRedirect:function(a){var c=a.scope;var b=a.callback;if(!$$CM.isNull(c)&&!$$CM.isNull(b)){b.call(c)}},clearHoldGroupToken:function(){if(!$$CM.isNull(this._holdGroupToken)){this.deleteHoldGroupToken({seasonID:this._seasonID,holdGroupToken:this._holdGroupToken})}},fetchHoldGroupToken:function(b){var h=$A();if(!$$CM.isNull(this._page2)){var f=this._page2.GetData();if(!$$CM.isNull(f)&&$$CM.isArray(f.SessionAssignmentArray)&&f.SessionAssignmentArray.length>0){h=this.getSessionProgramHoldRequests(f.SessionAssignmentArray)}}var e={PersonCriteria:{DOBAsString:this._camperData.DOBAsString,GradeID:this._camperData.CampGradeID,GenderID:this._camperData.GenderID,PersonID:!$$CM.isNumber(this._camperData.PersonID)||Number(this._camperData.PersonID)==0?null:this._camperData.PersonID},SessionProgramHoldRequests:h};var a={seasonID:this._seasonID,holdGroupToken:e,holdGroupTokenOld:Object.clone(this._holdGroupToken)};if(!$$CM.isNull(b)){a.scope=b.scope;a.callback=b.callback}this._holdGroupToken=null;if(!$$CM.isNull(a)&&!$$CM.isNull(a.holdGroupToken)&&$$CM.isArray(a.holdGroupToken.SessionProgramHoldRequests)&&a.holdGroupToken.SessionProgramHoldRequests.length>0){var d={showProgress:false,message:"Retrieving Reservation. Please wait..."};$$CMD.ShowWaitDialog(d);this._commonDAO.HoldGroupTokenFetch(a)}else{var g=a.scope;var c=a.callback;if(!$$CM.isNull(g)&&!$$CM.isNull(c)){c.call(g)}}},onHoldGroupTokenFetched:function(o,a){$$CMD.HideWaitDialog();var h=false;var d=$A();var j=null;if(!$$CM.isEmpty(this._seasonHoldGroupSettings.SessionFullMessage)){j=this._seasonHoldGroupSettings.SessionFullMessage}if(a.success==true){var e=a.data;if(!$$CM.isNull(e)){var k=e.SessionProgramHoldRequests;if($$CM.isArray(k)&&k.length>0){var n=k.findAll(function(p){return !$$CM.isNull(p.Result)&&p.Result.Success==true},this);var m=k.findAll(function(p){return !$$CM.isNull(p.Result)&&p.Result.Success!=true},this);if(n.length!=k.length){d=this.getHoldGroupTokenErrorList(m)}else{h=true;this._holdGroupToken=e;this.ToggleHoldGroupTokenTimer({activate:true});cm.ui.utilityControls.growlBanner.ShowBanner("Reservation was successful for all selected session assignments.",3000);var i=a.scope;var b=a.callback;if(!$$CM.isNull(i)&&!$$CM.isNull(b)){b.call(i)}var l=n.findAll(function(p){return !$$CM.isNull(p.Result)&&p.Status!=2},this);if(l.length>0){var g=this.getHoldGroupTokenReservationList(n);if(g.length>0){var f="";if(!$$CM.isEmpty(j)){f+='<p class="mt0px mb10px cmAdvisory">'+j+"</p>"}f+='<ul class="mt0px mb0px">';g.each(function(p){f+="<li><b>"+p.Status.toUpperCase()+"</b>: "+p.Name+"</li>"});f+="</ul>";var c={title:"Reservation Summary",header:"",message:f,width:500,autoCenter:true};$$CMD.AlertGo(c)}}}}}}if(h!=true){this.onHoldGroupTokenFailedRedirect();if(d.length==0){d.push({ID:404,Message:"Reservation was not successful."})}var f='<ul class="mt0px mb0px">';d.each(function(p){f+="<li>"+p.Message+"</li>"});f+="</ul>";var c={title:"Alert",header:"",message:f,width:500,autoCenter:true};$$CMD.Alert(c)}},getHoldGroupTokenReservationList:function(c){var a=$A();if($$CM.isArray(c)&&c.length>0){var b=$$CADU.GetSeasonSessionArray(this._seasonID);c.each(function(j){var d="";var e="";var f="";var k=j.Result;if(!$$CM.isNull(k)&&k.Success==true){var i=this._sessionGroupArray.find(function(l){return l.ID==j.SessionGroupID},this);if(!$$CM.isNull(i)){d="sgID"+j.SessionGroupID;e=i.Name;var g=b.find(function(l){return l.SessionID==j.SessionID},this);if(!$$CM.isNull(g)){d="ssID"+j.SessionID;e+="/"+g.Name;if(j.ProgramID>0&&$$CM.isArray(g.ProgramArray)){var h=g.ProgramArray.find(function(l){return l.ProgramID==j.ProgramID},this);if(!$$CM.isNull(h)){d="sspID"+j.ProgramID;e+="/"+h.Name}}}if(j.Status==4||j.Status==2){f="Applied"}else{if(j.Status==8){f="WaitList"}}if(j.Status==8){a.push({ID:d,Name:e,Status:f})}}}},this)}return a},getHoldGroupTokenErrorList:function(c){var a=$A();if($$CM.isArray(c)&&c.length>0){var b=$$CADU.GetSeasonSessionArray(this._seasonID);c.each(function(m){var g="";var h="";var k=null;if(!$$CM.isEmpty(this._seasonHoldGroupSettings.SessionFullMessage)){k=this._seasonHoldGroupSettings.SessionFullMessage}var n=m.Result;var f=a.find(function(o){o.ID==g},this);if(!$$CM.isNull(n)&&n.Success!=true&&$$CM.isNull(f)){var l=this._sessionGroupArray.find(function(o){return o.ID==m.SessionGroupID},this);if(n.IsAtOrOverCapacitySessionGroup==true){g="sgID"+m.SessionGroupID;h="<b>"+l.Name+":</b> "+(!$$CM.isEmpty(k)?k:n.ErrorMessage)}else{var i=b.find(function(o){return o.SessionID==m.SessionID},this);if(!$$CM.isNull(i)){g="ssID"+m.SessionID;h+=i.Name;if(m.ProgramID>0&&$$CM.isArray(i.ProgramArray)){var j=i.ProgramArray.find(function(o){return o.ProgramID==m.ProgramID},this);if(!$$CM.isNull(j)){g="sspID"+m.ProgramID;h+="/"+j.Name}}var d=n.DaysAtCapacity;if($$CM.isArray(d)&&d.length>0){var e="";d.each(function(o){var p=this._daysOfWeekFlag.GetName(o.DayOfWeekID);if(!$$CM.isEmpty(p)){if(e.length>0){e+=", "}e+=p.substring(0,3)}},this);if(e.length>0){h+=" ("+e+")"}}}h="<b>"+h+":</b> "+(!$$CM.isEmpty(k)?k:n.ErrorMessage)}a.push({ID:g,Message:h})}else{if($$CM.isNull(n)){var l=this._sessionGroupArray.find(function(o){return o.ID==m.SessionGroupID},this);g="sgID"+m.SessionGroupID;h="<b>"+l.Name+":</b> reservations failed"}}},this)}return a},onHoldGroupTokenTimeRemaining:function(b,a){var c=this._seasonHoldGroupSettings.TimeRemainingAlertMessage;cm.ui.utilityControls.growlBanner.ShowBanner(c,5000,"jGrowlWarning")},onHoldGroupTokenExpired:function(e,b){var d="";if(!$$CM.isNull(this._seasonHoldGroupSettings.TimeExpiredAlertMessage)){d=this._seasonHoldGroupSettings.TimeExpiredAlertMessage}else{d="Your reservation has expired"}var c={title:"Reservation expired",message:d,handlerOk:this.onHoldGroupTokenExpiredOK,handlerCancel:this.onHoldGroupTokenExpiredCancel,dialogClass:"alert",scope:this};$$CMD.Confirm(c);var a={seasonID:this._seasonID,holdGroupToken:this._holdGroupToken};this.deleteHoldGroupToken(a)},onHoldGroupTokenExpiredOK:function(b,a){this.fetchHoldGroupToken(a)},onHoldGroupTokenExpiredCancel:function(b,a){this.onHoldGroupTokenFailedRedirect()},ToggleHoldGroupTokenTimer:function(b){var a=b.activate;this._ctrHoldGroupTokenTimer.Stop();this._ctrHoldGroupTokenTimer.Hide();if(a==true){var c=Number(this._seasonHoldGroupSettings.HoldingTimeSeconds)/60;var d=true;var e=this._seasonHoldGroupSettings.TimeRemainingAlertList;this._ctrHoldGroupTokenTimer.Restart({durationInMinutes:c,timeExpiredAlert:d,timeRemainingAlertList:e});if(this._seasonHoldGroupSettings.DisplayTimer==true){this._ctrHoldGroupTokenTimer.Show()}}},maintainCCAndACHArraysOnRedirection:function(a){if(!$$CM.isNull(a)){var e=$A();var d=$A();if(!$$CM.isNull(this._familyBillingData)){if($$CM.isArray(this._familyBillingData.CreditCardArray)){e=this._familyBillingData.CreditCardArray}if($$CM.isArray(this._familyBillingData.AchAccountArray)){d=this._familyBillingData.AchAccountArray}}if($$CM.isNull(a.Page6Data)){a.Page6Data=new Object()}if(!$$CM.isNull(a.Page6Data.FamilyBillingData)){var c=a.Page6Data.FamilyBillingData.CreditCardArray;if(!$$CM.isArray(c)){c=$A()}e.each(function(g){var f=c.find(function(h){return h.ID==g.ID},this);if(f==null){c.push(g)}},this);var b=a.Page6Data.FamilyBillingData.AchAccountArray;if(!$$CM.isArray(b)){b=$A()}d.each(function(g){var f=b.find(function(h){return h.ID==g.ID},this);if(f==null){b.push(g)}},this)}}},onHoldGroupTokenFailedRedirect:function(){var e=true;var c=null;if(!$$CM.isNull(this._paginator)){var a=this._paginator.GetCurrentPage();currentPageID=a.ID()}if(e==true){this._divWrapper.Hide();this._divLoading.Show();var b=this.GetData(currentPageID);this.maintainCCAndACHArraysOnRedirection(b);this._personFormData=b;var f=this._personFormData.SeasonID;var d=this._personFormData.PersonID;if(!$$CM.isNull(this._page2)){this._saveForLaterInit={startPageID:this._page2.ID(),seasonID:f,personID:d,camperData:this._camperData,personFormData:this._personFormData}}if($$USER.PersonID>0){this.getTokenizedTimestamp({refreshExpired:false})}else{this.getUserSession()}}if(!$$CM.isNull(this._paginator)){this._paginator.EnableFooter(true)}},onSessionAssignmentDataChangedRedirect:function(f){this._divWrapper.Hide();this._divLoading.Show();var c=null;if(!$$CM.isNull(this._paginator)){var a=this._paginator.GetCurrentPage();currentPageID=a.ID()}var b=this.GetData(currentPageID);this.maintainCCAndACHArraysOnRedirection(b);this._personFormData=b;var e=this._personFormData.SeasonID;var d=this._personFormData.PersonID;if($$CM.isNull(f)){f=$A()}if($$CM.isNull(this._personFormData.Page2Data)){this._personFormData.Page2Data=new Object()}this._personFormData.Page2Data.SessionAssignmentArray=f;if(!$$CM.isNull(this._page2)){this._saveForLaterInit={startPageID:this._page2.ID(),seasonID:e,personID:d,camperData:this._camperData,personFormData:this._personFormData}}if($$USER.PersonID>0){this.getTokenizedTimestamp({refreshExpired:false})}else{this.getUserSession()}if(!$$CM.isNull(this._paginator)){this._paginator.EnableFooter(true)}},ToggleCurrentCamper:function(){this.bindCamperShortInfo();this.bindCamperDetails()},ShowPage:function(c){if(!$$CM.isNull(this._paginator)){var b=this._paginator.GetPageArray();if($$CM.isArray(b)){var a=b.find(function(d){return d.ID()==c},this);if(!$$CM.isNull(a)){c=a.ID()}else{c=b[0].ID()}this.TogglePaginationHeader(c);this._paginator.ShowPage(c)}}},TogglePaginationHeader:function(b){var a=(this._page1Applicable==true&&!$$CM.isNull(this._page1)&&this._page1.ID()==b);if(a==true){this.HidePaginationHeader()}else{this.ShowPaginationHeader()}},HidePaginationHeader:function(){if(!$$CM.isNull(this._paginator)){this._paginator.HideHeader()}},ShowPaginationHeader:function(){if(!$$CM.isNull(this._paginator)){this._paginator.ShowHeader()}},ResetPaginator:function(){if(!$$CM.isNull(this._paginator)){this._paginator.Reset()}},TogglePaginationFooter:function(){if(!$$CM.isNull(this._paginator)&&!$$CM.isNull(this._paginator.GetCurrentPage())){this._paginator.updateFooter()}},getTokenizedTimestamp:function(a){this._commonDAO.TokenizedTimestampFetch({key:"CamperApp_101",refreshExpired:a.refreshExpired})},onTokenizedTimestampFetched:function(c,a){if(a.success==true){var b=this._commonDAO.TokenizedTimestampGet(a);if(!$$CM.isNull(b)&&!$$CM.isNull(b.Data)){this._tokenizedTimestamp=b.Data}this.onSeasonChanged(this,{SeasonID:this._seasonID})}else{}},_seasonSelected:false,onSeasonChanged:function(d,a){this._seasonID=a.SeasonID;if(!$$CM.isNull($$QC)){$$QC.SeasonId=this._seasonID}if(this._isFinancialMVC1!=true||(this._seasonID>0&&this._seasonID<this._v3FinancialSeasonID)){var c="?";var b=$$CM.GetQueryStringParam("domain");if(!$$CM.isEmpty(b)){c+="domain="+b}if(this._userTypeFlag.CompareById($$USER.UserTypeFlag,0,0)==true||this._userTypeFlag.CompareById($$USER.UserTypeFlag,4,0)==true){this.GetControllerDAO().redirectURL(document.location.protocol+"//"+document.location.host+"/v2/camper/application/App0.aspx"+c)}else{if(c.length>1){c+="&"}this.GetControllerDAO().redirectURL(document.location.protocol+"//"+document.location.host+"/v2/camper/application/App1.aspx"+c+"noInstructions=true&seasonID="+this._seasonID)}}else{if(!$$CM.isNull(this._page1)){this._seasonSelected=true;this._page1.ContinueEnabled=false;this.TogglePaginationFooter()}this._page1Data=a;this._camperData=null;this.bindCamperShortInfo();this.getSeasonalSettingsData()}},getSeasonalSettingsData:function(){var a="SeasonalSettingsDataGet";var b=this._seasonID;this.seasonalSettingsDataFetch({mvcAction:a,seasonID:b})},onSeasonalSettingsDataFetched:function(k,b){var f=this;$$CMD.HideWaitDialog();if(b.success==true){var j=b.seasonID;var c=f.seasonalSettingsDataGet({seasonID:j});if(!$$CM.isNull(c)){if(!$$CM.isNull(c.CamperApplicationSettings)){f._settings=c.CamperApplicationSettings;f._settings.CampSettings=c.CampSettings;f._settings.SeasonSessionGroupSettingsList=c.SeasonSessionGroupSettingsList;f._settings.MinGradeID=c.MinGradeID;f._settings.MaxGradeID=c.MaxGradeID;f._settings.MinAge=c.MinAge;f._settings.MaxAge=c.MaxAge;f._settings.SeasonSessions=c.SeasonSessions}}if(!$$CM.isNull(f._settings)&&f._settings.GeneralSettings.GoogleAnalyticsAccountID!=""){$$GAT.AddTracker(f._settings.GeneralSettings.GoogleAnalyticsAccountID,"capp")}if(!$$CM.isNull($$QC)&&$$CLIENT.ID==191){var g=Math.floor(1000000+Math.random()*9000000);$$QC.Initialize(g)}if(!$$CM.isNull(f._settings)&&$$USER.PersonID>0&&j>0){f.getFamilyInfoForParent(j,$$USER.PersonID)}else{var e=this._settings.GeneralSettings;var a=!$$CM.isNull(e)?e.AllowNew:false;if(f._seasonSelected==true&&a!=true){this._divMessageWrapper.ClearChildControls(true);var d=$$P.div();this._divMessageWrapper.AddChild(d);d.AddClassName("cmAlert");if(!$$CM.isEmpty(e.AllowNewMessage)){d.UpdateInnerHtml(e.AllowNewMessage)}else{d.UpdateInnerHtml("We are only accepting applications from returning applicants at this time.")}this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show();return}else{if(!$$CM.isNull(f._saveForLaterInit)){f.toggleInitialData(f._saveForLaterInit.personFormData);f.bindCamperShortInfo();f.ShowPaginationHeader()}else{var i={FormID:f._formID,SeasonID:f._seasonID,Page1Data:f._page1Data,Page3Data:{Family1:{Parent1:{Name:{FirstName:$$USER.FirstName,LastName:$$USER.LastName},LoginEmail:LoginEmail=$$USER.Email,PersonID:$$USER.PersonID}}}};f.renderPages();f.Bind(i);if(!$$CM.isNull(f._page1)){var h=f._page1.ID();f._page1.BindCamperArray(null);f.ShowPage(h);if(f._settings&&f._settings.GeneralSettings&&f._settings.GeneralSettings.AutoDisplayInstructions==true){f.showInstructions()}}f._divLoading.Hide();f._divWrapper.Show()}}}}else{f._divMessageWrapper.ClearChildControls(true);var d=$$P.div();f._divMessageWrapper.AddChild(d);d.AddClassName("cmAlert");d.UpdateInnerHtml("There was a problem retrieving application settings.");f._divLoading.Hide();f._divWrapper.Hide();f._divMessageWrapper.Show()}},getFamilyInfoForParent:function(e,d){var c="";var b="FamilyInfoGet";var a={dataProperty:"FamilyInfoArray",seasonID:e,personID:d,objectTypeFlagID:16,onSuccess:this.onGetFamilyInfoForParent_success,onFailure:this.onGetFamilyInfoForParent_failure};this._camperDAO.FamilyInfoFetch(c,b,a)},onGetFamilyInfoForParent_success:function(a){var f=a.scope;var k=a.seasonID;var j=a.personID;var h=a.objectTypeFlagID;var e=$$CADU.IsSecondaryFamilyParent(k,j,h);if(e==true){var g=$$SETTINGSDU.GetFormattedCallUsMessage("Due to your account setup camper application is not applicable.  If you have any question",f._settings.GeneralSettings);f._divMessageWrapper.ClearChildControls(true);var c=$$P.div();f._divMessageWrapper.AddChild(c);c.AddClassName("cmAlert");c.UpdateInnerHtml(g);f._divLoading.Hide();f._divWrapper.Hide();f._divMessageWrapper.Show()}else{var b=$$CADU.GetCamperIDNameList(k,j,h);var d=$$CADU.IsPrimaryFamilyParent(k,j,h);f.renderPages();f._page1.BindCamperArray(b,d);f._page1.Bind(f._page1Data);if(!$$CM.isNull(f._saveForLaterInit)){f.toggleInitialData(f._saveForLaterInit.personFormData);f.bindCamperShortInfo();f.ShowPaginationHeader()}else{var i=f._page1.ID();f.ShowPage(i);f._divLoading.Hide();f._divWrapper.Show();f.showInstructions();f.toggleInitialData()}}},onGetFamilyInfoForParent_failure:function(a){var c=a.scope;c._divMessageWrapper.ClearChildControls(true);var b=$$P.div();c._divMessageWrapper.AddChild(b);b.AddClassName("cmAlert");b.UpdateInnerHtml("There was a problem retrieving your Family Information data");c._divLoading.Hide();c._divWrapper.Hide();c._divMessageWrapper.Show()},getFamilyInfoForCamper:function(f,e,b){var d="";var c="FamilyInfoGet";var a={dataProperty:"FamilyInfoArray",personID:e,camperID:b,seasonID:f,objectTypeFlagID:16,onSuccess:this.onGetFamilyInfoForCamper_success,onFailure:this.onGetFamilyInfoForCamper_failure};this._camperDAO.FamilyInfoFetch(d,c,a)},onGetFamilyInfoForCamper_success:function(a){var c=a.scope;var f=a.seasonID;var e=a.personID;var b=a.camperID;var d=a.objectTypeFlagID;c.getPersonForm(f,b)},onGetFamilyInfoForCamper_failure:function(a){var b=a.scope},onFamilyInfoFetched:function(j,a){if(a.success==true){var c=a.dataProperty;var i=a.seasonID;var h=a.personID;var b=a.camperID;var g=a.objectTypeFlagID;if(!$$CM.isNull(a.data)){var e=a.data.find(function(k){return k.Key=="familyID"},this);if(!$$CM.isNull(e)){var d=e.Data;if($$CM.isNumber(d)&&Number(d)>0){this._familyID=d;this.fetchCamperRegistrationLock();var f=this;jQuery(window).unload(function(){if($$CM.isNumber(d)&&$$CM.isNumber(i)){var k={};k.objectID=d;k.seasonID=i;k.registrationLockMode=f._co.registrationLockMode;f._formsDAO.RegistrationReleaseLock(k)}})}}}a.onSuccess({seasonID:i,personID:h,camperID:b,objectTypeFlagID:g,scope:this})}else{a.onFailure({scope:this})}},onCamperAvatarChanged:function(b,a){if(!$$CM.isNull(this._camperData)){this._camperData.AvatarFileName=a.AvatarFileName;this._camperData.ProfilePhotoURL=a.ProfilePhotoURL;this._camperData.AvatarURL=a.AvatarURL;this._page1.BindCamper(this._camperData)}},onCamperChanged:function(e,a){if(!$$CM.isNull(this._page1)){this._page1.ContinueEnabled=false;this.TogglePaginationFooter()}this._personFormData=null;var d=this._seasonID;var b=$$CM.isNumber(a.personID)?a.personID:0;if(b>0){this.getFamilyInfoForCamper(d,$$USER.PersonID,b)}else{if(!$$CM.isNull(this._personFormData)){this.ToggleCurrentCamper();this.Bind(this._personFormData)}else{var c={SeasonID:d,PersonID:b,FormID:this._formID};this._personFormData=c;this.toggleInitialData(c)}}},getPersonForm:function(b,a){this.personFormFetch({mvcAction:"CamperApplicationGet",seasonID:b,personID:a})},onPersonFormFetched:function(f,a){if(a.success==true){var e=a.seasonID;var d=a.personID;var c=this.personFormGet({seasonID:e,personID:d});this.toggleInitialData(c)}else{this._divMessageWrapper.ClearChildControls(true);var b=$$P.div();this._divMessageWrapper.AddChild(b);b.AddClassName("cmAlert");b.UpdateInnerHtml("There was a problem retrieving application data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},toggleInitialData:function(c){if($$CM.isNull(c)){c=new Object()}var f=c.SeasonID;var d=c.PersonID;if(!$$CM.isNull(this._page1)){this._page1.ContinueEnabled=true}if($$CM.isNull(c.Page1Data)){c.Page1Data=new Object()}if($$CM.isNull(c.Page3Data)){c.Page3Data=new Object()}if($$CM.isNull(c.Page5Data)){c.Page5Data=new Object()}if($$CM.isNull(c.Page6Data)){c.Page6Data=new Object()}var b=$A();if($$CM.isArray(c.PersonRelationshipList)){var e=c.PersonRelationshipList.findAll(function(j){return Number(j.PersonID)==Number(d)},this);if(!$$CM.isNull(e)&&$$CM.isArray(e)){b=e}}this._camperData=$$CADU.GetCamperData(f,$$USER.PersonID,16,d,c);if(!$$CM.isNull(this._saveForLaterInit)&&!$$CM.isNull(this._saveForLaterInit.camperData)){var g=this._saveForLaterInit.camperData;if(!$$CM.isNull(g)){if($$CM.isNull(this._camperData)){this._camperData=this._saveForLaterInit.camperData}if($$CM.isInteger(g.CampGradeID)){this._camperData.CampGradeID=g.CampGradeID}if(!$$CM.isEmpty(g.DOBAsString)){this._camperData.DOBAsString=g.DOBAsString}if($$CM.isInteger(g.GenderID)){this._camperData.GenderID=g.GenderID}if(!$$CM.isNull(g.Name)){this._camperData.Name=g.Name}if($$CM.isInteger(g.PricingIdentifierID)){this._camperData.PricingIdentifierID=g.PricingIdentifierID}if(!$$CM.isEmpty(g.SSN)){this._camperData.SSN=g.SSN}if($$CM.isInteger(g.SchoolGradeID)){this._camperData.SchoolGradeID=g.SchoolGradeID}if(!$$CM.isEmpty(g.SchoolName)){this._camperData.SchoolName=g.SchoolName}if(!$$CM.isNull(g.TShirtSize)){this._camperData.TShirtSize=g.TShirtSize}if($$CM.isInteger(g.YearsAtCamp)){this._camperData.YearsAtCamp=g.YearsAtCamp}}else{if($$CM.isNull(this._camperData)){this._camperData=new Object()}}this._camperData.PersonID=d;var i=this._saveForLaterInit.personFormData;if(!$$CM.isNull(i)){var h=i.Page5Data;if(!$$CM.isNull(h)){if(!$$CM.isEmpty(h.CamperCellPhone)){this._camperData.CellPhone=h.CamperCellPhone}if(!$$CM.isEmpty(h.CamperLoginEmail)){this._camperData.LoginEmail=h.CamperLoginEmail}}}}c.Page1Data.Camper=this._camperData;this._family1Data=$$CADU.GetFamilyData(f,$$USER.PersonID,16,true,b);var a=d;if(!$$CM.isNumber(a)||($$CM.isNumber(a)&&Number(a)==0)){a=null}this._family2Data=$$CADU.GetFamilyData(f,$$USER.PersonID,16,false,b,a);if($$CM.isNull(c.Page3Data.Family1)){c.Page3Data.Family1=this._family1Data}if($$CM.isNull(c.Page3Data.Family2)){c.Page3Data.Family2=this._family2Data}if($$CM.isNull(c.Page3Data.EmergencyContact1)&&$$CM.isNull(c.Page3Data.EmergencyContact2)){this._emergencyContactsData=$$CADU.GetFamilyEmergencyContactsData(f,$$USER.PersonID,16,true);if(!$$CM.isNull(this._emergencyContactsData)){c.Page3Data.EmergencyContact1=this._emergencyContactsData.EmergencyContact1;c.Page3Data.EmergencyContact2=this._emergencyContactsData.EmergencyContact2}}c.Page5Data.CamperCellPhone=this._camperData.CellPhone;c.Page5Data.CamperLoginEmail=this._camperData.LoginEmail;if($$CM.isNull(c.Page6Data.FamilyBillingData)){this._familyBillingData=null;if(!$$CM.isNull(this._family1Data)){this._familyBillingData=$$CADU.GetFamilyBillingData(this._family1Data.FamilyID)}if(!$$CM.isNull(this._familyBillingData)){c.Page6Data.FamilyBillingData=this._familyBillingData}else{c.Page6Data.FamilyBillingData=new Object()}}this.ToggleCurrentCamper();this.Bind(c)},toggleConditionalPages:function(){var f=$A();if(!$$CM.isNull(this._page2)){var c=this._page2.GetData();if(!$$CM.isNull(c)&&$$CM.isArray(c.SessionAssignmentArray)){f=c.SessionAssignmentArray}}if(!$$CM.isNull(this._page4)){var e=$$CADU.GetApplicableSeasonalAdditionalOptionArray(this._seasonAdditionalOptionArray,f);this._page4.BindSeasonalListsData(e)}var g=$A();var d=$A();f.each(function(k){var l=k.SessionID;var m=g.find(function(n){Number(n)==Number(l)},this);if(l>0&&$$CM.isNull(m)){g.push(l)}var i=k.ProgramID;var j=d.find(function(n){Number(n)==Number(i)},this);if(i>0&&$$CM.isNull(j)){d.push(i)}},this);var a=$$CADU.GetYearAtCampIncrement(f);if(this._paginator.IsForward()){var h=1;if($$CM.isNumber(this._camperData.YearsAtCamp)&&this._camperData.YearsAtCamp>0){h=this._camperData.YearsAtCamp+a}var b=$A();b.push({Key:"G:SeasonID",Value:this._seasonID});b.push({Key:"G:Session",Value:g});b.push({Key:"G:Program",Value:d});b.push({Key:"G:Grade",Value:this._camperData.CampGradeID});b.push({Key:"G:YearsAtCamp",Value:h});this._ctrCustomFormPaginationWrapper.BindExternalData(b)}},onPageShownEvent:function(c,a){var b=a;if(!$$CM.isNull($$GAT)){$$GAT.trackPageView("campminder/camper/application/page"+b)}},getSeasonalListsData:function(){this._divLoading.Show();this._divWrapper.Hide();var d="SeasonalListsDataGet";var f=this._seasonID;var b=this._camperData;var e=0;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true){if(!$$CM.isNull(b)){e=b.PricingIdentifierID}}var g=this._tokenizedTimestamp;var a={mvcAction:d,seasonID:f,camperData:b,pricingIdentifierID:e,tokenizedTimestamp:g};var c={showProgress:false,message:"Retrieving Season Sessions. Please wait..."};$$CMD.ShowWaitDialog(c);this.seasonalListsDataFetch(a)},onSeasonalListsDataFetched:function(f,a){if($$CM.isNull(this._page2)){$$CMD.HideWaitDialog()}if(a.success==true){var e=a.seasonID;var b=this.seasonalListsDataGet({seasonID:e});if(!$$CM.isNull(b)){this._payInFullKey=b.PayInFullKey;this._seasonSessionList=b.SeasonSessionList;if(!$$CM.isArray(this._seasonSessionList)){this._seasonSessionList=$A()}this._sessionGroupSettingsList=b.SeasonSessionGroupSettingsList;if(!$$CM.isArray(this._sessionGroupSettingsList)){this._sessionGroupSettingsList=$A()}this._seasonHoldGroupSettings=b.SeasonHoldGroupSettings;if($$CM.isNull(this._seasonHoldGroupSettings)){this._seasonHoldGroupSettings=new Object()}this._seasonAdditionalOptionArray=$A();if($$CM.isArray(b.SeasonAdditionalOptionList)){this._seasonAdditionalOptionArray=b.SeasonAdditionalOptionList}if(!$$CM.isNull(this._page2)){var d=this;if($$CM.isNumber(b.CamperAge)){this._camperData.Age=Number(b.CamperAge)}setTimeout(function(){d._page2.BindSeasonalListsData(b,d._camperData)},10)}if(!$$CM.isNull(this._page6)&&this._page6Applicable==true){this._page6.BindSeasonalListsData(b)}}if($$CM.isNull(this._page2)){this.ShowPage(this._page2.ID());this._saveForLaterInit=null;this._paginator.ToggleTabIndex();this._divLoading.Hide();this._divWrapper.Show()}}else{this._divMessageWrapper.ClearChildControls(true);var c=$$P.div();this._divMessageWrapper.AddChild(c);c.AddClassName("cmAlert");c.UpdateInnerHtml("There was a problem retrieving seasonal session data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},onPage2BindSeasonalListsDataComplete:function(c,a){$$CMD.HideWaitDialog();if(this._page2.IsApplicable()==true){this.toggleConditionalPages()}else{if(this._settings.PricingIdentifierApplicable!=true||this._settings.EnablePricingIdentifierOnSessionSelector!=true){var b={title:"Alert",header:"",message:"There are no sessions that match this applicant's age, grade, or gender information. Please contact us with any questions you may have.",width:500};$$CMD.Alert(b)}}this.ShowPage(this._page2.ID());this._saveForLaterInit=null;this._paginator.ToggleTabIndex();this._divLoading.Hide();this._divWrapper.Show()},getFamilyFinancial:function(g){this._divLoading.Show();this._divWrapper.Hide();var j=this._seasonID;var h=$$USER.PersonID;var e=0;if(!$$CM.isNull(this._family1Data)){e=this._family1Data.FamilyID}var c=this._camperData;var d=this.GetData();this._personFormData=d;var k=$A();if(!$$CM.isNull(d.Page2Data)&&$$CM.isArray(d.Page2Data.SessionAssignmentArray)){k=d.Page2Data.SessionAssignmentArray}var l=$A();if(!$$CM.isNull(d.HoldGroupToken)&&$$CM.isArray(d.HoldGroupToken.SessionProgramHoldRequests)){l=d.HoldGroupToken.SessionProgramHoldRequests}var i=$A();if(!$$CM.isNull(d.Page3Data)&&$$CM.isArray(d.Page3Data.PromotionAssignmentArray)){i=d.Page3Data.PromotionAssignmentArray}var a=$A();if(!$$CM.isNull(d.Page4Data)&&$$CM.isArray(d.Page4Data.AdditionalOptionAssignmentArray)){a=d.Page4Data.AdditionalOptionAssignmentArray}var f="FamilyFinancialGet";var b={dataProperty:"FamilyFinancialArray",seasonID:j,familyID:e,personID:h,camperData:c,sessionAssignmentArray:k,sessionProgramHoldRequests:l,promotionAssignmentArray:i,additionalOptionAssignmentArray:a,payInFull:g,payInFullKey:this._payInFullKey,tokenizedTimestamp:this._tokenizedTimestamp};this.familyFinancialFetch(f,b)},onFamilyFinancialFetched:function(e,b){if(b.success==true){var d=this.familyFinancialGet(b);if(!$$CM.isNull(d)){if(d.SessionAssignmentDataChanged==true){cm.ui.utilityControls.growlBanner.ShowBanner("Session Assignment data has changed. You will be re-directed to session selection page.",2000,"jGrowlAlert");this.ToggleHoldGroupTokenTimer({activate:false});this._divLoading.Show();this._divWrapper.Hide();this.onSessionAssignmentDataChangedRedirect(d.SessionAssignmentArray)}else{this._financialCalculatorHash=d.Hash;if(!$$CM.isNull(this._page6)){var a={seasonID:b.seasonID,personID:b.personID,camperData:b.camperData,sessionAssignmentArray:b.sessionAssignmentArray,promotionAssignmentArray:b.promotionAssignmentArray,additionalOptionAssignmentArray:b.additionalOptionAssignmentArray,familyFinancial:d};this._page6.BindFamilyFinancial(a);if(!$$CM.isNull($$QC)&&$$QC.IsValid()){$$QC.ProcessCamperApplication(b.sessionAssignmentArray,d.FinancialItemArray)}}this._divLoading.Hide();this._divWrapper.Show()}}else{this._divLoading.Hide();this._divWrapper.Show()}}else{this._divMessageWrapper.ClearChildControls(true);var c=$$P.div();this._divMessageWrapper.AddChild(c);c.AddClassName("cmAlert");c.UpdateInnerHtml("There was a problem retrieving family financial data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},onApplyPromotionCode:function(l,b){var h=b.promotionCode;var i=this._seasonID;var g=$$USER.PersonID;var e=0;if(!$$CM.isNull(this._family1Data)){e=this._family1Data.FamilyID}var c=0;if(!$$CM.isNull(this._camperData)){c=this._camperData.PersonID}var d=this.GetData();this._personFormData=d;var j=$A();if(!$$CM.isNull(d.Page2Data)&&$$CM.isArray(d.Page2Data.SessionAssignmentArray)){j=d.Page2Data.SessionAssignmentArray}var k=$A();if(!$$CM.isNull(d.HoldGroupToken)&&$$CM.isArray(d.HoldGroupToken.SessionProgramHoldRequests)){k=d.HoldGroupToken.SessionProgramHoldRequests}var a={promotionCode:h,seasonID:i,familyID:e,parentPersonID:g,camperPersonID:c,camperData:this._camperData,sessionAssignmentArray:j,sessionProgramHoldRequests:k,tokenizedTimestamp:this._tokenizedTimestamp};var f="ApplyPromotionCode";this.applyPromotionCode(f,a)},onApplyPromotionCodeCompleted:function(b,a){this._page3.onApplyPromotionCodeCompleted(a)},getProviderPlanAmountArray:function(c,a,d,b,f,e){this._divLoading.Show();this._divWrapper.Hide();DAO.CamperApplication.ProviderPlanAmountGetList({ProviderID:c,AmountToBeInsured:a,ProviderPlanIDList:d,CountryCode:b,StateCode:f},{wait:true,scope:this,onSuccess:function(g){var i=g.data;if($$CM.isArray(i)){if(!$$CM.isNull(this._page7)){var j=null;var h=this._page3.GetData();if(!$$CM.isNull(h)&&!$$CM.isNull(h.Family1)&&!$$CM.isNull(h.Family1.HomeAddress)){j=h.Family1.HomeAddress.StateProvince}this._page7.BindCancellationInsuranceData(i,j)}}this._divLoading.Hide();this._divWrapper.Show()},onFailure:function(){this._divMessageWrapper.ClearChildControls(true);var g=$$P.div();this._divMessageWrapper.AddChild(g);g.AddClassName("cmAlert");g.UpdateInnerHtml("There was a problem retrieving cancellation insurance data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},this)},validatePromotionAssignments:function(g){if($$CM.isArray(g)){var h=$A();g.each(function(l){if(!$$CM.isNull(l)&&l.InDB!=true&&!$$CM.isEmpty(l.PromotionCode)){h.push(l.PromotionCode)}},this);if(h.length>0){var i=this._seasonID;var f=$$USER.PersonID;var d=0;if(!$$CM.isNull(this._family1Data)){d=this._family1Data.FamilyID}var b=0;if(!$$CM.isNull(this._camperData)){b=this._camperData.PersonID}var c=this.GetData();this._personFormData=c;var j=$A();if(!$$CM.isNull(c.Page2Data)&&$$CM.isArray(c.Page2Data.SessionAssignmentArray)){j=c.Page2Data.SessionAssignmentArray}var k=$A();if(!$$CM.isNull(c.HoldGroupToken)&&$$CM.isArray(c.HoldGroupToken.SessionProgramHoldRequests)){k=c.HoldGroupToken.SessionProgramHoldRequests}var a={promotionCodeArray:h,seasonID:i,familyID:d,parentPersonID:f,camperPersonID:b,camperData:this._camperData,sessionAssignmentArray:j,sessionProgramHoldRequests:k,tokenizedTimestamp:this._tokenizedTimestamp};var e="ValidatePromotionCodes";this.validatePromotionCodes(e,a)}}},onValidatePromotionCodesCompleted:function(b,a){this._page3.onValidatePromotionCodesCompleted(a)},onPayInFull:function(c,a){var b=false;if(!$$CM.isNull(a)){b=a.payInFull}this.getFamilyFinancial(b)},saveForLater:function(a){this.submit(a)},submit:function(c){var a={showProgress:false,message:"Please wait..."};$$CMD.HideWaitDialog();if(this._submitLock!=true){this._submitLock=true;$$CMD.ShowWaitDialog(a);var b={};b.fn=this.onValidSubmit;b.arg={pageID:c};b.scope=this;this._securityDAO.ValidateUserSession(b,false,true)}},onVerifyUser:function(b,a){this._securityDAO.ValidateUserSession(a,false,true)},onUserSessionValidated:function(d,a){$$CMD.HideWaitDialog();if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)&&!$$CM.isNumber(a.data)){cm.User.Bind(a.data);if(!$$CM.isNull(a.handler)&&!$$CM.isNull(a.handler.fn)){a.handler.fn.call(a.handler.scope,this,a.handler.arg);return}}else{var c=Number(a.data);switch(c){case 0:var b={title:"Session Expired",header:"The User Session has expired",message:"If you are an existing user in our system (or have already 'Saved for Later'), you may try your last action again by re-logging in using a second tab. Click on the following link <a target='_blank' href='/ui/forms/application/camper/App'>Re-Login</a> to open another tab in this browser. On that other tab, please re-login. If you are asked to update your security questions, please do so. Disregard the new application in the new tab and instead, return to this tab and try your last action again.<br>&nbsp;<br>If this fails, or you are a new user to our system, we are sorry but you will need to begin again. We suggest that you copy and paste the answers to your questions into a text editor to save them to try again. Once again, we are sorry for this inconvenience.",width:550};$$CMD.Alert(b);break;case 1:if(!$$CM.isNull(a.handler)&&!$$CM.isNull(a.handler.fn)){a.handler.fn.call(a.handler.scope,this,a.handler.arg);return}break;case 2:this._accountLoginSessionExpired.Bind(a.handler);this._accountLoginSessionExpiredDialog.Show();return;break}}this._submitLock=false},onAccountLoginSessionExpired_Login:function(c,a){this._accountLoginSessionExpiredDialog.Hide();var b=this._accountLoginSessionExpired.GetData();this._securityDAO.LoginCITUserV3(b.Email,b.Password,b.handler,false,true)},onCITUserLoggedIn:function(c,a){if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)){cm.User.Bind(a.data);if(!$$CM.isNull(a.handler)&&!$$CM.isNull(a.handler.fn)){a.handler.fn.call(a.handler.scope,this,a.handler.arg);return}}else{if(!$$CM.isNull(a.data.ErrorResponse)){var b={title:"Alert",header:a.data.ErrorResponse.Header,message:a.data.ErrorResponse.Message,width:400};$$CMD.Alert(b)}}this._submitLock=false},onAccountLoginSessionExpired_Close:function(b,a){this._accountLoginSessionExpiredDialog.Hide()},onAccountLoginSessionExpired_ResetAccount:function(c,a){this._accountLoginSessionExpiredDialog.Hide();var b=this._accountLoginSessionExpired.GetData();this._securityDAO.SendUserInviteCITUserV3(b.Email)},onUserInviteCITUserV3Sent:function(d,a){if(a.success==true){var b=this._accountLoginSessionExpired.GetData();var c={title:"Email sent",header:"",message:"An email has been sent to <strong>"+b.Email+"</strong>.<br />&nbsp;<br /><strong>Leave this page open!</strong><br />&nbsp;<br />Click on the link in that email to complete your password recovery process in another browser tab (OF THIS BROWSER). This will log you back in. If you are asked to update your security questions, please do so. Disregard the new application in that new tab and instead, return to this tab and try your last action again.<br />&nbsp;<br />Please check your JUNK/SPAM folder and note that password delivery may take up to 5 minutes.<br /><br />Make sure 'automation@campminder' is in your email White List.<br /><br />The password recovery link will expire in 1 hour."};$$CMD.AlertGo(c)}this._submitLock=false},onValidSubmit:function(g,a){var c={showProgress:false,message:"Please wait..."};$$CMD.ShowWaitDialog(c);var d=a.pageID;var b=this.GetData(d);var f=parseInt(b.SeasonID);var e=parseInt(b.PersonID);this.personFormModify({mvcAction:"CamperApplicationModify",seasonID:f,personID:e,data:b})},onPersonFormModified:function(o,a){$$CMD.HideWaitDialog();this._submitLock=false;if(!$$CM.isNull($$GAT)){$$GAT.trackPageView("campminder/camper/application/submitted")}if(a.success==true&&$$CM.isObject(a.data)){var b=a.data;var n=b.SeasonID;var m=b.PersonID;var l=this.personFormGet({seasonID:n,personID:m});if(l.Complete==true){this._appSummary.Bind(l);this._paginator.Hide();this._appSummary.Show();this._paginator.GetHistoryManager().ToggleHash(this._appSummary.ID());this.ToggleHoldGroupTokenTimer({activate:false});this.ResetPaginator();var p=0;if($$CM.isNumber(l.FinalBalance)){p=l.FinalBalance;if($$CM.isNumber(l.PreviousBalance)){p=p-l.PreviousBalance}if(p<0){p=0}}if($$QC.IsValid()){$$QC.ProcessOrders()}var c=this._settings.GeneralSettings;if(!$$CM.isNull(c)){if(!$$CM.isNull(c.GoogleAdWordsConversionID)&&!$$CM.isEmpty(c.GoogleAdWordsConversionID)&&!$$CM.isNull(c.GoogleAdWordsLabel)&&!$$CM.isEmpty(c.GoogleAdWordsLabel)){var d=c.GoogleAdWordsConversionID;var e=c.GoogleAdWordsLabel;jQuery.getScript("https://www.googleadservices.com/pagead/conversion_async.js").done(function(s,t){window.google_trackConversion({google_conversion_id:d,google_conversion_label:e,google_conversion_value:p,google_custom_params:{},google_remarketing_only:false})})}var q=c.YahooSearchMarketingAccountID;if(!$$CM.isEmpty(q)){var r=$("iFrameYahoo").contentWindow;r.location.href="/v2/common/iFrameYahoo.aspx?YahooValue="+p+"&YahooSearchMarketingAccountID="+q}var h=c.Microsoft_adCenterDomainID;if(!$$CM.isEmpty(h)){var i=$("iFrameMicrosoft").contentWindow;i.location.href="/v2/common/iFrameMicrosoft.aspx?Microsoft_adCenterDomainID="+h}if(!$$CM.isEmpty($$CLIENT.gtm)){var g=($$USER.ID==0)?1:0;var k=b.UserPersonID;var f={orderTotal:p,camperId:m,parentId:k,visitorType:(g?"New":"Returning"),event:"Reservation"};window[this._dataLayerProp].push(f)}}}else{if(!$$CM.isEmpty(l.ErrorMessage)){cm.ui.utilityControls.growlBanner.ShowBanner(l.ErrorMessage,2000,"jGrowlAlert");this.ToggleHoldGroupTokenTimer({activate:false});this._divLoading.Show();this._divWrapper.Hide()}else{cm.ui.utilityControls.growlBanner.ShowBanner("You have successfully saved for later",2000)}this.saveForLaterRedirect({personFormData:l})}}else{if(a.success==false&&(!$$CM.isNull(a.error)&&a.error.StandardExceptionCodeID==1)&&!$$CM.isNull(this._page6)){var j=this._page6.ID();this.ShowPage(j)}else{if(a.success==false&&(!$$CM.isNull(a.error)&&a.error.StandardExceptionCodeID==2)&&!$$CM.isNull(this._page2)){var j=this._page2.ID();this.ShowPage(j)}else{if(a.success==false||!$$CM.isObject(a.data)&&!$$CM.isEmpty(a.data)){this._paginator.Hide();this._appSummary.BindError(a.data);this._appSummary.Show();this.ToggleHoldGroupTokenTimer({activate:false});this.ResetPaginator()}}}}},saveForLaterRedirect:function(a){var c=a.personFormData;var e=c.SeasonID;var d=c.PersonID;var b={showProgress:false,message:"You have successfully saved for later. Redirecting to Session Selector. Please wait..."};$$CMD.ShowWaitDialog(b);if(!$$CM.isNull(this._page2)){this._saveForLaterInit={startPageID:this._page2.ID(),seasonID:e,personID:d,camperData:this._camperData,personFormData:c}}if($$USER.PersonID>0){this.getTokenizedTimestamp({refreshExpired:false})}else{this.getUserSession()}},getUserSession:function(){var a={};this._securityDAO.GetUserSession(a)},onUserSessionRetrieved:function(b,a){if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)&&!$$CM.isNumber(a.data)){cm.User.Bind(a.data);this.getTokenizedTimestamp({refreshExpired:false});this._securityDAO.TokenizedUserFetch(10080)}},onLoggedIn:function(c,a){var b=c;this._page0.Hide();this._divLoading.Show();$$CMD.HideWaitDialog();this.postInitialize()},showInstructions:function(){if(this._showInstructionsAtStart){if(this._userTypeFlag.CompareById($$USER.UserTypeFlag,0,0)!=true&&this._userTypeFlag.CompareById($$USER.UserTypeFlag,4,0)!=true){this.onInstructionsClicked();this._showInstructionsAtStart=false}}},onInstructionsClicked:function(d,a){var c=this.GetSettings();var b=((!$$CM.isNull(this._entityLabelSettings)&&!$$CM.isNull(this._entityLabelSettings.EntityLabelInstitution))?this._entityLabelSettings.EntityLabelInstitution:"camp");dialogCO=this.BuildInstructionsDialog(c,"Use the <strong>Continue</strong> and <strong>Back</strong> buttons on each page to navigate through this online form.","camperAppInstructions",b);$$CMD.Alert(dialogCO)},GetSeasonID:function(){return this._seasonID},GetSettings:function(){if($$CM.isNull(this._settings)){this._settings=new Object()}return this._settings},onDataUpdated:function(){var b=this.GetBoundData();var d="";if(!$$CM.isNull(b)){if(!$$CM.isNull(this._paginator)){var c=this._paginator.GetPageArray();c.each(function(f){if($$CM.isFunction(f.ClearLocalData)){f.ClearLocalData()}f.Bind(b)},this);if(!$$CM.isNull(this._ctrCustomFormPaginationWrapper)){var a=$A();if(!$$CM.isNull(b.PageCustomFormData)&&$$CM.isArray(b.PageCustomFormData.CustomFieldDataArray)){a=b.PageCustomFormData.CustomFieldDataArray}if(a.length>0){this._ctrCustomFormPaginationWrapper.Bind(a)}}var e=b.SaveForLaterPageNameID;if(e>1&&e<100){this.ShowPaginationHeader();this._saveForLaterInit={startPageID:this._page2.ID(),seasonID:b.SeasonID,personID:b.PersonID,camperData:this._camperData,personFormData:b};if(!$$CM.isNull(this._page1)&&this._page1.IsValid(true)){this.getSeasonalListsData()}}}}else{if(!$$CM.isNull(this._ctrCustomFormPaginationWrapper)){this._ctrCustomFormPaginationWrapper.Bind(null)}}this._submitLock=false},GetData:function(d){var c=this.GetBoundData();if($$CM.isNull(c)){c=new Object()}c.FormID=this._formID;c.SeasonID=this._seasonID;c.PayInFullKey=this._payInFullKey;c.TokenizedUserString=cm.dao.Base.Data.TokenizedUserString;c.HoldGroupToken=this._holdGroupToken;c.FinancialCalculatorHash=this._financialCalculatorHash;var a=true;c.SaveForLaterPageNameID=0;if(!$$CM.isEmpty(d)){a=false;c.SaveForLaterPageNameID=this._pageNameEnum.GetId(d);if(!$$CM.isInteger(c.SaveForLaterPageNameID)&&d.indexOf("CustomFields")>=0){c.SaveForLaterPageNameID=this._pageNameEnum.GetId("CustomFields")}}c.Complete=a;c.TokenizedTimestamp=this._tokenizedTimestamp;if(this._page1Applicable==true){c.Page1Data=this._page1.GetData();if(d==this._page1.ID()){return c}}if(this._page2Applicable==true&&this._page2.Visible==true){c.Page2Data=this._page2.GetData();if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true){c.Page2Data.PricingIdentifierID=this._camperData.PricingIdentifierID}if(d==this._page2.ID()){return c}}if(this._page3Applicable==true&&this._page3.Visible==true){c.Page3Data=this._page3.GetData();if(d==this._page3.ID()){return c}}if(this._page4Applicable==true||this._page4.Visible==true){c.Page4Data=this._page4.GetData();if(d==this._page4.ID()){return c}}if(this._page5Applicable==true&&this._page5.Visible==true){c.Page5Data=this._page5.GetData();if(d==this._page5.ID()){return c}}if($$CM.isNull(c.PageCustomFormData)){c.PageCustomFormData=new Object()}if(!$$CM.isArray(c.PageCustomFormData.CustomFieldDataArray)){c.PageCustomFormData.CustomFieldDataArray=$A()}if(!$$CM.isNull(this._ctrCustomFormPaginationWrapper)){var b=this._ctrCustomFormPaginationWrapper.GetData();c.PageCustomFormData.CustomFieldDataArray=b;if(!$$CM.isEmpty(d)&&d.indexOf("CustomFields")>-1){return c}}if(this._page6Applicable==true&&this._page6.Visible==true){c.Page6Data=this._page6.GetData();if(d==this._page6.ID()){return c}}if(this._page7Applicable==true&&this._page7.Visible==true){c.Page7Data=this._page7.GetData();if(d==this._page7.ID()){return c}}return c},onMaintenanceMessage_received:function(c,a){if(a.success==true&&!$$CM.isUndefinedOrNull(a)&&!$$CM.isUndefinedOrNull(a.data)){var b=$$P.div("cmMaintenance");b.AddClassName("cmMaintenance cmClear");b.AddChild($$P.h3(null,"System Maintenance"));b.AddChild($$P.div(null,a.data));this.Parent.AddChild(b,$$E(this))}}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.AppSummaryConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.AppSummary=Class.create(cm.ui.Control,{configureDefaultOptions:function(){return new cm.ui.forms.application.camper.AppSummaryConfigOptions()},initializeDAOs:function($super){$super();this._mediaDAO=new cm.dao.Media.DAO();this._commonDAO=new cm.dao.Common.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this.VB_DONOR=16777216;this._versionBranch=$$CLIENT.VersionBranch;this._isDonorVersionBranch=(this._versionBranch&this.VB_DONOR)==this.VB_DONOR;this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.ConfirmationPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.ConfirmationPageHeaderMessageCssClass}this._facebookID="";if(!$$CM.isEmpty(cm.dao.Security.Data.FacebookID)){this._facebookID=cm.dao.Security.Data.FacebookID}},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt0px mb15px "});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}if($$SETTINGSDU.GetCITSettings().EnableOLCamperApp){this.initOliversLabels()}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"<h4>Application Submitted</h4>",legendCssClass:"cmSectionHeader mb20px"});this.AddChild(this._fsWrapper);this._divDownloadPDF=$$P.div("divDownloadPDF");this._fsWrapper.AddChild(this._divDownloadPDF);this._divDownloadPDF.AddClassName("cmFormRow mb20px");this._btnDownloadPDF=new $$BTN("btnDownloadPDF",{text:"Print This Application"});this._divDownloadPDF.AddChild(this._btnDownloadPDF);this._btnDownloadPDF.AddClassName("cmGoButton");var a=this._settings.ConfirmationMessage;if(!$$CM.isEmpty(a)){this._ctrConfirmationMessage=new cm.ui.forms.SectionMessage("divConfirmationMessage_"+this._uniqueID,{message:a,cssClass:"cmClear mtb10px "});this._fsWrapper.AddChild(this._ctrConfirmationMessage);var b=this._settings.ConfirmationMessageCssClass;if(!$$CM.isEmpty(b)){this._ctrConfirmationMessage.AddClassName(b)}}this._divFacebookSharing=$$P.div("divFacebookSharing");this._fsWrapper.AddChild(this._divFacebookSharing);this._divFacebookSharing.AddClassName("cmFormRow cmSocialMedia");this._divFacebookSharingIcon=$$P.div("divFacebookSharingIcon");this._divFacebookSharing.AddChild(this._divFacebookSharingIcon);this._divFacebookSharingIcon.AddClassName("cmSocialMediaIcon");this._lnkFacebookSharingIcon=new $$A("lnkTwitterSharingIcon_"+this._uniqueID,{text:"<img alt='Share on Facebook' src='/v2/common/images/socialMedia/facebook31x31.png' />"});this._divFacebookSharingIcon.AddChild(this._lnkFacebookSharingIcon);this._divFacebookSharingLink=$$P.div("divFacebookSharingLink");this._divFacebookSharing.AddChild(this._divFacebookSharingLink);this._divFacebookSharingLink.AddClassName("cmSocialMediaLink");this._lnkFacebookSharingText=new $$A("lnkFacebookSharingText_"+this._uniqueID,{text:"{camperName} is going to camp... Tell everyone!"});this._divFacebookSharingLink.AddChild(this._lnkFacebookSharingText);if(!$$CM.isEmpty(this._facebookID)&&this._settings.FacebookEnableSharing==true){if(!$$CM.isNull(FB)&&FB._initialized!=true){FB.init({appId:this._facebookID,status:true,cookie:true,xfbml:true,version:"v2.0"});FB._initialized=true}}else{this._divFacebookSharing.Hide()}this._divTwitterSharing=$$P.div("divTwitterSharing");this._fsWrapper.AddChild(this._divTwitterSharing);this._divTwitterSharing.AddClassName("cmFormRow cmSocialMedia");this._divTwitterSharingIcon=$$P.div("divTwitterSharingIcon");this._divTwitterSharing.AddChild(this._divTwitterSharingIcon);this._divTwitterSharingIcon.AddClassName("cmSocialMediaIcon");this._lnkTwitterSharingIcon=new $$A("lnkTwitterSharingIcon_"+this._uniqueID,{text:"<img alt='Share on Twitter' src='/v2/common/images/socialMedia/twitter31x31.png' />"});this._divTwitterSharingIcon.AddChild(this._lnkTwitterSharingIcon);this._divTwitterSharingLink=$$P.div("divTwitterSharingLink");this._divTwitterSharing.AddChild(this._divTwitterSharingLink);this._divTwitterSharingLink.AddClassName("cmSocialMediaLink");this._lnkTwitterSharingText=new $$A("lnkTwitterSharingText_"+this._uniqueID,{text:"{camperName} is going to camp... Tweet this with your Twitter friends!"});this._divTwitterSharingLink.AddChild(this._lnkTwitterSharingText);if(this._settings.TwitterEnableSharing!=true){this._divTwitterSharing.Hide()}this._divDonate=$$P.div("divDonate");this._fsWrapper.AddChild(this._divDonate);this._divDonate.AddClassName("cmFormRow mtb20px");if(this._isDonorVersionBranch!=true||this._settings.EnableDonorLink!=true){this._divDonate.Hide()}this._btnDonate=new $$BTN("btnDonate",{text:"Make a gift today"});this._divDonate.AddChild(this._btnDonate);this._btnDonate.AddClassName("cmGoButton");this._divGoToButtons=$$P.div("divBeginNewApplication");this._fsWrapper.AddChild(this._divGoToButtons);this._divGoToButtons.AddClassName("cmFormRow mt10px");this._btnBeginNewApplication=new $$BTN("btnBeginNewApplication",{text:"Begin New Application"});this._divGoToButtons.AddChild(this._btnBeginNewApplication);this._btnBeginNewApplication.AddClassName("cmGoButton");this._btnMyAccountMenu=new $$BTN("btnMyAccountMenu",{text:"My Account Menu"});this._divGoToButtons.AddChild(this._btnMyAccountMenu);this._btnMyAccountMenu.AddClassName("cmGoButton cmFloatRight");this._fsSubmitionError=new $$FS("SubmitionError",{legendLabel:"Application Submission Error",legendCssClass:"cmSectionHeader"});this.AddChild(this._fsSubmitionError);this._fsSubmitionError.Hide();this._divSubmitionError=$$P.div("divSubmitionError");this._fsSubmitionError.AddChild(this._divSubmitionError);this._divSubmitionError.AddClassName("cmFormRow mtb10px");this._divSubmitionError.UpdateInnerHtml("Error goes here");var c=$$P.div();this.AddChild(c);c.AddClassName("cmFormRow mb20px")},wireEvents:function($super){$super();this._btnDownloadPDF.ClickEvent.subscribe(this.onDownloadPDF,this);this._lnkFacebookSharingIcon.ClickEvent.subscribe(this.onShareOnFacebook,this);this._lnkFacebookSharingText.ClickEvent.subscribe(this.onShareOnFacebook,this);this._lnkTwitterSharingIcon.ClickEvent.subscribe(this.onShareOnTwitter,this);this._lnkTwitterSharingText.ClickEvent.subscribe(this.onShareOnTwitter,this);this._btnDonate.ClickEvent.subscribe(this.onDonate,this);this._btnBeginNewApplication.ClickEvent.subscribe(this.onBeginNewApplication,this);this._btnMyAccountMenu.ClickEvent.subscribe(this.onMyAccountMenu,this)},onDownloadPDF:function(b,a){this._mediaDAO.DownloadFile(this._pdfFileName,"CamperApplication","FormFiles\\Received",false)},onShareOnFacebook:function(m,a){var n=$$CLIENT.V2DomainName;var k=this._camper.Name;var l=k.NickName;var j=k.FirstName;var f=this._settings.FacebookPostMessage;f=f.replace(/{nickname}/gi,l);f=f.replace(/{firstname}/gi,j);var c=this._settings.FacebookAttachmentLinkTitle;var g="http://"+n+".campintouch.com/v2/Redirector.aspx?url=";var d=g+this._settings.FacebookAttachmentLinkUrl.urlEncode();var b=this._settings.FacebookAttachmentDescription;b=b.replace(/{nickname}/gi,l);b=b.replace(/{firstname}/gi,j);var e=g+"http://www.campminder.com".urlEncode();var i={method:"feed",name:c,message:f,link:d,description:b};cm.ui.forms.application.camper.AppSummary.scope=this;function h(q){if(!$$CM.isNull(q)&&q.post_id){var p=cm.ui.forms.application.camper.AppSummary.scope;p._commonDAO.SocialNetworkSharingLogSave({personID:$$USER.PersonID,camperPersonID:p._camper.PersonID,socialNetworkID:1,source:"Camper Application (MVC)"});var o={title:"Thank You",header:"Sharing on Facebook",message:"Your post has been posted to your Facebook wall"};$$CMD.AlertGo(o)}else{var o={title:"Alert",header:"Sharing on Facebook",message:"Your post has NOT been posted to your Facebook wall"};$$CMD.AlertCancel(o)}}FB.ui(i,h)},onShareOnTwitter:function(h,a){var e=this._camper.Name;var f=e.NickName;var b=e.FirstName;var j=this._settings.TwitterLinkUrl;var k=this._settings.TwitterMessage;k=k.replace(/{nickname}/gi,f);k=k.replace(/{firstname}/gi,b);var g="http://twitter.com/share?count=none";g+="&text="+k.urlEncode();g+="&url="+j.urlEncode();var l=550;var c=300;var d=(screen.width/2)-(l/2);var i=(screen.height/2)-(c/2);$$CM.doPopup(g,"Twitter","width="+l+",height="+c+",left="+d+",top="+i+",location=0,menubar=0,status=0,titlebar=0,toolbar=0,resizable=0")},onDonate:function(b,a){document.location="/ui/forms/donor/Form"},initOliversLabels:function(){var a=$$SETTINGSDU.GetCITSettings().OLCustomHeaderText;this._divOL=$$P.div("divOL");this._olImage=new $$IMG("olImage",{source:"/MCMImages/MenuIcons/Tshirt.gif",alt:"Olivers Labels"});this._divOL.AddChild(this._olImage);this._divolLinks=$$P.div("divolLinks");this._divolLinks.AssignStyle("vertical-align","top");this._olLink=new $$A("olLink",{text:a});this._olLink.AssignStyle("font-weight","bold");this._divolLinks.AddChild(this._olLink);this._divOlMessage=$$P.div("divOlMessage");this._olMessageLine=$$P.p("olLabel","Click here to purchase labels for your child's clothing and other belongings.");this._olMessageLine.AddClassName("mt10px");this._divOlMessage.AddClassName("w400px");this._divOlMessage.AddChild(this._olMessageLine);this._divolLinks.AddChild(this._divOlMessage);this._divolLinks.AddClassName("cmInlineBlock ml10px mb0px");this._divOL.AddChild(this._divolLinks);this._divOL.AddClassName("cmFormRow");this.AddChild(this._divOL)},onBeginNewApplication:function(c,a){var b={showProgress:false,message:"Starting a new application. Please wait..."};$$CMD.ShowWaitDialog(b);setTimeout(function(){document.location="App"},2000)},onMyAccountMenu:function(b,a){document.location="/MyAccount.aspx"},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},Bind:function(a){this._fsWrapper.Show();this._fsSubmitionError.Hide();if(!$$CM.isNull(a)){this._pdfFileName=a.PdfFileName;this._camper=null;if(!$$CM.isNull(a.Page1Data)&&!$$CM.isNull(a.Page1Data.Camper)){this._camper=a.Page1Data.Camper}if(!$$CM.isNull(this._camper)&&!$$CM.isNull(this._camper.Name)){var b=this._camper.Name;this._facebookSharingLinkText=this._settings.FacebookSharingLinkText;this._facebookSharingLinkText=this._facebookSharingLinkText.replace(/{firstname}/gi,b.FirstName);this._facebookSharingLinkText=this._facebookSharingLinkText.replace(/{nickname}/gi,b.NickName);this._facebookSharingLinkText=this._facebookSharingLinkText.replace(/{lastname}/gi,b.LastName);this._lnkFacebookSharingText.UpdateInnerHtml(this._facebookSharingLinkText);this._twitterSharingLinkText=this._settings.TwitterSharingLinkText;this._twitterSharingLinkText=this._twitterSharingLinkText.replace(/{firstname}/gi,b.FirstName);this._twitterSharingLinkText=this._twitterSharingLinkText.replace(/{nickname}/gi,b.NickName);this._twitterSharingLinkText=this._twitterSharingLinkText.replace(/{lastname}/gi,b.LastName);this._lnkTwitterSharingText.UpdateInnerHtml(this._twitterSharingLinkText)}if(!$$CM.isNull(this._olLink)&&!$$CM.isNull(a.Oid)){this._olLink.SetLinkUrl("/ui/oliver/Label?oid="+a.Oid+"&ClientID="+$$CLIENT.ID)}}},BindError:function(a){this._fsWrapper.Hide();this._fsSubmitionError.Show();this._divSubmitionError.UpdateInnerHtml(a)}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page0ConfigOptions=Class.create(cm.ConfigOptions,{entityID:"Page0",settings:new Object()});cm.ui.forms.application.camper.Page0=Class.create(cm.ui.ComplexControl,{LoggedInEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page0ConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();this._controller=this._co.controller;if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._entityID=this._co.entityID;this._settings=this._co.settings;this._personAccountChecked=false;this._loginEmail="";if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.LoginPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.LoginPageHeaderMessageCssClass;this._pageMessage0=this._settings.MessagePage0;this._pageMessage0CssClass=this._settings.MessagePage0CustomTextClass}this._noticeMessage="<strong>Notice:</strong>&nbsp;<span class='cmRequiredField'>Required fields</span> have a dotted underline.";this._noticeMessageCssClass="cmClear cmAdvisory mt0px mb10px"},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO()},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("div"+this._entityID+"HeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mtb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._divControlsWrapper=$$P.div("div"+this._entityID+"ControlsWrapper_"+this._uniqueID);this.AddChild(this._divControlsWrapper);this._fsAboutYou=new $$FS("fs"+this._entityID+"AboutYou_"+this._uniqueID,{legendLabel:"About You (Parent/Guardian)",legendCssClass:"cmSectionHeader mb5px"});this._divControlsWrapper.AddChild(this._fsAboutYou);this._fsAboutYou.AddClassName("mt10px pt10px");if(!$$CM.isEmpty(this._noticeMessage)){this._ctrNoticeMessage=new cm.ui.forms.SectionMessage("div"+this._entityID+"Message_"+this._uniqueID,{message:this._noticeMessage,cssClass:this._noticeMessageCssClass});this._fsAboutYou.AddChild(this._ctrNoticeMessage)}this._divAboutYou=$$P.div("div"+this._entityID+"AboutYou_"+this._uniqueID);this._fsAboutYou.AddChild(this._divAboutYou);this._divAboutYou.AddClassName("cmFormRow");this._ftxtFirstName=new $$FTXT("ftxtFirstName_"+this._uniqueID,{label:"First Name",isRequired:true});this._divAboutYou.AddChild(this._ftxtFirstName);this._ftxtFirstName.AddClassName("mb5px");this._ftxtFirstName.Validator.addEvaluator($$EVAL.STRING({FieldName:"First Name",IsRequired:true}));this._ftxtFirstName.GetInputControl().SetAttribute("tabIndex","1");this._ftxtLastName=new $$FTXT("ftxtLastName_"+this._uniqueID,{label:"Last Name",isRequired:true});this._divAboutYou.AddChild(this._ftxtLastName);this._ftxtLastName.AddClassName("mb5px");this._ftxtLastName.Validator.addEvaluator($$EVAL.STRING({FieldName:"Last Name",IsRequired:true}));this._ftxtLastName.GetInputControl().SetAttribute("tabIndex","2");this._ftxtEmail=new $$FTXT("ftxtEmail_"+this._uniqueID,{label:"Email",isRequired:true,maxLength:100});this._divAboutYou.AddChild(this._ftxtEmail);this._ftxtEmail.AddClassName("mb5px");this._ftxtEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:"Email",IsRequired:true}));this._ftxtEmail.GetInputControl().SetAttribute("tabIndex","3");this._fddlLegalGuardian=new $$FDDL("fddlLegalGuardian_"+this._uniqueID,{label:"Relationship",isRequired:true});this._divAboutYou.AddChild(this._fddlLegalGuardian);this._fddlLegalGuardian.AddClassName("mb5px");this._fddlLegalGuardian.bindList($A([{Name:"I am a legal guardian/custodial parent",ID:1},{Name:"I am NOT a legal guardian/custodial parent",ID:2}]),"","Select",false);this._fddlLegalGuardian.Validator.addEvaluator($$EVAL.SELECT({FieldName:"Relationship",IsRequired:true}));this._fddlLegalGuardian.GetInputControl().SetAttribute("tabIndex","4");this._divButtonContainer=$$P.div("div"+this._entityID+"ButtonContainer_"+this._uniqueID);this._fsAboutYou.AddChild(this._divButtonContainer);this._divButtonContainer.AddClassName("cmBtnContainer");this._btnContinue=new $$BTN("btnContinue_"+this._uniqueID,{text:"Continue"});this._divButtonContainer.AddChild(this._btnContinue);this._btnContinue.AddClassName("cmGoButton cmFloatRight");this._btnContinue.SetAttribute("tabIndex","5");this.initializeModals()},initializeModals:function(){this._cmDivModals=$$P.div("div"+this._entityID+"Modals_"+this._uniqueID);this.AddChild(this._cmDivModals);this._accountCheck=new cm.ui.forms.AccountCheck("AccountCheck");this._accountCheck.CheckEvent.subscribe(this.onAccountCheck_Check,this);this._accountCheck.SkipEvent.subscribe(this.onAccountCheck_Skip,this);this._accountCheckDialog=new cm.ui.dialog.ModalDialog("AccountCheckDialog",{title:"Account Check",width:350,draggable:false,dialogClass:"cmGoDialog"});this._cmDivModals.AddChild(this._accountCheckDialog);this._accountCheckDialog.AddChild(this._accountCheck);this._accountCreate=new cm.ui.forms.AccountCreate("AccountCreate");this._accountCreate.ContinueEvent.subscribe(this.onAccountCreate_Continue,this);this._accountCreate.CloseEvent.subscribe(this.onAccountCreate_Close,this);this._accountCreateDialog=new cm.ui.dialog.ModalDialog("AccountCreateDialog",{title:"Create Account",width:400,draggable:false,dialogClass:"cmGoDialog"});this._cmDivModals.AddChild(this._accountCreateDialog);this._accountCreateDialog.AddChild(this._accountCreate);this._accountLogin=new cm.ui.forms.AccountLogin("AccountLogin");this._accountLogin.LoginEvent.subscribe(this.onAccountLogin_Login,this);this._accountLogin.CloseEvent.subscribe(this.onAccountLogin_Close,this);this._accountLogin.ResetAccountEvent.subscribe(this.onAccountLogin_ResetAccount,this);this._accountLoginDialog=new cm.ui.dialog.ModalDialog("AccountLoginDialog",{title:"Account Login",width:350,draggable:false,dialogClass:"cmGoDialog"});this._cmDivModals.AddChild(this._accountLoginDialog);this._accountLoginDialog.AddChild(this._accountLogin)},createEvents:function($super){$super();this.LoggedInEvent=new cm.event();this.AddEnterPressListener()},wireEvents:function($super){$super();this._btnContinue.ClickEvent.subscribe(this.onContinueClicked,this);this.EnterPressEvent.subscribe(this.onContinueClicked,this);this._securityDAO.LoginEmailChecked.subscribe(this.onLoginEmailChecked,this);this._securityDAO.PersonAccountChecked.subscribe(this.onPersonAccountChecked,this);this._securityDAO.CITUserLoggedIn.subscribe(this.onCITUserLoggedIn,this);this._securityDAO.ApplicationUserCreated.subscribe(this.onApplicationUserCreated,this);this._securityDAO.UserInviteCITUserV3Sent.subscribe(this.onUserInviteCITUserV3Sent,this)},onContinueClicked:function(d,a){this._loginEmail="";this._personAccountChecked=false;if(this.IsValid(true)==true){var c=$A();var b=this.GetData().Email;c.push(b);this._securityDAO.LoginEmailCheck(c)}},onLoginEmailChecked:function(c,a){if(a.success==true){$$CMD.HideWaitDialog();if(!this._personAccountChecked){if(!$$CM.isEmpty(a.data)){this._loginEmail=a.data;this.ShowAccountLoginDialog()}else{var b=this.GetData();if(!$$CM.isNull(b)){this._securityDAO.PersonAccountCheck(b.FirstName,b.LastName)}}}else{if(!$$CM.isEmpty(a.data)){this._loginEmail=a.data;this.ShowAccountLoginDialog()}else{this.ShowAccountCreateDialog()}}}else{$$CMD.HideWaitDialog();this._personAccountChecked=false;this._loginEmail=""}},onPersonAccountChecked:function(b,a){if(a.success==true){$$CMD.HideWaitDialog();this._personAccountChecked=true;if(a.data==true){this.ShowAccountCheckDialog()}else{this.ShowAccountCreateDialog()}}else{$$CMD.HideWaitDialog();this._personAccountChecked=false;this._loginEmail=""}},SetFocus:function(){this._ftxtFirstName.GetInputControl().Focus()},ShowAccountLoginDialog:function(){this._accountLogin.Bind(this.GetData());this._accountLoginDialog.Show();this._accountLogin.SetFocus()},ShowAccountCheckDialog:function(){this._accountCheck.Bind(this.GetData());this._accountCheckDialog.Show()},onAccountCheck_Check:function(e,a){var b=a.data;this._accountCheckDialog.Hide();var c={showProgress:false,message:"Checking your account..."};$$CMD.ShowWaitDialog(c);var d=b;this._securityDAO.LoginEmailCheck(d)},onAccountCheck_Skip:function(b,a){this._accountCheckDialog.Hide();this.ShowAccountCreateDialog()},ShowAccountCreateDialog:function(){this._accountCreate.Bind(this.GetData());this._accountCreateDialog.Show();this._accountCreate.SetFocus()},onAccountCreate_Continue:function(d,a){var b=a.data;this._accountCreateDialog.Hide();var c={showProgress:false,message:"Creating your account..."};$$CMD.ShowWaitDialog(c);this._securityDAO.CreateApplicationUser(this.GetData().FirstName,this.GetData().LastName,this.GetData().Email,b.Password1)},onApplicationUserCreated:function(b,a){if(a.success==true){var c=a.data;cm.User.Bind(c);this.LoggedInEvent.fire(this,{})}else{$$CMD.HideWaitDialog();this._personAccountChecked=false;this._loginEmail=""}},onAccountLogin_Login:function(d,a){var b=a.data;this._accountLoginDialog.Hide();var c={showProgress:false,message:"Logging you in..."};$$CMD.ShowWaitDialog(c);this._securityDAO.LoginCITUserV3(this.GetData().Email,b.Password,null,false,true)},onCITUserLoggedIn:function(e,a){if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)){if(!$$CM.isNull(a.data.RedirectResponse)&&a.data.RedirectResponse.Path.toLowerCase().indexOf("loginupgrade")>=0){this.redirectToUpdate(a.data)}else{var f=a.data;cm.User.Bind(f);this.LoggedInEvent.fire(this,{})}}else{$$CMD.HideWaitDialog();if(!$$CM.isNull(a.data.ErrorResponse)){var c=a.data.ErrorResponse.Message;var d=document.location.search;c=c.replace("click the 'Retrieve Password' link","go to the <a href='/v2/login/login.aspx"+d+"' target='_blank'>Log In</a> page and click the 'Retrieve Password' link");var b={title:"Alert",header:a.data.ErrorResponse.Header,message:c,width:400};$$CMD.Alert(b)}this._personAccountChecked=false;this._loginEmail=""}},onAccountLogin_ResetAccount:function(b,a){this._loginEmail="";this._personAccountChecked=false;this._accountLoginDialog.Hide();this._securityDAO.SendUserInviteCITUserV3(this.GetData().Email,this._controller.GetConfigOptions().formID)},onUserInviteCITUserV3Sent:function(c,a){if(a.success==true){var b={title:"Email sent",header:"",message:"An email has been sent to <strong>"+this.GetData().Email+"</strong>.<br /><br />Please check your JUNK/SPAM folder and note that password delivery may take up to 5 minutes.<br /><br />Make sure 'automation@campminder' is in your email White List.<br /><br />Click on the link in that email to complete your password recovery process. That link will expire in 1 hour."};$$CMD.AlertGo(b)}},onAccountCreate_Close:function(b,a){this._loginEmail="";this._personAccountChecked=false;this._accountCreateDialog.Hide()},onAccountLogin_Close:function(b,a){this._loginEmail="";this._personAccountChecked=false;this._accountLoginDialog.Hide()},Validate:function(d){var e=this._divControlsWrapper.Validator.validate();var b=true;if(e.IsValid()==true){var a=this.GetData();if(Number(a.LegalGuardian)!=1){d=false;e._isValid=false;var c=$$SETTINGSDU.GetFormattedCallUsMessage("This online application may be completed only by a legal parent/guardian.   If you have any questions",this._settings.GeneralSettings);$$CMD.AlertCancel({title:"Error",header:"",message:c})}}if(d==true){this.Validator.ShowErrors(e)}return e},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ftxtFirstName.Bind(null);this._ftxtLastName.Bind(null);this._fddlLegalGuardian.Bind(null);this._ftxtEmail.Bind(null)},onDataUpdated:function(){var a=this.GetBoundData();if(!$$CM.isNull(a)){var b=a;this._ftxtFirstName.Bind(b.FirstName);this._ftxtLastName.Bind(b.LastName);this._ftxtEmail.Bind(b.Email);this._fddlLegalGuardian.Bind(b.LegalGuardian)}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var a=this.GetBoundData();if($$CM.isNull(a)){a=new Object()}a.FirstName=this._ftxtFirstName.GetData();a.LastName=this._ftxtLastName.GetData();a.LegalGuardian=this._fddlLegalGuardian.GetData();if($$CM.isEmpty(this._loginEmail)){a.Email=this._ftxtEmail.GetData()}else{a.Email=this._loginEmail}return a},redirectToUpdate:function(a){if(!$$CM.isNull(a)&&!$$CM.isNull(a.RedirectResponse)&&a.RedirectResponse.Path!=""){var c="";if(a.RedirectResponse.Path.indexOf("http")==-1){c=c+$$CM.getProtocolHost()}c=c+a.RedirectResponse.Path;if(!$$CM.isEmpty(a.RedirectResponse.Token)){c=c+"&tkn="+a.RedirectResponse.Token}if(!$$CM.isEmpty(a.RedirectResponse.RedirectURL)){c=c+"&redirect_url="+a.RedirectResponse.RedirectURL.urlEncode()}if(!$$CM.isEmpty(a.RedirectResponse.Err)){c=c+"&err="+a.RedirectResponse.Err.urlEncode()}if(!$$CM.isNull(a.RedirectResponse.QueryString)&&a.RedirectResponse.QueryString!=""){c=c+"&"+a.RedirectResponse.QueryString}var b={showProgress:false,message:"Logging you in..."};$$CMD.ShowWaitDialog(b);window.location=c;return}}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page1ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonArray:$A(),seasonID:0,existingStatus:0,leadSourceArray:$A(),leadSourceCategoryArray:$A()});cm.ui.forms.application.camper.Page1=Class.create(cm.ui.pagination.PaginatorPage,{SeasonChangedEvent:null,CamperChangedEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page1ConfigOptions()},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._userTypeFlag=cm.dao.Security.Enums.UserTypeFlag.asEnum();this.FINANCIAL_MVC1=2097152;this._versionBranch=$$CLIENT.VersionBranch;this._isFinancialMVC1=(this._versionBranch&this.FINANCIAL_MVC1)==this.FINANCIAL_MVC1;this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;this._clientSettings=$$SETTINGSDU.GetClientSettings();this._entityLabelSettings=$$SETTINGSDU.GetEntityLabelSettings();this._v3FinancialSeasonID=0;if(!$$CM.isNull(this._clientSettings)){this._v3FinancialSeasonID=Number(this._clientSettings.V3FinancialSeasonID)}this._seasonArray=$A();if($$CM.isArray(this._co.seasonArray)){this._seasonArray=this._co.seasonArray}if(this._seasonArray.length<=0&&$$CM.isArray(cm.dao.Settings.Data.ApplicationCamperEnabledSeasonArray)){this._seasonArray=cm.dao.Settings.Data.ApplicationCamperEnabledSeasonArray}this._leadSourceArray=this._co.leadSourceArray;if((!$$CM.isArray(this._leadSourceArray)||this._leadSourceArray<=0)&&$$CM.isArray(cm.dao.Lists.Data.CamperLeadSourceArray)){this._leadSourceArray=cm.dao.Lists.Data.CamperLeadSourceArray}if($$CM.isArray(this._leadSourceArray)&&this._leadSourceArray.length>0){this._leadSourceArray=this._leadSourceArray.findAll(function(a){return a.IsInternal!=true})}this._leadSourceCategoryArray=this._co.leadSourceCategoryArray;if((!$$CM.isArray(this._leadSourceCategoryArray)||this._leadSourceCategoryArray<=0)&&$$CM.isArray(cm.dao.Lists.Data.CamperLeadSourceCategoryArray)){this._leadSourceCategoryArray=cm.dao.Lists.Data.CamperLeadSourceCategoryArray}if($$CM.isArray(this._leadSourceCategoryArray)&&this._leadSourceCategoryArray.length>0){this._leadSourceCategoryArray=this._leadSourceCategoryArray.findAll(function(a){return a.IsInternal!=true})}if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.CamperInformationPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.CamperInformationPageHeaderMessageCssClass;this._camperInstructions=this._settings.CamperInstructions;this._camperInstructionsCssClass=this._settings.CamperInstructionsCssClass;this._enableLeadSource=this._settings.EnableLeadSource;this._requireLeadSource=this._settings.RequireLeadSource;this._camperInformationHeaderMessage=this._settings.CamperInformationHeaderMessage;this._enableGender=this._settings.EnableGender;this._defaultGender=this._settings.DefaultGender;this._schoolIsDisabled=this._settings._schoolIsDisabled;this._schoolIsRequired=this._settings.SchoolIsRequired;this._enableTShirtSize=this._settings.EnableTShirtSize;this._requireTShirtSize=this._settings.RequireTShirtSize;this._enabledTShirtSizeArray=this._settings.EnabledTShirtSizeArray;this._enableSSN=this._settings.EnableSSN;this._disableGrade=this._settings.DisableGrade}},initializeUIElements:function(){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt0px mb15px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessage)&&this._seasonID>0){if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}else{this._ctrPageHeaderMessage.Hide()}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"",legendCssClass:"cmSectionHeader"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px_ mb20px_");this._divLeft=$$P.div("divLeft_"+this._uniqueID);this._fsWrapper.AddChild(this._divLeft);this._divLeft.AddClassName("cmFloatLeft w50prct");this._divRight=$$P.div("divRight_"+this._uniqueID);this._fsWrapper.AddChild(this._divRight);this._divRight.AddClassName("cmFloatRight w50prct");this._divSeason=$$P.div("divSeason_"+this._uniqueID);this._divLeft.AddChild(this._divSeason);this._divSeason.AddClassName("cmFormRow");this._fddlSeason=new $$FDDL("fddlSeason_"+this._uniqueID,{label:"Season",spanWidth:"60",inputWidth:"120"});this._divSeason.AddChild(this._fddlSeason);this._fddlSeason.bindList(this._seasonArray,"","Select a Season");this._fddlSeason.Validator.addEvaluator($$EVAL.SELECT({FieldName:"Season",IsRequired:true}));this._ctrLeadSource=new cm.ui.forms.LeadSourceSelector("divLeadSource_"+this._uniqueID,{uniqueID:this._uniqueID,isRequired:this._requireLeadSource,renderMode:2,leadSourceArray:this._leadSourceArray,leadSourceCategoryArray:this._leadSourceCategoryArray});this._divLeft.AddChild(this._ctrLeadSource);this._pLoadingCampers=$$P.p("pLoadingCampers_"+this._uniqueID);this._divLeft.AddChild(this._pLoadingCampers);this._pLoadingCampers.AddClassName("cmClear");this._pLoadingCampers.UpdateInnerHtml("<img alt='Loading data...' src='/v2/common/images/UI/gear.gif'> Loading data...");this._pLoadingCampers.Hide();this._divCampers=$$P.div("divCampers_"+this._uniqueID);this._divLeft.AddChild(this._divCampers);this._divCampers.AssignStyle("display","inline-block");this._divCampers.Hide(true);this._fsrblCampers=new $$FSRBL("fsCampers_"+this._uniqueID,{uniqueID:this._uniqueID,legendLabel:$$CM.convertToEntityLabelString("Campers",cm.dao.Settings.Data.EntityLabelSettings),legendCssClass:"cmLegendBasic ptb5px cmFloatLeft w100prct",isRequired:true});this._divCampers.AddChild(this._fsrblCampers);this._fsrblCampers.AddClassName("w100prct mb5px");this._divCamperInstructions=$$P.div("divCampers_"+this._uniqueID);this._divLeft.AddChild(this._divCamperInstructions);this._divCamperInstructions.AddClassName("cmFormRow");if(this._seasonID<=0){this._divCamperInstructions.Hide()}if(!$$CM.isEmpty(this._camperInstructions)){this._ctrCamperInstructions=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._camperInstructions,cssClass:"cmClear mtb0px mr10px"});this._divCamperInstructions.AddChild(this._ctrCamperInstructions);if(!$$CM.isEmpty(this._camperInstructionsCssClass)){this._ctrCamperInstructions.AddClassName(this._camperInstructionsCssClass)}}this._ctrCamperDetails=new cm.ui.forms.application.CamperDetails("ctrCamperDetails_"+this._uniqueID,{settings:this._settings});this._divRight.AddChild(this._ctrCamperDetails);this._ctrCamperDetails.Hide();this._divMessageWrapper=$$P.div("divMessageWrapper_"+this._uniqueID);this.AddChild(this._divMessageWrapper);this._divMessageWrapper.Hide();this._divMessage=$$P.div();this._divMessageWrapper.AddChild(this._divMessage);this._divMessage.AddClassName("cmAlert");if(!$$CM.isArray(this._seasonArray)||this._seasonArray.length<=0){this._fsWrapper.Hide();this._divMessageWrapper.Show();var a="No seasons available.";this._divMessage.UpdateInnerHtml(a)}},createEvents:function($super){$super();this.SeasonChangedEvent=new cm.event();this.CamperChangedEvent=new cm.event()},wireEvents:function($super){$super();this._fddlSeason.ChangeEvent.subscribe(this.onSeasonChanged,this);this._fsrblCampers.SelectionChangedEvent.subscribe(this.onCamperChanged,this)},onSeasonChanged:function(f,a){var b=this.GetBoundData();if(!$$CM.isNull(b)){b.SaveForLaterPageNameID=0}var e=this._fddlSeason.GetData();if($$CM.isNumber(e)){this._seasonID=Number(e)}else{this._seasonID=0}if(this._isFinancialMVC1!=true||(this._seasonID>0&&this._seasonID<this._v3FinancialSeasonID)){var d="?";var c=$$CM.GetQueryStringParam("domain");if(!$$CM.isEmpty(c)){d+="domain="+c}if(this._userTypeFlag.CompareById($$USER.UserTypeFlag,0,0)==true||this._userTypeFlag.CompareById($$USER.UserTypeFlag,4,0)==true){this.GetControllerDAO().redirectURL(document.location.protocol+"//"+document.location.host+"/v2/camper/application/App0.aspx"+d)}else{if(d.length>1){d+="&"}this.GetControllerDAO().redirectURL(document.location.protocol+"//"+document.location.host+"/v2/camper/application/App1.aspx"+d+"noInstructions=true&seasonID="+this._seasonID)}}else{this._ctrPageHeaderMessage.Hide();this._ctrCamperDetails.Hide();this._ctrLeadSource.Hide();this._divCampers.Hide();this._divCamperInstructions.Hide();if(e>0){this._pLoadingCampers.Show()}this.SeasonChangedEvent.fire(this,this.GetData())}},onCamperChanged:function(f,a){var d=f.GetValue();this._ctrCamperDetails.Hide();var b=null;if(!$$CM.isNull(this._camperIDNameArray)&&$$CM.isArray(this._camperIDNameArray)){b=this._camperIDNameArray.find(function(g){return g.ID==d},this)}if(this._isPrimaryFamilyParent==true){this.CamperChangedEvent.fire(this,{personID:d,seasonID:this._seasonID})}else{var e="Sorry; you don't have access to complete this application. Please contact the office.";var c={title:"Alert",header:"",message:e,width:500};$$CMD.Alert(c)}},CamperDetailsShow:function(a){if(!$$CM.isEmpty(this._fsrblCampers.GetData())){this._ctrCamperDetails.Show(a.animate,a.rate,a.effect,a.options,a.callback,a.scope,{})}},BindLeadSource:function(a){this._ctrLeadSource.Bind(a)},BindCamper:function(a){this._ctrCamperDetails.SetSeasonID(this._seasonID);this._ctrCamperDetails.Bind(a)},BindCamperArray:function(b,c){this._camperIDNameArray=b;this._isPrimaryFamilyParent=c;this._fsrblCampers.GetListControl().DestroyChildControls(true);if($$CM.isArray(this._camperIDNameArray)&&this._camperIDNameArray.length>0){var a="Camper_"+$$CM.uniqueID();if($$CM.isArray(this._camperIDNameArray)){this._camperIDNameArray.sortBy(function(d){return d.Name}).each(function(f){var l=true;if($$CM.IsUPR()){var m=FW.Data.GetStore("Camper").GetFirst("PersonStatusArray",{PersonID:f.ID,SeasonID:this._seasonID});if(!$$CM.isNull(m)){var o=new cm.ui.common.PersonStatus(m);if(!o.IsChild()||(o.IsChild()&&o.IsAlumniChild())){l=false}}else{var j=$$CLIENT.CurrentSeasonID;var n=FW.Data.GetStore("Camper").GetFirst("PersonStatusArray",{PersonID:f.ID,SeasonID:j});if(!$$CM.isNull(n)){var o=new cm.ui.common.PersonStatus(n);if(!o.IsChild()||(o.IsChild()&&o.IsAlumniChild())){l=false}}}}if(l==true){var e=f.CampGradeID;if(this._settings.MaxGradeID!=null&&this._settings.MinGradeID!=null&&$$CM.isNumber(e)&&Number(e)>-100){var u=e>this._settings.MaxGradeID;var v=e<this._settings.MinGradeID;l=!u&&!v}if(this._settings.MaxAge!=null&&this._settings.MinAge!=null&&!$$CM.isNull(f.CamperAge)){var p=this._settings.SeasonSessionGroupSettingsList;var q=this._settings.SeasonSessions;var g=this._settings.CampSettings;var r=this._settings;var s=(Math.floor(r.MaxAge))+((r.MaxAge%1)*8.300000000000001);var t=(Math.floor(r.MinAge))+((r.MinAge%1)*8.300000000000001);var k=this.determineYearDiff;var d=new Date(f.CamperDOBasString);var i=new Date();var h=0;p.each(function(z){var w=f.CamperAge;if(z.AgeEvaluationModeID==0){if(g.AgeMode==1){var x=null;q.each(function(B){var C=new Date(B.StartDateAsString);if(x==null){x=C}else{if(k(x,C)<0){x=C}}});if(!$$CM.isEmpty(x)){w=k(d,x)}}else{if(g.AgeMode==2){w=k(d,i)}else{var y=new Date(z.SeasonID,g.AgeMonth,g.AgeDay);w=k(d,y)}}}else{if(z.AgeEvaluationModeID==1){w=k(d,i)}else{if(z.AgeEvaluationModeID==2){if(z.AgeEvaluationSpecificDateAsString!=null&&z.AgeEvaluationSpecificDateAsString!=""){var A=new Date(z.AgeEvaluationSpecificDateAsString);w=k(d,A)}}else{if(z.AgeEvaluationModeID==3){var x=null;q.each(function(B){var C=new Date(B.StartDateAsString);if(x==null){x=C}else{if(k(x,C)<0){x=C}}});if(!$$CM.isEmpty(x)){w=k(d,x)}}else{if(z.AgeEvaluationModeID==5){var x=null;q.each(function(B){if(B.SessionGroupID==z.SessionGroupID){var C=new Date(B.StartDateAsString);if(x==null){x=C}else{if(k(x,C)<0){x=C}}}});if(!$$CM.isEmpty(x)){w=k(d,x)}}else{if(z.AgeEvaluationModeID==7){q.each(function(B){var C=new Date(B.StartDateAsString);w=k(d,C);if(w!=null&&s>=w&&t<=w){h++}});w=null}}}}}}if(w!=null&&s>=w&&t<=w){h++}});if(h==0){l=false}}}if(l){this._fsrblCampers.AddFormRadioButton({ID:f.ID,Name:f.Name,GroupName:a,cssClass:"cmCamperRadioRutton"})}},this)}if(this._isPrimaryFamilyParent==true){this._fsrblCampers.AddFormRadioButton({ID:0,Name:"Another Child",GroupName:a,cssClass:"cmCamperRadioRutton"});this._fsrblCampers.Validator.addEvaluator($$EVAL.GROUP({FieldName:$$CM.convertToEntityLabelString("Camper",cm.dao.Settings.Data.EntityLabelSettings),IsRequired:true}))}this._leadSourceApplicable=false;this._divCampers.Show(true);this._ctrCamperDetails.Hide()}else{if(this._seasonID>0){if(this._enableLeadSource!=true){this._leadSourceApplicable=false}else{this._leadSourceApplicable=true}this._ctrCamperDetails.Show(false);this.ContinueEnabled=true}else{this._leadSourceApplicable=false}}if(this._leadSourceApplicable!=true){this._ctrLeadSource.Hide()}this._pLoadingCampers.Hide()},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._fddlSeason.Bind(null)},onDataUpdated:function(){this.ClearFields();this._fddlSeason.Bind(this._seasonID);var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page1Data)){var b=a.Page1Data;if(!$$CM.isNull(b.Camper)&&$$CM.isInteger(b.Camper.PersonID)){this._fsrblCampers.Bind([b.Camper.PersonID])}}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetLeadSource:function(){var a=this._ctrLeadSource.GetData();data.LeadSourceData=a;return a},GetData:function(){var b=null;var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page1Data)){b=a.Page1Data}if($$CM.isNull(b)){b=new Object()}b.SeasonID=this._seasonID;var c=this._ctrLeadSource.GetData();b.LeadSourceData=c;b.Camper=this._ctrCamperDetails.GetData();return b},determineYearDiff:function(c,d){var e=86400000;var f=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());var g=Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());return(Math.floor((g-f)/e))/365}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page2ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0,seasonSessionArray:$A(),seasonSessionGroupArray:$A(),pricingRuleArray:$A()});cm.ui.forms.application.camper.Page2=Class.create(cm.ui.pagination.PaginatorPage,{TicketMasterFetchedEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page2ConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;this._sessionLabel="session";if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.SessionSelectionPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.SessionSelectionPageHeaderMessageCssClass;this._ssSectionMessage=this._settings.SessionSelectorHeaderMessage;this._ssSectionMessageCssClass=this._settings.SessionSelectorHeaderMessageCssClass;this._sessionLabel="session";if(!$$CM.isNull(this._settings)&&!$$CM.isNull(this._settings.SessionLabel)&&$$CM.isString(this._settings.SessionLabel)){this._sessionLabel=this._settings.SessionLabel}}this._sessionGroupArray=$A();if(!$$CM.isNull(cm.dao.Lists.Data.SessionGroupArray)&&$$CM.isArray(cm.dao.Lists.Data.SessionGroupArray)){this._sessionGroupArray=cm.dao.Lists.Data.SessionGroupArray}if($$CM.isArray(this._sessionGroupArray)){this._sessionGroupArray=this._sessionGroupArray.sort($$CM.sortByOrderIndex)}this._seasonSessionArray=this._co.seasonSessionArray;this._seasonSessionGroupArray=this._co.sessionGroupArray;this._pricingRuleArray=this._co.pricingRuleArray;this._pricingIdentifierID=0},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}var a=this.replaceSessionWithSessionLabel("<h4>Select Session</h4>");this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:a,legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");this._divSessionSelectorWrapper=$$P.div();this._fsWrapper.AddChild(this._divSessionSelectorWrapper)},replaceSessionWithSessionLabel:function(a){return a.replace(/session/ig,this._sessionLabel)},createEvents:function($super){$super();this.TicketMasterFetchedEvent=new cm.event();this.Page2BindCompleteEvent=new cm.event()},wireEvents:function($super){$super()},SetCamper:function(a,b){this._camperData=a;if(!$$CM.isNull(b)){this._camperData.PersonHash=b}},BindSeasonalListsData:function(c,a){if(!$$CM.isNull(a)){this.SetCamper(a,$$CM.isNull(c)?null:c.PersonHash)}this._pricingIdentifierID=0;this._seasonSessionArray=$A();this._pricingRuleArray=$A();if(!$$CM.isNull(c)){if($$CM.isNumber(c.PricingIdentifierID)&&c.PricingIdentifierID>0){this._pricingIdentifierID=c.PricingIdentifierID}if(!$$CM.isNull(c.PricingTableSettingsList)){this._pricingTableSettingsArray=c.PricingTableSettingsList}if(!$$CM.isNull(c.PricingRuleList)){this._pricingRuleArray=c.PricingRuleList}if(!$$CM.isNull(c.SeasonSessionList)){this._seasonSessionArray=c.SeasonSessionList}if(!$$CM.isNull(c.SeasonSessionGroupSettingsList)){this._sessionGroupSettingsArray=c.SeasonSessionGroupSettingsList}if(!$$CM.isNull(c.EnrollmentSessionGroupList)){this._enrollmentSessionGroupArray=c.EnrollmentSessionGroupList}}if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true){var b=this.GetBoundData();if(!$$CM.isNull(b)&&!$$CM.isNull(b.Page2Data)){this._pricingIdentifierID=b.Page2Data.PricingIdentifierID}}var d={legendLabel:"",legendCssClass:"cmSectionHeader mb20px",sectionMessage:this._ssSectionMessage,sectionMessageCssClass:this._ssSectionMessageCssClass,settings:this._settings,personHash:this._personHash,camperData:this._camperData,pricingIdentifierID:this._pricingIdentifierID,sessionGroupArray:this._sessionGroupArray,pricingTableSettingsArray:this._pricingTableSettingsArray,pricingRuleArray:this._pricingRuleArray,seasonSessionArray:this._seasonSessionArray,sessionGroupSettingsArray:this._sessionGroupSettingsArray,enrollmentSessionGroupArray:this._enrollmentSessionGroupArray};this._divSessionSelectorWrapper.DestroyChildControls(true);this._ctrSessionSelector=new cm.ui.forms.sessions.SessionSelector($$CM.uniqueID()+"_SS",d);this._divSessionSelectorWrapper.AddChild(this._ctrSessionSelector);this.isApplicable=this._ctrSessionSelector.IsApplicable();if(this.isApplicable==true){this.ReBind()}this.Page2BindCompleteEvent.fire(this,null)},ReBind:function(){var a=this.GetBoundData();this.Bind(a)},IsApplicable:function(){return this.isApplicable},Validate:function(a){var b=new cm.validation.ValidationResult("",null);var c=this._ctrSessionSelector.Validate();b.AppendResult(c);if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();if(!$$CM.isNull(this._ctrSessionSelector)){this._ctrSessionSelector.Bind(null)}},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this._originalData=Object.clone(a)}var c=this.GetLocalData();if(!$$CM.isNull(c)&&!$$CM.isNull(c.Page2Data)){var b=c.Page2Data;if(!$$CM.isNull(this._ctrSessionSelector)){this._ctrSessionSelector.Bind(b)}}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var a=this.GetBoundData();this._localData=a;var b=null;if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page2Data)){b=a.Page2Data}if($$CM.isNull(b)){b=new Object()}if(!$$CM.isNull(this._ctrSessionSelector)){var c=this._ctrSessionSelector.GetData();if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector==true&&c.PricingIdentifierID>0){b.PricingIdentifierID=c.PricingIdentifierID}b.SessionAssignmentArray=c.SessionAssignmentArray}if($$CM.isNull(this._localData)){this._localData=new Object()}this._localData.Page2Data=b;return b}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page3ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.Page3=Class.create(cm.ui.pagination.PaginatorPage,{LoginEmailCheckEvent:null,ApplyPromotionCodeEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page3ConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.ParentInformationPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.ParentInformationPageHeaderMessageCssClass;this._parentInformationHeaderMessage=this._settings.ParentInformationHeaderMessage;this._parentInformationHeaderMessageCssClass=this._settings.ParentInformationHeaderMessageCssClass;this._enableEmergencyContacts=this._settings.EnableEmergencyContacts;this._requireEmergencyContacts=this._settings.RequireEmergencyContacts;this._emergencyContactsMessage=this._settings.EmergencyContactsMessage;this._showF1P2=this._settings.EnableF1P2;this._f2ReceivesMailDisabled=this._settings.F2ReceivesMailDisabled;this._f2ReceivesMailDefaultValue=this._settings.F2ReceivesMailDefaultValue;this._f2ReceivesInvoiceCopiesDisabled=this._settings.F2ReceivesInvoiceCopiesDisabled;this._f2ReceivesInvoiceCopiesDefaultValue=this._settings.F2ReceivesInvoiceCopiesDefaultValue;this._enableSummerAddress=this._co.settings.EnableSummerAddress}},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"",legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");var e={entityID:"F1",name:"Household",primary:true,headerMessage:this._parentInformationHeaderMessage,headerMessageCssClass:this._parentInformationHeaderMessageCssClass,enableMailOption:false,requireMailOption:false,enableInvoiceOption:false,requireInvoiceOption:false};var c={enabled:true,legendLabel:"",legendCssClass:"",groupFieldName:"",defaultCountry:$$CLIENT.Country,required:true};var d={enabled:this._enableSummerAddress,legendLabel:"<h5>Summer Address</h5>",legendCssClass:"cmSectionHeader mb10px",groupFieldName:"",defaultCountry:$$CLIENT.Country,required:false,subTitle:"(If different than home address)"};var f={entityID:"F1P1",name:"Your Personal Information",legendLabel:"<h5>Your Personal Information</h5>",legendCssClass:"cmSectionHeader mb20px",requireLoginEmail:true,pEnabled:true};var g={entityID:"F1P2",name:"Second Parent/Guardian",legendLabel:"<h5>Second Parent/Guardian</h5>",legendCssClass:"cmSectionHeader mb20px",pEnabled:this._settings.EnableF1P2};this._ctrFamily1Details=new cm.ui.forms.application.FamilyDetails("ctrF1Details_"+this._uniqueID,{uniqueID:this._uniqueID,settings:this._settings,familyConfigOptions:e,address1ConfigOptions:c,address2ConfigOptions:d,parent1ConfigOptions:f,parent2ConfigOptions:g});this._fsWrapper.AddChild(this._ctrFamily1Details);this._aFamily2Add=new $$A("aFamily2Add_"+this._uniqueID,{text:"Add another parent/guardian who resides at a different address"});this._fsWrapper.AddChild(this._aFamily2Add);this._aFamily2Add.AddClassName("cmFormRow mb15px");var j={entityID:"F2",name:"Household #2",primary:false,headerMessage:null,headerMessageCssClass:null,enableMailOption:!this._f2ReceivesMailDisabled,requireMailOption:!this._f2ReceivesMailDisabled,mailOptionDefaultValue:this._f2ReceivesMailDefaultValue,enableInvoiceOption:!this._f2ReceivesInvoiceCopiesDisabled,requireInvoiceOption:!this._f2ReceivesInvoiceCopiesDisabled,invoiceOptionDefaultValue:this._f2ReceivesInvoiceCopiesDefaultValue};var h={enabled:true,legendLabel:"",legendCssClass:"",groupFieldName:"",defaultCountry:$$CLIENT.Country,required:false};var i={enabled:this._enableSummerAddress,legendLabel:"<h5>Summer Address</h5>",legendCssClass:"cmSectionHeader mb10px",groupFieldName:"",required:false,subTitle:"(If different than home address)"};var k={entityID:"F2P1",name:"Household #2, Parent/Guardian #1",legendLabel:"<h5>Household #2, Parent/Guardian #1</h5>",legendCssClass:"cmSectionHeader mb20px",pEnabled:true};var l={entityID:"F2P2",name:"Household #2, Parent/Guardian #2",legendLabel:"<h5>Household #2, Parent/Guardian #2</h5>",legendCssClass:"cmSectionHeader mb20px",pEnabled:false};this._ctrFamily2Details=new cm.ui.forms.application.FamilyDetails("ctrF2Details_"+this._uniqueID,{uniqueID:this._uniqueID,settings:this._settings,familyConfigOptions:j,address1ConfigOptions:h,address2ConfigOptions:i,parent1ConfigOptions:k,parent2ConfigOptions:l});this._fsWrapper.AddChild(this._ctrFamily2Details);this._ctrFamily2Details.AddClassName("mt10px");this._ctrFamily2Details.Hide(false);var b={uniqueID:this._uniqueID,legendLabel:"<h4>Emergency Contacts</h4>",legendCssClass:"cmSectionHeader mtb10px",initialTabIndex:32,optionalMessage:this._emergencyContactsMessage,required:this._requireEmergencyContacts};this._ctrEmergencyContacts=new cm.ui.forms.EmergencyContacts("divEmergencyContacts_"+this._uniqueID,b);this._fsWrapper.AddChild(this._ctrEmergencyContacts);if(this._enableEmergencyContacts==false){this._ctrEmergencyContacts.Hide(false)}var m="Please supply valid Promotional codes and/or coupons.";var a="";if(this._settings.PromoCodeMessage){m=this._settings.PromoCodeMessage}if(this._settings.PromoCodeMessageCssClass){a=this._settings.PromoCodeMessageCssClass}var n={uniqueID:this._uniqueID,legendLabel:"<h4>Promotions & Coupons</h4>",legendCssClass:"cmSectionHeader mtb10px",optionalMessage:m,optionalMessageCssClass:a,initialTabIndex:60};this._ctrPromotionsWidget=new cm.ui.forms.PromotionsWidget("divPromotionsWidget_"+this._uniqueID,n);this._fsWrapper.AddChild(this._ctrPromotionsWidget);if(this._settings.EnablePromoCodes!=true){this._ctrPromotionsWidget.Hide()}},createEvents:function($super){$super();this.LoginEmailCheckEvent=new cm.event();this.ApplyPromotionCodeEvent=new cm.event()},wireEvents:function($super){$super();this._aFamily2Add.ClickEvent.subscribe(this.onFamily2Add,this);this._ctrFamily2Details.RemoveFamilyEvent.subscribe(this.onFamily2Remove,this);this._ctrFamily1Details.LoginEmailCheckEvent.subscribe(this.onLoginEmailCheck,this);this._ctrFamily2Details.LoginEmailCheckEvent.subscribe(this.onLoginEmailCheck,this);this._ctrPromotionsWidget.ApplyPromotionCodeEvent.subscribe(this.onApplyPromotionCode,this)},SetCamper:function(a){this._camperData=a},onFamily2Add:function(b,a){this._aFamily2Add.Hide();this._ctrFamily2Details.Show(true,1000,"blind",{direction:"vertical"},this.onFamily2AnimationCompleted,this,{expanded:true})},onFamily2Remove:function(b,a){this._ctrFamily2Details.Hide(true,1000,"blind",{direction:"vertical"},this.onFamily2AnimationCompleted,this,{expanded:false})},onFamily2AnimationCompleted:function(a){if(a.expanded==true){this._ctrFamily2Details.onFamily2AnimationCompleted(a)}else{this._aFamily2Add.Show(true)}},onLoginEmailCheck:function(b,a){this.LoginEmailCheckEvent.fire(b,a)},onApplyPromotionCode:function(b,a){this.ApplyPromotionCodeEvent.fire(this,a)},onApplyPromotionCodeCompleted:function(a){this._ctrPromotionsWidget.onApplyPromotionCodeCompleted(a)},onValidatePromotionCodesCompleted:function(a){this._ctrPromotionsWidget.onValidatePromotionCodesCompleted(a)},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ctrFamily1Details.Bind();this._ctrFamily2Details.Bind();this._ctrEmergencyContacts.Bind();this._ctrPromotionsWidget.Bind();this._aFamily2Add.Show();this._ctrFamily2Details.Hide(false)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page3Data)){var b=a.Page3Data;if(!$$CM.isNull(b.Family1)){this._ctrFamily1Details.Bind(b.Family1);if(b.Family1.FamilyID>0){this._ctrFamily1Details.Show()}}if(!$$CM.isNull(b.Family2)){this._ctrFamily2Details.Bind(b.Family2);if(b.Family2.FamilyID>0){this._aFamily2Add.Hide();this._ctrFamily2Details.Show()}}var c=new Object();c.EmergencyContact1=b.EmergencyContact1;c.EmergencyContact2=b.EmergencyContact2;this._ctrEmergencyContacts.Bind(c);this._ctrPromotionsWidget.Bind(b.PromotionAssignmentArray)}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var b=null;var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page3Data)){b=a.Page3Data}if($$CM.isNull(b)){b=new Object()}b.Family1=this._ctrFamily1Details.GetData();if(this._ctrFamily2Details.IsVisible()){b.Family2=this._ctrFamily2Details.GetData()}var c=this._ctrEmergencyContacts.GetData();if(!$$CM.isNull(c)){b.EmergencyContact1=c.EmergencyContact1;b.EmergencyContact2=c.EmergencyContact2}b.PromotionAssignmentArray=this._ctrPromotionsWidget.GetData();return b}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page4ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.Page4=Class.create(cm.ui.pagination.PaginatorPage,{initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.AdditionalOptionsPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.AdditionalOptionsPageHeaderMessageCssClass;this._oasSectionMessage=this._settings.OptionalActivityHeaderMessage;this._oasSectionMessageCssClass=this._settings.OptionalActivityHeaderMessageCssClass}},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"<h4>Additional Options</h4>",legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");this._divSelectorWrapper=$$P.div();this._fsWrapper.AddChild(this._divSelectorWrapper)},wireEvents:function($super){$super()},SetCamper:function(a){this._camperData=a;this._ctrAdditionalOptionSelector.SetCamper(this._camperData)},BindSeasonalListsData:function(b){this._divSelectorWrapper.DestroyChildControls(true);var a={legendLabel:"",legendCssClass:"cmSectionHeader mb20px",sectionMessage:this._oasSectionMessage,sectionMessageCssClass:this._oasSectionMessageCssClass,settings:this._settings,additionalOptionArray:b,formID:101};this._ctrAdditionalOptionSelector=new cm.ui.forms.AdditionalOptionSelector($$CM.uniqueID()+"_AOS",a);this._divSelectorWrapper.AddChild(this._ctrAdditionalOptionSelector);this.isApplicable=this._ctrAdditionalOptionSelector.IsApplicable();if(this.isApplicable==true){this.ReBind()}this.SetApplicable(this.isApplicable)},IsApplicable:function(){return this.isApplicable},ReBind:function(){var a=this.GetBoundData();this.Bind(a)},Validate:function(a){var b=this._ctrAdditionalOptionSelector.Validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();if(!$$CM.isNull(this._ctrAdditionalOptionSelector)){this._ctrAdditionalOptionSelector.Bind()}},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)){this._originalData=Object.clone(a)}var c=this.GetLocalData();if(!$$CM.isNull(c)&&!$$CM.isNull(c.Page4Data)){var b=c.Page4Data;if(!$$CM.isNull(this._ctrAdditionalOptionSelector)&&!$$CM.isNull(b)){this._ctrAdditionalOptionSelector.Bind(b.AdditionalOptionAssignmentArray)}}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var a=this.GetBoundData();this._localData=a;var b=null;if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page4Data)){b=a.Page4Data}if($$CM.isNull(b)){b=new Object()}if(!$$CM.isNull(this._ctrAdditionalOptionSelector)){b.AdditionalOptionAssignmentArray=this._ctrAdditionalOptionSelector.GetData()}if($$CM.isNull(this._localData)){this._localData=new Object()}this._localData.Page4Data=b;return b}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page5ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.Page5=Class.create(cm.ui.pagination.PaginatorPage,{LoginEmailCheckEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page5ConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;this.isApplicable=this._settings.EnableCamperPhoto==true||this._settings.EnableCamperCellPhone==true||this._settings.EnableCamperEmail==true||this._settings.EnableBunkWithRequests==true||this._settings.EnableDoNotBunkWithRequests==true||this._settings.EnableCounselorRequests==true||this._settings.EnableBunkBedRequests==true;if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.AdditionalInformationPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.AdditionalInformationPageHeaderMessageCssClass;this._additionalInformationHeaderMessage=this._settings.AdditionalInformationHeaderMessage;this._additionalInformationHeaderMessageCssClass=this._settings.AdditionalInformationHeaderMessageCssClass}this._isNewAvatar=false},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO()},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"<h4>Additional Information</h4>",legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");if(!$$CM.isEmpty(this._additionalInformationHeaderMessage)){this._ctrAdditionalInformationHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._additionalInformationHeaderMessage,cssClass:"cmClear mtb10px "});this._fsWrapper.AddChild(this._ctrAdditionalInformationHeaderMessage);if(!$$CM.isEmpty(this._additionalInformationHeaderMessageCssClass)){this._ctrAdditionalInformationHeaderMessage.AddClassName(this._additionalInformationHeaderMessageCssClass)}}this._divPhoto=$$P.div("_divPhoto");this._fsWrapper.AddChild(this._divPhoto);this._divPhoto.AddClassName("cmFormRow mb20px");var c=$$CM.isNull(cm.dao.Settings.Data.EntityLabelSettings.EntityLabel)?"camper":cm.dao.Settings.Data.EntityLabelSettings.EntityLabel;var d=$$CM.isNull(cm.dao.Settings.Data.EntityLabelSettings.EntityLabelPossessive)?"camper's":cm.dao.Settings.Data.EntityLabelSettings.EntityLabelPossessive;this._ctrAvatarControl=new cm.ui.common.AvatarControl("ctrAvatarControl",{controller:this,isUPRProfile:false,isProfilePhoto:true,isSelf:false,personLabel:c,personLabelPossessive:d,instructionConclusion:"",verifyUserOnServerCall:true});this._divPhoto.AddChild(this._ctrAvatarControl);if(this._settings.EnableCamperPhoto!=true){this._ctrAvatarControl.Hide()}this._divContactInfo=$$P.div("divContactInfo");this._fsWrapper.AddChild(this._divContactInfo);this._divContactInfo.AddClassName("cmFormRow");var e=$$CM.convertToEntityLabelString("Camper Cell Phone",cm.dao.Settings.Data.EntityLabelSettings);this._ftxtCamperPhone=new $$FTXT("ftxtCamperPhone"+this._id,{label:e,isRequired:(this._settings.RequireCamperCellPhone==true),maxLength:15});this._divContactInfo.AddChild(this._ftxtCamperPhone);this._ftxtCamperPhone.GetTitleControl().AddClassName("w250px");this._ftxtCamperPhone.GetInputControl().AddClassName("w250px");this._ftxtCamperPhone.Validator.addEvaluator($$EVAL.STRING({FieldName:e,IsRequired:(this._settings.RequireCamperCellPhone==true)}));if(this._settings.EnableCamperCellPhone!=true){this._ftxtCamperPhone.Hide()}var f=$$CM.convertToEntityLabelString("Camper Email",cm.dao.Settings.Data.EntityLabelSettings);this._ftxtCamperEmail=new $$FEMAIL("ftxtCamperEmail"+this._id,{label:f,isRequired:(this._settings.RequireCamperEmail==true)});this._divContactInfo.AddChild(this._ftxtCamperEmail);this._ftxtCamperEmail.GetTitleControl().AddClassName("w250px");this._ftxtCamperEmail.GetInputControl().AddClassName("w250px");this._ftxtCamperEmail.Validator.addEvaluator($$EVAL.EMAIL({FieldName:f,IsRequired:(this._settings.RequireCamperEmail==true)}));if(this._settings.EnableCamperEmail!=true){this._ftxtCamperEmail.Hide()}var a=$$P.div();this._divContactInfo.AddChild(a);a.AddClassName("cmClear");var b=$$P.div();this._divContactInfo.AddChild(b);b.AddClassName("cmDivider mb5px");this._ctrBunkInfoBlockList=new cm.ui.forms.BunkInfoBlockList($$CM.uniqueID()+"_BIBL",{legendLabel:"",legendCssClass:"cmSectionHeader mb20px",settings:this._settings});this._fsWrapper.AddChild(this._ctrBunkInfoBlockList);this.SetApplicable(this.isApplicable)},createEvents:function($super){$super();this.InitializedAvatarModal=new cm.event();this.AvatarChangeEvent=new cm.event();this.VerifyUser=new cm.event();this.LoginEmailCheckEvent=new cm.event()},wireEvents:function($super){$super();this._ctrAvatarControl.InitializedEvent.subscribe(this.onInitializedAvatarModal,this);this._ctrAvatarControl.SubmitEvent.subscribe(this.onSubmitAvatarModal,this);this._ctrAvatarControl.ClearEvent.subscribe(this.onClearAvatarModal,this);this._ctrAvatarControl.VerifyUser.subscribe(this.onVerifyUser,this);this._securityDAO.PersonAvatarFileNameModified.subscribe(this.onPersonAvatarFileNameModified,this);this._ftxtCamperEmail.BlurEvent.subscribe(this.onLoginEmailCheck,this)},DestroyAvatarControl:function(){if(!$$CM.isNull(this._ctrAvatarControl)){this._ctrAvatarControl.Destroy()}},onLoginEmailCheck:function(b,a){this.LoginEmailCheckEvent.fire(b,{})},SetCamper:function(a){this._camperData=a;if(!$$CM.isNull(this._camperData)){var b=this._ftxtCamperPhone.GetData();if($$CM.isEmpty(b)&&!$$CM.isEmpty(this._camperData.CellPhone)){this._ftxtCamperPhone.Bind(this._camperData.CellPhone)}var c=this._ftxtCamperEmail.GetData();if($$CM.isEmpty(c)&&!$$CM.isEmpty(this._camperData.LoginEmail)){this._ftxtCamperEmail.Bind(this._camperData.LoginEmail);if(!$$CM.isNull(this._camperData)&&this._camperData.PersonID>0){this._ftxtCamperEmail.SetEnabled(false)}}}},onInitializedAvatarModal:function(){this.InitializedAvatarModal.fire(this,{})},onVerifyUser:function(b,a){this.VerifyUser.fire(this,a)},onSubmitAvatarModal:function(b,a){this._isNewAvatar=true;this.AvatarChangeEvent.fire(this,a)},onClearAvatarModal:function(){var c=this._ctrAvatarControl.GetData();var e=0;var b=$$CLIENT.ID;var a="";var d={};d.fn=this.onVerifyUserPersonAvatarFileNameModify;d.arg=[b,e,a];d.scope=this;this.VerifyUser.fire(this,d)},onVerifyUserPersonAvatarFileNameModify:function(e,a){var c=a[0];var d=a[1];var b=a[2];this._securityDAO.PersonAvatarFileNameModify(c,d,b)},onPersonAvatarFileNameModified:function(b,a){},AvatarControlGetData:function(){return avatarFileName},IsApplicable:function(){return this.isApplicable},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},ClearFields:function(){this.Validator.Clear();this._ftxtCamperPhone.Bind();this._ftxtCamperEmail.Bind();this._ctrBunkInfoBlockList.Bind()},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page5Data)){var c=a.Page5Data;if(!$$CM.isEmpty(c.CamperCellPhone)){this._ftxtCamperPhone.Bind(c.CamperCellPhone)}if(!$$CM.isEmpty(c.CamperLoginEmail)){this._ftxtCamperEmail.Bind(c.CamperLoginEmail);if(!$$CM.isNull(this._camperData)&&this._camperData.PersonID>0){this._ftxtCamperEmail.SetEnabled(false)}}var b={BunkWith:c.BunkWith,DoNotBunkWith:c.DoNotBunkWith,CounselorRequests:c.CounselorRequests,BunkBedRequests:c.BunkBedRequests};this._ctrBunkInfoBlockList.Bind(b)}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},BindAvatar:function(b){var a={PersonID:0,ClientID:$$CLIENT.ID,Gender:2};if(!$$CM.isNull(b)){a.PersonID=b.PersonID;var c=null;if($$CM.isNumber(b.Gender)){c=Number(b.Gender)}else{if($$CM.isNumber(b.GenderID)){c=Number(b.GenderID)}}b.Gender=c;b.GenderID=c;a.Gender=c;a.GenderID=c;a.AvatarFileName=b.AvatarFileName;a.ProfilePhotoURL=b.ProfilePhotoURL;a.AvatarURL=b.AvatarURL;a.PersonInfo=b}this._isNewAvatar=(a.PersonID<=0);this._ctrAvatarControl.Bind(a)},GetData:function(){var c=null;var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page5Data)){c=a.Page5Data}if($$CM.isNull(c)){c=new Object()}c.AvatarFileName=this._ctrAvatarControl.GetAvatarFileName();c.IsNewAvatar=this._isNewAvatar;c.CamperCellPhone=this._ftxtCamperPhone.GetData();c.CamperLoginEmail=this._ftxtCamperEmail.GetData();var b=this._ctrBunkInfoBlockList.GetData();if(!$$CM.isNull(b)){c.BunkWith=b.BunkWith;c.DoNotBunkWith=b.DoNotBunkWith;c.CounselorRequests=b.CounselorRequests;c.BunkBedRequests=b.BunkBedRequests}return c}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page6ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.Page6=Class.create(cm.ui.pagination.PaginatorPage,{PayInFullEvent:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page5ConfigOptions()},initializeDAOs:function($super){this._merchantDAO=new cm.dao.Merchant.DAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;this._financialSettings=FW.Data.GetStore("Settings").GetFirst("FinancialSettings");if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.BillingPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.BillingPageHeaderMessageCssClass}var a=0},initializeUIElements:function(){if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"",legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._ctrBillingDetails=new cm.ui.forms.application.BillingDetails("ctrBillingDetails_"+this._uniqueID,{uniqueID:this._uniqueID,settings:this._settings,seasonID:this._seasonID,legendLabel:"<h4>Billing Information</h4>",legendCssClass:"cmSectionHeader mb00px"});this._fsWrapper.AddChild(this._ctrBillingDetails);var a=this._merchantDAO.GetEnum("CreditCardVaultCategoryType");var b=a.GetId("ClientLegacy");this._ctrPaymentDetails=new cm.ui.forms.application.PaymentDetails("ctrPaymentDetails_"+this._uniqueID,{uniqueID:this._uniqueID,settings:this._settings,seasonID:this._seasonID,legendLabel:"<h4>Payment Information</h4>",legendCssClass:"cmSectionHeader mb00px",creditCardVaultCategoryTypeID:b,financialSettings:this._financialSettings});this._fsWrapper.AddChild(this._ctrPaymentDetails);this._ctrPaymentDetails.PayInFullEvent.subscribe(this.onPayInFull,this)},createEvents:function($super){$super();this.PayInFullEvent=new cm.event()},wireEvents:function($super){$super()},onPayInFull:function(b,a){this.PayInFullEvent.fire(this,{payInFull:a.payInFull})},SetPayInFullApplicable:function(a){this._ctrPaymentDetails.SetPayInFullApplicable(a)},ToggleBillingAddress:function(a){this._ctrBillingDetails.ToggleBillingAddress(a);this._ctrPaymentDetails.ToggleBillingAddress(a)},BindSeasonalListsData:function(a){this._ctrPaymentDetails.BindSeasonalListsData(a)},BindFamilyFinancial:function(a){this._ctrPaymentDetails.BindFamilyFinancial(a)},Validate:function(a){var b=this.Validator.validate();if(b.IsValid()){b.AppendResult(this._ctrBillingDetails.Validate())}if(b.IsValid()){b.AppendResult(this._ctrPaymentDetails.Validate())}if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._ctrBillingDetails.Bind(null);this._ctrPaymentDetails.Bind(null)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page6Data)){var b=a.Page6Data;this._ctrBillingDetails.Bind(b.FamilyBillingData);this._ctrPaymentDetails.Bind(b.FamilyBillingData)}},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var c=null;var b=this.GetBoundData();if(!$$CM.isNull(b)&&!$$CM.isNull(b.Page6Data)){c=b.Page6Data}if($$CM.isNull(c)){c=new Object()}if($$CM.isNull(c.FamilyBillingData)){c.FamilyBillingData=new Object()}var a=this._ctrBillingDetails.GetData();if(!$$CM.isNull(a)){c.FamilyBillingData.MailingTitle=a.MailingTitle;c.FamilyBillingData.Email=a.Email;c.FamilyBillingData.Address=a.Address;c.FamilyBillingData.ReceivesInvoices=a.ReceivesInvoices;c.FamilyBillingData.InvoiceDeliveryMethodID=a.InvoiceDeliveryMethodID;if(!$$CM.isInteger(c.FamilyBillingData.InvoiceDeliveryMethodID)){c.FamilyBillingData.InvoiceDeliveryMethodID=0}c.FamilyBillingData.BillingAddressID=a.BillingAddressID;c.FamilyBillingData.ModifyEntityAddressArray=a.ModifyEntityAddressArray}var d=this._ctrPaymentDetails.GetData();if(!$$CM.isNull(d)){c.FamilyBillingData.PayInFull=d.PayInFull;c.FamilyBillingData.DepositPaymentMethodID=d.DepositPaymentMethodID;c.FamilyBillingData.BillingPreferenceID=d.BillingPreferenceID;c.FamilyBillingData.CreditCardArray=d.CreditCardArray;c.FamilyBillingData.AchAccountArray=d.AchAccountArray}return c},GetTotals:function(){return this._ctrPaymentDetails.GetTotals()}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.Page7ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.Page7=Class.create(cm.ui.pagination.PaginatorPage,{configureDefaultOptions:function(){return new cm.ui.forms.application.camper.Page7ConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;this._sessionAssignmentArray=null;this._enumCreditCardGatewayType=FW.Enums.Financial.CreditCardGatewayType;this._enumCreditCardGatewayCategory=FW.Enums.Financial.CreditCardGatewayCategory;this._enumCreditCardCategory=FW.Enums.Financial.CreditCardCategory;this._enumCreditCardType=FW.Enums.Financial.CreditCardTypeAbbreviated;this._enumPaymentMethodType=FW.Enums.Financial.PaymentMethodTypeFlagStringValue;if(!$$CM.isNull(this._settings)){this._cancellationInsuranceLabel="Program Protector";this._cancellationInsuranceProviderID=this._settings.CancellationInsurancePlanIDsEnabled;this._cancellationInsuranceProviderPlanIDArray=$A();if($$CM.isArray(this._settings.CancellationInsurancePlanIDsEnabled)){this._cancellationInsuranceProviderPlanIDArray=this._settings.CancellationInsurancePlanIDsEnabled}this._pageHeaderMessage=this._settings.TermsAndConditionsPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.TermsAndConditionsPageHeaderMessageCssClass;this._backgroundCheckShowFlag=(this._settings.BackgroundCheckShowFlag&this._existingStatus)==this._existingStatus;this._referApplicationShowFlag=(this._settings.ReferApplicationShowFlag&this._existingStatus)==this._existingStatus;this._termsAndConditionsLabel=this._settings.TermsAndConditionsLabel;this._termsAndConditionsText=this._settings.TermsAndConditionsText;this._signatureConfirmationText=this._settings.SignatureConfirmationText}this._creditCardTypeArray=FW.Enums.CreditCardType.GetArrayWithout(0);this._creditCardTypeIDArray=$A();if($$CM.isArray(this._creditCardTypeArray)){this._creditCardTypeArray.each(function(a){this._creditCardTypeIDArray.push(a.ID)},this)}},initializeUIElements:function(){var a={legendLabel:"<h4>"+this._cancellationInsuranceLabel+"</h4>",legendLabelCssClass:"cmSectionHeader mb0px",headerMessage:this._cancellationInsuranceHeaderMessage,headerMessageCssClass:this._cancellationInsuranceHeaderMessageCssClass,providerID:this._cancellationInsuranceProviderID,providerPlanIDArray:this._cancellationInsuranceProviderPlanIDArray,ccObjectID:0,ccVaultType:1,ccLegendLabel:"<h5 class='fs16px'>"+this._cancellationInsuranceLabel+" Credit Card(s)</h5>",ccLegendCssClass:"w100prct mb0px",ccCreditCardGatewayTypeID:this._enumCreditCardGatewayType.GetId("Camp"),ccCreditCardGatewayCategoryID:this._enumCreditCardGatewayCategory.GetId("CancellationInsurance"),ccCreditCardCategoryID:this._enumCreditCardCategory.GetId("Individual"),ccCreditCardTypeIDArray:this._creditCardTypeIDArray};this._ctrCancellationInsuranceWidget=new cm.ui.forms.cancellationInsurance.CancellationInsuranceWidget("ctrCancellationInsuranceWidget_"+this._uniqueID,a);this.AddChild(this._ctrCancellationInsuranceWidget);this._ctrCancellationInsuranceWidget.CreditCardModifiedEvent.subscribe(this.onCancellationInsuranceCreditCardModified,this);this._ctrCancellationInsuranceWidget.ToggleApplicability();if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"<h4>"+this._termsAndConditionsLabel+"</h4>",legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");this._divTermsAndConditions=$$P.div("divTermsAndConditions_"+this._uniqueID);this._fsWrapper.AddChild(this._divTermsAndConditions);this._divTermsAndConditions.AddClassName("cmTermsAndConditions w510px h200px");if(!$$CM.isEmpty(this._termsAndConditionsText)){this._divTermsAndConditions.UpdateInnerHtml(this._termsAndConditionsText)}this._divTermsAndConditionsAgreement=$$P.div("divTermsAndConditionsAgreement_"+this._uniqueID);this._fsWrapper.AddChild(this._divTermsAndConditionsAgreement);this._divTermsAndConditionsAgreement.AddClassName("cmFormRow mb10px");var c="By entering my electronic signature below, I affirm that I have read and agree to the terms and conditions in this application.";if(!$$CM.isEmpty(this._signatureConfirmationText)){c=this._signatureConfirmationText}this._fcbTermsAndConditionsAgreement=new $$FCB("fcbTermsAndConditionsAgreement_"+this._uniqueID,{name:"Terms & Conditions Agreement",label:c,isRequired:true});this._divTermsAndConditionsAgreement.AddChild(this._fcbTermsAndConditionsAgreement);this._fcbTermsAndConditionsAgreement.AddClassName("cmBool w520px");this._fcbTermsAndConditionsAgreement.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this._fcbTermsAndConditionsAgreement.GetTitleControl().AddClassName("cmBold w500px");this._fcbTermsAndConditionsAgreement.Validator.addEvaluator($$EVAL.BOOL({IsRequired:true,RequireValue:true}));this._divSignature=$$P.div("divSignature_"+this._uniqueID);this._fsWrapper.AddChild(this._divSignature);this._divSignature.AddClassName("cmFormRow mtb10");this._ftxtSignature=new $$FTXT("ftxtSignature_"+this._uniqueID,{label:"Signature",isRequired:true});this._divSignature.AddChild(this._ftxtSignature);this._ftxtSignature.AddClassName("w80prct");this._ftxtSignature.GetInputControl().AddClassName("w200px");this._ftxtSignature.Validator.addEvaluator($$EVAL.TEXT({FieldName:"Signature",IsRequired:true}));this._ftxtSignatureDate=new $$FTXT("ftxtSignatureDate_"+this._uniqueID,{label:"",isRequired:true});this._divSignature.AddChild(this._ftxtSignatureDate);this._ftxtSignatureDate.AddClassName("w20prct");this._ftxtSignatureDate.GetInputControl().AddClassName("w100px");$$E(this._ftxtSignatureDate.GetInputControl()).disabled=true;this._ftxtSignatureDate.Validator.addEvaluator($$EVAL.DATE({FieldName:"Signature Date",IsRequired:true}));var b=new $$CMDATE();b.bindFromDate(new Date());var d=b.getFormattedDate(false,true,false,false,false);this._ftxtSignatureDate.Bind(d)},wireEvents:function($super){$super()},onCancellationInsuranceCreditCardModified:function(b,a){$$CADU.SetCustomCreditCardArray($$USER.PersonID,"CancellationCreditCardArray",a.creditCard)},BindCancellationCreditCardSelector:function(a){if(!$$CM.isNull(a)){this._ctrCancellationInsuranceWidget.BindCreditCardSelector(a.PersonID,a.CreditCardArray)}},BindCancellationInsuranceProviderID:function(a){this._ctrCancellationInsuranceWidget.BindProviderID(a)},BindCancellationInsuranceAmountToBeInsured:function(a){this._ctrCancellationInsuranceWidget.BindAmountToBeInsured(a)},BindSessionAssignments:function(a){this._sessionAssignmentArray=a},BindCancellationInsuranceData:function(a,c,b){this._ctrCancellationInsuranceWidget.BindStateCode(c);this._ctrCancellationInsuranceWidget.Bind(a)},CancellationInsuranceToggleApplicability:function(){this._ctrCancellationInsuranceWidget.ToggleApplicability()},CancellationInsuranceIsApplicable:function(){var a=$A();if(!$$CM.isNull(this._sessionAssignmentArray)&&$$CM.isArray(this._sessionAssignmentArray)){var b=this._sessionAssignmentArray.length;if(b>0){a=this._sessionAssignmentArray.findAll(function(c){return(!c.InDB&&!c.IsDeleted)})}}return a.length>0&&this._ctrCancellationInsuranceWidget.IsApplicable()},Validate:function(a){var b=this.Validator.validate();if(this.CancellationInsuranceIsApplicable()){var c=this._ctrCancellationInsuranceWidget.Validate();b.AppendResult(c)}if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._fcbTermsAndConditionsAgreement.Bind(null)},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page7Data)){var c=a.Page7Data}var b=new $$CMDATE();b.bindFromDate(new Date());var d=b.getFormattedDate(false,true,false,false,false);this._ftxtSignatureDate.Bind(d)},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var d=new Object();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page7Data)){d=a.Page7Data}var b=this._ctrCancellationInsuranceWidget.GetData();d.CancellationInsuranceData=b;d.TermsAndConditionsAgreement=this._fcbTermsAndConditionsAgreement.GetData();if(this._backgroundCheckShowFlag==true){d.BackgroundCheckAgreement=this._fcbBackgroundCheckAgreement.GetData()}if(this._referApplicationShowFlag==true){d.ReferToOtherCamps=this._fcbReferToOtherCamps.GetData()}d.Signature=this._ftxtSignature.GetData();var c=new $$CMDATE();c.bindFromDate(new Date());d.SignatureDateAsString=c.getData();return d}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.TestAppConfigOptions=Class.create(cm.ui.forms.application.ApplicationBaseConfigOptions,{controllerDataProperty:"PersonFormArray",mvcController:"application/Camper",seasonID:2015,personID:6066620,formID:101,registrationLockMode:10001,FINANCIAL_MVC1:2097152});cm.ui.forms.application.camper.TestApp=Class.create(cm.ui.forms.application.ApplicationBase,{isGoogleAnalyticsLoaded:false,googlePageTracker:null,iFrameGoogle:null,iFrameYahoo:null,iFrameMicrosoft:null,iFrameGoogleTagMgr:null,configureDefaultOptions:function(){return new cm.ui.forms.application.camper.TestAppConfigOptions()},initializeDAOs:function($super){$super();this._securityDAO=new cm.dao.Security.DAO();this._settingsDAO=new cm.dao.Settings.DAO();this._listsDAO=new cm.dao.Lists.DAO();this._camperDAO=new cm.dao.Camper.DAO();this._commonDAO=new cm.dao.Common.DAO();this._maintenanceDAO=new cm.dao.Maintenance.DAO();this._formsDAO=this.GetControllerDAO()},initializeData:function($super){$super();this._co=this.GetConfigOptions();this._maintenanceDAO.MaintenanceMessageFetch();this._submitLock=false;this._userTypeFlag=cm.dao.Security.Enums.UserTypeFlag.asEnum();this._daysOfWeekFlag=this._listsDAO.GetEnum("DaysOfWeek");this.FINANCIAL_MVC1=2097152;this._versionBranch=$$CLIENT.VersionBranch;this._isFinancialMVC1=(this._versionBranch&this.FINANCIAL_MVC1)==this.FINANCIAL_MVC1;this._clientSettings=$$SETTINGSDU.GetClientSettings();this._clientGeneralSettings=$$SETTINGSDU.GetClientGeneralSettings();this._camperSettings=$$SETTINGSDU.GetCamperSettings();this._financialSettings=$$SETTINGSDU.GetFinancialSettings();this._entityLabelSettings=$$SETTINGSDU.GetEntityLabelSettings();this._v3FinancialSeasonID=0;if(!$$CM.isNull(this._clientSettings)){this._v3FinancialSeasonID=Number(this._clientSettings.V3FinancialSeasonID)}this._test="test";this._existingStatus=1;this._applicationStatus=0;this._saveForLaterEnabled=true;this._showInstructionsAtStart=false;if($$CM.GetQueryStringParam("noInstructions")!="true"){this._showInstructionsAtStart=true}this._seasonID=this._co.seasonID;var b=Number($$CM.GetQueryStringParam("seasonID"));if(b>0){this._seasonID=b}this._personID=this._co.personID;var a=Number($$CM.GetQueryStringParam("personID"));if(a>0){this._personID=a}this._formID=this._co.formID;this._seasonArray=$A();if($$CM.isArray(cm.dao.Settings.Data.CamperApplicationSeasonArray)){this._seasonArray=cm.dao.Settings.Data.CamperApplicationSeasonArray}this._page0A_Applicable=(this._seasonArray.length<=0||this._seasonArray.length>1);this._sessionGroupArray=$A();if(!$$CM.isNull(cm.dao.Lists.Data.SessionGroupArray)&&$$CM.isArray(cm.dao.Lists.Data.SessionGroupArray)){this._sessionGroupArray=cm.dao.Lists.Data.SessionGroupArray}this._pageNameEnum=null;if($$CM.isArray(cm.dao.Forms.Enums.PageName)){this._pageNameEnum=cm.dao.Forms.Enums.PageName.asEnum()}this._cmDivModals=$$P.div("divModals");this.AddChild(this._cmDivModals);this._accountLoginSessionExpired=new cm.ui.forms.AccountLoginSessionExpired("AccountLoginSessionExpired");this._accountLoginSessionExpired.LoginSessionExpiredEvent.subscribe(this.onAccountLoginSessionExpired_Login,this);this._accountLoginSessionExpired.CloseSessionExpiredEvent.subscribe(this.onAccountLoginSessionExpired_Close,this);this._accountLoginSessionExpired.ResetAccountSessionExpiredEvent.subscribe(this.onAccountLoginSessionExpired_ResetAccount,this);this._accountLoginSessionExpiredDialog=new cm.ui.dialog.ModalDialog("AccountLoginSessionExpiredDialog",{title:"Account Login",width:350,draggable:false,dialogClass:"cmGoDialog"});this._cmDivModals.AddChild(this._accountLoginSessionExpiredDialog);this._accountLoginSessionExpiredDialog.AddChild(this._accountLoginSessionExpired);this._camperData=null;this._family1=null;this._family2=null;this._saveForLaterInit=null;this._seasonSessionList=$A();this._sessionGroupSettingsList=$A();this._seasonHoldGroupSettings=new Object()},initializeUIElements:function(){this._divSubHeader=$$P.div("divSubHeader");this.AddChild(this._divSubHeader);this._divSubHeader.AddClassName("hd");this._divTitle=$$P.div("divTitle");this._divSubHeader.AddChild(this._divTitle);this._divTitle.AssignStyle("width","450px");this._divTitle.AssignStyle("display","inline-block");var a=$$P.h4("HeadingTitle");this._divTitle.AddChild(a);a.AddClassName("cmPageHeader");var f=$$CM.convertToEntityLabelString("Camper Application",cm.dao.Settings.Data.EntityLabelSettings);try{f=cm.dao.Forms.Data.Forms[101].FormName}catch(c){}a.UpdateInnerHtml(f);a.AssignStyle("border","0");this._divTicketMaster=$$P.div("divTimer");this._divSubHeader.AddChild(this._divTicketMaster);this._divTicketMaster.AssignStyle("display","inline-block");this._divTicketMaster.AssignStyle("float","right");this._ctrHoldGroupTokenTimer=new $$TIMER("holdGroupTokenTimer",{durationInMinutes:0,startNow:false});this._divTicketMaster.AddChild(this._ctrHoldGroupTokenTimer);this._ctrHoldGroupTokenTimer.Hide();this._divInfoLinks=$$P.div("divInfoLinks");this.AddChild(this._divInfoLinks);this._divInfoLinks.Hide();this._divInfoLinksLeft=$$P.div("divInfoLinksLeft");this._divInfoLinks.AddChild(this._divInfoLinksLeft);this._divInfoLinksLeft.AddClassName("cmFloatLeft");this._divCamperShortInfo=$$P.div("divShortInfo");this._divInfoLinksLeft.AddChild(this._divCamperShortInfo);this._divCamperShortInfo.AddClassName("cmSubtle");this._divInfoLinksRight=$$P.div("divInfoLinksRight");this._divInfoLinks.AddChild(this._divInfoLinksRight);this._divInfoLinksRight.AddClassName("cmFloatRight");this._aInstructions=new $$A("aInstructions",{text:"Instructions"});this._divInfoLinksRight.AddChild(this._aInstructions);this._aInstructions.UpdateInnerHtml("Instructions");var b=$$P.div();this.AddChild(b);b.AddClassName("cmClear");this._divLoading=$$P.div("divLoading");this.AddChild(this._divLoading);this._divLoading.AddClassName("mt20px mb20px");var d="";var e="";if(!$$CM.isEmpty(cm.hosts.common)){e=cm.hosts.common}d=e+"/common/lib/core/ui/common/images/loading.gif";this._imgLoading=$$P.img();this._imgLoading.SetAttribute("src",d);this._divLoading.UpdateInnerHtml("Preparing your application...");this._divLoading.AddChild(this._imgLoading);this._divLoading.AddClassName("cmExpand");this._divWrapper=$$P.div("divWrapper");this.AddChild(this._divWrapper);this._divWrapper.AddClassName("w100prct mt20px mb10px");this._divWrapper.Hide();this._divMessageWrapper=$$P.div("divMessageWrapper");this.AddChild(this._divMessageWrapper);this._divMessageWrapper.Hide();this.iFrameGoogle=$$P.iframe("iFrameGoogle","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameGoogle);this.iFrameGoogle.Hide();this.iFrameYahoo=$$P.iframe("iFrameYahoo","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameYahoo);this.iFrameYahoo.Hide();this.iFrameMicrosoft=$$P.iframe("iFrameMicrosoft","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameMicrosoft);this.iFrameMicrosoft.Hide();if($$CLIENT.ID==532||$$CLIENT.ID==534){$$CLIENT.gtm=($$CLIENT.ID==532)?"GTM-TVQWVD":"GTM-MJ7FMX";this.iFrameGoogleTagMgr=$$P.iframe("iFrameGoogleTagMgr","/v2/common/images/clear.gif",1,1);this.AddChild(this.iFrameGoogleTagMgr);this.iFrameGoogleTagMgr.Hide()}},wireEvents:function($super){$super();this._securityDAO.LoginEmailChecked.subscribe(this.onLoginEmailChecked,this);this._securityDAO.UserSessionValidated.subscribe(this.onUserSessionValidated,this);this._securityDAO.UserSessionRetrieved.subscribe(this.onUserSessionRetrieved,this);this._securityDAO.CITUserLoggedIn.subscribe(this.onCITUserLoggedIn,this);this._securityDAO.UserInviteCITUserV3Sent.subscribe(this.onUserInviteCITUserV3Sent,this);this._maintenanceDAO.MaintenanceMessageReceivedEvent.subscribe(this.onMaintenanceMessage_received,this);this._camperDAO.FamilyInfoFetchedEvent.subscribe(this.onFamilyInfoFetched,this);this._commonDAO.TokenizedTimestampFetchedEvent.subscribe(this.onTokenizedTimestampFetched,this);this._commonDAO.HoldGroupTokenFetchedEvent.subscribe(this.onHoldGroupTokenFetched,this);this._commonDAO.HoldGroupTokenDeletedEvent.subscribe(this.onHoldGroupTokenDeleted,this);this._formsDAO.CamperRegistrationLockFetchedEvent.subscribe(this.onCamperRegistrationLockFetched,this);this._aInstructions.ClickEvent.subscribe(this.onInstructionsClicked,this);this._ctrHoldGroupTokenTimer.TimeRemainingEvent.subscribe(this.onHoldGroupTokenTimeRemaining,this);this._ctrHoldGroupTokenTimer.ExpiredEvent.subscribe(this.onHoldGroupTokenExpired,this)},fetchCamperRegistrationLock:function(){var a={};a.objectID=this._familyID;a.seasonID=this._seasonID;a.registrationLockMode=this._co.registrationLockMode;this._formsDAO.CamperRegistrationLockFetch(a)},onCamperRegistrationLockFetched:function(c,a){var b=this;setTimeout(function(){b.fetchCamperRegistrationLock()},30000)},onLoginEmailCheck:function(m,a){var b=m;var g=b.GetData();var c=this.GetData();this._personFormData=c;var h=$A();if(!$$CM.isNull(c.Page3Data)){var e=c.Page3Data.Family1;if(!$$CM.isNull(e)){var k=e.Parent1;if(!$$CM.isNull(k)&&!$$CM.isEmpty(k.LoginEmail)){h.push(k.LoginEmail)}var l=e.Parent2;if(!$$CM.isNull(l)&&!$$CM.isEmpty(l.LoginEmail)){h.push(l.LoginEmail)}}var f=c.Page3Data.Family2;if(!$$CM.isNull(f)){var k=f.Parent1;if(!$$CM.isNull(k)&&!$$CM.isEmpty(k.LoginEmail)){h.push(k.LoginEmail)}var l=f.Parent2;if(!$$CM.isNull(l)&&!$$CM.isEmpty(l.LoginEmail)){h.push(l.LoginEmail)}}}if(!$$CM.isNull(c.Page5Data)&&!$$CM.isEmpty(c.Page5Data.CamperLoginEmail)){h.push(c.Page5Data.CamperLoginEmail)}var i=h.findAll(function(n){return n.toLowerCase()==g.toLowerCase()},this);if(i.length>1){var j=g+" has already been used for this family! Please choose different email address.";var d={title:"Alert",header:"Login Email In-Use",message:j};$$CMD.Alert(d);b.Bind()}else{this._securityDAO.LoginEmailCheck([g],{ctrEmail:m})}},onLoginEmailChecked:function(e,a){var d=null;if(a.success==true){var b=a.ctrEmail;if(!$$CM.isEmpty(a.data)){d=a.data+" is in-use! Please choose different email address.";b.Bind()}}else{d="An error occurred validating email address."}if(!$$CM.isEmpty(d)){var c={title:"Alert",header:"Login Email In-Use",message:d};$$CMD.Alert(c)}},bindCamperShortInfo:function(){var b="";if(!$$CM.isNull(this._camperData)){var a=this._camperData.Name;if(!$$CM.isNull(a)){if(!$$CM.isEmpty(a.FullName)){b+="for "+a.FullName}else{b+="for "+a.FirstName+" "+a.LastName}if(!$$CM.isNull(this._seasonID)&&this._seasonID>0){b+=", "+this._seasonID+" Season"}}}this._divCamperShortInfo.UpdateInnerHtml(b)},bindCamperDetails:function(){if(!$$CM.isNull(this._page1)){this._page1.BindCamper(this._camperData);this._page1.CamperDetailsShow({animate:true,callback:this.TogglePaginationFooter,scope:this})}},renderPages:function(){this._divWrapper.ClearChildControls(false);var a=this.GetSettings();this._saveForLaterEnabled=!a.NoSaveForLater;this._divInfoLinks.Show();this._divWrapper.DestroyChildControls(true);if(!$$CM.isNull(this._paginator)){if(!$$CM.isNull(this._page5)){this._page5.DestroyAvatarControl()}this.ResetPaginator()}else{this._paginator=new cm.ui.pagination.ApplicationNumberPaginator("divNumberPaginator",{toggleTabIndex:true});this._paginator.PageShownEvent.subscribe(this.onPageShownEvent,this)}this._divWrapper.AddChild(this._paginator);this._divMessageWrapper.Hide();if(this._seasonArray.length>0){this._aInstructions.Show()}else{this._aInstructions.Hide();this._showInstructionsAtStart=false}this._page7Applicable=true;if(this._page7Applicable==true){this._page7=new cm.ui.forms.application.camper.TestPage7(this._pageNameEnum.GetName(7),{index:800,backEnabled:true,continueLabel:"Submit",settings:a,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus,visible:true});this._paginator.AddPage(this._page7);this._page7.BeforeLoadEvent.subscribe(this.onSignaturePageBeforeLoad,this);this._page7.AfterLoadEvent.subscribe(this.onAfterLoad,this);this._page7.BeforeContinueEvent.subscribe(this.onSignaturePageBeforeContinue,this);this._page7.SaveForLaterEvent.subscribe(this.onSaveForLater,this);this._page7.BeforeUnLoadEvent.subscribe(this.onSignaturePageBeforeUnLoad,this)}this._appSummary=new cm.ui.forms.application.camper.AppSummary(this._pageNameEnum.GetName(100),{index:900,settings:a,seasonID:this.GetSeasonID(),existingStatus:this._existingStatus});this._divWrapper.AddChild(this._appSummary);this._appSummary.Hide()},postInitialize:function(){this.getTokenizedTimestamp({refreshExpired:true});this._securityDAO.TokenizedUserFetch(10080)},onSignaturePageBeforeLoad:function(c,a){var b=c;this.ShowPaginationHeader()},onSignaturePageBeforeContinue:function(e,a){var c=e;var d=a.scope;var b=a.callback;if(!$$CM.isNull(d)&&!$$CM.isNull(b)){b.call(d)}},onSignaturePageBeforeUnLoad:function(c,a){var b=c;if(this._paginator.IsForward()){this.submit()}},onSaveForLater:function(d,a){var b=d;var c=b.ID();this.saveForLater(c)},onAfterLoad:function(c,a){var b=c;window.scrollTo(0,0)},maintainCCAndACHArraysOnRedirection:function(a){if(!$$CM.isNull(a)){var e=$A();var d=$A();if(!$$CM.isNull(this._familyBillingData)){if($$CM.isArray(this._familyBillingData.CreditCardArray)){e=this._familyBillingData.CreditCardArray}if($$CM.isArray(this._familyBillingData.AchAccountArray)){d=this._familyBillingData.AchAccountArray}}if($$CM.isNull(a.Page6Data)){a.Page6Data=new Object()}if(!$$CM.isNull(a.Page6Data.FamilyBillingData)){var c=a.Page6Data.FamilyBillingData.CreditCardArray;if(!$$CM.isArray(c)){c=$A()}e.each(function(g){var f=c.find(function(h){return h.ID==g.ID},this);if(f==null){c.push(g)}},this);var b=a.Page6Data.FamilyBillingData.AchAccountArray;if(!$$CM.isArray(b)){b=$A()}d.each(function(g){var f=b.find(function(h){return h.ID==g.ID},this);if(f==null){b.push(g)}},this)}}},ToggleCurrentCamper:function(){this.bindCamperShortInfo();this.bindCamperDetails()},ShowPage:function(c){if(!$$CM.isNull(this._paginator)){var b=this._paginator.GetPageArray();if($$CM.isArray(b)){var a=b.find(function(d){return d.ID()==c},this);if(!$$CM.isNull(a)){c=a.ID()}else{c=b[0].ID()}this.TogglePaginationHeader(c);this._paginator.ShowPage(c)}}},TogglePaginationHeader:function(b){var a=(this._page1Applicable==true&&!$$CM.isNull(this._page1)&&this._page1.ID()==b);if(a==true){this.HidePaginationHeader()}else{this.ShowPaginationHeader()}},HidePaginationHeader:function(){if(!$$CM.isNull(this._paginator)){this._paginator.HideHeader()}},ShowPaginationHeader:function(){if(!$$CM.isNull(this._paginator)){this._paginator.ShowHeader()}},ResetPaginator:function(){if(!$$CM.isNull(this._paginator)){this._paginator.Reset()}},TogglePaginationFooter:function(){if(!$$CM.isNull(this._paginator)&&!$$CM.isNull(this._paginator.GetCurrentPage())){this._paginator.updateFooter()}},getTokenizedTimestamp:function(a){this._commonDAO.TokenizedTimestampFetch({key:"CamperApp_101",refreshExpired:a.refreshExpired})},onTokenizedTimestampFetched:function(c,a){if(a.success==true){var b=this._commonDAO.TokenizedTimestampGet(a);if(!$$CM.isNull(b)&&!$$CM.isNull(b.Data)){this._tokenizedTimestamp=b.Data}this.onSeasonChanged(this,{SeasonID:this._seasonID})}else{}},onSeasonChanged:function(b,a){this._seasonID=a.SeasonID;this.getSeasonalSettingsData()},getSeasonalSettingsData:function(){var a="SeasonalSettingsDataGet";var b=this._seasonID;this.seasonalSettingsDataFetch({mvcAction:a,seasonID:b})},onSeasonalSettingsDataFetched:function(f,a){var d=this;$$CMD.HideWaitDialog();if(a.success==true){var e=a.seasonID;var b=d.seasonalSettingsDataGet({seasonID:e});if(!$$CM.isNull(b)){if(!$$CM.isNull(b.CamperApplicationSettings)){d._settings=b.CamperApplicationSettings;d._settings.MinGradeID=b.MinGradeID;d._settings.MaxGradeID=b.MaxGradeID}}this.renderPages();this.getFamilyInfoForCamper(this._seasonID,$$USER.PersonID,this._personID)}else{d._divMessageWrapper.ClearChildControls(true);var c=$$P.div();d._divMessageWrapper.AddChild(c);c.AddClassName("cmAlert");c.UpdateInnerHtml("There was a problem retrieving application settings.");d._divLoading.Hide();d._divWrapper.Hide();d._divMessageWrapper.Show()}},getFamilyInfoForCamper:function(f,e,b){var d="";var c="FamilyInfoGet";var a={dataProperty:"FamilyInfoArray",personID:e,camperID:b,seasonID:f,objectTypeFlagID:16,onSuccess:this.onGetFamilyInfoForCamper_success,onFailure:this.onGetFamilyInfoForCamper_failure};this._camperDAO.FamilyInfoFetch(d,c,a)},onGetFamilyInfoForCamper_success:function(a){var c=a.scope;var f=a.seasonID;var e=a.personID;var b=a.camperID;var d=a.objectTypeFlagID;c.getPersonForm(f,b)},onGetFamilyInfoForCamper_failure:function(a){var b=a.scope},onFamilyInfoFetched:function(j,a){if(a.success==true){var c=a.dataProperty;var i=a.seasonID;var h=a.personID;var b=a.camperID;var g=a.objectTypeFlagID;if(!$$CM.isNull(a.data)){var e=a.data.find(function(k){return k.Key=="familyID"},this);if(!$$CM.isNull(e)){var d=e.Data;if($$CM.isNumber(d)&&Number(d)>0){this._familyID=d;this.fetchCamperRegistrationLock();var f=this;jQuery(window).unload(function(){if($$CM.isNumber(d)&&$$CM.isNumber(i)){var k={};k.objectID=d;k.seasonID=i;k.registrationLockMode=f._co.registrationLockMode;f._formsDAO.RegistrationReleaseLock(k)}})}}}a.onSuccess({seasonID:i,personID:h,camperID:b,objectTypeFlagID:g,scope:this})}else{a.onFailure({scope:this})}},getPersonForm:function(b,a){this.personFormFetch({mvcAction:"CamperApplicationGet",seasonID:b,personID:a})},onPersonFormFetched:function(f,a){if(a.success==true){var e=a.seasonID;var d=a.personID;var c=this.personFormGet({seasonID:e,personID:d});this.toggleInitialData(c);this._divLoading.Hide();this._divWrapper.Show();this._divMessageWrapper.Hide()}else{this._divMessageWrapper.ClearChildControls(true);var b=$$P.div();this._divMessageWrapper.AddChild(b);b.AddClassName("cmAlert");b.UpdateInnerHtml("There was a problem retrieving application data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},toggleInitialData:function(b){if($$CM.isNull(b)){b=new Object()}var e=b.SeasonID;var c=b.PersonID;if(!$$CM.isNull(this._page1)){this._page1.ContinueEnabled=true}if($$CM.isNull(b.Page1Data)){b.Page1Data=new Object()}if($$CM.isNull(b.Page3Data)){b.Page3Data=new Object()}if($$CM.isNull(b.Page5Data)){b.Page5Data=new Object()}if($$CM.isNull(b.Page6Data)){b.Page6Data=new Object()}var a=$A();if($$CM.isArray(b.PersonRelationshipList)){var d=b.PersonRelationshipList.findAll(function(i){return Number(i.PersonID)==Number(c)},this);if(!$$CM.isNull(d)&&$$CM.isArray(d)){a=d}}this._camperData=$$CADU.GetCamperData(e,$$USER.PersonID,16,c,b);if(!$$CM.isNull(this._saveForLaterInit)&&!$$CM.isNull(this._saveForLaterInit.camperData)){var f=this._saveForLaterInit.camperData;if(!$$CM.isNull(f)){if($$CM.isNull(this._camperData)){this._camperData=this._saveForLaterInit.camperData}if($$CM.isInteger(f.CampGradeID)){this._camperData.CampGradeID=f.CampGradeID}if(!$$CM.isEmpty(f.DOBAsString)){this._camperData.DOBAsString=f.DOBAsString}if($$CM.isInteger(f.GenderID)){this._camperData.GenderID=f.GenderID}if(!$$CM.isNull(f.Name)){this._camperData.Name=f.Name}if($$CM.isInteger(f.PricingIdentifierID)){this._camperData.PricingIdentifierID=f.PricingIdentifierID}if(!$$CM.isEmpty(f.DOBAsString)){this._camperData.SSN=f.DOBAsString}if($$CM.isInteger(f.SchoolGradeID)){this._camperData.SchoolGradeID=f.SchoolGradeID}if(!$$CM.isEmpty(f.SchoolName)){this._camperData.SchoolName=f.SchoolName}if(!$$CM.isNull(f.TShirtSize)){this._camperData.TShirtSize=f.TShirtSize}if($$CM.isInteger(f.YearsAtCamp)){this._camperData.YearsAtCamp=f.YearsAtCamp}}else{if($$CM.isNull(this._camperData)){this._camperData=new Object()}}this._camperData.PersonID=c;var h=this._saveForLaterInit.personFormData;if(!$$CM.isNull(h)){var g=h.Page5Data;if(!$$CM.isNull(g)){if(!$$CM.isEmpty(g.CamperCellPhone)){this._camperData.CellPhone=g.CamperCellPhone}if(!$$CM.isEmpty(g.CamperLoginEmail)){this._camperData.LoginEmail=g.CamperLoginEmail}}}}b.Page1Data.Camper=this._camperData;this._family1Data=$$CADU.GetFamilyData(e,$$USER.PersonID,16,true,a);this._family2Data=$$CADU.GetFamilyData(e,$$USER.PersonID,16,false,a);if($$CM.isNull(b.Page3Data.Family1)){b.Page3Data.Family1=this._family1Data}if($$CM.isNull(b.Page3Data._family2Data)){b.Page3Data.Family2=this._family2Data}if($$CM.isNull(b.Page3Data.EmergencyContact1)&&$$CM.isNull(b.Page3Data.EmergencyContact2)){this._emergencyContactsData=$$CADU.GetFamilyEmergencyContactsData(e,$$USER.PersonID,16,true);if(!$$CM.isNull(this._emergencyContactsData)){b.Page3Data.EmergencyContact1=this._emergencyContactsData.EmergencyContact1;b.Page3Data.EmergencyContact2=this._emergencyContactsData.EmergencyContact2}}b.Page5Data.CamperCellPhone=this._camperData.CellPhone;b.Page5Data.CamperLoginEmail=this._camperData.LoginEmail;if($$CM.isNull(b.Page6Data.FamilyBillingData)){this._familyBillingData=null;if(!$$CM.isNull(this._family1Data)){this._familyBillingData=$$CADU.GetFamilyBillingData(this._family1Data.FamilyID)}if(!$$CM.isNull(this._familyBillingData)){b.Page6Data.FamilyBillingData=this._familyBillingData}else{b.Page6Data.FamilyBillingData=new Object()}}this.ToggleCurrentCamper();this.Bind(b)},toggleConditionalPages:function(){var f=$A();if(!$$CM.isNull(this._page2)){var c=this._page2.GetData();if(!$$CM.isNull(c)&&$$CM.isArray(c.SessionAssignmentArray)){f=c.SessionAssignmentArray}}if(!$$CM.isNull(this._page4)){var e=$$CADU.GetApplicableSeasonalAdditionalOptionArray(this._seasonAdditionalOptionArray,f);this._page4.BindSeasonalListsData(e)}var g=$A();var d=$A();f.each(function(k){var l=k.SessionID;var m=g.find(function(n){Number(n)==Number(l)},this);if(l>0&&$$CM.isNull(m)){g.push(l)}var i=k.ProgramID;var j=d.find(function(n){Number(n)==Number(i)},this);if(i>0&&$$CM.isNull(j)){d.push(i)}},this);var a=$$CADU.GetYearAtCampIncrement(f);if(this._paginator.IsForward()){var h=1;if($$CM.isNumber(this._camperData.YearsAtCamp)&&this._camperData.YearsAtCamp>0){h=this._camperData.YearsAtCamp+a}var b=$A();b.push({Key:"G:SeasonID",Value:this._seasonID});b.push({Key:"G:Session",Value:g});b.push({Key:"G:Program",Value:d});b.push({Key:"G:Grade",Value:this._camperData.CampGradeID});b.push({Key:"G:YearsAtCamp",Value:h});this._ctrCustomFormPaginationWrapper.BindExternalData(b)}},onPageShownEvent:function(c,a){var b=a;if(this.isGoogleAnalyticsLoaded==true&&this.googlePageTracker){this.googlePageTracker._trackPageview("campminder/camper/application/page"+b)}},getSeasonalListsData:function(){this._divLoading.Show();this._divWrapper.Hide();var d="SeasonalListsDataGet";var f=this._seasonID;var b=this._camperData;var e=0;if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true){if(!$$CM.isNull(b)){e=b.PricingIdentifierID}}var g=this._tokenizedTimestamp;var a={mvcAction:d,seasonID:f,camperData:b,pricingIdentifierID:e,tokenizedTimestamp:g};var c={showProgress:false,message:"Retrieving Season Sessions. Please wait..."};$$CMD.ShowWaitDialog(c);this.seasonalListsDataFetch(a)},onSeasonalListsDataFetched:function(f,a){if($$CM.isNull(this._page2)){$$CMD.HideWaitDialog()}if(a.success==true){var e=a.seasonID;var b=this.seasonalListsDataGet({seasonID:e});if(!$$CM.isNull(b)){this._payInFullKey=b.PayInFullKey;this._seasonSessionList=b.SeasonSessionList;if(!$$CM.isArray(this._seasonSessionList)){this._seasonSessionList=$A()}this._sessionGroupSettingsList=b.SeasonSessionGroupSettingsList;if(!$$CM.isArray(this._sessionGroupSettingsList)){this._sessionGroupSettingsList=$A()}this._seasonHoldGroupSettings=b.SeasonHoldGroupSettings;if($$CM.isNull(this._seasonHoldGroupSettings)){this._seasonHoldGroupSettings=new Object()}this._seasonAdditionalOptionArray=$A();if($$CM.isArray(b.SeasonAdditionalOptionList)){this._seasonAdditionalOptionArray=b.SeasonAdditionalOptionList}if(!$$CM.isNull(this._page2)){var d=this;if($$CM.isNumber(b.CamperAge)){this._camperData.Age=Number(b.CamperAge)}setTimeout(function(){d._page2.BindSeasonalListsData(b,d._camperData)},10)}if(!$$CM.isNull(this._page6)&&this._page6Applicable==true){this._page6.BindSeasonalListsData(b)}}if($$CM.isNull(this._page2)){this.ShowPage(this._page2.ID());this._saveForLaterInit=null;this._paginator.ToggleTabIndex();this._divLoading.Hide();this._divWrapper.Show()}}else{this._divMessageWrapper.ClearChildControls(true);var c=$$P.div();this._divMessageWrapper.AddChild(c);c.AddClassName("cmAlert");c.UpdateInnerHtml("There was a problem retrieving seasonal session data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},onPage2BindSeasonalListsDataComplete:function(c,a){$$CMD.HideWaitDialog();if(this._page2.IsApplicable()==true){this.toggleConditionalPages()}else{if(this._settings.PricingIdentifierApplicable!=true||this._settings.EnablePricingIdentifierOnSessionSelector!=true){var b={title:"Alert",header:"",message:"There are no sessions that match this applicant's age, grade, or gender information. Please contact us with any questions you may have.",width:500};$$CMD.Alert(b)}}this.ShowPage(this._page2.ID());this._saveForLaterInit=null;this._paginator.ToggleTabIndex();this._divLoading.Hide();this._divWrapper.Show()},getFamilyFinancial:function(g){this._divLoading.Show();this._divWrapper.Hide();var j=this._seasonID;var h=$$USER.PersonID;var e=0;if(!$$CM.isNull(this._family1Data)){e=this._family1Data.FamilyID}var c=this._camperData;var d=this.GetData();this._personFormData=d;var k=$A();if(!$$CM.isNull(d.Page2Data)&&$$CM.isArray(d.Page2Data.SessionAssignmentArray)){k=d.Page2Data.SessionAssignmentArray}var i=$A();if(!$$CM.isNull(d.Page3Data)&&$$CM.isArray(d.Page3Data.PromotionAssignmentArray)){i=d.Page3Data.PromotionAssignmentArray}var a=$A();if(!$$CM.isNull(d.Page4Data)&&$$CM.isArray(d.Page4Data.AdditionalOptionAssignmentArray)){a=d.Page4Data.AdditionalOptionAssignmentArray}var f="FamilyFinancialGet";var b={dataProperty:"FamilyFinancialArray",seasonID:j,familyID:e,personID:h,camperData:c,sessionAssignmentArray:k,promotionAssignmentArray:i,additionalOptionAssignmentArray:a,payInFull:g,payInFullKey:this._payInFullKey,tokenizedTimestamp:this._tokenizedTimestamp};this.familyFinancialFetch(f,b)},onFamilyFinancialFetched:function(e,b){if(b.success==true){var d=this.familyFinancialGet(b);if(!$$CM.isNull(d)){if(d.SessionAssignmentDataChanged==true){cm.ui.utilityControls.growlBanner.ShowBanner("Session Assignment data has changed. You will be re-directed to session selection page.",2000,"jGrowlAlert");this._divLoading.Show();this._divWrapper.Hide();this.onSessionAssignmentDataChangedRedirect(d.SessionAssignmentArray)}else{this._financialCalculatorHash=d.Hash;if(!$$CM.isNull(this._page6)){var a={seasonID:b.seasonID,personID:b.personID,camperData:b.camperData,sessionAssignmentArray:b.sessionAssignmentArray,promotionAssignmentArray:b.promotionAssignmentArray,additionalOptionAssignmentArray:b.additionalOptionAssignmentArray,familyFinancial:d};this._page6.BindFamilyFinancial(a)}this._divLoading.Hide();this._divWrapper.Show()}}else{this._divLoading.Hide();this._divWrapper.Show()}}else{this._divMessageWrapper.ClearChildControls(true);var c=$$P.div();this._divMessageWrapper.AddChild(c);c.AddClassName("cmAlert");c.UpdateInnerHtml("There was a problem retrieving family financial data");this._divLoading.Hide();this._divWrapper.Hide();this._divMessageWrapper.Show()}},onApplyPromotionCode:function(k,b){var h=b.promotionCode;var i=this._seasonID;var g=$$USER.PersonID;var e=0;if(!$$CM.isNull(this._family1Data)){e=this._family1Data.FamilyID}var c=0;if(!$$CM.isNull(this._camperData)){c=this._camperData.PersonID}var d=this.GetData();this._personFormData=d;var j=$A();if(!$$CM.isNull(d.Page2Data)&&$$CM.isArray(d.Page2Data.SessionAssignmentArray)){j=d.Page2Data.SessionAssignmentArray}var a={promotionCode:h,seasonID:i,familyID:e,parentPersonID:g,camperPersonID:c,camperData:this._camperData,sessionAssignmentArray:j,tokenizedTimestamp:this._tokenizedTimestamp};var f="ApplyPromotionCode";this.applyPromotionCode(f,a)},onApplyPromotionCodeCompleted:function(b,a){this._page3.onApplyPromotionCodeCompleted(a)},validatePromotionAssignments:function(g){if($$CM.isArray(g)){var h=$A();g.each(function(k){if(!$$CM.isNull(k)&&k.InDB!=true&&!$$CM.isEmpty(k.PromotionCode)){h.push(k.PromotionCode)}},this);if(h.length>0){var i=this._seasonID;var f=$$USER.PersonID;var d=0;if(!$$CM.isNull(this._family1Data)){d=this._family1Data.FamilyID}var b=0;if(!$$CM.isNull(this._camperData)){b=this._camperData.PersonID}var c=this.GetData();this._personFormData=c;var j=$A();if(!$$CM.isNull(c.Page2Data)&&$$CM.isArray(c.Page2Data.SessionAssignmentArray)){j=c.Page2Data.SessionAssignmentArray}var a={promotionCodeArray:h,seasonID:i,familyID:d,parentPersonID:f,camperPersonID:b,camperData:this._camperData,sessionAssignmentArray:j,tokenizedTimestamp:this._tokenizedTimestamp};var e="ValidatePromotionCodes";this.validatePromotionCodes(e,a)}}},onValidatePromotionCodesCompleted:function(b,a){this._page3.onValidatePromotionCodesCompleted(a)},onPayInFull:function(c,a){var b=false;if(!$$CM.isNull(a)){b=a.payInFull}this.getFamilyFinancial(b)},saveForLater:function(a){this.submit(a)},submit:function(c){var a={showProgress:false,message:"Please wait..."};$$CMD.HideWaitDialog();if(this._submitLock!=true){this._submitLock=true;$$CMD.ShowWaitDialog(a);var b={};b.fn=this.onValidSubmit;b.arg={pageID:c};b.scope=this;this._securityDAO.ValidateUserSession(b,false,true)}},onVerifyUser:function(b,a){this._securityDAO.ValidateUserSession(a,false,true)},onUserSessionValidated:function(d,a){$$CMD.HideWaitDialog();if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)&&!$$CM.isNumber(a.data)){cm.User.Bind(a.data);if(!$$CM.isNull(a.handler)&&!$$CM.isNull(a.handler.fn)){a.handler.fn.call(a.handler.scope,this,a.handler.arg);return}}else{var c=Number(a.data);switch(c){case 0:var b={title:"Session Expired",header:"The User Session has expired",message:"If you are an existing user in our system (or have already 'Saved for Later'), you may try your last action again by re-logging in using a second tab. Click on the following link <a target='_blank' href='/ui/forms/application/camper/App'>Re-Login</a> to open another tab in this browser. On that other tab, please re-login. If you are asked to update your security questions, please do so. Disregard the new application in the new tab and instead, return to this tab and try your last action again.<br>&nbsp;<br>If this fails, or you are a new user to our system, we are sorry but you will need to begin again. We suggest that you copy and paste the answers to your questions into a text editor to save them to try again. Once again, we are sorry for this inconvenience.",width:550};$$CMD.Alert(b);break;case 1:if(!$$CM.isNull(a.handler)&&!$$CM.isNull(a.handler.fn)){a.handler.fn.call(a.handler.scope,this,a.handler.arg);return}break;case 2:this._accountLoginSessionExpired.Bind(a.handler);this._accountLoginSessionExpiredDialog.Show();return;break}}this._submitLock=false},onAccountLoginSessionExpired_Login:function(c,a){this._accountLoginSessionExpiredDialog.Hide();var b=this._accountLoginSessionExpired.GetData();this._securityDAO.LoginCITUserV3(b.Email,b.Password,b.handler,false,true)},onCITUserLoggedIn:function(c,a){if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)){cm.User.Bind(a.data);if(!$$CM.isNull(a.handler)&&!$$CM.isNull(a.handler.fn)){a.handler.fn.call(a.handler.scope,this,a.handler.arg);return}}else{if(!$$CM.isNull(a.data.ErrorResponse)){var b={title:"Alert",header:a.data.ErrorResponse.Header,message:a.data.ErrorResponse.Message,width:400};$$CMD.Alert(b)}}this._submitLock=false},onAccountLoginSessionExpired_Close:function(b,a){this._accountLoginSessionExpiredDialog.Hide()},onAccountLoginSessionExpired_ResetAccount:function(c,a){this._accountLoginSessionExpiredDialog.Hide();var b=this._accountLoginSessionExpired.GetData();this._securityDAO.SendUserInviteCITUserV3(b.Email)},onUserInviteCITUserV3Sent:function(d,a){if(a.success==true){var b=this._accountLoginSessionExpired.GetData();var c={title:"Email sent",header:"",message:"An email has been sent to <strong>"+b.Email+"</strong>.<br />&nbsp;<br /><strong>Leave this page open!</strong><br />&nbsp;<br />Click on the link in that email to complete your password recovery process in another browser tab (OF THIS BROWSER). This will log you back in. If you are asked to update your security questions, please do so. Disregard the new application in that new tab and instead, return to this tab and try your last action again.<br />&nbsp;<br />Please check your JUNK/SPAM folder and note that password delivery may take up to 5 minutes.<br /><br />Make sure 'automation@campminder' is in your email White List.<br /><br />The password recovery link will expire in 1 hour."};$$CMD.AlertGo(c)}this._submitLock=false},onValidSubmit:function(g,a){var c={showProgress:false,message:"Please wait..."};$$CMD.ShowWaitDialog(c);var d=a.pageID;var b=this.GetData(d);var f=parseInt(b.SeasonID);var e=parseInt(b.PersonID);this.onPersonFormModified(g,{success:true,test:true,testData:b.Page7Data})},onPersonFormModified:function(p,a){$$CMD.HideWaitDialog();this._submitLock=false;if(a.test==true){if(!$$CM.isNull(a.testData)){alert($$CM.stringify(a.testData))}}if(this.isGoogleAnalyticsLoaded==true&&this.googlePageTracker){this.googlePageTracker._trackPageview("campminder/camper/application/submitted")}if(a.success==true&&$$CM.isObject(a.data)){var b=a.data;var n=b.SeasonID;var m=b.PersonID;var l=this.personFormGet({seasonID:n,personID:m});if(l.Complete==true){this._appSummary.Bind(l);this._paginator.Hide();this._appSummary.Show();this._paginator.GetHistoryManager().ToggleHash(this._appSummary.ID());this.ResetPaginator();var q=0;if($$CM.isNumber(l.FinalBalance)){q=l.FinalBalance;if($$CM.isNumber(l.PreviousBalance)){q=q-l.PreviousBalance}if(q<0){q=0}}var c=this._settings.GeneralSettings;if(!$$CM.isNull(c)){var d=c.GoogleAdWordsConversionID;var e=c.GoogleAdWordsLabel;if(!$$CM.isEmpty(d)){var f=$("iFrameGoogle").contentWindow;f.location.href="/v2/common/iFrameGoogle.aspx?GoogleConversion=true&GoogleValue="+q+"&GoogleAdWordsConversionID="+d+"&GoogleAdWordsLabel="+e}var r=c.YahooSearchMarketingAccountID;if(!$$CM.isEmpty(r)){var s=$("iFrameYahoo").contentWindow;s.location.href="/v2/common/iFrameYahoo.aspx?YahooValue="+q+"&YahooSearchMarketingAccountID="+r}var h=c.Microsoft_adCenterDomainID;if(!$$CM.isEmpty(h)){var i=$("iFrameMicrosoft").contentWindow;i.location.href="/v2/common/iFrameMicrosoft.aspx?Microsoft_adCenterDomainID="+h}if(!$$CM.isEmpty($$CLIENT.gtm)){var g=($$USER.ID==0)?1:0;var o=$("iFrameGoogleTagMgr").contentWindow;var k=b.UserPersonID;o.location.href="/v2/common/iFrameGoogleTagMgr.aspx?t="+$$CLIENT.gtm+"&c="+m+"&p="+k+"&v="+q+"&n="+g}}}else{if(!$$CM.isEmpty(l.ErrorMessage)){cm.ui.utilityControls.growlBanner.ShowBanner(l.ErrorMessage,2000,"jGrowlAlert");this._divLoading.Show();this._divWrapper.Hide()}else{cm.ui.utilityControls.growlBanner.ShowBanner("You have successfully saved for later",2000)}this.saveForLaterRedirect({personFormData:l})}}else{if(a.success==false&&(!$$CM.isNull(a.error)&&a.error.StandardExceptionCodeID==1)&&!$$CM.isNull(this._page6)){var j=this._page6.ID();this.ShowPage(j)}else{if(a.success==false&&(!$$CM.isNull(a.error)&&a.error.StandardExceptionCodeID==2)&&!$$CM.isNull(this._page2)){var j=this._page2.ID();this.ShowPage(j)}else{if(a.success==false||!$$CM.isObject(a.data)&&!$$CM.isEmpty(a.data)){this._paginator.Hide();this._appSummary.BindError(a.data);this._appSummary.Show();this.ResetPaginator()}}}}},saveForLaterRedirect:function(a){var c=a.personFormData;var e=c.SeasonID;var d=c.PersonID;var b={showProgress:false,message:"You have successfully saved for later. Redirecting to Session Selector. Please wait..."};$$CMD.ShowWaitDialog(b);if(!$$CM.isNull(this._page2)){this._saveForLaterInit={startPageID:this._page2.ID(),seasonID:e,personID:d,camperData:this._camperData,personFormData:c}}if($$USER.PersonID>0){this.getTokenizedTimestamp({refreshExpired:false})}else{this.getUserSession()}},getUserSession:function(){var a={};this._securityDAO.GetUserSession(a)},onUserSessionRetrieved:function(b,a){if(a.success==true&&$$CM.isNull(a.data.ErrorResponse)&&!$$CM.isNumber(a.data)){cm.User.Bind(a.data);this.getTokenizedTimestamp({refreshExpired:false});this._securityDAO.TokenizedUserFetch(10080)}},onLoggedIn:function(c,a){var b=c;this._page0.Hide();this._divLoading.Show();$$CMD.HideWaitDialog();this.postInitialize()},showInstructions:function(){if(this._showInstructionsAtStart){if(this._userTypeFlag.CompareById($$USER.UserTypeFlag,0,0)!=true&&this._userTypeFlag.CompareById($$USER.UserTypeFlag,4,0)!=true){this.onInstructionsClicked();this._showInstructionsAtStart=false}}},onInstructionsClicked:function(d,a){var c=this.GetSettings();var b=((!$$CM.isNull(this._entityLabelSettings)&&!$$CM.isNull(this._entityLabelSettings.EntityLabelInstitution))?this._entityLabelSettings.EntityLabelInstitution:"camp");dialogCO=this.BuildInstructionsDialog(c,"Use the <strong>Continue</strong> and <strong>Back</strong> buttons on each page to navigate through this online form.","camperAppInstructions",b);$$CMD.Alert(dialogCO)},GetSeasonID:function(){return this._seasonID},GetSettings:function(){if($$CM.isNull(this._settings)){this._settings=new Object()}return this._settings},onDataUpdated:function(){var c=this.GetBoundData();var e="";if(!$$CM.isNull(c)){if(!$$CM.isNull(this._paginator)){var d=this._paginator.GetPageArray();d.each(function(g){if($$CM.isFunction(g.ClearLocalData)){g.ClearLocalData()}g.Bind(c)},this);if(!$$CM.isNull(this._page7)){var a=2000;this._page7.BindCancellationInsuranceAmountToBeInsured(a);if(this._page7.CancellationInsuranceIsApplicable()){var b=$$CADU.GetCustomCreditCardArray($$USER.PersonID,"CancellationCreditCardArray");this._page7.BindCancellationCreditCardSelector({PersonID:$$USER.PersonID,CreditCardArray:b});var f=$A();f.push({ProviderPlanID:100,Amount:95});f.push({ProviderPlanID:101,Amount:153});this._page7.BindCancellationInsuranceData(f)}}}}else{}this.ShowPage(e);this._submitLock=false},GetData:function(d){var c=this.GetBoundData();if($$CM.isNull(c)){c=new Object()}c.FormID=this._formID;c.SeasonID=this._seasonID;c.PayInFullKey=this._payInFullKey;c.TokenizedUserString=cm.dao.Base.Data.TokenizedUserString;c.HoldGroupToken=this._holdGroupToken;c.FinancialCalculatorHash=this._financialCalculatorHash;var a=true;c.SaveForLaterPageNameID=0;if(!$$CM.isEmpty(d)){a=false;c.SaveForLaterPageNameID=this._pageNameEnum.GetId(d);if(!$$CM.isInteger(c.SaveForLaterPageNameID)&&d.indexOf("CustomFields")>=0){c.SaveForLaterPageNameID=this._pageNameEnum.GetId("CustomFields")}}c.Complete=a;c.TokenizedTimestamp=this._tokenizedTimestamp;if(this._page1Applicable==true){c.Page1Data=this._page1.GetData();if(d==this._page1.ID()){return c}}if(this._page2Applicable==true&&this._page2.Visible==true){c.Page2Data=this._page2.GetData();if(this._settings.PricingIdentifierApplicable==true&&this._settings.EnablePricingIdentifierOnSessionSelector!=true){c.Page2Data.PricingIdentifierID=this._camperData.PricingIdentifierID}if(d==this._page2.ID()){return c}}if(this._page3Applicable==true&&this._page3.Visible==true){c.Page3Data=this._page3.GetData();if(d==this._page3.ID()){return c}}if(this._page4Applicable==true&&this._page4.Visible==true){c.Page4Data=this._page4.GetData();if(d==this._page4.ID()){return c}}if(this._page5Applicable==true&&this._page5.Visible==true){c.Page5Data=this._page5.GetData();if(d==this._page5.ID()){return c}}if($$CM.isNull(c.PageCustomFormData)){c.PageCustomFormData=new Object()}if(!$$CM.isArray(c.PageCustomFormData.CustomFieldDataArray)){c.PageCustomFormData.CustomFieldDataArray=$A()}if(!$$CM.isNull(this._ctrCustomFormPaginationWrapper)){var b=this._ctrCustomFormPaginationWrapper.GetData();c.PageCustomFormData.CustomFieldDataArray=b;if(!$$CM.isEmpty(d)&&d.indexOf("CustomFields")>-1){return c}}if(this._page6Applicable==true&&this._page6.Visible==true){c.Page6Data=this._page6.GetData();if(d==this._page6.ID()){return c}}if(this._page7Applicable==true&&this._page7.Visible==true){c.Page7Data=this._page7.GetData();if(d==this._page7.ID()){return c}}return c},onMaintenanceMessage_received:function(c,a){if(a.success==true&&!$$CM.isUndefinedOrNull(a)&&!$$CM.isUndefinedOrNull(a.data)){var b=$$P.div("cmMaintenance");b.AddClassName("cmMaintenance cmClear");b.AddChild($$P.h3(null,"System Maintenance"));b.AddChild($$P.div(null,a.data));this.Parent.AddChild(b,$$E(this))}}});"cm.ui.forms.application.camper".namespace();cm.ui.forms.application.camper.TestPage7ConfigOptions=Class.create(cm.ui.pagination.PaginatorPageConfigOptions,{settings:new Object(),seasonID:0,existingStatus:0});cm.ui.forms.application.camper.TestPage7=Class.create(cm.ui.pagination.PaginatorPage,{configureDefaultOptions:function(){return new cm.ui.forms.application.camper.TestPage7ConfigOptions()},initializeData:function($super){$super();this._co=this.GetConfigOptions();if(!$$CM.isEmpty(this._co.uniqueID)){this._uniqueID=this._co.uniqueID}else{this._uniqueID=$$CM.uniqueID()}this._settings=this._co.settings;this._seasonID=this._co.seasonID;this._existingStatus=this._co.existingStatus;this._enumPaymentMethodTypeFlag=cm.dao.Financial.Enums.PaymentMethodTypeFlagStringValue.asEnum();this._enumCreditCardGatewayType=FW.Enums.Financial.CreditCardGatewayType;this._enumCreditCardGatewayCategory=FW.Enums.Financial.CreditCardGatewayCategory;this._enumCreditCardCategory=FW.Enums.Financial.CreditCardCategory;this._enumCreditCardType=FW.Enums.Financial.CreditCardTypeAbbreviated;this._enumPaymentMethodType=FW.Enums.Financial.PaymentMethodTypeFlagStringValue;if(!$$CM.isNull(this._settings)){this._pageHeaderMessage=this._settings.TermsAndConditionsPageHeaderMessage;this._pageHeaderMessageCssClass=this._settings.TermsAndConditionsPageHeaderMessageCssClass;this._backgroundCheckShowFlag=(this._settings.BackgroundCheckShowFlag&this._existingStatus)==this._existingStatus;this._referApplicationShowFlag=(this._settings.ReferApplicationShowFlag&this._existingStatus)==this._existingStatus;this._cancellationInsuranceLabel="Program Protection";this._cancellationInsuranceHeaderMessage=this._settings.CancellationInsuranceHeaderMessage;this._cancellationInsuranceHeaderMessageCssClass=this._settings.CancellationInsuranceHeaderMessageCssClass;this._cancellationInsuranceProviderPlanIDArray=$A();if($$CM.isArray(this._settings.CancellationInsurancePlanIDsEnabled)){this._cancellationInsuranceProviderPlanIDArray=this._settings.CancellationInsurancePlanIDsEnabled}this._termsAndConditionsLabel=this._settings.TermsAndConditionsLabel;this._termsAndConditionsText=this._settings.TermsAndConditionsText;this._signatureConfirmationText=this._settings.SignatureConfirmationText}this._creditCardTypeArray=FW.Enums.CreditCardType.GetArrayWithout(0);this._creditCardTypeIDArray=$A();if($$CM.isArray(this._creditCardTypeArray)){this._creditCardTypeArray.each(function(a){this._creditCardTypeIDArray.push(a.ID)},this)}},initializeUIElements:function(){var a={legendLabel:"<h4>"+this._cancellationInsuranceLabel+"</h4>",legendLabelCssClass:"cmSectionHeader mb0px",headerMessage:this._cancellationInsuranceHeaderMessage,headerMessageCssClass:this._cancellationInsuranceHeaderMessageCssClass,providerPlanIDArray:this._cancellationInsuranceProviderPlanIDArray,ccDisable:false,ccDisableText:"",ccObjectID:0,ccVaultType:1,ccLegendLabel:"<h5 class='fs16px'>Program Protection Credit Card(s)</h5>",ccLegendCssClass:"w100prct mb0px",ccCreditCardGatewayTypeID:this._enumCreditCardGatewayType.GetId("Camp"),ccCreditCardGatewayCategoryID:this._enumCreditCardGatewayCategory.GetId("CancellationIns"),ccCreditCardCategoryID:this._enumCreditCardCategory.GetId("Individual"),ccCreditCardTypeIDArray:this._creditCardTypeIDArray};this._ctrCancellationInsuranceWidget=new cm.ui.forms.cancellationInsurance.CancellationInsuranceWidget("ctrCancellationInsuranceWidget_"+this._uniqueID,a);this.AddChild(this._ctrCancellationInsuranceWidget);this._ctrCancellationInsuranceWidget.ToggleApplicability();if(!$$CM.isEmpty(this._pageHeaderMessage)){this._ctrPageHeaderMessage=new cm.ui.forms.SectionMessage("divPageHeaderMessage_"+this._uniqueID,{message:this._pageHeaderMessage,cssClass:"cmClear mt15px mb0px"});this.AddChild(this._ctrPageHeaderMessage);if(!$$CM.isEmpty(this._pageHeaderMessageCssClass)){this._ctrPageHeaderMessage.AddClassName(this._pageHeaderMessageCssClass)}}this._fsWrapper=new $$FS("fsWrapper_"+this._uniqueID,{legendLabel:"<h4>"+this._termsAndConditionsLabel+"</h4>",legendCssClass:"cmSectionHeader mb0px"});this.AddChild(this._fsWrapper);this._fsWrapper.AddClassName("pt10px");this._divTermsAndConditions=$$P.div("divTermsAndConditions_"+this._uniqueID);this._fsWrapper.AddChild(this._divTermsAndConditions);this._divTermsAndConditions.AddClassName("cmTermsAndConditions w510px h200px");if(!$$CM.isEmpty(this._termsAndConditionsText)){this._divTermsAndConditions.UpdateInnerHtml(this._termsAndConditionsText)}this._divTermsAndConditionsAgreement=$$P.div("divTermsAndConditionsAgreement_"+this._uniqueID);this._fsWrapper.AddChild(this._divTermsAndConditionsAgreement);this._divTermsAndConditionsAgreement.AddClassName("cmFormRow mb10px");var c="By entering my electronic signature below, I affirm that I have read and agree to the terms and conditions in this application.";if(!$$CM.isEmpty(this._signatureConfirmationText)){c=this._signatureConfirmationText}this._fcbTermsAndConditionsAgreement=new $$FCB("fcbTermsAndConditionsAgreement_"+this._uniqueID,{name:"Terms & Conditions Agreement",label:c,isRequired:true});this._divTermsAndConditionsAgreement.AddChild(this._fcbTermsAndConditionsAgreement);this._fcbTermsAndConditionsAgreement.AddClassName("cmBool w520px");this._fcbTermsAndConditionsAgreement.GetTitleControl().RemoveClassName("cmCheckboxTitleBase");this._fcbTermsAndConditionsAgreement.GetTitleControl().AddClassName("cmBold w500px");this._fcbTermsAndConditionsAgreement.Validator.addEvaluator($$EVAL.BOOL({IsRequired:true,RequireValue:true}));this._divSignature=$$P.div("divSignature_"+this._uniqueID);this._fsWrapper.AddChild(this._divSignature);this._divSignature.AddClassName("cmFormRow mtb10");this._ftxtSignature=new $$FTXT("ftxtSignature_"+this._uniqueID,{label:"Signature",isRequired:true});this._divSignature.AddChild(this._ftxtSignature);this._ftxtSignature.AddClassName("w80prct");this._ftxtSignature.GetInputControl().AddClassName("w200px");this._ftxtSignature.Validator.addEvaluator($$EVAL.TEXT({FieldName:"Signature",IsRequired:true}));this._ftxtSignatureDate=new $$FTXT("ftxtSignatureDate_"+this._uniqueID,{label:"",isRequired:true});this._divSignature.AddChild(this._ftxtSignatureDate);this._ftxtSignatureDate.AddClassName("w20prct");this._ftxtSignatureDate.GetInputControl().AddClassName("w100px");$$E(this._ftxtSignatureDate.GetInputControl()).disabled=true;this._ftxtSignatureDate.Validator.addEvaluator($$EVAL.DATE({FieldName:"Signature Date",IsRequired:true}));var b=new $$CMDATE();b.bindFromDate(new Date());var d=b.getFormattedDate(false,true,false,false,false);this._ftxtSignatureDate.Bind(d)},wireEvents:function($super){$super()},BindCancellationCreditCardSelector:function(a){if(!$$CM.isNull(a)){this._ctrCancellationInsuranceWidget.BindCreditCardSelector(a.PersonID,a.CreditCardArray)}},BindCancellationInsuranceAmountToBeInsured:function(a){this._ctrCancellationInsuranceWidget.BindAmountToBeInsured(a)},BindCancellationInsuranceData:function(a){this._ctrCancellationInsuranceWidget.Bind(a)},CancellationInsuranceToggleApplicability:function(){this._ctrCancellationInsuranceWidget.ToggleApplicability()},CancellationInsuranceIsApplicable:function(){return this._ctrCancellationInsuranceWidget.IsApplicable()},Validate:function(a){var b=this.Validator.validate();if(a==true){this.Validator.ShowErrors(b)}return b},IsValid:function(a){var b=this.Validate(a);return b.IsValid()},ClearFields:function(){this.Validator.Clear();this._fcbTermsAndConditionsAgreement.Bind(null);this._fcbTermsAndConditionsAgreement.Bind(true);this._ftxtSignature.Bind("Jah Hasangjekaj")},onDataUpdated:function(){this.ClearFields();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page7Data)){var c=a.Page7Data}var b=new $$CMDATE();b.bindFromDate(new Date());var d=b.getFormattedDate(false,true,false,false,false);this._ftxtSignatureDate.Bind(d)},ClearLocalData:function(){this._localData=null},GetLocalData:function(){var a=this._localData;if($$CM.isNull(a)){a=this.GetBoundData()}return a},GetData:function(){var d=new Object();var a=this.GetBoundData();if(!$$CM.isNull(a)&&!$$CM.isNull(a.Page7Data)){d=a.Page7Data}var b=this._ctrCancellationInsuranceWidget.GetData();d.CancellationInsuranceData=b;d.TermsAndConditionsAgreement=this._fcbTermsAndConditionsAgreement.GetData();if(this._backgroundCheckShowFlag==true){d.BackgroundCheckAgreement=this._fcbBackgroundCheckAgreement.GetData()}if(this._referApplicationShowFlag==true){d.ReferToOtherCamps=this._fcbReferToOtherCamps.GetData()}d.Signature=this._ftxtSignature.GetData();var c=new $$CMDATE();c.bindFromDate(new Date());d.SignatureDateAsString=c.getData();return d}});