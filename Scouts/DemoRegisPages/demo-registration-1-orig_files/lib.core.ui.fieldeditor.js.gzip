"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.FieldEditor=Class.create(cm.ui.Control,{_data:null,initializeData:function(){this._data=this.GetDataModel()},Bind:function(a){},GetData:function(){return this._data},GetDataModel:function(){return""},getMetaData:function(a){var b=this.GetConfigOptions().metaData;if(!$$CM.isNull(b)){var c=b[a];return b[a]}}});$$FE=function(data,meta){var fieldEditor;if($$CM.isNull(meta)){meta=new Object()}if(!$$CM.isNull(meta.fieldEditor)){fieldEditor=eval("new "+meta.fieldEditor+"(null, { metaData: meta })");fieldEditor.Bind(data)}else{if($$CM.isNull(data)){fieldEditor=new cm.ui.formControls.FormTextBox(null,{metaData:meta})}else{if($$CM.isBoolean(data)){fieldEditor=new cm.ui.formControls.FormCheckbox(null,{metaData:meta});fieldEditor.Bind(data)}else{if($$CM.isArray(data)){fieldEditor=new cm.ui.fieldeditor.ArrayFieldEditor(null,{metaData:meta});fieldEditor.Bind(data)}else{if($$CM.isObject(data)){if($$CM.isFunction(data.embed)){fieldEditor=new cm.ui.fieldeditor.ConfigOptionFieldEditor(null,{metaData:meta});fieldEditor.Bind(data)}}else{fieldEditor=new cm.ui.formControls.FormTextBox(null,{metaData:meta});fieldEditor.Bind(data);fieldEditor.GetData=function(){return($$CM.isNumber(this.GetValue())&&meta.forceString!=true)?parseFloat(this.GetValue()):this.GetValue()}}}}}}return fieldEditor};"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.ArrayFieldEditor=Class.create(cm.ui.fieldeditor.FieldEditor,{_table:null,_addCellBtn:null,Bind:function(a){if($$CM.isArray(a)){this._table.ClearChildControls();var b=0;a.each(function(d){var g=new $$FTXT();g.Bind(d);var f=$$P.tr();f.index=b;var e=$$P.td();e.index=b;var c=new $$BTN();c.index=b;c.Bind("-");c.ClickEvent.subscribe(this.onRemoveRowClicked,this);e.AddChild(c);f.AddChild(e);e=$$P.td();e.AddChild(g);f.AddChild(e);this._table.AddChild(f);b++},this)}},initializeUIElements:function(){this._addCellBtn=new $$BTN();this._addCellBtn.Bind("+");this._addCellBtn.ClickEvent.subscribe(this.onAddCellClicked,this);this.AddChild(this._addCellBtn);this._table=new $$TBL();this.AddChild(this._table)},GetDataModel:function(){return $A()},GetData:function(){var b=$A();this._table.ChildControls().each(function(a){b.push(a.ChildControls()[1].ChildControls()[0].GetData())},this);return b},onAddCellClicked:function(d,c){var b=this.GetData();b.push("");this.Bind(b)},onRemoveRowClicked:function(b,a){this.Bind(this.GetData().removeAt(b.index))}});"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.CustomFieldSelector=Class.create(cm.ui.fieldeditor.FieldEditor,{_ddl:null,GetData:function(){return this._ddl.GetData()},Bind:function(a){this._ddl.Bind(a)},getDataSource:function(){return this.getMetaData("__source").GetDataSource()},createEvents:function(){this.AddChangeListener()},initializeUIElements:function(){this._ddl=new $$FDDL();this._ddl.bindList(this.getList(),-1,"Select one");this._ddl.Validator.addEvaluator(new cm.validation.evaluator.DuplicateCustomFieldEvaluator({IsRequired:true,source:this.getMetaData("__source")}));this.AddChild(this._ddl)},getList:function(){var list=$A();this.getDataSource().each(function(x){if(eval(this.getMetaData("__source").GetConstraints())){list.push({ID:x.FieldID,Name:x.Name})}},this);return list}});"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.SelectFieldEditor=Class.create(cm.ui.fieldeditor.ArrayFieldEditor,{_nextIndex:0,Bind:function(a){if($$CM.isArray(a)){this._table.ClearChildControls();var b=0;a.each(function(d){var f=$$P.tr();f.index=b;var e=$$P.td();e.index=b;var c=new $$BTN();c.index=b;c.Bind("Del");c.AddClassName("cmBackButton");c.ClickEvent.subscribe(this.onRemoveRowClicked,this);e.AddChild(c);f.AddChild(e);txt=new $$FTXT();txt.Bind(d.Name);e=$$P.td();e.AddChild(txt);f.AddChild(e);this._table.AddChild(f);b++},this)}},initializeUIElements:function(){this._cfgButton=new $$BTN();this._cfgButton.Bind("Configure");this._cfgButton.ClickEvent.subscribe(this.onConfigureStart,this);this.AddChild(this._cfgButton);this._modal=new cm.ui.dialog.ModalDialog(null,{width:230,height:280});this.AddChild(this._modal);this._addCellBtn=new $$BTN();this._addCellBtn.Bind("Add Option...");this._addCellBtn.AddClassName("ml5px mt5px");this._addCellBtn.ClickEvent.subscribe(this.onAddCellClicked,this);this._modal.AddChild(this._addCellBtn);this._optDiv=$$P.div();this._optDiv.AddClassName("cmSelectFieldEditor cmBorderBox");this._modal.AddChild(this._optDiv);this._table=new $$TBL();this._optDiv.AddChild(this._table);this._cancelBtn=new $$BTN();this._cancelBtn.Bind("Cancel");this._cancelBtn.AddClassName("cmFloatLeft ml5px cmCancelDeleteButton");this._cancelBtn.ClickEvent.subscribe(this.onCancel,this);this._modal.AddChild(this._cancelBtn);this._saveBtn=new $$BTN();this._saveBtn.Bind("Save");this._saveBtn.AddClassName("cmFloatRight mr5px cmGoButton");this._saveBtn.ClickEvent.subscribe(this.onSave,this);this._modal.AddChild(this._saveBtn)},wireEvents:function(){this._cfgButton.ClickEvent.unsubscribeAll();this._cfgButton.ClickEvent.subscribe(this.onConfigureClicked,this)},GetData:function(){var b=$A();this._table.ChildControls().each(function(a){b.push({ID:a.ChildControls()[1].ChildControls()[0].GetData(),Name:a.ChildControls()[1].ChildControls()[0].GetData()})},this);return b},onAddCellClicked:function(d,c){var b=this.GetData();b.push({ID:"",Value:""});this.Bind(b);this._nextIndex++},onRemoveRowClicked:function(d,c){var b=this.GetData();this.Bind(b.removeAt(d.index))},onConfigureClicked:function(b,a){this._modal.Show()},onCancel:function(b,a){this._modal.Hide()},onSave:function(b,a){this._modal.Hide()}});"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.ConfigOptionFieldEditor=Class.create(cm.ui.fieldeditor.FieldEditor,{_options:null,_cfgEditor:null,initializeUIElements:function(){this._cfgEditor=new cm.ui.utilityControls.ConfigOptionEditor();this.AddChild(this._cfgEditor)},GetDataModel:function(){return new cm.ConfigOptions()},Bind:function(a){this._cfgEditor.Bind(this.getMetaData("__source"))},GetData:function(){return this._cfgEditor.GetData()}});"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.ListSelector=Class.create(cm.ui.fieldeditor.FieldEditor,{_ddl:null,initializeUIElements:function(){var a=$A();a=a.concat(this.getMetaData("params"));this._ddl=new $$FDDL();this._ddl.bindList(a,0);this.AddChild(this._ddl)},Bind:function(a){this._ddl.Bind(a)},GetData:function(){return this._ddl.GetData()},GetDataModel:function(){return $A()}});"cm.ui.fieldeditor".namespace();cm.ui.fieldeditor.RelationFieldEditor=Class.create(cm.ui.fieldeditor.FieldEditor,{_delBtn:null,_guidSelectionDDL:null,_conditionSelection:null,_valueDDL:null,_actionDDL:null,_isMulti:null,VALUE_FIELD_INDEX:3,DeleteClicked:null,render:function(){var a=$$P.tr();return $$E(a)},initializeUIElements:function(){var a;a=$$P.td();this._delBtn=new $$BTN();this._delBtn.Bind("DEL");a.AddChild(this._delBtn);this.AddChild(a);a=$$P.td();this._guidSelectionDDL=this.GetConfigOptions().__parent.makeGuidDDL();this._guidSelectionDDL.Validator.addEvaluator($$EVAL.SELECT({IsRequired:true}));a.AddChild(this._guidSelectionDDL);this.AddChild(a);a=$$P.td();this._conditionSelection=new $$FDDL(null,{name:"Condition",dataSource:this.GetConfigOptions().__parent.makeConditionList()});this._conditionSelection.Validator.addEvaluator($$EVAL.SELECT({IsRequired:true}));a.AddChild(this._conditionSelection);this.AddChild(a);a=$$P.td();this.AddChild(a);a=$$P.td();this._actionDDL=new $$FDDL(null,{name:"Action",dataSource:$$ACTION.GetList()});this._actionDDL.Validator.addEvaluator($$EVAL.SELECT({IsRequired:true}));a.AddChild(this._actionDDL);this.AddChild(a)},postInitialize:function(){this.updateConditionSelection()},createEvents:function(){this.DeleteClicked=new cm.event()},wireEvents:function(){this._guidSelectionDDL.ChangeEvent.subscribe(this.onGuidChanged,this);this._conditionSelection.ChangeEvent.subscribe(this.updateConditionSelection,this);this._delBtn.ClickEvent.subscribe(this.onDeleteClicked,this)},GetData:function(){var a=new cm.ui.viewport.relational.Relation();a.GUID=this._guidSelectionDDL.GetData();a.Conditions=this._conditionSelection.GetData();a.Value=this._valueDDL.GetData();a.Action=this._actionDDL.GetData();if(!$$CM.isArray(a.Value)&&$$CM.isNumber(a.Value)){a.Value=parseFloat(a.Value)}return a},Bind:function(a){this._guidSelectionDDL.Bind(a.GUID);this.onGuidChanged();this._conditionSelection.Bind(a.Conditions);this.updateConditionSelection();this._valueDDL.Bind(a.Value);this._actionDDL.Bind(a.Action)},SetMultiSelectMode:function(a){if(a==true){}},isMultiSelect:function(){return this._conditionSelection.GetData()==cm.dao.CustomForms.Enums.Conditions.asEnum().GetId("Is One Of")},onDeleteClicked:function(b,a){this.DeleteClicked.fire(this,a)},onGuidChanged:function(e,a){var c=this.GetConfigOptions().__parent.GetConstraints().GetConstraint(this._guidSelectionDDL.GetData());if(!$$CM.isNull(c)&&!$$CM.isNull(c.CustomFieldID)){var b=cm.dao.CustomForms.Data.CustomFields.find(function(f){return f.FieldID==c.CustomFieldID},this);if(!$$CM.isNull(b)&&b.IsArray==true){this._conditionSelection.bindList(this.getMultiSelectConditions())}else{this._conditionSelection.bindList(this.getSingleSelectConditions())}this._conditionSelection.Reset()}else{if(!$$CM.isNull(c.IsMulti)&&c.IsMulti==true){this._conditionSelection.bindList(this.getMultiSelectConditions())}else{if(!$$CM.isNull(c.IsMulti)&&c.IsMulti==false){this._conditionSelection.bindList(this.getSingleSelectConditions())}}}var d=this.GetConfigOptions().__parent.GetDatasource(this._guidSelectionDDL.GetData());this._valueDDL.bindList(d);this._valueDDL.Reset()},updateConditionSelection:function(){var a=this.ChildControls()[this.VALUE_FIELD_INDEX];if($$CM.isNull(this._isMulti)||this.isMultiSelect()!=this._isMulti){a.ClearChildControls();this._isMulti=this.isMultiSelect();if(this._isMulti==true){this._valueDDL=new $$FSCBL(null,{name:"Value",dataSource:this.GetConfigOptions().__parent.GetDatasource(this._guidSelectionDDL.GetData())});this._valueDDL.Validator.addEvaluator($$EVAL.GROUP({IsRequired:true}))}else{this._valueDDL=new $$FDDL(null,{name:"Value",dataSource:this.GetConfigOptions().__parent.GetDatasource(this._guidSelectionDDL.GetData())});this._valueDDL.Validator.addEvaluator($$EVAL.SELECT({IsRequired:true}))}a.AddChild(this._valueDDL)}},getMultiSelectConditions:function(){return this.getMultiNameArray(true)},getSingleSelectConditions:function(){return this.getMultiNameArray(false)},getMultiNameArray:function(c){var b=new cm.dao.CustomForms.DAO();var a=b.GetEnum("Conditions").GetArray();var d=$A(["Contains","Is One Of"]);var e=$A();a.each(function(f){if(d.indexOf(f.Name)>=0&&c==true){e.push(f)}else{if(d.indexOf(f.Name)<0&&c==false){e.push(f)}}},this);return e}});